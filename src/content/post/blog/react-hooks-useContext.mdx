---
title: useContextëŠ” ìƒíƒœê´€ë¦¬ë¥¼ ìœ„í•œ ë„êµ¬ê°€ ì•„ë‹™ë‹ˆë‹¤.
date: 2026-01-07
updatedDate: 2026-01-07
tags: [ë¦¬ì•¡íŠ¸, React, useContext, Hooks, ìƒíƒœê´€ë¦¬, State, Reducer]
category: DEVELOPMENT
image: "/images/react-hooks-useContext/thumbnail.webp"
---

# useContextëŠ” ìƒíƒœê´€ë¦¬ë¥¼ ìœ„í•œ ë„êµ¬ê°€ ì•„ë‹™ë‹ˆë‹¤.

`React Context`ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ì—ì„œ ëŒ€ë¶€ë¶„ì˜ ê°•ì˜ëŠ” `Props Drilling` ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ë°©ë²• ë˜ëŠ” **ìƒíƒœ ê´€ë¦¬**ë¥¼ í•˜ëŠ” ë„êµ¬ë¡œ ë§ì´ ì“°ì¸ë‹¤.

ì´ë²ˆ ê¸€ì€, React ContextëŠ” ë‹¨ìˆœíˆ Props Drillingê³¼ ê°™ì€ ìƒíƒœ ê´€ë¦¬ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ë„êµ¬ë¡œ ì“°ì´ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ëŠ” ê²ƒì„ ì„¤ëª…í•˜ë©°, **ì˜ì¡´ì„± ì£¼ì…ì„ ìœ„í•œ ë„êµ¬**ë¼ëŠ” ì ì„ ì¢€ ë” ê°•ì¡°í•˜ê³  ì‹¶ì€ ê¸€ì´ë‹¤.

> ì‹¤ì œë¡œ Props Drillingì€ ì»´í¬ë„ŒíŠ¸ì˜ ìœ„ê³„ê´€ê³„ë¥¼ ì¡°ì •í•˜ê±°ë‚˜, ì»´í¬ë„ŒíŠ¸ë¥¼ í•©ì„±í•˜ì—¬ ëŒ€ë¶€ë¶„ì˜ ì¼€ì´ìŠ¤ëŠ” í•´ê²°í•  ìˆ˜ ìˆë‹¤.

---

## ContextëŠ” Props Drillingì„ í•´ê²°í•˜ê¸° ìœ„í•œ ë„êµ¬ê°€ ì•„ë‹ˆë‹¤

Reactì—ì„œ ì „ì—­ ìƒíƒœ, ìƒíƒœ ê´€ë¦¬, Context ì´ì•¼ê¸°ë¥¼ í•˜ë‹¤ ë³´ë©´ í•­ìƒ ì´ëŸ° ì§ˆë¬¸ì„ ë§ˆì£¼ì¹˜ê²Œ ëœë‹¤.

> "Contextë¡œ ë‹¤ í•´ê²°í•˜ë©´ ë˜ì§€ ì•Šë‚˜ìš”?"

ì´ ì§ˆë¬¸ì— ì œëŒ€ë¡œ ë‹µí•˜ë ¤ë©´, **ìš°ë¦¬ê°€ ë§í•˜ëŠ” 'ìƒíƒœ'ì™€ 'ìƒíƒœ ê´€ë¦¬'ê°€ ë¬´ì—‡ì¸ì§€**ë¶€í„° ëª…í™•íˆ í•´ì•¼ í•œë‹¤.

### ìƒíƒœ(State)ë€ ë¬´ì—‡ì¸ê°€?

ë¨¼ì €, ìƒíƒœì— ëŒ€í•œ ê°€ì¥ ë‹¨ìˆœí•˜ë©´ì„œë„ ì¤‘ìš”í•œ ì •ì˜ì— ëŒ€í•´ ì§šê³  ë„˜ì–´ê°€ê² ë‹¤.

> ìƒíƒœ(State): Applicationì˜ ë™ì‘ì„ ì„¤ëª…í•˜ëŠ” ë°ì´í„°

ë³´í†µ Applicationì„ ë§Œë“¤ ë•Œ ì•„ë˜ ê°™ì€ ë‚´ìš©ë“¤ì„ ìš°ë¦¬ëŠ” ìƒíƒœë¡œ ê´€ë¦¬í•œë‹¤.

1. ë¡œê·¸ì¸ ì—¬ë¶€
2. í¼ ì…ë ¥ê°’
3. ë‹¤í¬ ëª¨ë“œ
4. ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ ë°ì´í„° ë“±.

í•˜ì§€ë§Œ ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì ì€, "ìƒíƒœê°€ ìˆë‹¤"ì™€ "ìƒíƒœë¥¼ ê´€ë¦¬í•œë‹¤"ëŠ” ê²ƒì€ ë‹¤ë¥´ë‹¤ëŠ” ê²ƒì´ë‹¤.

### ìƒíƒœ ê´€ë¦¬(State Management)ë€ ë¬´ì—‡ì¸ê°€?

ìƒíƒœ ê´€ë¦¬ë€ ë‹¨ìˆœíˆ ê°’ì„ ë“¤ê³  ìˆëŠ” ê²ƒì´ ì•„ë‹ˆë‹¤.

> `ìƒíƒœ ê´€ë¦¬(State Management)`: ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìƒëª…ì£¼ê¸° ë™ì•ˆ ìƒíƒœê°€ ì–´ë–»ê²Œ ìƒì„±ë˜ê³ , ë³€ê²½ë˜ê³ , ì „íŒŒë˜ëŠ”ì§€ë¥¼ ë‹¤ë£¨ëŠ” ë°©ì‹

ì´ë¥¼ ì¡°ê¸ˆ ë” ê¸°ìˆ ì ìœ¼ë¡œ ì •ë¦¬í•˜ë©´, ìƒíƒœ ê´€ë¦¬ ë„êµ¬ê°€ ê°–ì¶°ì•¼ í•  ìµœì†Œ ìš”êµ¬ì‚¬í•­ì€ ë‹¤ìŒ 4ê°€ì§€ë‹¤.

```tsx
// 1. ì´ˆê¸° ê°’ì„ ì €ì¥í•œë‹¤
const [count, setCount] = useState(0);

// 2. í˜„ì¬ ê°’ì„ ì½ì„ ìˆ˜ ìˆë‹¤
console.log(count);

// 3. ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆë‹¤
setCount(1);

// 4. ê°’ì´ ë³€ê²½ë˜ì—ˆìŒì„ êµ¬ë…ìì—ê²Œ ì•Œë¦°ë‹¤ â†’ ì»´í¬ë„ŒíŠ¸ ë¦¬ë Œë”ë§
```

### Redux, Tanstack Query ì™€ ê°™ì€ ì „ì—­ ìƒíƒœ / ì„œë²„ ìƒíƒœ ê´€ë¦¬ ë„êµ¬ëŠ” ì™œ "ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬" ì¼ê¹Œ?

Zustand, Redux, Recoil, Tanstack Query, Apolloì™€ ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì€ ìœ„ì˜ **4ê°€ì§€ ìš”êµ¬ì‚¬í•­ì„ ëª¨ë‘ ì¶©ì¡±**í•œë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ Reduxë¥¼ ì˜ˆì‹œë¡œ í•œ ë²ˆ ë“¤ì–´ë³´ê² ë‹¤.

```tsx
// 1. ì´ˆê¸° ìƒíƒœ ì •ì˜ ê°€ëŠ¥
const store = createStore(reducer, { count: 0 });

// 2. ì–´ë””ì„œë“  ìƒíƒœ ì¡°íšŒ ê°€ëŠ¥
const count = useSelector((state) => state.count);

// 3. ëª…ì‹œì ì¸ ì—…ë°ì´íŠ¸ ë©”ì»¤ë‹ˆì¦˜ ì œê³µ
dispatch({ type: "INCREMENT" });

// 4. í•„ìš”í•œ ì»´í¬ë„ŒíŠ¸ë§Œ ì„ íƒì ìœ¼ë¡œ ë¦¬ë Œë”ë§
// useSelectorê°€ êµ¬ë…í•œ ê°’ë§Œ ë³€ê²½ ì‹œ ë¦¬ë Œë”ë§
```

ê·¸ë˜ì„œ ìš°ë¦¬ëŠ” ì´ë“¤ì„ "ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬"ë¼ê³  ë¶€ë¥¸ë‹¤.

### ê·¸ëŸ¼ React ContextëŠ” ìƒíƒœ ê´€ë¦¬ ë„êµ¬ì¼ê¹Œ?

ê²°ë¡ ë¶€í„° ë§í•˜ë©´, **React Context ìì²´ëŠ” ìƒíƒœ ê´€ë¦¬ ë„êµ¬ê°€ ì•„ë‹ˆë©°**, ì—…ë°ì´íŠ¸ ë©”ì»¤ë‹ˆì¦˜ì„ ì œê³µí•˜ì§€ ì•ŠëŠ”ë‹¤.

Context APIëŠ” ë³¸ì§ˆì ìœ¼ë¡œ ë‹¤ìŒ ì—­í• ë§Œ ìˆ˜í–‰í•œë‹¤.

1. ê°’ì„ íŠ¸ë¦¬ ì•„ë˜ë¡œ ì „ë‹¬í•œë‹¤.
2. ê°’ì„ ì½ì„ ìˆ˜ ìˆê²Œ í•œë‹¤.
3. ê°’ì´ ë°”ë€Œë©´ êµ¬ë… ì¤‘ì¸ ì»´í¬ë„ŒíŠ¸ë¥¼ ë¦¬ë Œë”ë§ í•œë‹¤.

```tsx
const ThemeContext = createContext<"light" | "dark">("light");
```

ContextëŠ” `ê°’ì˜ ì €ì¥ì†Œ(storage)`ê°€ ì•„ë‹ˆë¼ **ë Œë” íŠ¸ë¦¬ë¥¼ ë”°ë¼ ê°’ì„ ì „ë‹¬í•˜ëŠ” í†µë¡œ**ì— ê°€ê¹ë‹¤.

### Context ì‚¬ìš©í•  ë•Œ ê°’ ì—…ë°ì´íŠ¸ í•˜ì§€ ì•Šë‚˜?

ë§ë‹¤. ì‹¤ì œë¡œ ìš°ë¦¬ëŠ” ì´ëŸ° ì½”ë“œë¥¼ ì•„ì£¼ ë§ì´ ì“´ë‹¤.

```tsx
const ThemeContext = createContext<{
  theme: "light" | "dark";
  toggleTheme: () => void;
} | null>(null);

function ThemeProvider({ children }: PropsWithChildren) {
  const [theme, setTheme] = useState<"light" | "dark">("light");

  const toggleTheme = () =>
    setTheme((prev) => (prev === "light" ? "dark" : "light"));

  return (
    <ThemeContext.Provider value={{ theme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}
```

ì´ ì½”ë“œë¥¼ ë³´ë©´ ìì—°ìŠ¤ëŸ½ê²Œ "Contextë„ ì—…ë°ì´íŠ¸ ê¸°ëŠ¥ì´ ìˆëŠ” ê±° ì•„ë‹Œê°€?" ë¼ëŠ” ìƒê°ì´ ë“ ë‹¤.
í•˜ì§€ë§Œ ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì‚¬ì‹¤ì´ í•˜ë‚˜ ìˆë‹¤.

ìœ„ ì½”ë“œì—ì„œ **ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ì£¼ì²´ëŠ” Contextê°€ ì•„ë‹ˆë‹¤.**

```tsx
const [theme, setTheme] = useState<"light" | "dark">("light");
```

- [`useState`](/post/react-hooks-usestate) â†’ **ìƒíƒœ ìƒì„± + ì—…ë°ì´íŠ¸ ë©”ì»¤ë‹ˆì¦˜**
- `Context` â†’ **ê·¸ ê²°ê³¼ë¥¼ ì „ë‹¬í•˜ëŠ” ìˆ˜ë‹¨**

ì¦‰ êµ¬ì¡°ì ìœ¼ë¡œ ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤.

```text
[React State(useState / useReducer)]
          â†“
     Context Provider
          â†“
       Consumers
```

ContextëŠ” **ì—…ë°ì´íŠ¸ ê°€ëŠ¥í•œ ê°’ì„ "ì „ë‹¬"í•  ë¿**,
**ì—…ë°ì´íŠ¸ ë¡œì§ì„ ì§ì ‘ ì œê³µí•˜ì§€ ì•ŠëŠ”ë‹¤.**

### Contextì— ì €ì¥ëœ ê°’ì€ ì–´ë–»ê²Œ ë°”ë€ŒëŠ”ê°€?

Contextì— ì €ì¥ëœ ê°’ì„ ë³€ê²½í•˜ëŠ” **ìœ ì¼í•œ ë°©ë²•ì€ í•˜ë‚˜ë¿ì´ë‹¤.** Providerì— ìƒˆë¡œìš´ value propì„ ì „ë‹¬í•˜ëŠ” ê²ƒì´ë‹¤.

```tsx
<ThemeContext.Provider value={newValue}>
```

ê·¸ë ‡ë‹¤ë©´, value propsì— ê°’ì€ ì–´ë””ë¡œë¶€í„° ì˜¤ëŠ” ê±¸ê¹Œ?

```tsx
// 1. useState
const [theme, setTheme] = useState("light");

// 2. useReducer
const [state, dispatch] = useReducer(reducer, initialState);

// 3. class ì»´í¬ë„ŒíŠ¸ì˜ this.state
this.state = { theme: "light" };

// 4. ì™¸ë¶€ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬
const theme = useSelector((state) => state.theme);

// 5. ì˜ì†ì„± (ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°, ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ê°’ ë“±)
const theme = localStorage.getItem("theme");

// 6. ì™¸ë¶€ ì‹œìŠ¤í…œ (ì„œë²„ ì‘ë‹µ)
const { data: theme } = useQuery({ queryKey: ["theme"], queryFn: fetchTheme });
```

ì¦‰, **Context ìì²´ì—ì„œ ë§Œë“¤ì–´ì§€ëŠ” ê°’ì€ ì•„ë‹ˆë‹¤.**

---

## Contextì˜ êµ¬ì¡°ì  í•œê³„

ContextëŠ” **ì„ íƒì  êµ¬ë…ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤.**

ê°’ì´ ê°ì²´ì¼ ë•Œ ì¼ë¶€ ì†ì„±ë§Œ ë°”ë€Œì–´ë„ í•´ë‹¹ Contextë¥¼ êµ¬ë…í•˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ëœë‹¤.

```tsx
const value = { theme, user, locale };
```

ì´ ì¤‘ í•˜ë‚˜ë¼ë„ ë°”ë€Œë©´, í•´ë‹¹ Contextë¥¼ ì“°ëŠ” **ëª¨ë“  ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§**ëœë‹¤. ì´ íŠ¹ì„± ë•Œë¬¸ì— ë¹ˆë²ˆí•˜ê²Œ ë³€ê²½ë˜ëŠ” ìƒíƒœì—ëŠ” ì í•©í•˜ì§€ ì•Šë‹¤.

### ContextëŠ” ì–´ë–¤ ìš©ë„ì— ì í•©í•œê°€?

React ì½”ì–´ íŒ€ë„ Contextì˜ ìš©ë„ë¥¼ ëª…í™•íˆ í•œë‹¤:

- ì—…ë°ì´íŠ¸ ë¹ˆë„ê°€ ë‚®ì€ ê°’ (theme, locale)
- ì „ì—­ì ìœ¼ë¡œ ì½íˆëŠ” ê°’
- êµ¬ì¡°ì ìœ¼ë¡œ ì•ˆì •ì ì¸ ê°’

Flux ìŠ¤íƒ€ì¼ì˜ ìƒíƒœ ê´€ë¦¬ë¥¼ ëŒ€ì²´í•˜ëŠ” ìš©ë„ë¡œëŠ” ì„¤ê³„ë˜ì§€ ì•Šì•˜ë‹¤.

Props Drillingì´ Contextì˜ ìš©ë„ê°€ ì•„ë‹ˆë¼ë©´, Contextì˜ ìš©ë„ëŠ” ë¬´ì—‡ì¼ê¹Œ?

---

## Contextì˜ ì§„ì§œ ìš©ë„: ì˜ì¡´ì„± ì£¼ì…(Dependency Injection)

> [ì˜ì¡´ì„± ì£¼ì…(Dependency Injection)](/post/dependency-injection)ì€ ê°ì²´ê°€ í•„ìš”ë¡œ í•˜ëŠ” ì˜ì¡´ì„±ì„ **ì§ì ‘ ìƒì„±í•˜ì§€ ì•Šê³  ì™¸ë¶€ì—ì„œ ë°›ëŠ”** íŒ¨í„´ì´ë‹¤.

í”íˆ, ë¬´ì—‡ì¸ê°€ì— ì˜ì¡´í•œë‹¤ëŠ” ê²ƒì€ ìœ„í—˜ì„ ë‚˜íƒ€ë‚¸ë‹¤. ë§ì€ ê°œë°œ ì„œì ì„ ë³´ë”ë¼ë„ "ê²°í•©ë„(Coupling)ë¥¼ ë‚®ì¶”ê³  ì‘ì§‘ë„(Cohesion)ë¥¼ ë†’ì´ì" ë¼ëŠ” ë§ì„ ì‰½ê²Œ ë³¼ ìˆ˜ ìˆë‹¤.

ë‹¨, ì–´ëŠ ì •ë„ ê²°í•©ê³¼ ì˜ì¡´ì„±ì€ í•„ìš”í•˜ë‹¤, ë³´í†µ ì´ëŸ° ê²°í•©ë„ë¥¼ ë‚®ì¶”ê¸°ìœ„í•´ ì¶”ìƒí™”ë¥¼ ì‚¬ìš©í•œë‹¤.
í•˜ì§€ë§Œ, ì„œë¹„ìŠ¤ë¥¼ ì¶”ìƒí™” ë§Œìœ¼ë¡œ êµ¬ì¶•í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í•˜ë‹¤.

### ì˜ì¡´ì„± ì£¼ì…(DI)ë¥¼ ì ìš©í•˜ì§€ ì•Šì€ ê²½ìš°

```ts {2}
class PostRepository {
  private httpClient = new HttpClient(); // ì§ì ‘ ìƒì„± - ê°•ê²°í•©

  async getPosts() {
    return this.httpClient.get("/posts");
  }
}
```

ìœ„ì˜ ì½”ë“œëŠ” ë¬¸ì œì ì´ ìˆë‹¤.

1. í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ì™¸ë¶€ í™˜ê²½(ë„¤íŠ¸ì›Œí¬)ì— ê°•í•˜ê²Œ ì˜ì¡´í•œë‹¤.

`HttpClient`ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ë©´ í…ŒìŠ¤íŠ¸ê°€ ì‹¤ì œ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ê²Œ ëœë‹¤. ì´ë ‡ê²Œ ë˜ë©´ í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì™¸ë¶€ í™˜ê²½ì— ë”°ë¼ ë‹¬ë¼ì§„ë‹¤.

```ts
describe("PostRepository", () => {
  it("ê²Œì‹œê¸€ì„ ê°€ì ¸ì˜¨ë‹¤", async () => {
    const postRepository = new PostRepository();
    const posts = await postRepository.getPosts();

    // âŒ ì„œë²„ê°€ ì¥ì•  ë‚˜ë©´? â†’ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨
    // âŒ ì„œë²„ ì‘ë‹µì´ ëŠë¦¬ë©´? â†’ í…ŒìŠ¤íŠ¸ íƒ€ì„ì•„ì›ƒ
    // âŒ ì„œë²„ ë°ì´í„°ê°€ ë‹¬ë¼ì§€ë©´? â†’ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨
    expect(posts).toHaveLength(1);
  });
});
```

í…ŒìŠ¤íŠ¸ëŠ” ì–¸ì œ ì‹¤í–‰í•´ë„ ê°™ì€ ê²°ê³¼ê°€ ë‚˜ì™€ì•¼ í•˜ëŠ”ë°, ì™¸ë¶€ í™˜ê²½ì— ì˜ì¡´í•˜ë©´ ì‹œì‹œê°ê° ì„±ê³µ ì—¬ë¶€ê°€ ë‹¬ë¼ì§„ë‹¤.

2. ì´ë¥¼ í•´ê²°í•˜ë ¤ë©´ ëª¨ë“ˆ mockì´ í•„ìš”í•˜ì§€ë§Œ ì„¤ì •ì´ ê¹Œë‹¤ë¡­ë‹¤.

ì™¸ë¶€ í™˜ê²½ ì˜ì¡´ì„±ì„ ëŠê¸° ìœ„í•´ `vi.mock`ìœ¼ë¡œ ëª¨ë“ˆ ìì²´ë¥¼ mockí•´ì•¼ í•œë‹¤.

```ts
import { describe, it, expect, vi, beforeEach } from "vitest";

const mockGet = vi.fn();

vi.mock("../HttpClient", () => ({
  HttpClient: vi.fn(() => ({ get: mockGet })),
}));

beforeEach(() => vi.clearAllMocks());

describe("PostRepository", () => {
  it("ê²Œì‹œê¸€ì„ ê°€ì ¸ì˜¨ë‹¤", async () => {
    mockGet.mockResolvedValueOnce([{ id: 1, title: "í…ŒìŠ¤íŠ¸" }]);
    const postRepository = new PostRepository();
    const posts = await postRepository.getPosts();
    expect(posts).toHaveLength(1);
  });
});
```

ëª¨ë“ˆ mock ì„¤ì •ì´ ë³µì¡í•˜ê³ , `beforeEach`ë¡œ mockì„ ë¦¬ì…‹í•´ì•¼ í…ŒìŠ¤íŠ¸ ê°„ ì˜í–¥ì„ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.

2. `HttpClient` êµ¬í˜„ì²´ê°€ ë³€ê²½ë˜ë©´, `PostRepository`ë„ ë³€ê²½ë˜ì–´ì•¼ í•œë‹¤.

```ts
// âŒ êµ¬í˜„ì²´ ë³€ê²½ ì‹œ í´ë˜ìŠ¤ ë‚´ë¶€ë¥¼ ì§ì ‘ ìˆ˜ì •í•´ì•¼ í•¨
class PostRepository {
  // fetch â†’ axiosë¡œ ë°”ê¾¸ë ¤ë©´ ì´ ì¤„ì„ ìˆ˜ì •í•´ì•¼ í•œë‹¤
  private httpClient = new FetchHttpClient();
  // private httpClient = new AxiosHttpClient();
}
```

`PostRepository`ê°€ êµ¬ì²´ì ì¸ `HttpClient` êµ¬í˜„ì²´ì— ì˜ì¡´í•˜ê¸°ì—, êµ¬í˜„ì²´ë¥¼ ë°”ê¿€ ë•Œë§ˆë‹¤ `PostRepository` ì½”ë“œë¥¼ ìˆ˜ì •í•´ì•¼ í•œë‹¤. ì—¬ëŸ¬ ê³³ì—ì„œ `HttpClient`ë¥¼ ì§ì ‘ ìƒì„±í•˜ë©´ ëª¨ë“  ê³³ì„ ìˆ˜ì •í•´ì•¼ í•œë‹¤.

### ì˜ì¡´ì„± ì£¼ì…(DI)ë¥¼ ì ìš©í•œ ê²½ìš°

ì´ëŸ¬í•œ ë¬¸ì œë¥¼ ì˜ì¡´ì„± ì£¼ì…(DI)ì„ í†µí•´ í•´ê²°í•  ìˆ˜ ìˆë‹¤. ì˜ì¡´ì„± ì£¼ì…ì˜ ê°€ì¥ í° ì¥ì ì€ í…ŒìŠ¤íŠ¸ê°€ ê°„ë‹¨í•´ì§„ë‹¤ëŠ” ê²ƒì´ë‹¤. import mock ì—†ì´ ê°€ì§œ ê°ì²´ë¥¼ ì§ì ‘ ì£¼ì…í•  ìˆ˜ ìˆë‹¤.

```ts {5,13}
// âœ… DI ì ìš© - ê°„ë‹¨í•œ ê°€ì§œ ê°ì²´ ì£¼ì…
import { describe, it, expect, vi } from "vitest";

interface HttpClient {
  get<T>(url: string): Promise<T>;
}

class PostRepository {
  constructor(private httpClient: HttpClient) {}

  async getPosts() {
    return this.httpClient.get("/posts");
  }
}

describe("PostRepository (DI ì ìš©)", () => {
  it("ê²Œì‹œê¸€ì„ ê°€ì ¸ì˜¨ë‹¤", async () => {
    const mockHttp: HttpClient = {
      get: vi.fn().mockResolvedValueOnce([{ id: 1, title: "í…ŒìŠ¤íŠ¸" }]),
    };

    const postRepository = new PostRepository(mockHttp);
    const posts = await postRepository.getPosts();

    expect(posts).toHaveLength(1);
    expect(mockHttp.get).toHaveBeenCalledWith("/posts");
  });
});
```

`Repository`ê°€ ìì‹ ì˜ ì—­í• ì¸ "ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒ"ì—ë§Œ ì§‘ì¤‘í•¨ìœ¼ë¡œì„œ, ì½”ë“œ ìì²´ê°€ ë” ëª…í™•í•´ì§„ë‹¤.
ê·¸ë¦¬ê³ , `Repository`ê°€ íŠ¹ì • `HttpClient` êµ¬í˜„ì²´ì— ì˜ì¡´í•˜ì§€ ì•Šê¸°ì—, êµ¬í˜„ì²´ ë³€ê²½ ì‹œì—ë„ `Repository` ì½”ë“œë¥¼ ìˆ˜ì •í•  í•„ìš”ê°€ ì—†ë‹¤.

ê·¸ë˜ì„œ ìš°ë¦¬ëŠ” ì†ì‰½ê²Œ ë„¤íŠ¸ì›Œí¬ê°€ í•„ìš”í•  ë–„, ë„¤íŠ¸ì›Œí¬ì— ì˜ì¡´í•  ìˆ˜ ìˆê³ , ë˜ í…ŒìŠ¤íŠ¸ í™˜ê²½ì¼ë•ŒëŠ” Stubì´ë‚˜ Mockì— ì˜ì¡´í•  ìˆ˜ ìˆë‹¤.

í•œë²ˆ, `HttpClient`ë¥¼ ì˜ˆì‹œë¡œ ë³´ì, ì‹¤ì œë¡œ ì¿ í‚¤ ê¸°ë°˜ìœ¼ë¡œ ì¸ì¦ì„ êµ¬í˜„í•œ ê²½ìš° ì›¹ í™˜ê²½ì—ì„œëŠ” ë³´ì•ˆìƒì˜ ì´ìœ ë¡œ `HTTPClient`ê°€ ë‹¨ìˆœíˆ credentials ì˜µì…˜ì„ ì¼œì£¼ëŠ” ê²ƒìœ¼ë¡œë§Œ ëë‚˜ì§€ ì•ŠëŠ”ë‹¤.

ëŒ€í‘œì ì¸ ì˜ˆì‹œê°€ [CSRF(Cross-Site Request Forgery)](/post/security-csrf) ëŒ€ì‘ì´ë‹¤.

ë¸Œë¼ìš°ì € ê¸°ë°˜ Applicationì—ì„œ ì¿ í‚¤ ê¸°ë°˜ ì¸ì¦ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ë¸Œë¼ìš°ì €ëŠ” ìš”ì²­ ì‹œ ì¿ í‚¤ë¥¼ ìë™ìœ¼ë¡œ í¬í•¨í•œë‹¤. ì´ íŠ¹ì„± ë•Œë¬¸ì— ì„œë²„ëŠ” "ì´ ìš”ì²­ì´ ì •ë§ ìš°ë¦¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì˜ë„ì ìœ¼ë¡œ ë°œìƒí•œ ê²ƒì¸ì§€"ë¥¼ ì¶”ê°€ë¡œ ê²€ì¦í•´ì•¼í•œë‹¤. ì´ ë•Œ í”íˆ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì´ CSRF í† í°ì„ ì»¤ìŠ¤í…€ HTTP í—¤ë”ë¡œ ì „ë‹¬í•˜ëŠ” ê²ƒì´ë‹¤.

ì´ëŸ° ê²½ìš°ì—ë„ Repository ë ˆì´ì–´ê°€ ì§ì ‘ CSRFë¥¼ ë‹¤ë£¨ê¸°ë³´ë‹¤ëŠ”, HTTPClientë¥¼ ì¸ìŠ¤í„´ìŠ¤í™”í•˜ëŠ” ì‹œì ì— ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸ë¥¼ êµ¬ì„±í•˜ëŠ” ê²ƒì´ ë” ìì—°ìŠ¤ëŸ½ë‹¤.

```ts
const client = new HttpClient();

client.setDefaultHeaders({
  "X-CSRF-Token": csrfToken,
});

const postRepository = new PostRepository(client);
```

ì´ë ‡ê²Œ êµ¬ì„±í•˜ë©´, PostRepositoryëŠ”

1. CSRF í† í°ì´ í•„ìš”í•œì§€ ì—¬ë¶€ë¥¼ ì•Œ í•„ìš”ê°€ ì—†ê³ ,
2. ì¿ í‚¤ ê¸°ë°˜ ì¸ì¦ì¸ì§€ í† í° ê¸°ë°˜ ì¸ì¦ì¸ì§€ë„ ëª¨ë¥´ë©°,
3. ë‹¨ì§€ "ë³´í˜¸ëœ HttpClient"ë¥¼ í†µí•´ ìš”ì²­ì„ ë³´ë‚¼ ë¿ì´ë‹¤.

ë˜í•œ ì´ëŸ° êµ¬ì¡°ëŠ” `A/B í…ŒìŠ¤íŠ¸(ë˜ëŠ” ì ì§„ì  ë¡¤ì•„ì›ƒ)`ë¥¼ ìˆ˜í–‰í•  ë•Œë„ íš¨ìœ¨ì ì¼ ìˆ˜ ìˆë‹¤.
A/B í…ŒìŠ¤íŠ¸ì˜ í•µì‹¬ì€ â€œë„ë©”ì¸ ë¡œì§ì„ ê±´ë“œë¦¬ì§€ ì•Šê³ â€ íŠ¹ì • ì‚¬ìš©ì ê·¸ë£¹ì—ê²Œë§Œ ìƒˆë¡œìš´ êµ¬í˜„ì„ ì ìš©í•´ ë³´ê³ , ë¬¸ì œê°€ ìˆìœ¼ë©´ ë¹ ë¥´ê²Œ ë˜ëŒë¦´ ìˆ˜ ìˆì–´ì•¼ í•œë‹¤ëŠ” ì ì´ë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ë² íƒ€ ì‚¬ìš©ìì—ê²Œë§Œ ì‹ ê·œ API ê²½ë¡œë¥¼ ì ìš©í•˜ê±°ë‚˜, ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜/ìºì‹œ ì •ì±…/ìƒˆ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì ìš©í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ ìˆì„ ìˆ˜ ìˆë‹¤. ì´ë•Œë„ `Repository`ë‚˜ `Service` ì½”ë“œì— `if (isBetaUser) ...` ê°™ì€ ì¡°ê±´ ë¶„ê¸°ë¥¼ í©ë¿Œë¦¬ëŠ” ëŒ€ì‹ , ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ `Repository` êµ¬í˜„ì²´ë¥¼ ê°ˆì•„ë¼ìš°ëŠ” ë°©ì‹ì´ í›¨ì”¬ ìì—°ìŠ¤ëŸ½ë‹¤.

```ts
interface PostRepository {
  getPosts(): Promise<Post[]>;
}

class PostRepositoryImpl implements PostRepository {
  // ê¸°ì¡´ êµ¬í˜„
}

class BetaPostRepositoryImpl implements PostRepository {
  // ë² íƒ€ ì‚¬ìš©ììš© ì‹ ê·œ êµ¬í˜„
}
```

ê·¸ë¦¬ê³  ì–´ë–¤ Repositoryë¥¼ ì“¸ì§€ëŠ” ì¡°ë¦½(Composition) ë‹¨ê³„ì—ì„œ ê²°ì •í•œë‹¤.

```ts
const client = new HttpClient();
client.setDefaultHeaders({
  "X-CSRF-Token": csrfToken,
});

const postRepository: PostRepository = checkIsBetaUser()
  ? new BetaPostRepositoryImpl(client)
  : new PostRepositoryImpl(client);
```

ì´ë ‡ê²Œ í•˜ë©´ RepositoryëŠ”

1. ìì‹ ì´ Aêµ°ì¸ì§€ Bêµ°ì¸ì§€ ì•Œ í•„ìš”ê°€ ì—†ê³ ,
2. ì‹¤í—˜ ë¶„ê¸° ë¡œì§ì´ ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œì— ì¹¨íˆ¬í•˜ì§€ ì•Šìœ¼ë©°
3. ì‹¤íŒ¨ ì‹œì—ë„ ì¡°ë¦½ ì§€ì ì—ì„œ êµ¬í˜„ì²´ë§Œ ë˜ëŒë¦¬ë©´ ë¡¤ë°±ì´ ê°€ëŠ¥í•˜ë‹¤.

ê²°êµ­ í•µì‹¬ì€, `CSRF`ë‚˜ `A/B í…ŒìŠ¤íŠ¸` ê°™ì€ `íš¡ë‹¨ ê´€ì‹¬ì‚¬(cross-cutting-concerns)`ë¥¼ Repositoryê°€ ì±…ì„ì§€ì§€ ì•Šë„ë¡ ì„¤ê³„ë¥¼ ì¡ëŠ” ê²ƒì´ë‹¤.

RepositoryëŠ” "ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ê°€ì ¸ì˜¤ëŠ”ê°€"ì—ë§Œ ì§‘ì¤‘í•˜ê³ , ì¸ì¦/ë³´ì•ˆ/ì‹¤í—˜/ê´€ì¸¡ ê°™ì€ ë§¥ë½ì€ HttpClient êµ¬ì„± í˜¹ì€ ì¡°ë¦½ ë‹¨ê³„ì—ì„œ ê²°ì •ë˜ë„ë¡ ë¶„ë¦¬í•˜ëŠ” í¸ì´ ìœ ì§€ë³´ìˆ˜ì™€ í™•ì¥ì— ìœ ë¦¬í•˜ë‹¤.

---

## Repositoryì™€ Service, ê°ìì˜ ì—­í• 

ì•ì„œ Repositoryê°€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì—­í• ì— ì§‘ì¤‘í•œë‹¤ê³  í–ˆë‹¤. ê·¸ëŸ°ë° ì‹¤ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒë§Œìœ¼ë¡œ ëë‚˜ì§€ ì•ŠëŠ”ë‹¤. ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ê°€ê³µí•˜ê±°ë‚˜, ì—¬ëŸ¬ ë°ì´í„°ë¥¼ ì¡°í•©í•˜ê±°ë‚˜, ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ ì ìš©í•´ì•¼ í•  ë•Œê°€ ìˆë‹¤.

ì´ë•Œ Service ë ˆì´ì–´ê°€ ë“±ì¥í•œë‹¤.

### Repository: ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ

RepositoryëŠ” "ì–´ë””ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ê°€"ì— ì§‘ì¤‘í•œë‹¤.

ì°½ê³  ê´€ë¦¬ì¸ì„ ë– ì˜¬ë ¤ ë³´ì. ì°½ê³  ê´€ë¦¬ì¸ì€ ë¬¼ê±´ì´ ì–´ë”” ìˆëŠ”ì§€ ì•Œê³ , ìš”ì²­ë°›ì€ ë¬¼ê±´ì„ êº¼ë‚´ì˜¤ëŠ” ì—­í• ë§Œ í•œë‹¤. ë¬¼ê±´ì„ ì–´ë–»ê²Œ ì‚¬ìš©í• ì§€, ëˆ„êµ¬ì—ê²Œ ì „ë‹¬í• ì§€ëŠ” ê´€ì‹¬ ë°–ì´ë‹¤.

```ts
// Repository: ë°ì´í„° ì ‘ê·¼ë§Œ ë‹´ë‹¹
class PostRepository {
  constructor(private httpClient: HttpClient) {}

  async getAll(): Promise<Post[]> {
    return this.httpClient.get("/posts");
  }

  async getById(id: number): Promise<Post> {
    return this.httpClient.get(`/posts/${id}`);
  }
}
```

RepositoryëŠ” API í˜¸ì¶œ, DB ì¿¼ë¦¬, ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì ‘ê·¼ ë“± **ìˆœìˆ˜í•œ ë°ì´í„° ì…ì¶œë ¥**ë§Œ ë‹´ë‹¹í•œë‹¤.

### Service: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê³„ì¸µ

ServiceëŠ” "ë°ì´í„°ë¡œ ë¬´ì—‡ì„ í•˜ëŠ”ê°€"ì— ì§‘ì¤‘í•œë‹¤.

ë§¤ì¥ ì§ì›ì„ ë– ì˜¬ë ¤ ë³´ì. ë§¤ì¥ ì§ì›ì€ ì°½ê³ ì—ì„œ ë¬¼ê±´ì„ ë°›ì•„ ê³ ê°ì—ê²Œ ì „ë‹¬í•˜ê¸° ì „ì— ìƒí’ˆ ìƒíƒœë¥¼ ê²€ìˆ˜í•˜ê±°ë‚˜, ê·œê²©ì— ë§ëŠ”ì§€ í™•ì¸í•œë‹¤.

ë¬¼ê±´ì´ ì°½ê³  ì–´ë””ì— ìˆëŠ”ì§€ëŠ” ëª¨ë¥´ì§€ë§Œ, ê³ ê°ì—ê²Œ ì „ë‹¬í•´ë„ ë˜ëŠ”ì§€ íŒë‹¨í•˜ëŠ” ë°©ë²•ì€ ì•ˆë‹¤.

```ts
// Service: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë‹´ë‹¹
class PostService {
  constructor(private postRepository: PostRepository) {}

  async createPost(input: CreatePostInput): Promise<Post> {
    // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§: ìœ íš¨ì„± ê²€ì¦
    this._validateTitle(input.title);
    this._validateContent(input.content);

    // ê²€ì¦ í†µê³¼ í›„ Repository í˜¸ì¶œ
    return this.postRepository.create(input);
  }

  private _validateTitle(title: string): void {
    if (title.length < 2) {
      throw new ValidationError("ì œëª©ì€ 2ì ì´ìƒì´ì–´ì•¼ í•œë‹¤");
    }
  }

  private _validateContent(content: string): void {
    if (content.length < 4) {
      throw new ValidationError("ë‚´ìš©ì€ 4ì ì´ìƒì´ì–´ì•¼ í•œë‹¤");
    }
  }
}
```

ServiceëŠ” ìœ íš¨ì„± ê²€ì¦ì²˜ëŸ¼ **í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì²˜ë¦¬í•´ì•¼ í•  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**ì„ ë‹´ë‹¹í•œë‹¤. ê²€ì¦ì„ í†µê³¼í•´ì•¼ë§Œ Repositoryë¥¼ í˜¸ì¶œí•œë‹¤.

### ì™œ êµ³ì´ ë‚˜ëˆŒê¹Œ?

ë‹¨ìˆœí•œ CRUD ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë¼ë©´ Repository í•˜ë‚˜ë¡œ ì¶©ë¶„í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ë³µì¡í•´ì§€ë©´ ì´ì•¼ê¸°ê°€ ë‹¬ë¼ì§„ë‹¤.

```ts
// âŒ Repositoryì— ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì„ì¸ ê²½ìš°
class PostRepository {
  async createPost(input: CreatePostInput, user: User): Promise<Post> {
    // ìœ íš¨ì„± ê²€ì¦
    if (input.title.length < 2) {
      throw new ValidationError("ì œëª©ì€ 2ì ì´ìƒì´ì–´ì•¼ í•œë‹¤");
    }
    if (input.content.length < 4) {
      throw new ValidationError("ë‚´ìš©ì€ 4ì ì´ìƒì´ì–´ì•¼ í•œë‹¤");
    }

    // ê¶Œí•œ ê²€ì‚¬
    if (user.role === "guest") {
      throw new AuthError("ê²ŒìŠ¤íŠ¸ëŠ” í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•  ìˆ˜ ì—†ë‹¤");
    }
    if (user.postsToday >= 10) {
      throw new LimitError("í•˜ë£¨ ìµœëŒ€ 10ê°œê¹Œì§€ë§Œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤");
    }

    // ì½˜í…ì¸  ì •ì±… ê²€ì‚¬
    if (this._containsBannedWords(input.content)) {
      throw new PolicyError("ê¸ˆì§€ëœ ë‹¨ì–´ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤");
    }

    // ìŠ¬ëŸ¬ê·¸ ìƒì„±
    const slug = this._generateSlug(input.title);

    return this.httpClient.post("/posts", { ...input, slug });
  }

  // Repositoryì— ë¹„ì¦ˆë‹ˆìŠ¤ í—¬í¼ ë©”ì„œë“œê°€ ê³„ì† ëŠ˜ì–´ë‚œë‹¤...
  private _containsBannedWords(content: string): boolean {
    /* ... */
  }
  private _generateSlug(title: string): string {
    /* ... */
  }
}
```

Repositoryê°€ ë°ì´í„° ì ‘ê·¼, ìœ íš¨ì„± ê²€ì¦, ê¶Œí•œ ê²€ì‚¬, ì½˜í…ì¸  ì •ì±…ê¹Œì§€ ëª¨ë‘ ë‹´ë‹¹í•˜ê²Œ ëœë‹¤. í…ŒìŠ¤íŠ¸ë„ ì–´ë ¤ì›Œì§€ê³ , ë¡œì§ í•˜ë‚˜ë¥¼ ìˆ˜ì •í•˜ë©´ Repository ì „ì²´ë¥¼ ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•´ì•¼ í•œë‹¤.

```ts
// âœ… ì—­í•  ë¶„ë¦¬
class PostRepository {
  async create(input: CreatePostInput): Promise<Post> {
    return this.httpClient.post("/posts", input);
  }
}

class PostService {
  async createPost(input: CreatePostInput): Promise<Post> {
    // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§: ìœ íš¨ì„± ê²€ì¦
    this._validateTitle(input.title);
    this._validateContent(input.content);

    return this.postRepository.create(input);
  }

  private _validateTitle(title: string): void {
    if (title.length < 2) {
      throw new ValidationError("ì œëª©ì€ 2ì ì´ìƒì´ì–´ì•¼ í•œë‹¤");
    }
  }

  private _validateContent(content: string): void {
    if (content.length < 4) {
      throw new ValidationError("ë‚´ìš©ì€ 4ì ì´ìƒì´ì–´ì•¼ í•œë‹¤");
    }
  }
}
```

RepositoryëŠ” ë‹¨ìˆœí•˜ê²Œ ìœ ì§€ë˜ê³ , ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§(ìœ íš¨ì„± ê²€ì¦)ì€ Serviceì—ì„œ ë‹´ë‹¹í•œë‹¤.

---

## React Contextë¥¼ í†µí•œ ì˜ì¡´ì„± ì£¼ì…

ì´ì œ Repositoryì™€ Serviceì˜ ì—­í• ì„ ì´í•´í–ˆìœ¼ë‹ˆ, Reactì—ì„œ ì´ êµ¬ì¡°ë¥¼ ì–´ë–»ê²Œ í™œìš©í•  ìˆ˜ ìˆì„ì§€ ì‚´í´ë³´ì.

### DI ì—†ì´ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì§ì ‘ fetch í˜¸ì¶œí•˜ê¸°

ë¨¼ì €, ì¼ë°˜ì ìœ¼ë¡œ ë§ì´ ì‘ì„±í•˜ëŠ” ë°©ì‹ë¶€í„° ì‚´í´ë³´ì.

```tsx
function Posts() {
  const {
    data: posts,
    isPending,
    isError,
  } = useQuery({
    queryKey: ["posts"],
    queryFn: () => fetch("/api/posts").then((res) => res.json()),
  });

  if (isPending) return <LoadingSpinner />;
  if (isError) return <ErrorPage />;

  return (
    <ul>
      {posts.map((post) => (
        <li key={post.id}>
          {post.title} - {post.author}
        </li>
      ))}
    </ul>
  );
}
```

ì´ ì»´í¬ë„ŒíŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ? ë„¤íŠ¸ì›Œí¬ ë ˆì´ì–´ë¥¼ mockí•´ì•¼ í•œë‹¤.

```tsx
import { http, HttpResponse } from "msw";
import { setupServer } from "msw/node";

const server = setupServer(
  http.get("/api/posts", () => {
    return HttpResponse.json([
      { id: 1, title: "ë§¤íŠœì˜ React ì…ë¬¸ì„œ", author: "ë§¤íŠœ" },
    ]);
  }),
);

beforeAll(() => server.listen());
afterEach(() => server.resetHandlers());
afterAll(() => server.close());

test("í¬ìŠ¤íŠ¸ë¥¼ ë¡œë“œí•˜ê³  í‘œì‹œí•œë‹¤", async () => {
  render(<Posts />);
  // ...
});
```

í…ŒìŠ¤íŠ¸ë§ˆë‹¤ ì´ëŸ° ì„¤ì •ì´ í•„ìš”í•˜ë‹¤. ê·¸ë¦¬ê³  ì»´í¬ë„ŒíŠ¸ ì„¤ê³„ì˜ ëª‡ ê°€ì§€ ë¬¸ì œë¥¼ ìƒê°í•´ ë³´ì.

**API ì—”ë“œí¬ì¸íŠ¸ê°€ ë³€ê²½ë˜ë©´?**

```tsx
// âŒ ì—”ë“œí¬ì¸íŠ¸ê°€ /api/postsì—ì„œ /api/v2/postsë¡œ ë³€ê²½ë˜ë©´
// ì´ URLì„ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¾ì•„ ìˆ˜ì •í•´ì•¼ í•œë‹¤

// Posts.tsx
queryFn: () => fetch("/api/v2/posts").then((res) => res.json()),

// PostDetail.tsx
queryFn: () => fetch(`/api/v2/posts/${id}`).then((res) => res.json()),

// CreatePost.tsx
mutationFn: (data) => fetch("/api/v2/posts", { method: "POST", body: JSON.stringify(data) }),

// í…ŒìŠ¤íŠ¸ íŒŒì¼ë“¤ë„ ì „ë¶€ ìˆ˜ì •...
```

**ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì²˜ë¦¬ê°€ ì»´í¬ë„ŒíŠ¸ë§ˆë‹¤ ì¤‘ë³µëœë‹¤**

```tsx
// âŒ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì—ì„œ ë™ì¼í•œ ì˜¤ë¥˜ ì²˜ë¦¬ë¥¼ ë°˜ë³µí•œë‹¤
function Posts() {
  const { data, error } = useQuery({
    queryFn: async () => {
      const res = await fetch("/api/posts");
      if (!res.ok) {
        if (res.status === 401) throw new Error("ë¡œê·¸ì¸ì´ í•„ìš”í•˜ë‹¤");
        if (res.status === 403) throw new Error("ê¶Œí•œì´ ì—†ë‹¤");
        if (res.status === 500) throw new Error("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤");
        throw new Error("ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜");
      }
      return res.json();
    },
  });
}

// PostDetail.tsxì—ì„œë„ ê°™ì€ ì˜¤ë¥˜ ì²˜ë¦¬...
// CreatePost.tsxì—ì„œë„ ê°™ì€ ì˜¤ë¥˜ ì²˜ë¦¬...
```

**ì™œ ë·° ì»´í¬ë„ŒíŠ¸ê°€ ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•´ ì•Œì•„ì•¼ í• ê¹Œ?**

```tsx
// âœ… ì»´í¬ë„ŒíŠ¸ëŠ” ë„¤íŠ¸ì›Œí¬ë¥¼ ëª¨ë¥¸ë‹¤
function Posts() {
  const { postService } = usePostClient();
  const { data } = useQuery({
    queryFn: () => postService.getPosts(), // URL? ì˜¤ë¥˜ ì²˜ë¦¬? ëª°ë¼ë„ ëœë‹¤
  });
}

// ì—”ë“œí¬ì¸íŠ¸ ë³€ê²½? Repositoryë§Œ ìˆ˜ì •í•˜ë©´ ëœë‹¤
// ì˜¤ë¥˜ ì²˜ë¦¬? HttpClientë‚˜ Repositoryì—ì„œ ì¼ê´„ ì²˜ë¦¬í•œë‹¤
```

### Contextë¡œ Service ì£¼ì…í•˜ê¸°

ì•ì„œ ë°°ìš´ Repositoryì™€ Service íŒ¨í„´ì„ React Contextì™€ ê²°í•©í•´ ë³´ì.

ë¨¼ì €, Repositoryì™€ Serviceë¥¼ ì •ì˜í•œë‹¤.

```ts
// repositories/PostRepository.ts
interface PostRepository {
  create(input: CreatePostInput): Promise<Post>;
}

class PostRepositoryImpl implements PostRepository {
  constructor(private httpClient: HttpClient) {}

  async create(input: CreatePostInput): Promise<Post> {
    return this.httpClient.post("/posts", input);
  }
}

// services/PostService.ts
class PostService {
  constructor(private postRepository: PostRepository) {}

  async createPost(input: CreatePostInput): Promise<Post> {
    this._validateTitle(input.title);
    this._validateContent(input.content);
    return this.postRepository.create(input);
  }

  private _validateTitle(title: string): void {
    if (title.length < 2) {
      throw new ValidationError("ì œëª©ì€ 2ì ì´ìƒì´ì–´ì•¼ í•œë‹¤");
    }
  }

  private _validateContent(content: string): void {
    if (content.length < 4) {
      throw new ValidationError("ë‚´ìš©ì€ 4ì ì´ìƒì´ì–´ì•¼ í•œë‹¤");
    }
  }
}
```

ì´ì œ Context Providerë¥¼ ë§Œë“ ë‹¤.

```tsx
// contexts/PostContext.tsx
import { createContext, use, useState, type PropsWithChildren } from "react";

interface PostClient {
  postService: PostService;
}

const PostContext = createContext<PostClient | null>(null);

export function PostContextProvider({
  children,
  client,
}: PropsWithChildren<{ client?: PostClient }>) {
  const httpClient = useHttpClient(); // ìœ„ì—ì„œ ì„¤ëª…í•œ HttpClient

  // Lazy initialization: ì„œë¹„ìŠ¤ ê·¸ë˜í”„ í•œ ë²ˆë§Œ ìƒì„±
  const [postClient] = useState<PostClient>(() => {
    if (client) return client; // í…ŒìŠ¤íŠ¸ìš© ì˜¤ë²„ë¼ì´ë“œ

    // ì˜ì¡´ì„± í•´ê²°: HttpClient â†’ Repository â†’ Service
    const postRepository = new PostRepositoryImpl(httpClient);
    const postService = new PostService(postRepository);
    return { postService };
  });

  return <PostContext value={postClient}>{children}</PostContext>;
}

export function usePostClient(): PostClient {
  const context = use(PostContext);
  if (!context) {
    throw new Error(
      "usePostClientëŠ” PostContextProvider ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤",
    );
  }
  return context;
}
```

ì—¬ê¸°ì„œ í•µì‹¬ì€ `useState`ì˜ lazy initializationì´ë‹¤. ì»´í¬ë„ŒíŠ¸ê°€ ì²˜ìŒ ë Œë”ë§ë  ë•Œ í•œ ë²ˆë§Œ ì„œë¹„ìŠ¤ ê·¸ë˜í”„ë¥¼ ìƒì„±í•˜ê³ , ì´í›„ ë¦¬ë Œë”ë§ì—ì„œëŠ” ê¸°ì¡´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¬ì‚¬ìš©í•œë‹¤.

ê·¸ë¦¬ê³  `client` propì„ í†µí•´ í…ŒìŠ¤íŠ¸ ì‹œ mockì„ ì£¼ì…í•  ìˆ˜ ìˆë‹¤.

### ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ê¸°

```tsx
function CreatePostForm() {
  const { postService } = usePostClient();
  const [title, setTitle] = useState("");
  const [content, setContent] = useState("");
  const [error, setError] = useState<string | null>(null);

  const mutation = useMutation({
    mutationFn: () => postService.createPost({ title, content }),
    onError: (err) => {
      const message =
        err instanceof Error ? err.message : "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤";
      setError(message);
    },
  });

  return (
    <form
      onSubmit={(e) => {
        e.preventDefault();
        mutation.mutate();
      }}
    >
      <input value={title} onChange={(e) => setTitle(e.target.value)} />
      <textarea value={content} onChange={(e) => setContent(e.target.value)} />
      {error && <p>{error}</p>}
      <button type="submit">ì‘ì„±</button>
    </form>
  );
}
```

ì»´í¬ë„ŒíŠ¸ëŠ” ë” ì´ìƒ ìœ íš¨ì„± ê²€ì¦ ë¡œì§ì„ ì•Œì§€ ëª»í•œë‹¤. ë‹¨ì§€ `postService`ì—ê²Œ "í¬ìŠ¤íŠ¸ë¥¼ ìƒì„±í•´ë‹¬ë¼"ê³  ìš”ì²­í•  ë¿ì´ë‹¤. ì œëª©ì´ 2ì ë¯¸ë§Œì´ê±°ë‚˜ ë‚´ìš©ì´ 4ì ë¯¸ë§Œì´ë©´ Serviceì—ì„œ `ValidationError`ë¥¼ ë˜ì§„ë‹¤.

### í…ŒìŠ¤íŠ¸ê°€ ì–¼ë§ˆë‚˜ ë‹¨ìˆœí•´ì§€ëŠ”ê°€?

```tsx
const mockPostService = {
  createPost: vi.fn().mockResolvedValue({
    id: 1,
    title: "ë§¤íŠœì˜ React ì…ë¬¸ì„œ",
    content: "ReactëŠ” UI ë¼ì´ë¸ŒëŸ¬ë¦¬ë‹¤",
    author: "ë§¤íŠœ",
  }),
};

test("í¬ìŠ¤íŠ¸ ìƒì„± ì„±ê³µ ì‹œ í¼ì„ ì œì¶œí•œë‹¤", async () => {
  render(
    <PostContextProvider client={{ postService: mockPostService }}>
      <CreatePostForm />
    </PostContextProvider>,
  );

  await userEvent.type(
    screen.getByRole("textbox", { name: /title/i }),
    "í…ŒìŠ¤íŠ¸ ì œëª©",
  );
  await userEvent.type(
    screen.getByRole("textbox", { name: /content/i }),
    "í…ŒìŠ¤íŠ¸ ë‚´ìš©ì…ë‹ˆë‹¤",
  );
  await userEvent.click(screen.getByRole("button", { name: "ì‘ì„±" }));

  expect(mockPostService.createPost).toHaveBeenCalledWith({
    title: "í…ŒìŠ¤íŠ¸ ì œëª©",
    content: "í…ŒìŠ¤íŠ¸ ë‚´ìš©ì…ë‹ˆë‹¤",
  });
});

test("ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•œë‹¤", async () => {
  mockPostService.createPost.mockRejectedValue(
    new ValidationError("ì œëª©ì€ 2ì ì´ìƒì´ì–´ì•¼ í•œë‹¤"),
  );

  render(
    <PostContextProvider client={{ postService: mockPostService }}>
      <CreatePostForm />
    </PostContextProvider>,
  );

  await userEvent.type(screen.getByRole("textbox", { name: /title/i }), "a");
  await userEvent.click(screen.getByRole("button", { name: "ì‘ì„±" }));

  await waitFor(() => {
    expect(screen.getByText("ì œëª©ì€ 2ì ì´ìƒì´ì–´ì•¼ í•œë‹¤")).toBeInTheDocument();
  });
});
```

í›¨ì”¬ ê°„ë‹¨í•˜ë‹¤.

- Mock Service Worker ì„¤ì • ì—†ìŒ
- `beforeAll` / `afterEach` / `afterAll` ì—†ìŒ
- import ëª¨í‚¹ ì—†ìŒ

`client` propì— mock ê°ì²´ë¥¼ ë„£ê¸°ë§Œ í•˜ë©´ ëœë‹¤. ìœ íš¨ì„± ê²€ì¦ ì—ëŸ¬ë„ ì‰½ê²Œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤.

```tsx
// ë‚´ìš© ê¸¸ì´ ê²€ì¦ ì‹¤íŒ¨
mockPostService.createPost.mockRejectedValue(
  new ValidationError("ë‚´ìš©ì€ 4ì ì´ìƒì´ì–´ì•¼ í•œë‹¤"),
);

// ê¶Œí•œ ê²€ì¦ ì‹¤íŒ¨
mockPostService.createPost.mockRejectedValue(
  new AuthError("ê²ŒìŠ¤íŠ¸ëŠ” í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•  ìˆ˜ ì—†ë‹¤"),
);
```

`mockRejectedValue`ë¡œ ì›í•˜ëŠ” ì—ëŸ¬ë¥¼ ë˜ì§€ê²Œ í•˜ë©´ ëì´ë‹¤.

### ì˜ì¡´ì„± ì£¼ì…ì´ ê°€ì ¸ë‹¤ ì£¼ëŠ” ì¬ì‚¬ìš©ì„±

ì´ íŒ¨í„´ì˜ ì§„ì§œ í˜ì€ êµ¬í˜„ì²´ë¥¼ ì‰½ê²Œ êµì²´í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤.

ì‹¤ë¬´ ì˜ˆì‹œë¥¼ ë“¤ì–´ë³´ì. ì„œë¹„ìŠ¤ì˜ ì£¼ ì‚¬ìš©ìì¸µì´ 30~60ëŒ€ë‹¤. ì‘ì€ í°íŠ¸ì™€ í™”ë ¤í•œ ì• ë‹ˆë©”ì´ì…˜ì´ ì„¸ë ¨ë˜ì–´ ë³´ì´ì§€ë§Œ, ì˜¤íˆë ¤ ë¶ˆí¸í•´í•˜ëŠ” ì‚¬ìš©ìë„ ë§ì•˜ë‹¤.

ìš°ë¦¬ íšŒì‚¬ëŠ” ë‘ ê°€ì§€ í…Œë§ˆë¥¼ A/B í…ŒìŠ¤íŠ¸í•˜ê³  ì‹¶ë‹¤.

- **Aì•ˆ**: ëª¨ë˜ í…Œë§ˆ (ì‘ì€ í°íŠ¸, í™”ë ¤í•œ ì• ë‹ˆë©”ì´ì…˜)
- **Bì•ˆ**: í´ë˜ì‹ í…Œë§ˆ (í° í°íŠ¸, ì§ê´€ì ì¸ UI)

```tsx
// ëª¨ë˜ í…Œë§ˆ: ì‘ì€ í°íŠ¸, ì• ë‹ˆë©”ì´ì…˜
class ModernThemeService {
  getConfig(): ThemeConfig {
    return {
      fontSize: { base: 14, heading: 18 },
      animation: { enabled: true, duration: 300 },
    };
  }
}

// í´ë˜ì‹ í…Œë§ˆ: í° í°íŠ¸, ì§ê´€ì 
class ClassicThemeService {
  getConfig(): ThemeConfig {
    return {
      fontSize: { base: 18, heading: 24 },
      animation: { enabled: false },
    };
  }
}
```

Providerì—ì„œ A/B í…ŒìŠ¤íŠ¸ ê·¸ë£¹ì— ë”°ë¼ Serviceë¥¼ êµì²´í•œë‹¤.

```tsx
function ThemeContextProvider({ children }: PropsWithChildren) {
  const { variant } = useABTest("theme-preference");

  const [themeClient] = useState<ThemeClient>(() => {
    const themeService =
      variant === "classic"
        ? new ClassicThemeService()
        : new ModernThemeService();

    return { themeService };
  });

  return <ThemeContext value={themeClient}>{children}</ThemeContext>;
}
```

`<Dashboard />` ì»´í¬ë„ŒíŠ¸ëŠ” **ë‹¨ í•œ ì¤„ë„ ë³€ê²½í•˜ì§€ ì•Šì•˜ë‹¤**. 50ëŒ€ ì´ìƒ ì‚¬ìš©ìì—ê²Œ Bì•ˆì„ ë…¸ì¶œí•˜ê³ , ì²´ë¥˜ ì‹œê°„ê³¼ ì´íƒˆë¥ ì„ ë¹„êµí•œ ë’¤ ì—°ë ¹ëŒ€ë³„ ê¸°ë³¸ í…Œë§ˆë¥¼ ê²°ì •í•˜ë©´ ëœë‹¤.

### Fixturesë¡œ í…ŒìŠ¤íŠ¸ì™€ ìŠ¤í† ë¦¬ë¶ ë°ì´í„° ê³µìœ í•˜ê¸°

ì•ì„œ í…ŒìŠ¤íŠ¸ì—ì„œ mock ê°ì²´ë¥¼ ì£¼ì…í•˜ëŠ” ë°©ë²•ì„ ì‚´í´ë´¤ë‹¤. ê·¸ëŸ°ë° í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ê°€ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ë¹„ìŠ·í•œ mock ë°ì´í„°ë¥¼ ë°˜ë³µí•´ì„œ ì‘ì„±í•˜ê²Œ ëœë‹¤. ìŠ¤í† ë¦¬ë¶ì—ì„œë„ ë§ˆì°¬ê°€ì§€ë‹¤. í¬ìŠ¤íŠ¸ ëª©ë¡ ìŠ¤í† ë¦¬ë¥¼ ë§Œë“¤ë ¤ë©´ ë˜ mock ë°ì´í„°ë¥¼ ì‘ì„±í•´ì•¼ í•œë‹¤.

ì´ ë°ì´í„°ë“¤ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬í•˜ë©´ ì–´ë–¨ê¹Œ?

**Fixtures í´ë” êµ¬ì¡°**

ì„œë²„ ì‘ë‹µì„ í‰ë‚´ë‚¸ ë°ì´í„°ë¥¼ `__fixtures__` í´ë”ì— ëª¨ì•„ë‘ê³ , í…ŒìŠ¤íŠ¸ì™€ ìŠ¤í† ë¦¬ë¶ì—ì„œ **ë™ì¼í•œ ë°ì´í„°ë¥¼ ì¬ì‚¬ìš©**í•  ìˆ˜ ìˆë‹¤.

```text
src/
â”œâ”€â”€ __fixtures__/
â”‚   â”œâ”€â”€ factories.ts       # í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± í•¨ìˆ˜
â”‚   â”œâ”€â”€ stubs.ts           # Service Stub êµ¬í˜„
â”‚   â”œâ”€â”€ presets.ts         # ì‹œë‚˜ë¦¬ì˜¤ë³„ Preset
â”‚   â””â”€â”€ index.ts           # í†µí•© export
â”œâ”€â”€ components/
â”‚   â””â”€â”€ PostList/
â”‚       â”œâ”€â”€ PostList.tsx
â”‚       â”œâ”€â”€ PostList.test.tsx     # fixtures ì‚¬ìš©
â”‚       â””â”€â”€ PostList.stories.tsx  # ë™ì¼í•œ fixtures ì‚¬ìš©
â””â”€â”€ contexts/
    â””â”€â”€ PostContext.tsx
```

**Factory: í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±**

í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë³„ë„ íŒŒì¼ë¡œ ë¶„ë¦¬í•œë‹¤. `satisfies` ë°˜ë³µì„ ì—†ì• ê³ , í•„ìš”í•œ í•„ë“œë§Œ ì˜¤ë²„ë¼ì´ë“œí•  ìˆ˜ ìˆë‹¤.

```ts
// __fixtures__/factories.ts
import type { Post } from "@/types";

let idCounter = 0;

export function createPost(overrides: Partial<Post> = {}): Post {
  idCounter += 1;
  return {
    id: overrides.id ?? idCounter,
    title: overrides.title ?? `í…ŒìŠ¤íŠ¸ í¬ìŠ¤íŠ¸ ${idCounter}`,
    content: overrides.content ?? "í…ŒìŠ¤íŠ¸ ë‚´ìš©ì´ë‹¤.",
    author: overrides.author ?? "ë§¤íŠœ",
  };
}

export function createPosts(count: number): Post[] {
  return Array.from({ length: count }, () => createPost());
}
```

`createPost()`ë¥¼ í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ê³ ìœ í•œ IDê°€ ë¶€ì—¬ëœë‹¤. íŠ¹ì • í•„ë“œë§Œ ë°”ê¾¸ê³  ì‹¶ìœ¼ë©´ `createPost({ title: "ì›í•˜ëŠ” ì œëª©" })`ì²˜ëŸ¼ ì˜¤ë²„ë¼ì´ë“œí•˜ë©´ ëœë‹¤.

**Stub: vi.fn() ì—†ì´ Service êµ¬í˜„**

`vi.fn()`ì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ” Stubì„ ë§Œë“¤ë©´ **ìŠ¤í† ë¦¬ë¶ì—ì„œë„ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ ì—†ì´** ë™ì‘í•œë‹¤.

```ts
// __fixtures__/stubs.ts
import type { Post, CreatePostInput, PostService } from "@/types";
import { createPost } from "./factories";

interface PostServiceStubOptions {
  posts?: Post[];
  createPostResult?: Post | Error;
}

export function createPostServiceStub(
  options: PostServiceStubOptions = {},
): PostService {
  const { posts = [], createPostResult } = options;

  return {
    async getPosts() {
      return posts;
    },
    async createPost(input: CreatePostInput) {
      if (createPostResult instanceof Error) {
        throw createPostResult;
      }
      return createPostResult ?? createPost(input);
    },
  };
}
```

Stubì€ ì‹¤ì œ `PostService` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë˜, ë‚´ë¶€ ë¡œì§ì„ ë‹¨ìˆœí™”í•œ ê²ƒì´ë‹¤. ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì—†ì´ ë¯¸ë¦¬ ì •ì˜í•œ ë°ì´í„°ë¥¼ ë°˜í™˜í•œë‹¤.

**Presets: ìì£¼ ì“°ëŠ” ì‹œë‚˜ë¦¬ì˜¤ ë¯¸ë¦¬ ì •ì˜**

ë°˜ë³µì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ë¥¼ Presetìœ¼ë¡œ ë¬¶ì–´ë‘ë©´ í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ í›¨ì”¬ ê°„ê²°í•´ì§„ë‹¤.

```ts
// __fixtures__/presets.ts
import { createPost, createPosts } from "./factories";
import { createPostServiceStub } from "./stubs";

export const postPresets = {
  // ê¸°ë³¸: í¬ìŠ¤íŠ¸ 3ê°œ
  withPosts: () => createPostServiceStub({ posts: createPosts(3) }),

  // ë¹ˆ ëª©ë¡
  empty: () => createPostServiceStub({ posts: [] }),

  // ë‹¨ì¼ í¬ìŠ¤íŠ¸
  single: () => createPostServiceStub({ posts: [createPost()] }),

  // ìƒì„± ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤
  createFails: (message = "ì œëª©ì€ 2ì ì´ìƒì´ì–´ì•¼ í•œë‹¤") =>
    createPostServiceStub({ createPostResult: new Error(message) }),
};
```

`postPresets.withPosts()`ë¥¼ í˜¸ì¶œí•˜ë©´ í¬ìŠ¤íŠ¸ 3ê°œê°€ ë‹´ê¸´ Stub Serviceê°€ ìƒì„±ëœë‹¤. í…ŒìŠ¤íŠ¸ë§ˆë‹¤ mock ë°ì´í„°ë¥¼ ë³µë¶™í•  í•„ìš”ê°€ ì—†ë‹¤.

**ìŠ¤í† ë¦¬ë¶ì—ì„œ í™œìš©í•˜ê¸°**

```tsx
// PostList.stories.tsx
import type { Meta, StoryObj } from "@storybook/react";
import { PostContextProvider } from "@/contexts/PostContext";
import { postPresets } from "@/__fixtures__";
import { PostList } from "./PostList";

const meta: Meta<typeof PostList> = {
  component: PostList,
};
export default meta;

type Story = StoryObj<typeof PostList>;

export const Default: Story = {
  decorators: [
    (Story) => (
      <PostContextProvider client={{ postService: postPresets.withPosts() }}>
        <Story />
      </PostContextProvider>
    ),
  ],
};

export const Empty: Story = {
  decorators: [
    (Story) => (
      <PostContextProvider client={{ postService: postPresets.empty() }}>
        <Story />
      </PostContextProvider>
    ),
  ],
};
```

`vi.fn()`ì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ìŠ¤í† ë¦¬ë¶ì—ì„œ Vitest ì—†ì´ë„ ì •ìƒ ë™ì‘í•œë‹¤. Contextì˜ `client` propì„ í†µí•´ Stubì„ ì£¼ì…í•˜ë©´ ì‹¤ì œ ì„œë²„ ì—†ì´ë„ ë‹¤ì–‘í•œ ìƒíƒœë¥¼ ì‹œê°ì ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

**í…ŒìŠ¤íŠ¸ì—ì„œ ë™ì¼í•˜ê²Œ í™œìš©í•˜ê¸°**

```tsx
// PostList.test.tsx
import { postPresets } from "@/__fixtures__";

test("í¬ìŠ¤íŠ¸ ëª©ë¡ì„ í‘œì‹œí•œë‹¤", async () => {
  render(
    <PostContextProvider client={{ postService: postPresets.withPosts() }}>
      <PostList />
    </PostContextProvider>,
  );

  expect(await screen.findByText("í…ŒìŠ¤íŠ¸ í¬ìŠ¤íŠ¸ 1")).toBeInTheDocument();
});

test("í¬ìŠ¤íŠ¸ê°€ ì—†ìœ¼ë©´ ë¹ˆ ìƒíƒœë¥¼ í‘œì‹œí•œë‹¤", async () => {
  render(
    <PostContextProvider client={{ postService: postPresets.empty() }}>
      <PostList />
    </PostContextProvider>,
  );

  expect(await screen.findByText("í¬ìŠ¤íŠ¸ê°€ ì—†ë‹¤")).toBeInTheDocument();
});
```

ìŠ¤í† ë¦¬ë¶ê³¼ **ì™„ì „íˆ ë™ì¼í•œ íŒ¨í„´**ì´ë‹¤. ê°™ì€ Presetì„ ì‚¬ìš©í•˜ë¯€ë¡œ ìŠ¤í† ë¦¬ë¶ì—ì„œ ë³´ì´ëŠ” UIì™€ í…ŒìŠ¤íŠ¸ì—ì„œ ê²€ì¦í•˜ëŠ” UIê°€ ì¼ì¹˜í•œë‹¤.

ì´ íŒ¨í„´ì˜ ì¥ì ì€ ëª…í™•í•˜ë‹¤.

1. **Factory**: ë°ì´í„° êµ¬ì¡°ê°€ ë°”ë€Œë©´ `createPost()` í•˜ë‚˜ë§Œ ìˆ˜ì •í•˜ë©´ ëœë‹¤
2. **Stub**: `vi.fn()` ì—†ì´ ë™ì‘í•˜ë¯€ë¡œ ìŠ¤í† ë¦¬ë¶ì—ì„œë„ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤
3. **Presets**: ìì£¼ ì“°ëŠ” ì‹œë‚˜ë¦¬ì˜¤ë¥¼ í•œ ì¤„ë¡œ í‘œí˜„í•  ìˆ˜ ìˆë‹¤

í•œ ê³³ì—ì„œ ê´€ë¦¬í•˜ê³ , ì—¬ëŸ¬ ê³³ì—ì„œ ì¬ì‚¬ìš©í•œë‹¤. ì´ê²ƒì´ ì˜ì¡´ì„± ì£¼ì…ì´ ê°€ì ¸ë‹¤ì£¼ëŠ” **ì§„ì§œ ì¬ì‚¬ìš©ì„±**ì´ë‹¤.

---

## DI íŒ¨í„´ì˜ í•œê³„ì™€ ê·¹ë³µ

### í•œê³„ 1: ë‚´ë¶€ ì˜ì¡´ì„± êµì²´ê°€ ì–´ë µë‹¤

í˜„ì¬ íŒ¨í„´ì—ì„œëŠ” `client` propìœ¼ë¡œ Service ì „ì²´ë¥¼ êµì²´í•  ìˆ˜ ìˆë‹¤.

```tsx
<PostContextProvider client={{ postService: mockPostService }}>
```

í•˜ì§€ë§Œ `postService`ëŠ” ê·¸ëŒ€ë¡œ ë‘ê³  ë‚´ë¶€ì˜ `postRepository`ë§Œ êµì²´í•˜ê³  ì‹¶ë‹¤ë©´? í˜„ì¬ êµ¬ì¡°ì—ì„œëŠ” ë¶ˆê°€ëŠ¥í•˜ë‹¤.

```tsx
// âŒ ì´ëŸ° ê±´ ì•ˆ ëœë‹¤
<PostContextProvider
  client={{
    postRepository: mockPostRepository, // Service ë‚´ë¶€ì˜ Repositoryë§Œ êµì²´ ë¶ˆê°€
  }}
>
```

Provider ë‚´ë¶€ì—ì„œ ì˜ì¡´ì„± ê·¸ë˜í”„ê°€ í•œ ë²ˆì— ìƒì„±ë˜ê¸° ë•Œë¬¸ì´ë‹¤. Springì´ë‚˜ NestJS ê°™ì€ DI ì»¨í…Œì´ë„ˆëŠ” ì´ëŸ° ì„¸ë°€í•œ êµì²´ê°€ ê°€ëŠ¥í•˜ì§€ë§Œ, ìš°ë¦¬ì˜ Context íŒ¨í„´ì€ **ìµœìƒìœ„ Service ë‹¨ìœ„ë¡œë§Œ êµì²´ ê°€ëŠ¥**í•˜ë‹¤.

**ê·¹ë³µ: DI ì»¨í…Œì´ë„ˆ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë„ì…**

ì´ ë¬¸ì œê°€ ìì£¼ ë°œìƒí•œë‹¤ë©´ [TSyringe](https://github.com/microsoft/tsyringe)ë‚˜ [InversifyJS](https://inversify.io/) ê°™ì€ DI ì»¨í…Œì´ë„ˆë¥¼ ê³ ë ¤í•  ìˆ˜ ìˆë‹¤.

```tsx
import { container, injectable, inject } from "tsyringe";

@injectable()
class PostService {
  constructor(
    // "PostRepository"ë¼ëŠ” í† í°ìœ¼ë¡œ ë“±ë¡ëœ ì˜ì¡´ì„±ì„ ì£¼ì…ë°›ëŠ”ë‹¤
    @inject("PostRepository") private postRepository: PostRepository,
  ) {}
}

// í”„ë¡œë•ì…˜: ì‹¤ì œ êµ¬í˜„ì²´ ë“±ë¡
container.register("PostRepository", { useClass: PostRepositoryImpl });
const postService = container.resolve(PostService);
// â†’ PostService ë‚´ë¶€ì— PostRepositoryImplì´ ìë™ ì£¼ì…ëœë‹¤

// í…ŒìŠ¤íŠ¸: Repositoryë§Œ mockìœ¼ë¡œ êµì²´
container.register("PostRepository", { useValue: mockPostRepository });
const postService = container.resolve(PostService);
// â†’ ê°™ì€ PostServiceì§€ë§Œ ë‚´ë¶€ Repositoryë§Œ mockìœ¼ë¡œ ë°”ë€ë‹¤
```

DI ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•˜ë©´ **ì˜ì¡´ì„± ê·¸ë˜í”„ì˜ ì–´ëŠ ì§€ì ì´ë“  êµì²´ ê°€ëŠ¥**í•˜ë‹¤. ServiceëŠ” ê·¸ëŒ€ë¡œ ë‘ê³  Repositoryë§Œ mockìœ¼ë¡œ ë°”ê¾¸ê±°ë‚˜, íŠ¹ì • ìœ í‹¸ë¦¬í‹°ë§Œ êµì²´í•˜ëŠ” ì„¸ë°€í•œ ì œì–´ê°€ ê°€ëŠ¥í•´ì§„ë‹¤.

ë‹¤ë§Œ, ë°ì½”ë ˆì´í„° ë¬¸ë²•ê³¼ DI ì»¨í…Œì´ë„ˆ ê°œë…ì— ìµìˆ™í•˜ì§€ ì•Šì€ íŒ€ì›ì´ ìˆë‹¤ë©´ ëŸ¬ë‹ ì»¤ë¸Œê°€ ë  ìˆ˜ ìˆë‹¤. **íŒ€ê³¼ ì¶©ë¶„íˆ ìƒì˜í•œ í›„ ë„ì…ì„ ê²°ì •**í•˜ì.

### í•œê³„ 2: Provider Hell

í”¼ì²˜ë§ˆë‹¤ Contextë¥¼ ë§Œë“¤ë©´ Providerê°€ ê³„ì† ì¤‘ì²©ëœë‹¤.

```tsx
// ğŸ˜± Provider Hell
function App() {
  return (
    <AuthContextProvider>
      <ThemeContextProvider>
        <PostContextProvider>
          <CommentContextProvider>
            <NotificationContextProvider>
              <AnalyticsContextProvider>
                <Dashboard />
              </AnalyticsContextProvider>
            </NotificationContextProvider>
          </CommentContextProvider>
        </PostContextProvider>
      </ThemeContextProvider>
    </AuthContextProvider>
  );
}
```

ì•ì„œ ì„¤ëª…í–ˆë“¯ì´, Context ê°’ì´ ë³€í•˜ì§€ ì•Šìœ¼ë©´ ë¦¬ë Œë”ë§ì€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ë¦¬ê³  `useState`ì˜ lazy initializationìœ¼ë¡œ Service ì¸ìŠ¤í„´ìŠ¤ê°€ í•œ ë²ˆë§Œ ìƒì„±ë˜ë¯€ë¡œ, Providerê°€ ì•„ë¬´ë¦¬ ë§ì•„ë„ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë‚˜ ì¤‘ë³µ ì¸ìŠ¤í„´ìŠ¤ ë¬¸ì œëŠ” ì—†ë‹¤.

**ì„±ëŠ¥ ë¬¸ì œëŠ” ì•„ë‹ˆë‹¤.**

í•˜ì§€ë§Œ ê°€ë…ì„±ì´ ë–¨ì–´ì§€ê³ , ìƒˆë¡œìš´ í”¼ì²˜ë¥¼ ì¶”ê°€í•  ë•Œë§ˆë‹¤ Providerë¥¼ ê°ì‹¸ì•¼ í•˜ëŠ” ë²ˆê±°ë¡œì›€ì´ ìˆë‹¤.

**ê·¹ë³µ 1: Provider í•©ì„± ìœ í‹¸ë¦¬í‹°**

```tsx
import { FC, PropsWithChildren } from "react";

function composeProviders(...providers: FC<PropsWithChildren>[]) {
  return ({ children }: PropsWithChildren) =>
    providers.reduceRight(
      (acc, Provider) => <Provider>{acc}</Provider>,
      children,
    );
}

const AppProviders = composeProviders(
  AuthContextProvider,
  ThemeContextProvider,
  PostContextProvider,
);

function App() {
  return (
    <AppProviders>
      <Dashboard />
    </AppProviders>
  );
}
```

**ê·¹ë³µ 2: MultiProvider ì»´í¬ë„ŒíŠ¸**

[React Context Hell](https://dev.to/alfredosalzillo/the-react-context-hell-7p4) ë¬¸ì„œì—ì„œ ì†Œê°œí•˜ëŠ” íŒ¨í„´ì´ë‹¤. Providerë¥¼ ë°°ì—´ë¡œ ì „ë‹¬í•˜ë©´ ìë™ìœ¼ë¡œ ì¤‘ì²©í•´ì¤€ë‹¤.

```tsx
import {
  cloneElement,
  isValidElement,
  PropsWithChildren,
  ReactNode,
} from "react";

function MultiProvider({
  children,
  providers,
}: PropsWithChildren<{ providers: ReactNode[] }>) {
  return (
    <>
      {providers.reduceRight(
        (acc, provider) =>
          isValidElement(provider) ? cloneElement(provider, {}, acc) : acc,
        children,
      )}
    </>
  );
}

function App() {
  return (
    <MultiProvider
      providers={[
        <AuthContextProvider />,
        <ThemeContextProvider />,
        <PostContextProvider />,
      ]}
    >
      <Dashboard />
    </MultiProvider>
  );
}
```

**ê·¹ë³µ 3: ê´€ë ¨ Serviceë“¤ì„ í•˜ë‚˜ì˜ Contextë¡œ ë¬¶ê¸°**

```tsx
interface AppClient {
  postService: PostService;
  commentService: CommentService;
}

function AppContextProvider({ children }: PropsWithChildren) {
  const httpClient = useHttpClient();

  const [appClient] = useState<AppClient>(() => {
    const postRepository = new PostRepositoryImpl(httpClient);
    const commentRepository = new CommentRepositoryImpl(httpClient);

    return {
      postService: new PostService(postRepository),
      commentService: new CommentService(commentRepository),
    };
  });

  return <AppContext value={appClient}>{children}</AppContext>;
}
```

---

## ë§ˆë¬´ë¦¬

AIê°€ ë°œì „í•˜ë©´ì„œ ê°œë°œìì—ê²Œ ìš”êµ¬ë˜ëŠ” ì—­ëŸ‰ì˜ ë¬´ê²Œì¤‘ì‹¬ì´ ì´ë™í•˜ê³  ìˆë‹¤. ì½”ë“œë¥¼ ë¹ ë¥´ê²Œ ì‘ì„±í•˜ëŠ” ëŠ¥ë ¥ì€ AIê°€ ëŒ€ì‹ í•˜ì§€ë§Œ, ê·¸ ì½”ë“œê°€ ì˜¬ë°”ë¥¸ ë°©í–¥ì¸ì§€ íŒë‹¨í•˜ê³  ìœ ì§€ë³´ìˆ˜ ê°€ëŠ¥í•œ êµ¬ì¡°ë¡œ í™•ì¥í•˜ëŠ” ì¼ì€ ì—¬ì „íˆ ì‚¬ëŒì˜ ëª«ì´ë‹¤. ì´ì „ì— [í´ë¦° ì•„í‚¤í…ì²˜ ê¸€](/post/react-clean-architecture)ì„ ì •ë¦¬í•˜ë©´ì„œë„ ëŠê¼ˆì§€ë§Œ, ì´ë²ˆì— Contextì™€ ì˜ì¡´ì„± ì£¼ì…ì„ ë‹¤ì‹œ ë“¤ì—¬ë‹¤ë³´ë©° ê·¸ ìƒê°ì´ ë” í™•ê³ í•´ì¡Œë‹¤.

ì¹¼ì´ë¼ëŠ” ë„êµ¬ë„ ì²˜ìŒì—” ë™ë¬¼ì˜ ê°€ì£½ì„ ë²—ê¸°ê³  ê³ ê¸°ë¥¼ ìë¥´ê¸° ìœ„í•´ ë§Œë“¤ì–´ì¡Œì„ ê²ƒì´ë‹¤. í•˜ì§€ë§Œ ì“°ëŠ” ì‚¬ëŒì— ë”°ë¼ ëˆ„êµ°ê°€ë¥¼ í•´ì¹˜ëŠ” ë¬´ê¸°ê°€ ë˜ê¸°ë„ í•œë‹¤. ë„êµ¬ëŠ” ê·¸ ìì²´ë¡œ ì¢‹ê±°ë‚˜ ë‚˜ìœ ê²Œ ì•„ë‹ˆë‹¤. ë§Œë“  ì‚¬ëŒì˜ ì˜ë„ë¥¼ ì´í•´í•˜ê³ , ì–´ë–¤ ë§¥ë½ì—ì„œ ì–´ë–»ê²Œ ì“°ëŠëƒì— ë”°ë¼ ê²°ê³¼ê°€ ì™„ì „íˆ ë‹¬ë¼ì§„ë‹¤.

Contextë„ ë§ˆì°¬ê°€ì§€ë‹¤. ë³¸ì§ˆì„ ì´í•´í•˜ê³  ë‚˜ë‹ˆ, ì–¸ì œ ì¨ì•¼ í•˜ê³  ì–¸ì œ ì“°ì§€ ë§ì•„ì•¼ í•˜ëŠ”ì§€ê°€ ëª…í™•í•´ì¡Œë‹¤. ì´ëŸ° íŒë‹¨ë ¥ì´ì•¼ë§ë¡œ AI ì‹œëŒ€ì—ë„ ëŒ€ì²´ë˜ì§€ ì•ŠëŠ” ê°œë°œìì˜ í•µì‹¬ ì—­ëŸ‰ì´ ì•„ë‹ê¹Œ ì‹¶ë‹¤.

---

## ì°¸ê³  ìë£Œ

- [React Context for Dependency Injection Not State Management](https://testdouble.com/insights/react-context-for-dependency-injection-not-state-management)
- [The React Context Hell](https://dev.to/alfredosalzillo/the-react-context-hell-7p4)
- [Reactì—ì„œì˜ ì˜ì¡´ì„± ì£¼ì…(Dependency Injection)](/post/dependency-injection)
- [useState ìŠ¤ëƒ…ìƒ·, ë°°ì¹­, ë¶ˆë³€ì„± í•œ ë²ˆì— ì •ë¦¬](/post/react-hooks-usestate)
- [useReducerë¡œ ë³µì¡í•œ ìƒíƒœ ê´€ë¦¬ ê¹”ë”í•˜ê²Œ ì •ë¦¬í•˜ê¸°](/post/react-hooks-usereducer)
- [React ì „ì—­ ìƒíƒœ ê´€ë¦¬ ì™„ë²½ ê°€ì´ë“œ](/post/global-state)
- [ë¦¬ì•¡íŠ¸ í´ë¦° ì•„í‚¤í…ì²˜ - 3ê°œ í•µì‹¬ ë ˆì´ì–´ë¡œ ì„¤ê³„í•˜ëŠ” ìœ ì§€ë³´ìˆ˜ì„±](/post/react-clean-architecture)
