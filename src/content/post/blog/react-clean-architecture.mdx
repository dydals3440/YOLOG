---
title: ë¦¬ì•¡íŠ¸ í´ë¦° ì•„í‚¤í…ì²˜ - 3ê°œ í•µì‹¬ ë ˆì´ì–´ë¡œ ì„¤ê³„í•˜ëŠ” ìœ ì§€ë³´ìˆ˜ì„±
date: 2025-11-09
updatedDate: 2025-11-09
tags:
  [
    ë¦¬ì•¡íŠ¸,
    React,
    í´ë¦° ì•„í‚¤í…ì²˜,
    Clean Architecture,
    í”„ë¡ íŠ¸ì—”ë“œ ì•„í‚¤í…ì²˜,
    Repository íŒ¨í„´,
    Mapper,
    TanStack Query,
    Domain,
    Entity,
  ]
category: DEVELOPMENT
image: "/images/react-clean-architecture/thumbnail.webp"
---

ì™„ë²½í•œ ì•„í‚¤í…ì²˜ëŠ” ì—†ë‹¤. í•˜ì§€ë§Œ **ë³€í™”ì— ìœ ì—°í•œ êµ¬ì¡°**ëŠ” ìˆë‹¤.

ê°œë°œìë¼ë©´ í•œ ë²ˆì¯¤ ì´ëŸ° ê³ ë¯¼ì„ í•´ë´¤ì„ ê²ƒì´ë‹¤. "ì˜¤ëŠ˜ ë‚´ê°€ ë‚´ë¦° ì„¤ê³„ ê²°ì •ì´ 6ê°œì›” ë’¤ì— ë°œëª©ì„ ì¡ì§€ëŠ” ì•Šì„ê¹Œ?" íŠ¹íˆ í”„ë¡ íŠ¸ì—”ë“œëŠ” ê¸°íš ë³€ê²½, API ìŠ¤í™ ë³€ë™, ë””ìì¸ ìˆ˜ì •ì´ ë¹ˆë²ˆí•œ ì˜ì—­ì´ë‹¤. ë³€ê²½ì€ ë¶ˆê°€í”¼í•˜ë‹¤.

ë¬¸ì œëŠ” ë³€ê²½ ê·¸ ìì²´ê°€ ì•„ë‹ˆë‹¤. **ë³€ê²½ì˜ íŒŒê¸‰ íš¨ê³¼**ê°€ ë¬¸ì œë‹¤. ì‘ì€ ìˆ˜ì • í•˜ë‚˜ê°€ 10ê°œ íŒŒì¼ë¡œ ë²ˆì§€ê³ , ì˜ˆìƒì¹˜ ëª»í•œ ì‚¬ì´ë“œ ì´í™íŠ¸ê°€ ë°œìƒí•œë‹¤. ìš°ë¦¬ëŠ” ì´ëŸ° êµ¬ì¡°ì—ì„œ ë²—ì–´ë‚˜ê³  ì‹¶ë‹¤.

ê¸°íšì´ ë°”ë€” ë•Œë§ˆë‹¤ 10ê°œ ì´ìƒì˜ íŒŒì¼ì„ ìˆ˜ì •í•´ë³¸ ì  ìˆëŠ”ê°€? ì„œë²„ API í•„ë“œëª… í•˜ë‚˜ ë°”ë€Œì—ˆëŠ”ë° ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ê³ ì³ì•¼ í–ˆë˜ ê²½í—˜ì€?

ìš°ë¦¬ ëª©í‘œëŠ” ì¥í•™ì¹´ë“œ ì‚¬ìš©ìë“¤ì´ ë” ì˜ í™œìš©í•  ìˆ˜ ìˆë„ë¡ **ì‚¬ë‚´ SaaS íˆ´ë¡œ ê¸°ëŠ¥ì„ ë‚´ì¬í™”**í•˜ëŠ” ê²ƒì´ë‹¤. ì œíœ´ ì¹´ë“œì‚¬ëŠ” í˜‘ì—… ê´€ê³„ì´ê¸°ì— **ê°ì‚¬í•˜ê²Œë„ íŠ¹ì • APIë“¤ì„ ì œê³µ**ë°›ì•„ ì‚¬ìš©í•˜ê³  ìˆì§€ë§Œ, ë‹¤ë¥¸ ì™¸ë¶€ ì¹´ë“œì‚¬ ì„œë¹„ìŠ¤ì— ë¹„í•˜ë©´ **ì•„ì§ API ìì²´ê°€ ë¹ˆì•½**í•˜ë‹¤.

í•„ìš”í•œ APIë“¤ì´ ì œê³µë˜ì§€ ì•Šì•„ ìˆëŠ” APIë¡œ ë¹„íš¨ìœ¨ì ì´ì§€ë§Œ ì–´ë–»ê²Œë“  ë§Œë“¤ì–´ë‚´ê±°ë‚˜, ì¹´ë“œì‚¬ì˜ ì¼ì • ê¸°ì•½ë§Œ ë¯¿ê³  ê¸°ë‹¤ë¦¬ê³  ìˆì—ˆë‹¤. ì¼ì •ì´ ë¶ˆëª…í™•í•˜ë‹¤ ë³´ë‹ˆ **ê¸°íšì´ ìì£¼ ë°”ë€Œì—ˆë‹¤**. ì—¬ëŸ¬ APIë¥¼ ì¡°í•©í•˜ê³ , ë¶ˆí•„ìš”í•œ í˜¸ì¶œì„ ë°˜ë³µí•˜ê³ , ë°ì´í„° ì‹±í¬ë¥¼ ë§ì¶”ëŠ” ì„ì‹œ ì½”ë“œê°€ ìŒ“ì—¬ê°”ë‹¤.

íŒ€ì›ë“¤ì€ ì¦ì€ ë³€ê²½ì— ì§€ì³¤ë‹¤. **ë³€ê²½ì— ìœ ì—°í•œ êµ¬ì¡°**ê°€ í•„ìš”í–ˆë‹¤. ë‚˜ì¤‘ì— ì¹´ë“œì‚¬ê°€ ì œëŒ€ë¡œ ëœ APIë¥¼ ì œê³µí•˜ë©´ ë¹ ë¥´ê²Œ êµì²´í•  ìˆ˜ ìˆë„ë¡, **ì™¸ë¶€ ì˜ì¡´ì„±ì„ ê²©ë¦¬í•˜ëŠ” ì„¤ê³„**ê°€ í•„ìˆ˜ì˜€ë‹¤.

### ìš°ë¦¬ê°€ ì•Œê³  ìˆë˜ ê²ƒ

í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•  ë•Œ ìš°ë¦¬ëŠ” ëª‡ ê°€ì§€ë¥¼ ì•Œê³  ìˆì—ˆë‹¤:

- ì¥í•™ì¹´ë“œ ê¸°ëŠ¥ì„ SaaS íˆ´ì— ë‚´ì¬í™”í•´ì•¼ í•œë‹¤
- ì œíœ´ ì¹´ë“œì‚¬ì˜ APIë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤
- ì‚¬ìš©ìë“¤ì´ í¸ë¦¬í•˜ê²Œ ì¹´ë“œë¥¼ í™œìš©í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤

### í•˜ì§€ë§Œ í˜„ì‹¤ì€ ë‹¬ëë‹¤

- APIê°€ ë¹ˆì•½í•´ì„œ í•„ìš”í•œ ê¸°ëŠ¥ì„ ì§ì ‘ ì¡°í•©í•´ì•¼ í–ˆë‹¤
- ì¹´ë“œì‚¬ì˜ ì¼ì •ì´ ë¶ˆëª…í™•í•´ì„œ ê¸°íšì´ ìì£¼ ë°”ë€Œì—ˆë‹¤
- ì„ì‹œ ì½”ë“œê°€ ìŒ“ì´ë©´ì„œ ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë ¤ì›Œì¡Œë‹¤
- ë‚˜ì¤‘ì— APIê°€ ê°œì„ ë˜ë©´ ì „ë©´ êµì²´ê°€ í•„ìš”í•  ê²ƒ ê°™ì•˜ë‹¤

ì´ë•Œ ìš°ë¦¬ëŠ” **ê°€ì •í•˜ì§€ ì•Šê¸°ë¡œ** í–ˆë‹¤. "ì¹´ë“œì‚¬ APIê°€ ì•ˆì •ì ì¼ ê²ƒì´ë‹¤", "ê¸°íšì´ í¬ê²Œ ë°”ë€Œì§€ ì•Šì„ ê²ƒì´ë‹¤"ë¼ëŠ” ê°€ì •ì€ ìœ„í—˜í–ˆë‹¤. ëŒ€ì‹  **ë³€í™”ë¥¼ ì „ì œ**ë¡œ ì„¤ê³„í•˜ê¸°ë¡œ í–ˆë‹¤.

ì„œë²„ë‚˜ ì•± ê°œë°œì—ì„œëŠ” ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•˜ì—¬ í´ë¦° ì•„í‚¤í…ì²˜ë¡œ ì™¸ë¶€ ì˜ì¡´ì„±ì„ ê²©ë¦¬í•œë‹¤. ë¦¬ì•¡íŠ¸ì—ì„œ ë§ì´ í™œìš©í•˜ëŠ” ë°©ë²•ì€ ì•„ë‹ˆì§€ë§Œ ê°€ëŠ¥í•˜ë‹¤ê³  íŒë‹¨í–ˆê³ , í´ë¦° ì•„í‚¤í…ì²˜ë¥¼ ë„ì…í•˜ë©´ ì–´ëŠì •ë„ ê°œì„ í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ì•˜ë‹¤.

ë„ì… í›„ ì¹´ë“œì‚¬ê°€ ì œëŒ€ë¡œ ëœ APIë¥¼ ì œê³µí•˜ë©´, **Data ë ˆì´ì–´ë§Œ ìˆ˜ì •**í•˜ë©´ ëœë‹¤. ì—¬ëŸ¬ APIë¥¼ ì¡°í•©í•˜ë˜ ë³µì¡í•œ ë¡œì§ì´ ì‚¬ë¼ì§„ë‹¤.

ì–´ë–»ê²Œ ì´ëŸ° ë³€í™”ê°€ ê°€ëŠ¥í–ˆì„ê¹Œ? ë¨¼ì € ê¸°ì¡´ ë°©ì‹ì˜ ë¬¸ì œì ë¶€í„° ì‚´í´ë³´ì.

---

## ê¸°ì¡´ ë°©ì‹ì˜ ë¬¸ì œì 

ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤ë¡œ ì´í•´í•´ë³´ì. ë°±ì—”ë“œíŒ€ì´ í† ìŠ¤ í˜ì´ë¨¼ì¸ ì™€ Stripe APIë¥¼ ê°ê° êµ¬ì¶•í–ˆê³ , ì´ì œ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ê²°ì œ í™”ë©´ì„ ë§Œë“¤ì–´ì•¼ í•œë‹¤. ë‘ ê²Œì´íŠ¸ì›¨ì´ ëª¨ë‘ ì§€ì›í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ë‹¤.

```ts
// âŒ TossConfirmButton.tsx - í† ìŠ¤ í˜ì´ë¨¼ì¸  ê²°ì œ ìŠ¹ì¸
import { useMutation } from "@tanstack/react-query";
import axios from "axios";

export function TossConfirmButton({ order, paymentKey }) {
  const { mutate } = useMutation({
    mutationFn: async () => {
      // âŒ ë¬¸ì œ 2: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‚°ì¬ - ê²€ì¦ ë¡œì§ì´ ì»´í¬ë„ŒíŠ¸ì— ì§ì ‘ ìˆìŒ
      if (order.totalAmount < 10_000) {
        throw new Error("ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì€ 10,000ì›ì…ë‹ˆë‹¤");
      }

      // âŒ ë¬¸ì œ 1: API ì—”ë“œí¬ì¸íŠ¸ê°€ ì»´í¬ë„ŒíŠ¸ì— ë°•í˜€ìˆìŒ
      const response = await axios.post("/api/payments/toss/confirm", {
        paymentKey,
        orderId: order.orderId,
        amount: order.totalAmount,
      });

      return response.data; // { paymentKey, status: "DONE", totalAmount, ... }
    },
    onSuccess: (data) => {
      // âŒ ë¬¸ì œ 3: í† ìŠ¤ ì‘ë‹µ í˜•ì‹ì— ì§ì ‘ ì˜ì¡´
      alert(
        `ê²°ì œ ì™„ë£Œ! ê²°ì œ í‚¤: ${data.paymentKey}, ê¸ˆì•¡: ${data.totalAmount}ì›`
      );
    },
  });

  return <button onClick={() => mutate()}>í† ìŠ¤ ê²°ì œ ìŠ¹ì¸</button>;
}
```

```ts
// âŒ StripeConfirmButton.tsx - Stripe ê²°ì œ ìŠ¹ì¸
import { useMutation } from "@tanstack/react-query";
import axios from "axios";

export function StripeConfirmButton({ order, paymentIntentId }) {
  const { mutate } = useMutation({
    mutationFn: async () => {
      // âŒ ë¬¸ì œ 2: ê²€ì¦ ë¡œì§ì´ ì¤‘ë³µë¨
      if (order.totalAmount < 10_000) {
        throw new Error("ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì€ 10,000ì›ì…ë‹ˆë‹¤");
      }

      // âŒ ë¬¸ì œ 1: Stripe ì—”ë“œí¬ì¸íŠ¸ê°€ ì»´í¬ë„ŒíŠ¸ì— ë°•í˜€ìˆìŒ
      const response = await axios.post("/api/payments/stripe/confirm", {
        paymentIntentId, // ë‹¤ë¥¸ í•„ë“œëª…
        orderId: order.orderId,
        amount: order.totalAmount,
      });

      return response.data; // { id, amount, status: "succeeded", ... }
    },
    onSuccess: (data) => {
      // âŒ ë¬¸ì œ 3: Stripe ì‘ë‹µ í˜•ì‹ì— ì§ì ‘ ì˜ì¡´ (í•„ë“œëª…ì´ ë‹¤ë¦„)
      alert(`ê²°ì œ ì™„ë£Œ! ê²°ì œ ID: ${data.id}, ê¸ˆì•¡: ${data.amount}ì›`);
    },
  });

  return <button onClick={() => mutate()}>Stripe ê²°ì œ ìŠ¹ì¸</button>;
}
```

ë‘ ì»´í¬ë„ŒíŠ¸ëŠ” ê±°ì˜ ë™ì¼í•˜ì§€ë§Œ ë¯¸ë¬˜í•˜ê²Œ ë‹¤ë¥´ë‹¤. API ì—”ë“œí¬ì¸íŠ¸, ìš”ì²­ í•„ë“œëª…, ì‘ë‹µ í•„ë“œëª…ì´ ëª¨ë‘ ë‹¤ë¥´ë‹¤. ì´ê²Œ ë¬´ìŠ¨ ë¬¸ì œì¼ê¹Œ?

### ë¬¸ì œ 1: API ì—”ë“œí¬ì¸íŠ¸ ì˜ì¡´ì„±

```ts
// âŒ TossConfirmButton.tsx
await axios.post("/api/payments/toss/confirm", { ... });

// âŒ StripeConfirmButton.tsx
await axios.post("/api/payments/stripe/confirm", { ... });
```

ê° ì»´í¬ë„ŒíŠ¸ê°€ íŠ¹ì • ë°±ì—”ë“œ API ì—”ë“œí¬ì¸íŠ¸ì— ì§ì ‘ ì˜ì¡´í•œë‹¤. ë°±ì—”ë“œê°€ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë³€ê²½í•˜ë©´(`/api/payments/toss/confirm` â†’ `/api/v2/toss/payments/confirm`) ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¾ì•„ì„œ ìˆ˜ì •í•´ì•¼ í•œë‹¤.

### ë¬¸ì œ 2: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‚°ì¬

```ts
// âŒ TossConfirmButton.tsx
if (order.totalAmount < 10_000)
  throw new Error("ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì€ 10,000ì›ì…ë‹ˆë‹¤");

// âŒ StripeConfirmButton.tsx
if (order.totalAmount < 10_000)
  throw new Error("ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì€ 10,000ì›ì…ë‹ˆë‹¤");
```

ê²€ì¦ ë¡œì§ì´ ë‘ ì»´í¬ë„ŒíŠ¸ì— ì¤‘ë³µëœë‹¤. "ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì„ 15,000ì›ìœ¼ë¡œ ì˜¬ë ¤ì£¼ì„¸ìš”" ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¾ì•„ ìˆ˜ì •í•´ì•¼ í•œë‹¤.

### ë¬¸ì œ 3: ì™¸ë¶€ ì‘ë‹µ í˜•ì‹ ì˜ì¡´

```ts
// âŒ TossConfirmButton.tsx
alert(`ê²°ì œ í‚¤: ${data.paymentKey}, ê¸ˆì•¡: ${data.totalAmount}ì›`);

// âŒ StripeConfirmButton.tsx
alert(`ê²°ì œ ID: ${data.id}, ê¸ˆì•¡: ${data.amount}ì›`);
```

í† ìŠ¤ì™€ StripeëŠ” ì‘ë‹µ í•„ë“œëª…ì´ ë‹¤ë¥´ë‹¤ (`paymentKey` vs `id`, `totalAmount` vs `amount`). ê° ì»´í¬ë„ŒíŠ¸ê°€ ì„œë¡œ ë‹¤ë¥¸ í˜•ì‹ì— ì˜ì¡´í•˜ê¸° ë•Œë¬¸ì—, ë°±ì—”ë“œê°€ ì‘ë‹µ í˜•ì‹ì„ ë³€ê²½í•˜ë©´ í•´ë‹¹ ê²Œì´íŠ¸ì›¨ì´ë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ìˆ˜ì •í•´ì•¼ í•œë‹¤.

### ë¬¸ì œ 4: ë ˆì´ì–´ êµ¬ë¶„ ì—†ìŒ

"í›…ìœ¼ë¡œ ë¶„ë¦¬í•˜ë©´ ë˜ì§€ ì•Šë‚˜?" ë§ë‹¤. í›…ìœ¼ë¡œ ì¬ì‚¬ìš©ì€ í•´ê²°í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ **ì–´ë””ê¹Œì§€ ë¶„ë¦¬**í•´ì•¼ í• ê¹Œ?

```ts
// âŒ í›…ìœ¼ë¡œë§Œ ë¶„ë¦¬í•˜ë©´ ì—¬ì „íˆ ë¬¸ì œ
async function confirmTossPayment(order, paymentKey) {
  if (order.totalAmount < MIN_AMOUNT) throw new Error(); // ê²€ì¦ (Domain)

  const response = await axios.post(
    // API í˜¸ì¶œ (Infrastructure)
    "/api/payments/toss/confirm",
    {
      paymentKey, // í† ìŠ¤ í˜•ì‹ (Data)
      orderId: order.orderId,
      amount: order.totalAmount,
    }
  );

  return response.data; // í† ìŠ¤ ì‘ë‹µ í˜•ì‹ (Data)
}
```

ì´ í•¨ìˆ˜ëŠ” **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**(ê²€ì¦), **API í˜¸ì¶œ**(axios), **ë°±ì—”ë“œ API í˜•ì‹**(`/api/payments/toss/confirm`, í† ìŠ¤ ì‘ë‹µ í•„ë“œëª…)ì´ ë’¤ì„ì—¬ ìˆë‹¤.

- `axios` â†’ `fetch` ë³€ê²½ ì‹œ: í•¨ìˆ˜ ìˆ˜ì • í•„ìš”
- ìµœì†Œ ê¸ˆì•¡ ê·œì¹™ ë³€ê²½ ì‹œ: í•¨ìˆ˜ ìˆ˜ì • í•„ìš”
- ì„œë²„ í•„ë“œëª… ë³€ê²½ ì‹œ: í•¨ìˆ˜ ìˆ˜ì • í•„ìš”
- **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**: API ëª¨í‚¹ ì—†ì´ ê²€ì¦ ë¡œì§ë§Œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ì—†ìŒ

í›…ì€ **ë¡œì§ ì¬ì‚¬ìš©**ë§Œ í•´ê²°í•œë‹¤. **ì±…ì„ ë¶„ë¦¬**ëŠ” í•´ê²°í•˜ì§€ ëª»í•œë‹¤. í´ë¦° ì•„í‚¤í…ì²˜ëŠ” ê° ë ˆì´ì–´ì˜ **ë³€ê²½ ì´ìœ ë¥¼ ë¶„ë¦¬**í•œë‹¤.

---

![ë¦¬ì•¡íŠ¸ í´ë¦° ì•„í‚¤í…ì²˜ - 3ê°œ í•µì‹¬ ë ˆì´ì–´ë¡œ ì—­í• ì„ ë¶„ë¦¬í•´ì„œ ë³€ê²½ì— ê°•í•œ êµ¬ì¡° ë§Œë“¤ê¸°](/images/react-clean-architecture/thumbnail.webp)

## í´ë¦° ì•„í‚¤í…ì²˜ë€?

í´ë¦° ì•„í‚¤í…ì²˜ëŠ” ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ êµ¬ì¡°ë‹¤. í•µì‹¬ì€ **ì—­í• ì„ ë¶„ë¦¬**í•˜ëŠ” ê²ƒì´ë‹¤.

ë§ˆì¹˜ ë°°ë‹¬ ì•±ì„ ë– ì˜¬ë ¤ë³´ì. ë°°ë‹¬ ì•±ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì—­í• ì´ ìˆë‹¤:

- **ê³ ê°**: ìŒì‹ì„ ì£¼ë¬¸í•œë‹¤
- **ì‹ë‹¹**: ìŒì‹ì„ ë§Œë“ ë‹¤
- **ë¼ì´ë”**: ìŒì‹ì„ ë°°ë‹¬í•œë‹¤
- **ì•±**: ì£¼ë¬¸ì„ ì „ë‹¬í•˜ê³  ìƒíƒœë¥¼ ê´€ë¦¬í•œë‹¤

ê°ìì˜ ì—­í• ì´ ëª…í™•í•˜ê³ , ì„œë¡œ ë…ë¦½ì ì´ë‹¤. ë¼ì´ë”ê°€ ë°”ë€Œì–´ë„ ì‹ë‹¹ì€ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ”ë‹¤. ì‹ë‹¹ì˜ ë©”ë‰´ê°€ ë°”ë€Œì–´ë„ ë¼ì´ë”ëŠ” ìƒê´€ì—†ë‹¤.

í´ë¦° ì•„í‚¤í…ì²˜ë„ ë§ˆì°¬ê°€ì§€ë‹¤. ì½”ë“œë¥¼ **3ê°œì˜ í•µì‹¬ ë ˆì´ì–´**ë¡œ ë‚˜ëˆ„ê³ , ê° ë ˆì´ì–´ëŠ” ëª…í™•í•œ ì—­í• ì„ ê°€ì§„ë‹¤.

### 3ê°œ í•µì‹¬ ë ˆì´ì–´ + ë³´ì¡° êµ¬ì„±ìš”ì†Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Presentation Layer (React)                  â”‚
â”‚  Components, Pages, Hooks, State (Zustand + TanStack)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ depends on
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Domain Layer (Business Logic)                  â”‚
â”‚     Use Cases, Entities, Repository Interfaces          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ implements
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Data Layer (API Access)                     â”‚
â”‚    Repository Impl, DTOs, Mappers, Data Sources         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ uses
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Infrastructure Layer (External Services)         â”‚
â”‚            HTTP Client (Axios), Storage                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

              Core Layer (Cross-cutting Concerns)
          Config, Constants, Utils, Errors, Validators
            â† ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì°¸ì¡° ê°€ëŠ¥
```

**3ê°œ í•µì‹¬ ë ˆì´ì–´** (Swift, Kotlin, Flutterì™€ ë™ì¼):

- **Presentation**: UIì™€ ìƒí˜¸ì‘ìš© (Hook, Component)
- **Domain**: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ê³¼ ë¡œì§ (UI, API ëª¨ë¦„)
- **Data**: ì™¸ë¶€ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ë‚´ë¶€ í˜•ì‹ìœ¼ë¡œ ë³€í™˜

**3ê°œ ë³´ì¡° êµ¬ì„±ìš”ì†Œ**:

- **DI**: ì˜ì¡´ì„± ì£¼ì… ë©”ì»¤ë‹ˆì¦˜ (ëª¨ë“  ë ˆì´ì–´ë¥¼ ì¡°í•©)
- **Infrastructure**: ì™¸ë¶€ ë„êµ¬ ì¶”ìƒí™” (HTTP í´ë¼ì´ì–¸íŠ¸, ë¼ì´ë¸ŒëŸ¬ë¦¬)
- **Core**: ê³µí†µ ìœ í‹¸ë¦¬í‹° (Constants, Utils, Errors, Validators)

í•µì‹¬ì€ `Domain`ì´ **ì™„ì „íˆ ë…ë¦½ì **ì´ë¼ëŠ” ì ì´ë‹¤. `Domain`ì€ UIê°€ ì–´ë–»ê²Œ ìƒê²¼ëŠ”ì§€, APIê°€ ì–´ë–¤ í˜•ì‹ì¸ì§€ ì „í˜€ ëª¨ë¥¸ë‹¤. ì˜¤ì§ **ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™**ë§Œ ë‹´ë‹¹í•œë‹¤.

### ì˜ì¡´ì„± ë°©í–¥

```
Presentation â†’ Domain â† Data â† Infrastructure
       â†“          â†“        â†“          â†“
                  DI (ëª¨ë“  ë ˆì´ì–´ë¥¼ ì¡°í•©)
       â†“          â†“        â†“          â†“
              Core (ëª¨ë“  ë ˆì´ì–´ê°€ ì˜ì¡´ ê°€ëŠ¥)
```

ì˜ì¡´ì„±ì€ **í•­ìƒ ì•ˆìª½ìœ¼ë¡œ** í–¥í•œë‹¤. `Domain`ì€ `Core`ë§Œ ì˜ì¡´í•˜ê³ , ë‚˜ë¨¸ì§€ ë ˆì´ì–´(`Data`, `Infrastructure`, `Presentation`)ëŠ” `Domain`ì„ ì˜ì¡´í•œë‹¤.

`DI` ë ˆì´ì–´ëŠ” ê°€ì¥ ë°”ê¹¥ìª½ì— ìœ„ì¹˜í•˜ì—¬ ëª¨ë“  ë ˆì´ì–´ì˜ êµ¬ì²´ì ì¸ êµ¬í˜„ì²´ë¥¼ ì¡°í•©í•˜ê³  ì˜ì¡´ì„±ì„ ì£¼ì…í•œë‹¤. `Core` ë ˆì´ì–´ëŠ” ê³µí†µ ìœ í‹¸ë¦¬í‹°ë¡œ, ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì°¸ì¡° ê°€ëŠ¥í•˜ë‹¤.

**í•µì‹¬ ì›ì¹™**:

- **Domainì€ ìˆœìˆ˜í•˜ë‹¤**: `Core`ë¥¼ ì œì™¸í•œ ì–´ë–¤ ë ˆì´ì–´ë„ importí•˜ì§€ ì•ŠëŠ”ë‹¤
- **Repository InterfaceëŠ” Domainì—**: `Data` LayerëŠ” Domainì˜ interfaceë¥¼ **êµ¬í˜„**í•œë‹¤
- **ì˜ì¡´ì„± ì—­ì „**: ê³ ìˆ˜ì¤€(`Domain`)ì´ ì €ìˆ˜ì¤€(`Data`)ì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤

í´ë¦° ì•„í‚¤í…ì²˜ì˜ ì°½ì‹œì Uncle Bobì€ ë‹¤ìŒê³¼ ê°™ì€ ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ ì˜ì¡´ì„± ë°©í–¥ì„ ì„¤ëª…í•œë‹¤:

![Uncle Bobì˜ í´ë¦° ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ - ë™ì‹¬ì› êµ¬ì¡°ë¡œ ë ˆì´ì–´ê°€ ë‚˜ë‰˜ì–´ì ¸ ìˆê³ , ì˜ì¡´ì„±ì€ í•­ìƒ ì•ˆìª½ìœ¼ë¡œ í–¥í•œë‹¤](/images/react-clean-architecture/clean-architecture.webp)

ì´ ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ ì£¼ëª©í•  ì ì€ **ëª¨ë“  í™”ì‚´í‘œê°€ ì•ˆìª½ì„ ê°€ë¦¬í‚¨ë‹¤**ëŠ” ê²ƒì´ë‹¤. ë°”ê¹¥ìª½ ë ˆì´ì–´(UI, DB, ì™¸ë¶€ ì„œë¹„ìŠ¤)ëŠ” ì•ˆìª½ì„ ì˜ì¡´í•˜ì§€ë§Œ, ì•ˆìª½(ì¤‘ì‹¬ì˜ Entities/Use Cases)ì€ ë°”ê¹¥ì„ ì „í˜€ ëª¨ë¥¸ë‹¤. ì´ê²ƒì´ ë°”ë¡œ **ì˜ì¡´ì„± ì—­ì „ ì›ì¹™**ì´ë‹¤.

ìš°ë¦¬ í”„ë¡œì íŠ¸ëŠ” ì´ êµ¬ì¡°ë¥¼ React ìƒíƒœê³„ì— ë§ê²Œ 3ê°œ í•µì‹¬ ë ˆì´ì–´ë¡œ ì¬êµ¬ì„±í–ˆë‹¤. í•˜ì§€ë§Œ í•µì‹¬ ì² í•™ì€ ë™ì¼í•˜ë‹¤: `Domain`ì€ ìˆœìˆ˜í•˜ê³ , ì˜ì¡´ì„±ì€ í•­ìƒ ì•ˆìª½ìœ¼ë¡œ íë¥¸ë‹¤.

> ğŸ’¡ ë” ìì„¸í•œ ë‚´ìš©ì€ Uncle Bobì˜ [Clean Architecture ë¸”ë¡œê·¸](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)ë¥¼ ì°¸ê³ í•˜ì.

ì´ê²Œ ì™œ ì¤‘ìš”í• ê¹Œ? `Domain`ì— ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë„£ìœ¼ë©´, UIê°€ ë°”ë€Œë“  APIê°€ ë°”ë€Œë“  `Domain`ì€ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ”ë‹¤. ë§ˆì¹˜ ì‹ë‹¹ì´ ë©”ë‰´ë¥¼ ë°”ê¿”ë„ ë¼ì´ë”ê°€ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ” ê²ƒì²˜ëŸ¼.

ê°œë…ì„ ì´í•´í–ˆìœ¼ë‹ˆ, ì´ì œ ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œ ì–´ë–»ê²Œ êµ¬í˜„í•˜ëŠ”ì§€ ë³´ì.

---

## í´ë” êµ¬ì¡°

ì´ ê¸€ì€ **ê°„ë‹¨í•œ ë„ë©”ì¸ì˜ ì„œë¹„ìŠ¤** ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆë‹¤. ë³µì¡í•œ ë„ë©”ì¸ êµ¬ì¡°ëŠ” ì°¸ê³ ìš©ìœ¼ë¡œ í•¨ê»˜ ì†Œê°œí•œë‹¤.

### ê°„ë‹¨í•œ ë„ë©”ì¸ì˜ ì„œë¹„ìŠ¤

```
src/
â”œâ”€â”€ di/
â”‚   â””â”€â”€ DIContainer.ts             # ì˜ì¡´ì„± ì£¼ì… ì»¨í…Œì´ë„ˆ
â”‚
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ constants.ts               # ì „ì—­ ìƒìˆ˜
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ formatters.ts          # ê³µí†µ í¬ë§·íŒ… í•¨ìˆ˜
â”‚   â””â”€â”€ validators/
â”‚       â””â”€â”€ paymentValidator.ts    # ê²€ì¦ ìœ í‹¸
â”‚
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ http/
â”‚   â”‚   â”œâ”€â”€ httpClient.ts          # HTTP í´ë¼ì´ì–¸íŠ¸ ì¶”ìƒí™”
â”‚   â”‚   â””â”€â”€ axiosHttpClient.ts     # Axios êµ¬í˜„ì²´
â”‚   â””â”€â”€ external/
â”‚       â””â”€â”€ analytics.ts            # ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ datasources/
â”‚   â”‚   â”œâ”€â”€ remote/                # ì„œë²„ API í˜¸ì¶œ
â”‚   â”‚   â”‚   â”œâ”€â”€ tossPaymentsDataSource.ts
â”‚   â”‚   â”‚   â””â”€â”€ stripeDataSource.ts
â”‚   â”‚   â””â”€â”€ local/                 # ë¸Œë¼ìš°ì € ì €ì¥ì†Œ (localStorage, sessionStorage)
â”‚   â”‚       â”œâ”€â”€ orderCacheDataSource.ts
â”‚   â”‚       â”œâ”€â”€ settingsDataSource.ts
â”‚   â”‚       â””â”€â”€ cartDataSource.ts
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ PaymentRepositoryImpl.ts
â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ tossPaymentDto.ts      # openapi-typescriptë¡œ ìë™ ìƒì„±
â”‚   â”‚   â””â”€â”€ stripePaymentDto.ts    # openapi-typescriptë¡œ ìë™ ìƒì„±
â”‚   â””â”€â”€ mappers/
â”‚       â”œâ”€â”€ tossPaymentMapper.ts
â”‚       â””â”€â”€ stripePaymentMapper.ts
â”‚
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/
â”‚   â”œâ”€â”€ repositories/
â”‚   â””â”€â”€ useCases/
â”‚
â””â”€â”€ presentation/
    â”œâ”€â”€ hooks/
    â”œâ”€â”€ components/
    â””â”€â”€ adapters/
```

**remote/ vs local/ ë¶„ë¦¬ ì´ìœ **:

- **remote/**: ì„œë²„ API í˜¸ì¶œì„ ë‹´ë‹¹í•œë‹¤ (`axios`, `fetch` ì‚¬ìš©)
- **local/**: ë¸Œë¼ìš°ì € ì €ì¥ì†Œë¥¼ ë‹´ë‹¹í•œë‹¤ (`localStorage`, `sessionStorage`, ë©”ëª¨ë¦¬ ìºì‹œ)
- ì±…ì„ì´ ë‹¤ë¥´ë¯€ë¡œ ë¶„ë¦¬í•˜ë©´ ë³€ê²½ì— ê°•í•˜ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ APIê°€ `REST`ì—ì„œ `GraphQL`ë¡œ ë°”ë€Œì–´ë„ `remote/` í´ë”ë§Œ ìˆ˜ì •í•˜ë©´ ëœë‹¤

**ì¥ì **:

- í•œëˆˆì— ì „ì²´ ë ˆì´ì–´ êµ¬ì¡° íŒŒì•… ê°€ëŠ¥
- ë ˆì´ì–´ë³„ ì±…ì„ì´ ëª…í™•í•¨
- íŒ€ ì˜¨ë³´ë”©ì´ ì‰¬ì›€ (ìƒˆë¡œìš´ ê°œë°œìê°€ êµ¬ì¡° ì´í•´í•˜ê¸° ì‰¬ì›€)

**ë‹¨ì **:

- ë„ë©”ì¸ì´ ë§ì•„ì§€ë©´ íŒŒì¼ ì°¾ê¸° ì–´ë ¤ì›€
- í•œ ë„ë©”ì¸ ìˆ˜ì • ì‹œ ì—¬ëŸ¬ í´ë”ë¥¼ ì´ë™í•´ì•¼ í•¨

---

### ë³µì¡í•œ ë„ë©”ì¸ì˜ ì„œë¹„ìŠ¤

ë„ë©”ì¸ì´ ë§ê±°ë‚˜ íŒ€ ê·œëª¨ê°€ í° ê²½ìš° **ë„ë©”ì¸ì„ ê¸°ì¤€ìœ¼ë¡œ í´ë”ë¥¼ ë‚˜ëˆŒ ìˆ˜ ìˆë‹¤**.

```
apps/web/src/
â”œâ”€â”€ domains/                    # ë„ë©”ì¸ë³„ ì™„ì „ ë…ë¦½
â”‚   â”œâ”€â”€ auth/                   # ì¸ì¦ ë„ë©”ì¸
â”‚   â”‚   â”œâ”€â”€ di/
â”‚   â”‚   â”‚   â””â”€â”€ container.ts
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”‚   â””â”€â”€ useCases/
â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”‚   â”œâ”€â”€ datasources/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ remote/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ authDataSource.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ local/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ tokenDataSource.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”‚   â””â”€â”€ mappers/
â”‚   â”‚   â””â”€â”€ presentation/
â”‚   â”‚       â”œâ”€â”€ hooks/
â”‚   â”‚       â””â”€â”€ components/
â”‚   â”‚
â”‚   â”œâ”€â”€ payment/                # ê²°ì œ ë„ë©”ì¸
â”‚   â”‚   â”œâ”€â”€ di/
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â””â”€â”€ presentation/
â”‚   â”‚
â”‚   â”œâ”€â”€ user/                   # ì‚¬ìš©ì ë„ë©”ì¸
â”‚   â”‚   â”œâ”€â”€ di/
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â””â”€â”€ presentation/
â”‚   â”‚
â”‚   â””â”€â”€ [other-domains]/
â”‚
â””â”€â”€ core/                       # ëª¨ë“  ë„ë©”ì¸ì´ ê³µìœ 
    â”œâ”€â”€ infrastructure/         # HTTP, Storage ì¶”ìƒí™”
    â”‚   â”œâ”€â”€ http/
    â”‚   â”œâ”€â”€ storage/
    â”‚   â””â”€â”€ logging/
    â”œâ”€â”€ shared/                 # ë„ë©”ì¸ ë…ë¦½ì  ê³µí†µ ì½”ë“œ
    â”‚   â”œâ”€â”€ constants.ts
    â”‚   â”œâ”€â”€ utils/
    â”‚   â””â”€â”€ validators/
    â””â”€â”€ ui/                     # ê³µí†µ UI ì»´í¬ë„ŒíŠ¸
        â””â”€â”€ components/
            â”œâ”€â”€ Button.tsx
            â””â”€â”€ Input.tsx
```

**ì¥ì **:

- **ë„ë©”ì¸ë³„ë¡œ ì™„ì „íˆ ë…ë¦½ì **: ê° ë„ë©”ì¸ì´ ìì‹ ë§Œì˜ DI, Domain, Data, Presentationì„ ê°€ì§
- **í•œ ë„ë©”ì¸ ìˆ˜ì • ì‹œ í•´ë‹¹ í´ë”ë§Œ ì—´ë©´ ë¨**: íŒŒì¼ ì°¾ê¸°ê°€ í›¨ì”¬ ì‰¬ì›€
- **íŒ€ë³„ë¡œ ë„ë©”ì¸ ë‹´ë‹¹ ê°€ëŠ¥**: ì¸ì¦íŒ€ì€ `auth/`, ê²°ì œíŒ€ì€ `payment/` í´ë”ë§Œ ê´€ë¦¬

**ë‹¨ì **:

- ì´ˆê¸° êµ¬ì¡° ì„¤ì •ì´ ë³µì¡í•¨
- ë„ë©”ì¸ì´ ì ìœ¼ë©´ ì˜¤ë²„ì—”ì§€ë‹ˆì–´ë§ì´ ë  ìˆ˜ ìˆìŒ
- ë„ë©”ì¸ ê°„ ê²½ê³„ ì„¤ì •ì´ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŒ

---

### ì–¸ì œ ì–´ë–¤ êµ¬ì¡°ë¥¼ ì„ íƒí• ê¹Œ?

í”„ë¡œì íŠ¸ì˜ ë³µì¡ë„ì™€ íŒ€ êµ¬ì„±ì— ë”°ë¼ ì„ íƒí•  ìˆ˜ ìˆë‹¤:

| ìƒí™©                 | ê³ ë ¤í•  ìˆ˜ ìˆëŠ” êµ¬ì¡° | ì„ íƒ ì´ìœ              |
| -------------------- | ------------------- | --------------------- |
| **ë„ë©”ì¸ì´ ì ì„ ë•Œ** | ê°„ë‹¨í•œ ë„ë©”ì¸ êµ¬ì¡°  | ì‹¬í”Œí•˜ê³  ë¹ ë¥¸ ê°œë°œ    |
| **ë„ë©”ì¸ì´ ë§ì„ ë•Œ** | ë³µì¡í•œ ë„ë©”ì¸ êµ¬ì¡°  | ë„ë©”ì¸ë³„ ë…ë¦½ì„± í™•ë³´  |
| **ì†Œê·œëª¨ íŒ€**        | ê°„ë‹¨í•œ ë„ë©”ì¸ êµ¬ì¡°  | ë³µì¡ë„ ë‚®ì¶¤           |
| **íŒ€ ê·œëª¨ê°€ í´ ë•Œ**  | ë³µì¡í•œ ë„ë©”ì¸ êµ¬ì¡°  | íŒ€ë³„ ë„ë©”ì¸ ë‹´ë‹¹ ê°€ëŠ¥ |
| **ë‹¨ê¸° í”„ë¡œì íŠ¸**    | ê°„ë‹¨í•œ ë„ë©”ì¸ êµ¬ì¡°  | ë¹ ë¥¸ ê°œë°œ ìš°ì„         |

í”„ë¡œì íŠ¸ì˜ ë³µì¡ë„ì— ë”°ë¥¼ ìˆ˜ë„ ìˆê³ , íŒ€ì›ì´ ë§ì€ ê²½ìš° ì—…ë¬´ì˜ íš¨ìœ¨í™”ë¡œ ì¸í•´ êµ¬ì¡°ë¥¼ ë¶„ë¦¬í•  ìˆ˜ë„ ìˆë‹¤. **íš¨ìœ¨ì ìœ¼ë¡œ ê°œë°œí•  ìˆ˜ ìˆëŠ” ë°©í–¥ì„±ì„ ì„ íƒí•˜ëŠ” ê²Œ ì¤‘ìš”í•˜ë‹¤.**

**ì‹¤ìš©ì  ì¡°ì–¸**: ì²˜ìŒì—” ê°„ë‹¨í•œ êµ¬ì¡°ë¡œ ì‹œì‘í•˜ê³ , ë„ë©”ì¸ì´ë‚˜ íŒ€ì´ ì„±ì¥í•˜ë©´ ë³µì¡í•œ êµ¬ì¡°ë¡œ ì ì§„ì ìœ¼ë¡œ ì „í™˜í•  ìˆ˜ ìˆë‹¤.

ë§ˆì¹˜ ì§‘ì„ ì§“ë“¯ì´, ì²˜ìŒì—” ì‘ì€ ì§‘(ê°„ë‹¨í•œ êµ¬ì¡°)ì„ ì§“ê³ , ê°€ì¡±ì´ ëŠ˜ì–´ë‚˜ë©´(ë„ë©”ì¸/íŒ€ ì¦ê°€) ì¦ì¶•(ë³µì¡í•œ êµ¬ì¡° ì „í™˜)í•˜ëŠ” ê²ƒì´ë‹¤.

**í•µì‹¬ ì›ì¹™**: í´ë” êµ¬ì¡°ëŠ” íŒ€ê³¼ í”„ë¡œì íŠ¸ë¥¼ ìœ„í•œ **ë„êµ¬**ë‹¤. êµì¡°ì ìœ¼ë¡œ ë”°ë¥´ì§€ ë§ê³ , ìƒí™©ì— ë§ê²Œ ì„ íƒí•˜ì. ì™„ë²½í•œ êµ¬ì¡°ëŠ” ì—†ê³ , í”„ë¡œì íŠ¸ì— ë§ëŠ” êµ¬ì¡°ë§Œ ìˆì„ ë¿ì´ë‹¤.

ì´ì œ ê°€ì¥ ë°”ê¹¥ìª½ ë ˆì´ì–´ë¶€í„° ì°¨ë¡€ëŒ€ë¡œ ì‚´í´ë³´ì.

---

## Core Layer: ê³µí†µ ê¸°ëŠ¥ì˜ ì¤‘ì‹¬

`Core` ë ˆì´ì–´ëŠ” ì¡°ê¸ˆ íŠ¹ë³„í•˜ë‹¤. **ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ” ê³µí†µ ê¸°ëŠ¥**ì„ ë‹´ê³  ìˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ í´ë¦° ì•„í‚¤í…ì²˜ì—ì„œëŠ” ì˜ì¡´ì„±ì´ ì•ˆìª½ìœ¼ë¡œ í–¥í•˜ì§€ë§Œ, `Core`ëŠ” ì˜ˆì™¸ë‹¤.

ì™œ í•„ìš”í• ê¹Œ? ìƒìˆ˜, ì—ëŸ¬, ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ì²˜ëŸ¼ ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì½”ë“œë¥¼ ë§¤ë²ˆ ê° ë ˆì´ì–´ì— ì¤‘ë³µí•´ì„œ ë§Œë“¤ í•„ìš”ê°€ ìˆì„ê¹Œ? ê·¸ë ‡ì§€ ì•Šë‹¤. `Core`ì— í•œ ë²ˆë§Œ ì •ì˜í•˜ê³  ëª¨ë“  ë ˆì´ì–´ì—ì„œ ê°€ì ¸ë‹¤ ì“°ë©´ ëœë‹¤.

### Constants: ì „ì—­ ìƒìˆ˜

```ts
// core/constants.ts
export const MIN_PAYMENT_AMOUNT = 1_000; // ìµœì†Œ ê²°ì œ ê¸ˆì•¡
export const MAX_PAYMENT_AMOUNT = 1_000_000; // ìµœëŒ€ ê²°ì œ ê¸ˆì•¡
export const CURRENCY_UNIT = "ì›"; // í†µí™” ë‹¨ìœ„
```

### Validators: ê²€ì¦ ë¡œì§

```ts
// core/validators/paymentValidator.ts
import { MIN_PAYMENT_AMOUNT, MAX_PAYMENT_AMOUNT } from "../constants";

export const validatePaymentAmount = (amount: number): void => {
  if (amount < MIN_PAYMENT_AMOUNT) {
    throw new Error(`ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì€ ${MIN_PAYMENT_AMOUNT}ì›ì…ë‹ˆë‹¤`);
  }
  if (amount > MAX_PAYMENT_AMOUNT) {
    throw new Error(`ìµœëŒ€ ê²°ì œ ê¸ˆì•¡ì€ ${MAX_PAYMENT_AMOUNT}ì›ì…ë‹ˆë‹¤`);
  }
};
```

### Utils: ê³µí†µ ìœ í‹¸ë¦¬í‹°

```ts
// core/utils/formatters.ts
export const formatCurrency = (amount: number): string => {
  return amount.toLocaleString("ko-KR");
};

export const formatPayment = (payment: number): string => {
  return `${formatCurrency(payment)}ì›`;
};
```

`Core` ë ˆì´ì–´ëŠ” **ìˆœìˆ˜ í•¨ìˆ˜ì™€ ìƒìˆ˜**ë§Œ ë‹´ëŠ”ë‹¤. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ë‚˜ ì™¸ë¶€ ì˜ì¡´ì„±ì„ ê°€ì§€ë©´ ì•ˆ ëœë‹¤. ê·¸ë˜ì•¼ ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

---

ê³µí†µ ê¸°ëŠ¥ì„ ì •ì˜í–ˆìœ¼ë‹ˆ, ì´ì œ ì™¸ë¶€ ì„¸ê³„ì™€ì˜ ì—°ê²° ê³ ë¦¬ë¥¼ ì‚´í´ë³´ì.

## Infrastructure Layer: ì™¸ë¶€ ì„¸ê³„ì™€ì˜ ê²©ë¦¬

`Infrastructure` ë ˆì´ì–´ëŠ” ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë‚˜ HTTP í´ë¼ì´ì–¸íŠ¸ë¥¼ ì¶”ìƒí™”í•œë‹¤. ì™œ í•„ìš”í• ê¹Œ?

ë§Œì•½ `axios`ë¥¼ ì§ì ‘ ì“°ë‹¤ê°€ `fetch`ë¡œ ë°”ê¾¸ê³  ì‹¶ë‹¤ë©´? ëª¨ë“  ì½”ë“œë¥¼ ìˆ˜ì •í•´ì•¼ í•œë‹¤. í•˜ì§€ë§Œ ì¶”ìƒí™”í•´ë‘ë©´ êµ¬í˜„ì²´ë§Œ ë°”ê¾¸ë©´ ëœë‹¤.

```ts
// infrastructure/http/httpClient.ts
export interface HttpClient {
  get<T>(url: string): Promise<T>;
  post<T>(url: string, data: unknown): Promise<T>;
  put<T>(url: string, data: unknown): Promise<T>;
  delete<T>(url: string): Promise<T>;
}
```

ì´ê±´ **ì¸í„°í˜ì´ìŠ¤**ë‹¤. êµ¬í˜„ì²´ëŠ” ë”°ë¡œ ë§Œë“ ë‹¤.

```ts
// infrastructure/http/axiosHttpClient.ts
import axios from "axios";
import type { HttpClient } from "./httpClient";

export class AxiosHttpClient implements HttpClient {
  async get<T>(url: string): Promise<T> {
    const response = await axios.get(url);
    return response.data;
  }

  async post<T>(url: string, data: unknown): Promise<T> {
    const response = await axios.post(url, data);
    return response.data;
  }

  // put, deleteë„ ìœ ì‚¬í•˜ê²Œ êµ¬í˜„
}
```

ì´ì œ `axios`ì—ì„œ `fetch`ë¡œ ë°”ê¾¸ê³  ì‹¶ìœ¼ë©´? ìƒˆë¡œìš´ êµ¬í˜„ì²´ë§Œ ë§Œë“¤ë©´ ëœë‹¤.

```ts
// infrastructure/http/fetchHttpClient.ts
import type { HttpClient } from "./httpClient";

export class FetchHttpClient implements HttpClient {
  async get<T>(url: string): Promise<T> {
    const response = await fetch(url);
    return response.json();
  }

  async post<T>(url: string, data: unknown): Promise<T> {
    const response = await fetch(url, {
      method: "POST",
      body: JSON.stringify(data),
      headers: { "Content-Type": "application/json" },
    });
    return response.json();
  }

  // put, deleteë„ ìœ ì‚¬í•˜ê²Œ êµ¬í˜„
}
```

ë‚˜ë¨¸ì§€ ì½”ë“œëŠ” `HttpClient` ì¸í„°í˜ì´ìŠ¤ë§Œ ì˜ì¡´í•˜ë¯€ë¡œ **ì•„ë¬´ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ”ë‹¤**.

---

ì™¸ë¶€ ì„¸ê³„ë¥¼ ê²©ë¦¬í–ˆìœ¼ë‹ˆ, ì´ì œ ë“¤ì–´ì˜¨ ë°ì´í„°ë¥¼ ìš°ë¦¬ê°€ ì›í•˜ëŠ” í˜•ì‹ìœ¼ë¡œ ë°”ê¿”ë³´ì.

## Data Layer: ì™¸ë¶€ ë°ì´í„°ë¥¼ ë‚´ë¶€ í˜•ì‹ìœ¼ë¡œ ë³€í™˜

`Data` ë ˆì´ì–´ëŠ” **Domainì˜ Repository Interfaceë¥¼ êµ¬í˜„**í•˜ê³ , **DTOë¥¼ Entityë¡œ ë³€í™˜**í•œë‹¤.

**ì¤‘ìš”í•œ ì›ì¹™**:

- **Repository Implementationì€ Dataì—**: Domainì˜ interfaceë¥¼ `implements`í•œë‹¤
- **DTO â†’ Entity ë³€í™˜ì€ Dataì˜ ì±…ì„**: Mapperë¥¼ í†µí•´ ë³€í™˜í•œë‹¤
- **Domainê³¼ Infrastructureë¥¼ ì—°ê²°**: Domainì€ "ë¬´ì—‡ì„", DataëŠ” "ì–´ë–»ê²Œ"ë¥¼ ë‹´ë‹¹í•œë‹¤

`Data` ë ˆì´ì–´ëŠ” 4ê°€ì§€ ì—­í• ì„ í•œë‹¤:

1. `Repository Impl`: Domainì˜ Repository Interfaceë¥¼ êµ¬í˜„í•œë‹¤
2. `DataSource`: APIë¥¼ í˜¸ì¶œí•˜ê³  DTOë¥¼ ë°˜í™˜í•œë‹¤
3. `DTO(Data Transfer Object)`: ì„œë²„ ì‘ë‹µ íƒ€ì…ì„ ì •ì˜í•œë‹¤
4. `Mapper`: DTOë¥¼ `Domain`ì˜ `Entity`ë¡œ ë³€í™˜í•œë‹¤

### Repository: API í˜¸ì¶œ ë¡œì§

```ts
// data/repositories/PaymentRepositoryImpl.ts
import type {
  PaymentRepository,
  ConfirmPaymentParams,
} from "@/domain/repositories/PaymentRepository";
import type { IPaymentDataSource } from "@/data/datasources/remote/IPaymentDataSource";
import type { Payment, PaymentGateway } from "@/domain/entities/Payment";
import { mapTossPaymentDtoToDomain } from "@/data/mappers/tossPaymentMapper";
import { mapStripePaymentDtoToDomain } from "@/data/mappers/stripePaymentMapper";

export class PaymentRepositoryImpl implements PaymentRepository {
  constructor(
    private tossDataSource: IPaymentDataSource,
    private stripeDataSource: IPaymentDataSource
  ) {}

  // ê²Œì´íŠ¸ì›¨ì´ë³„ DataSourceì™€ Mapperë¥¼ ë°˜í™˜í•˜ëŠ” í—¬í¼ ë©”ì„œë“œ
  private getGatewayContext(gateway: PaymentGateway) {
    switch (gateway) {
      case "toss":
        return {
          dataSource: this.tossDataSource,
          mapper: mapTossPaymentDtoToDomain,
        };
      case "stripe":
        return {
          dataSource: this.stripeDataSource,
          mapper: mapStripePaymentDtoToDomain,
        };
      default:
        throw new Error(`ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ì…ë‹ˆë‹¤: ${gateway}`);
    }
  }

  async confirmPayment(
    params: ConfirmPaymentParams,
    gateway: PaymentGateway
  ): Promise<Payment> {
    // 1. ê²Œì´íŠ¸ì›¨ì´ì— ë§ëŠ” DataSourceì™€ Mapper ì„ íƒ
    const { dataSource, mapper } = this.getGatewayContext(gateway);

    // 2. DataSourceë¡œ DTO ê°€ì ¸ì˜¤ê¸°
    const paymentDto = await dataSource.confirmPayment(
      params.orderId,
      params.paymentKey,
      params.amount
    );

    // 3. Mapperë¡œ Entity ë³€í™˜
    return mapper(paymentDto);
  }

  async getPayment(
    paymentId: string,
    gateway: PaymentGateway
  ): Promise<Payment> {
    const { dataSource, mapper } = this.getGatewayContext(gateway);
    const paymentDto = await dataSource.getPayment(paymentId);
    return mapper(paymentDto);
  }

  async cancelPayment(
    paymentId: string,
    gateway: PaymentGateway,
    reason?: string
  ): Promise<Payment> {
    const { dataSource, mapper } = this.getGatewayContext(gateway);
    const paymentDto = await dataSource.cancelPayment(paymentId, reason);
    return mapper(paymentDto);
  }
}
```

**ì¤‘ìš”í•œ ì›ì¹™**:

- **Repository interfaceëŠ” `Domain`ì—, implementationì€ `Data`ì—**: `Domain`ì€ "ì–´ë–»ê²Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ì§€"ëŠ” ëª°ë¼ë„ ëœë‹¤
- **DTO â†’ Entity ë³€í™˜ì€ `Repository`ì˜ ì±…ì„**: `UseCase`ëŠ” `Entity`ë§Œ ë°›ëŠ”ë‹¤
- **DataSourceë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤**: API í˜¸ì¶œì€ `DataSource`ê°€ ë‹´ë‹¹í•œë‹¤

**getGatewayContext() íŒ¨í„´ì˜ ì¥ì **:

ìœ„ ì½”ë“œì—ì„œ `getGatewayContext()` í—¬í¼ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•œ ì´ìœ ëŠ”:

1. **DRY ì›ì¹™ ì¤€ìˆ˜**: 3ê°œ ë©”ì„œë“œ(`confirmPayment`, `getPayment`, `cancelPayment`)ì—ì„œ ë°˜ë³µë˜ë˜ switch-case ë¡œì§ì„ í•œ ê³³ìœ¼ë¡œ ëª¨ì•˜ë‹¤
2. **íƒ€ì… ì•ˆì •ì„±**: ë°˜í™˜ íƒ€ì…ì´ ëª…í™•í•˜ë‹¤ (`{ dataSource: IPaymentDataSource, mapper: Function }`)
3. **ìœ ì§€ë³´ìˆ˜ì„±**: ìƒˆ ê²Œì´íŠ¸ì›¨ì´(PayPal, Kakao Pay ë“±) ì¶”ê°€ ì‹œ `getGatewayContext()` í•œ ê³³ë§Œ ìˆ˜ì •í•˜ë©´ ëœë‹¤
4. **ê°€ë…ì„±**: ê° ë©”ì„œë“œê°€ ê°„ê²°í•´ì ¸ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì§‘ì¤‘í•  ìˆ˜ ìˆë‹¤

#### RepositoryëŠ” ì™œ ë‘ ê°€ì§€ ì±…ì„ì„ ë¶„ë¦¬í•˜ëŠ”ê°€?

`Repository`ëŠ” ë‘ ê°€ì§€ ì±…ì„ì„ ê°€ì§„ë‹¤:

1. **APIë¥¼ í˜¸ì¶œí•´ì„œ DTOë¥¼ ë°›ëŠ”ë‹¤** (DataSourceì˜ ì—­í• )
2. **DTOë¥¼ Entityë¡œ ë³€í™˜í•œë‹¤** (Mapperì˜ ì—­í• )

ë§Œì•½ `Repository`ê°€ ì´ ë‘ ê°€ì§€ë¥¼ ëª¨ë‘ í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

```ts
// âŒ ë‚˜ìœ ì˜ˆì‹œ: Repositoryê°€ ëª¨ë“  ê²ƒì„ í•¨
class PaymentRepositoryImpl {
  constructor(private httpClient: HttpClient) {}

  async confirmPayment(
    params: ConfirmPaymentParams,
    gateway: PaymentGateway
  ): Promise<Payment> {
    // âŒ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì§ì ‘ ì•Œì•„ì•¼ í•¨
    const endpoint =
      gateway === "toss"
        ? "https://api.tosspayments.com/v1/payments/confirm"
        : "https://api.stripe.com/v1/payment_intents/confirm";

    // âŒ HTTP í˜¸ì¶œë„ ì§ì ‘
    const dto = await this.httpClient.post(endpoint, params);

    // âŒ ë³€í™˜ë„ ì§ì ‘ (ìƒíƒœ ë§¤í•‘, íƒ€ì… ë³€í™˜ ë“±)
    return new Payment({
      paymentId: dto.paymentKey || dto.id,
      status: dto.status === "DONE" ? "SUCCEEDED" : "PENDING",
      // ...
    });
  }
}
```

ë¬¸ì œì :

- `Repository`ê°€ í† ìŠ¤ì™€ Stripeì˜ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ëª¨ë‘ ì•Œì•„ì•¼ í•œë‹¤
- ìƒˆ ê²Œì´íŠ¸ì›¨ì´ ì¶”ê°€ ì‹œ `Repository`ë¥¼ ê³„ì† ìˆ˜ì •í•´ì•¼ í•œë‹¤ (OCP ìœ„ë°˜)
- ìƒíƒœ ë§¤í•‘ ë¡œì§ì´ `Repository`ì— ì„ì—¬ ìˆì–´ ì¬ì‚¬ìš©ì´ ì–´ë µë‹¤
- í…ŒìŠ¤íŠ¸ ì‹œ HTTP í˜¸ì¶œì„ ëª¨í‚¹í•´ì•¼ í•œë‹¤

ë”°ë¼ì„œ ìš°ë¦¬ëŠ” **ë‹¨ì¼ ì±…ì„ ì›ì¹™**ì— ë”°ë¼ ë¶„ë¦¬í•œë‹¤:

- **DataSource**: ê²Œì´íŠ¸ì›¨ì´ API í˜¸ì¶œë§Œ ë‹´ë‹¹ (Raw HTTP, ì¸ì¦ í—¤ë” ë“±)
- **Mapper**: DTO â†’ Entity ë³€í™˜ë§Œ ë‹´ë‹¹ (ìƒíƒœ ë§¤í•‘, íƒ€ì… ë³€í™˜ ë“±)
- **Repository**: DataSourceì™€ Mapperë¥¼ ì¡°í•©í•´ì„œ Entityë¥¼ ë°˜í™˜

```ts
// âœ… ì¢‹ì€ ì˜ˆì‹œ: ì±…ì„ ë¶„ë¦¬
class PaymentRepositoryImpl {
  constructor(
    private tossDataSource: IPaymentDataSource,
    private stripeDataSource: IPaymentDataSource
  ) {} // HttpClientê°€ ì•„ë‹Œ DataSource ì£¼ì…

  private getGatewayContext(gateway: PaymentGateway) {
    switch (gateway) {
      case "toss":
        return {
          dataSource: this.tossDataSource,
          mapper: mapTossPaymentDtoToDomain,
        };
      case "stripe":
        return {
          dataSource: this.stripeDataSource,
          mapper: mapStripePaymentDtoToDomain,
        };
      default:
        throw new Error(`ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ì…ë‹ˆë‹¤: ${gateway}`);
    }
  }

  async confirmPayment(
    params: ConfirmPaymentParams,
    gateway: PaymentGateway
  ): Promise<Payment> {
    const { dataSource, mapper } = this.getGatewayContext(gateway); // ê²Œì´íŠ¸ì›¨ì´ë³„ ì„ íƒ

    const dto = await dataSource.confirmPayment(
      params.orderId,
      params.paymentKey,
      params.amount
    ); // DataSourceê°€ HTTP ì²˜ë¦¬
    return mapper(dto); // Mapperê°€ ë³€í™˜ ì²˜ë¦¬
  }
}
```

ì´ì œ `DataSource`ê°€ ë¬´ì—‡ì¸ì§€ ìì„¸íˆ ë³´ì.

### DataSource: ë„¤íŠ¸ì›Œí¬ í†µì‹  ë‹´ë‹¹

`DataSource`ëŠ” **API ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•˜ê³  DTOë¥¼ ë°˜í™˜í•˜ëŠ” ì—­í• **ì„ í•œë‹¤.

ë§ˆì¹˜ íƒë°° ê¸°ì‚¬ê°€ ë¬¼ê±´ì„ ë°°ì†¡ë§Œ í•˜ê³  í¬ì¥ì„ ëœ¯ì§€ ì•ŠëŠ” ê²ƒì²˜ëŸ¼, `DataSource`ëŠ” ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸°ë§Œ í•˜ê³  ë³€í™˜í•˜ì§€ ì•ŠëŠ”ë‹¤.

```ts
// data/datasources/remote/IPaymentDataSource.ts
import type { TossPaymentDto } from "@/data/dto/tossPaymentDto";
import type { StripePaymentDto } from "@/data/dto/stripePaymentDto";

export interface IPaymentDataSource {
  confirmPayment(
    orderId: string,
    paymentKey: string,
    amount: number
  ): Promise<TossPaymentDto | StripePaymentDto>;
  getPayment(paymentId: string): Promise<TossPaymentDto | StripePaymentDto>;
  cancelPayment(
    paymentId: string,
    reason?: string
  ): Promise<TossPaymentDto | StripePaymentDto>;
}
```

```ts
// data/datasources/remote/tossPaymentsDataSource.ts
import type { HttpClient } from "@/infrastructure/http/HttpClient";
import type { TossPaymentDto } from "@/data/dto/tossPaymentDto";
import type { IPaymentDataSource } from "./IPaymentDataSource";

export class TossPaymentsDataSource implements IPaymentDataSource {
  constructor(private httpClient: HttpClient) {}

  async confirmPayment(
    orderId: string,
    paymentKey: string,
    amount: number
  ): Promise<TossPaymentDto> {
    // ë°±ì—”ë“œ API í˜¸ì¶œ
    return this.httpClient.post<TossPaymentDto>("/api/payments/toss/confirm", {
      paymentKey,
      orderId,
      amount,
    });
  }

  async getPayment(paymentKey: string): Promise<TossPaymentDto> {
    return this.httpClient.get<TossPaymentDto>(
      `/api/payments/toss/${paymentKey}`
    );
  }

  async cancelPayment(
    paymentKey: string,
    cancelReason?: string
  ): Promise<TossPaymentDto> {
    return this.httpClient.post<TossPaymentDto>(
      `/api/payments/toss/${paymentKey}/cancel`,
      {
        cancelReason,
      }
    );
  }
}
```

`DataSource`ëŠ” 3ê°€ì§€ ì›ì¹™ì„ ë”°ë¥¸ë‹¤:

1. **DTOë§Œ ë°˜í™˜í•œë‹¤**: `Entity`ê°€ ì•„ë‹Œ `DTO`ë¥¼ ë°˜í™˜í•œë‹¤. ë³€í™˜ì€ `Mapper`ì˜ ëª«ì´ë‹¤.
2. `HttpClient` ì¸í„°í˜ì´ìŠ¤ì— ì˜ì¡´í•œë‹¤: `axios`ë‚˜ `fetch`ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤. `HttpClient` ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ HTTP í´ë¼ì´ì–¸íŠ¸ë¥¼ ì¶”ìƒí™”í•œë‹¤.
3. **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ í¬í•¨í•˜ì§€ ì•ŠëŠ”ë‹¤**: API í˜¸ì¶œë§Œ ë‹´ë‹¹í•œë‹¤.

`DataSource`ì™€ `HttpClient`ì˜ ê´€ê³„ë¥¼ ë³´ë©´, `axios`ì¸ì§€ `fetch`ì¸ì§€ëŠ” `DataSource`ë„ ëª¨ë¥¸ë‹¤. ì´ê²ƒì´ ë°”ë¡œ ì˜ì¡´ì„± ì—­ì „ ì›ì¹™ì´ë‹¤.

### ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ê°€ ì¶”ê°€ë˜ë©´?

ì´ì œ ê°€ì¥ ê°•ë ¥í•œ ì¥ì ì„ ì‚´í´ë³´ì. **í•´ì™¸ í™•ì¥ìœ¼ë¡œ ìƒˆë¡œìš´ ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ë¥¼ ì¶”ê°€í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ?**

í•œêµ­ ì‹œì¥ì—ì„œ í† ìŠ¤ í˜ì´ë¨¼ì¸ ë¡œ ì‹œì‘í–ˆë‹¤ê°€, ë¯¸êµ­/ìœ ëŸ½ ì§„ì¶œì„ ìœ„í•´ Stripeë¥¼ ì¶”ê°€í•œë‹¤ë©´?

ë§ˆì¹˜ ìƒˆë¡œìš´ ë°°ì†¡ íŒŒíŠ¸ë„ˆê°€ ì¶”ê°€ë˜ì–´ë„ ì°½ê³ ì™€ ì¬ê³  ì‹œìŠ¤í…œì€ ê·¸ëŒ€ë¡œì¸ ê²ƒì²˜ëŸ¼, **ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ê°€ ì¶”ê°€ë˜ì–´ë„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ê·¸ëŒ€ë¡œ**ë‹¤.

**ì‹œë‚˜ë¦¬ì˜¤**: í•œêµ­(í† ìŠ¤) â†’ í•´ì™¸ í™•ì¥(Stripe ì¶”ê°€)

#### ê¸°ì¡´: í† ìŠ¤ í˜ì´ë¨¼ì¸ ë§Œ ì§€ì›

ì´ë¯¸ ìœ„ì—ì„œ ë³¸ `TossPaymentsDataSource`ê°€ ìˆë‹¤.

#### ì¶”ê°€: Stripe DataSource êµ¬í˜„

```ts
// data/datasources/remote/stripeDataSource.ts
import type { HttpClient } from "@/infrastructure/http/HttpClient";
import type { StripePaymentDto } from "@/data/dto/stripePaymentDto";
import type { IPaymentDataSource } from "./IPaymentDataSource";

export class StripeDataSource implements IPaymentDataSource {
  constructor(private httpClient: HttpClient) {}

  async confirmPayment(
    orderId: string,
    paymentIntentId: string,
    amount: number
  ): Promise<StripePaymentDto> {
    // ë°±ì—”ë“œ API í˜¸ì¶œ
    return this.httpClient.post<StripePaymentDto>(
      "/api/payments/stripe/confirm",
      {
        paymentIntentId,
        orderId,
        amount,
      }
    );
  }

  async getPayment(paymentIntentId: string): Promise<StripePaymentDto> {
    return this.httpClient.get<StripePaymentDto>(
      `/api/payments/stripe/${paymentIntentId}`
    );
  }

  async cancelPayment(
    paymentIntentId: string,
    cancellationReason?: string
  ): Promise<StripePaymentDto> {
    return this.httpClient.post<StripePaymentDto>(
      `/api/payments/stripe/${paymentIntentId}/cancel`,
      {
        cancellationReason,
      }
    );
  }
}
```

í† ìŠ¤ì™€ StripeëŠ” **API ì—”ë“œí¬ì¸íŠ¸, ì¸ì¦ ë°©ì‹, ìš”ì²­/ì‘ë‹µ í˜•ì‹ì´ ì™„ì „íˆ ë‹¤ë¥´ë‹¤**. í•˜ì§€ë§Œ ë‘˜ ë‹¤ `IPaymentDataSource` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê¸° ë•Œë¬¸ì— ìƒìœ„ ë ˆì´ì–´ëŠ” ì°¨ì´ë¥¼ ëª¨ë¥¸ë‹¤.

**ì¶”ê°€ëœ ê²ƒ**: íŒŒì¼ **3ê°œ**

- `StripeDataSource.ts` - Stripe API í˜¸ì¶œ
- `stripePaymentDto.ts` - Stripe ì‘ë‹µ íƒ€ì… (ì´ë¯¸ ì¶”ê°€í•¨)
- `stripePaymentMapper.ts` - Stripe DTO â†’ Payment Entity ë³€í™˜ (ì´ë¯¸ ì¶”ê°€í•¨)

**ë³€ê²½ë˜ì§€ ì•Šì€ ê²ƒ**:

- `Payment` Entity - ê·¸ëŒ€ë¡œ
- `Order` Entity - ê·¸ëŒ€ë¡œ
- `ConfirmPaymentUseCase` - ê·¸ëŒ€ë¡œ
- `PaymentRepository` Interface - ê·¸ëŒ€ë¡œ
- `useConfirmPayment` Hook - ê·¸ëŒ€ë¡œ
- `CheckoutButton` Component - ê·¸ëŒ€ë¡œ

ì¸í„°í˜ì´ìŠ¤ë§Œ ë°”ë¼ë³´ê¸° ë•Œë¬¸ì— **ìƒˆë¡œìš´ ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ ì¶”ê°€ê°€ ê°„í¸í•˜ë‹¤**. ê¸°ì¡´ ì½”ë“œëŠ” ì „í˜€ ì†ëŒ€ì§€ ì•Šê³ , ìƒˆ `DataSource`ì™€ `Mapper`ë§Œ ì¶”ê°€í•˜ë©´ ëœë‹¤.

### DTO: ì„œë²„ ì‘ë‹µ íƒ€ì…

í† ìŠ¤ í˜ì´ë¨¼ì¸ ì™€ StripeëŠ” **ì‘ë‹µ í˜•ì‹ì´ ì™„ì „íˆ ë‹¤ë¥´ë‹¤**. í•„ë“œëª…ë„ ë‹¤ë¥´ê³ , ë°ì´í„° íƒ€ì…ë„ ë‹¤ë¥´ë‹¤.

```ts
// data/dto/tossPaymentDto.ts - í† ìŠ¤ í˜ì´ë¨¼ì¸  ì‘ë‹µ
export interface TossPaymentDto {
  paymentKey: string; // í† ìŠ¤ì—ì„œ ë°œê¸‰í•œ ê²°ì œ ê³ ìœ  í‚¤
  orderId: string; // ì£¼ë¬¸ ID
  orderName: string; // ì£¼ë¬¸ëª…
  status: "READY" | "IN_PROGRESS" | "DONE" | "CANCELED" | "ABORTED"; // ê²°ì œ ìƒíƒœ
  method: "ì¹´ë“œ" | "ê°€ìƒê³„ì¢Œ" | "ê°„í¸ê²°ì œ" | "ê³„ì¢Œì´ì²´"; // ê²°ì œ ìˆ˜ë‹¨
  totalAmount: number; // ì´ ê²°ì œ ê¸ˆì•¡ (ì› ë‹¨ìœ„)
  balanceAmount: number; // ì·¨ì†Œ ê°€ëŠ¥ ê¸ˆì•¡
  currency: "KRW"; // í†µí™”
  requestedAt: string; // ê²°ì œ ìš”ì²­ ì‹œê° (ISO 8601)
  approvedAt: string; // ê²°ì œ ìŠ¹ì¸ ì‹œê° (ISO 8601)
  receipt?: {
    url: string; // ì˜ìˆ˜ì¦ URL
  };
}

// data/dto/stripePaymentDto.ts - Stripe ì‘ë‹µ
export interface StripePaymentDto {
  id: string; // Stripeì—ì„œ ë°œê¸‰í•œ ê²°ì œ ID
  amount: number; // ê²°ì œ ê¸ˆì•¡ (ì„¼íŠ¸ ë‹¨ìœ„! ì£¼ì˜)
  currency: string; // í†µí™” (usd, krw ë“±)
  status: "requires_payment_method" | "processing" | "succeeded" | "canceled"; // ê²°ì œ ìƒíƒœ
  payment_method: string | null; // ê²°ì œ ìˆ˜ë‹¨ ID
  metadata: {
    orderId: string; // ì£¼ë¬¸ ID (ë©”íƒ€ë°ì´í„°ì— ì €ì¥)
  };
  created: number; // ìƒì„± ì‹œê° (Unix timestamp, ì´ˆ ë‹¨ìœ„)
  canceled_at: number | null; // ì·¨ì†Œ ì‹œê° (Unix timestamp)
  charges?: {
    data: Array<{
      receipt_url: string; // ì˜ìˆ˜ì¦ URL
    }>;
  };
}
```

**ì£¼ìš” ì°¨ì´ì **:

| í•­ëª©          | í† ìŠ¤ í˜ì´ë¨¼ì¸    | Stripe                 |
| ------------- | --------------- | ---------------------- |
| í•„ë“œëª… ìŠ¤íƒ€ì¼ | `camelCase`     | `snake_case`           |
| ê²°ì œ ID       | `paymentKey`    | `id`                   |
| ê¸ˆì•¡ ë‹¨ìœ„     | ì› (`10000`)    | ì„¼íŠ¸ (`1000` = $10.00) |
| ìƒíƒœ ê°’       | `"DONE"`        | `"succeeded"`          |
| ì‹œê° í˜•ì‹     | ISO 8601 ë¬¸ìì—´ | Unix timestamp (ìˆ«ì)  |
| orderId ìœ„ì¹˜  | ìµœìƒìœ„ í•„ë“œ     | `metadata` ê°ì²´ ì•ˆ     |

#### íƒ€ì… ìë™ ìƒì„± ë„êµ¬

ë°±ì—”ë“œê°€ OpenAPI(Swagger) ìŠ¤í™ì„ ì œê³µí•œë‹¤ë©´ íƒ€ì…ì„ ìë™ìœ¼ë¡œ ìƒì„±í•  ìˆ˜ ìˆë‹¤. í† ìŠ¤ í˜ì´ë¨¼ì¸ ì™€ Stripe ëª¨ë‘ OpenAPI ìŠ¤í™ì„ ì œê³µí•œë‹¤.

> **ì°¸ê³ **: ì•„ë˜ í†µê³„ëŠ” 2025ë…„ 11ì›” ê¸°ì¤€ì´ë©°, ì½ëŠ” ì‹œì ì— ë”°ë¼ ì£¼ê°„ ë‹¤ìš´ë¡œë“œ ìˆ˜ë‚˜ GitHub Starsê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆë‹¤.

- **[openapi-typescript](https://openapi-ts.dev/)**: ì£¼ê°„ ë‹¤ìš´ë¡œë“œ 1,550,913íšŒ. OpenAPI ìŠ¤í™ì—ì„œ TypeScript íƒ€ì…ì„ ìƒì„±. ëŸ°íƒ€ì„ ë¹„ìš© 0, 7.6k GitHub stars
- **[orval](https://orval.dev/)**: ì£¼ê°„ ë‹¤ìš´ë¡œë“œ 508,185íšŒ. íƒ€ì…ë¿ë§Œ ì•„ë‹ˆë¼ React Query í›…, Mock ë°ì´í„°ê¹Œì§€ í•œ ë²ˆì— ìƒì„±. 4.9k GitHub stars
- **[zod-to-openapi](https://github.com/asteasolutions/zod-to-openapi)**: ì£¼ê°„ ë‹¤ìš´ë¡œë“œ 994,912íšŒ. Zod ìŠ¤í‚¤ë§ˆì—ì„œ OpenAPI ë¬¸ì„œë¥¼ ìƒì„± (ì—­ë°©í–¥). 1.4k GitHub stars
- **[zodios](https://www.zodios.org/)**: ì£¼ê°„ ë‹¤ìš´ë¡œë“œ 342,000~709,000íšŒ. Zod ê¸°ë°˜ íƒ€ì… ì•ˆì „ HTTP í´ë¼ì´ì–¸íŠ¸. ëŸ°íƒ€ì„ ê²€ì¦ í¬í•¨. 1.9k GitHub stars

**ì‚¬ìš© ì˜ˆì‹œ**:

`openapi-typescript`ë¥¼ ì‚¬ìš©í•˜ë©´ ì•ì„œ ì •ì˜í•œ `TossPaymentDto`, `StripePaymentDto`ì™€ ë™ì¼í•œ íƒ€ì…ì´ ìë™ìœ¼ë¡œ ìƒì„±ëœë‹¤. ìƒì„±ëœ íƒ€ì…ì€ ë‹¤ìŒì²˜ëŸ¼ re-exportí•´ì„œ ì‚¬ìš©í•œë‹¤.

```ts
// data/dto/tossPaymentDto.ts (packages/typesì—ì„œ re-export)
export type { TossPaymentDto } from "@/packages/types/generated/payment";

// data/dto/stripePaymentDto.ts
export type { StripePaymentDto } from "@/packages/types/generated/payment";
```

**ì‹¤ë¬´ì—ì„œëŠ” ë‘ ê°€ì§€ ì ‘ê·¼ ë°©ì‹ì´ ê°€ëŠ¥í•˜ë‹¤**:

1. **OpenAPI ìŠ¤í™ì´ ì œê³µë˜ëŠ” ê²½ìš°**: ìœ„ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤(`openapi-typescript`, `orval` ë“±)ì„ í™œìš©í•´ ìŠ¤ì›¨ê±° ë°”íƒ•ìœ¼ë¡œ ì œë„ˆë ˆì´íŒ…ëœ íƒ€ì…ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤. API ìŠ¤í™ ë³€ê²½ ì‹œ íƒ€ì…ë„ ìë™ìœ¼ë¡œ ë™ê¸°í™”ë˜ë¯€ë¡œ ê°€ì¥ ì´ìƒì ì´ë‹¤.

2. **OpenAPI ìŠ¤í™ì´ ì—†ëŠ” ê²½ìš°**: ë…¸ì…˜ ëª…ì„¸, êµ¬ê¸€ ë…ìŠ¤, ìŠ¬ë™ ë©”ì‹œì§€ ë“± ì„œë²„ ê°œë°œìì™€ í•©ì˜í•œ ëª…ì„¸ë¥¼ ë°”íƒ•ìœ¼ë¡œ DTOë¥¼ ì§ì ‘ ì •ì˜í•œë‹¤. ìë™í™”ëŠ” ë˜ì§€ ì•Šì§€ë§Œ, ëª…ì„¸ë§Œ ëª…í™•í•˜ë‹¤ë©´ ì¶©ë¶„íˆ ì•ˆì „í•˜ê²Œ íƒ€ì…ì„ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

```ts
// OpenAPIê°€ ì—†ëŠ” í™˜ê²½ì—ì„œ ëª…ì„¸ ê¸°ë°˜ DTO ì •ì˜
// data/dto/paymentDto.ts
export interface PaymentDto {
  paymentKey: string; // ë…¸ì…˜ ëª…ì„¸ v2.1 ì°¸ì¡°
  orderId: string;
  totalAmount: number;
  status: "DONE" | "CANCELED";
}
```

**ì¤‘ìš”í•œ ê²ƒì€ íƒ€ì… ìƒì„± ë„êµ¬ê°€ ì•„ë‹ˆë¼ ëª…ì„¸ì™€ì˜ ë™ê¸°í™”ë‹¤**. ë„êµ¬ëŠ” ê·¸ ê³¼ì •ì„ ìë™í™”í•  ë¿ì´ë‹¤.

#### ëŸ°íƒ€ì„ ê²€ì¦: Zod

`openapi-typescript`ë¡œ ìƒì„±í•œ íƒ€ì…ì€ ì»´íŒŒì¼ íƒ€ì„ì—ë§Œ ë™ì‘í•œë‹¤. í•˜ì§€ë§Œ ì‹¤ì œ API ì‘ë‹µì€ ëŸ°íƒ€ì„ì— ê²€ì¦ì´ í•„ìš”í•˜ë‹¤. ë°±ì—”ë“œê°€ ì˜ëª»ëœ ë°ì´í„°ë¥¼ ë³´ë‚´ê±°ë‚˜, API ìŠ¤í™ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œ ëŸ°íƒ€ì„ ì—ëŸ¬ë¥¼ ë°©ì§€í•˜ë ¤ë©´ `Zod` ê°™ì€ ëŸ°íƒ€ì„ ê²€ì¦ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤.

```ts
// data/dto/tossPaymentDto.ts
import { z } from "zod";

// Zod ìŠ¤í‚¤ë§ˆ ì •ì˜
export const TossPaymentDtoSchema = z.object({
  paymentKey: z.string(),
  orderId: z.string(),
  status: z.enum(["READY", "IN_PROGRESS", "DONE", "CANCELED", "ABORTED"]),
  totalAmount: z.number().positive(),
  approvedAt: z.string().datetime(),
});

// íƒ€ì… ì¶”ë¡ 
export type TossPaymentDto = z.infer<typeof TossPaymentDtoSchema>;

// data/datasources/remote/tossPaymentsDataSource.ts
import { TossPaymentDtoSchema } from "@/data/dto/tossPaymentDto";

export class TossPaymentsDataSource implements IPaymentDataSource {
  async confirmPayment(
    orderId: string,
    paymentKey: string,
    amount: number
  ): Promise<TossPaymentDto> {
    const response = await this.httpClient.post("/api/payments/toss/confirm", {
      paymentKey,
      orderId,
      amount,
    });

    // ëŸ°íƒ€ì„ ê²€ì¦ - ì˜ëª»ëœ ë°ì´í„°ë©´ ì¦‰ì‹œ ì—ëŸ¬ ë°œìƒ
    return TossPaymentDtoSchema.parse(response);
  }
}
```

ì´ë ‡ê²Œ í•˜ë©´ ë°±ì—”ë“œê°€ ì˜ˆìƒì¹˜ ëª»í•œ ë°ì´í„°ë¥¼ ë³´ë‚´ë„ `DataSource` ë ˆì´ì–´ì—ì„œ ì¦‰ì‹œ ì—ëŸ¬ë¥¼ ì¡ì„ ìˆ˜ ìˆë‹¤. ì»´íŒŒì¼ íƒ€ì„ íƒ€ì… ì•ˆì •ì„±ê³¼ ëŸ°íƒ€ì„ ê²€ì¦ì„ ëª¨ë‘ í™•ë³´í•  ìˆ˜ ìˆë‹¤.

### DTOì™€ Entityì˜ ì°¨ì´

ì„œë²„ê°€ ë³´ë‚´ëŠ” ë°ì´í„°(DTO)ì™€ ìš°ë¦¬ê°€ ì“°ëŠ” ë°ì´í„°(Entity)ëŠ” ë‹¤ë¥´ë‹¤.

**DTO (Data Transfer Object)**:

- ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ê°€ ì •ì˜í•œ í˜•ì‹ (í† ìŠ¤: `camelCase`, Stripe: `snake_case`)
- ê²€ì¦ ë¡œì§ ì—†ìŒ
- ê²Œì´íŠ¸ì›¨ì´ ì—…ë°ì´íŠ¸ì— ë”°ë¼ ë³€ê²½ë¨

**Entity**:

- í”„ë¡ íŠ¸ì—”ë“œê°€ ì œì–´í•˜ëŠ” í†µì¼ëœ í˜•ì‹ (`camelCase`, íƒ€ì… ì•ˆì •ì„±)
- UIì—ì„œ ì‚¬ìš©í•˜ê¸° í¸í•œ êµ¬ì¡° (í•„ë“œëª…, ë©”ì„œë“œ)
- ê²Œì´íŠ¸ì›¨ì´ ì‘ë‹µì´ ë°”ë€Œì–´ë„ ì˜í–¥ë°›ì§€ ì•ŠìŒ (`Mapper`ê°€ ë³´í˜¸)

ë§ˆì¹˜ `íƒë°° ìƒì(DTO)`ì™€ `ìƒí’ˆ(Entity)`ì˜ ê´€ê³„ë‹¤. í† ìŠ¤ì™€ StripeëŠ” ì„œë¡œ ë‹¤ë¥¸ í¬ì¥ ë°©ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë³´ë‚´ì§€ë§Œ, `Mapper`ê°€ "í¬ì¥ì„ ëœ¯ì–´ì„œ ìƒí’ˆì„ êº¼ë‚´ëŠ” ì—­í• "ì„ í•˜ê¸° ë•Œë¬¸ì— ìš°ë¦¬ëŠ” í•­ìƒ ë™ì¼í•œ `Payment` Entityë¥¼ ë°›ëŠ”ë‹¤.

í† ìŠ¤ í˜ì´ë¨¼ì¸ ì—ì„œ ê°‘ìê¸° "API ë²„ì „ ì—…ë°ì´íŠ¸ë¡œ `paymentKey` í•„ë“œë¥¼ `payment_id`ë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤"ë¼ê³  í†µë³´í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ? ê¸°ì¡´ ë°©ì‹ì´ë¼ë©´ í•´ë‹¹ í•„ë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¾ì•„ì„œ ìˆ˜ì •í•´ì•¼ í•œë‹¤. í•˜ì§€ë§Œ í´ë¦° ì•„í‚¤í…ì²˜ì—ì„œëŠ” ë‹¨ **í•œ ê³³**ë§Œ ê³ ì¹˜ë©´ ëœë‹¤. ë°”ë¡œ `TossPaymentMapper`ë‹¤.

---

### Mapper: ì„œë²„ ë³€ê²½ì˜ ì¶©ê²©ì„ í¡ìˆ˜í•˜ëŠ” ì™„ì¶©ì¬

`Mapper`ëŠ” ì„œë²„ì™€ ìš°ë¦¬ ì½”ë“œ ì‚¬ì´ì˜ **ë²ˆì—­ê¸°**ë‹¤. ì„œë²„ê°€ `payment_gateway_id`ë¥¼ ë³´ë‚´ë“  `gateway_id`ë¥¼ ë³´ë‚´ë“ , ìš°ë¦¬ ì½”ë“œëŠ” ì „í˜€ ì‹ ê²½ ì“°ì§€ ì•ŠëŠ”ë‹¤. `Mapper`ê°€ ëª¨ë“  ë³€ê²½ì„ **í•œ ê³³ì—ì„œ ì²˜ë¦¬**í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

ë§ˆì¹˜ ê±´ë¬¼ì˜ **ë©´ì§„ êµ¬ì¡°**ì™€ ë¹„ìŠ·í•˜ë‹¤. ì§€ì§„(ì„œë²„ ë³€ê²½)ì´ ì¼ì–´ë‚˜ë„ ê±´ë¬¼ ë‚´ë¶€(Domain, Presentation)ëŠ” í”ë“¤ë¦¬ì§€ ì•ŠëŠ”ë‹¤. ì¶©ê²© í¡ìˆ˜ ì¥ì¹˜(Mapper)ê°€ ëª¨ë“  ì¶©ê²©ì„ í¡ìˆ˜í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

MapperëŠ” classê°€ ì•„ë‹Œ **ìˆœìˆ˜ í•¨ìˆ˜**ë¡œ êµ¬í˜„í•œë‹¤. ìƒíƒœë¥¼ ê°€ì§ˆ í•„ìš”ê°€ ì—†ê³ , ë‹¨ìˆœíˆ ë°ì´í„°ë¥¼ ë³€í™˜í•˜ëŠ” ì—­í• ë§Œ í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

```ts
// data/mappers/tossPaymentMapper.ts
import { z } from "zod";
import {
  Payment,
  PaymentStatus,
  PaymentMethod,
} from "@/domain/entities/Payment";
import type { TossPaymentDto } from "@/data/dto/tossPaymentDto";

const tossPaymentDtoSchema = z.object({
  paymentKey: z.string(),
  orderId: z.string(),
  orderName: z.string(),
  status: z.enum(["READY", "IN_PROGRESS", "DONE", "CANCELED", "ABORTED"]),
  method: z.enum(["ì¹´ë“œ", "ê°€ìƒê³„ì¢Œ", "ê°„í¸ê²°ì œ", "ê³„ì¢Œì´ì²´"]),
  totalAmount: z.number(),
  currency: z.literal("KRW"),
  requestedAt: z.string(),
  approvedAt: z.string().optional(),
  receipt: z.object({ url: z.string() }).optional(),
});

// í† ìŠ¤ ìƒíƒœ â†’ í†µí•© ìƒíƒœë¡œ ë§¤í•‘
function mapTossStatus(status: TossPaymentDto["status"]): PaymentStatus {
  const statusMap: Record<TossPaymentDto["status"], PaymentStatus> = {
    READY: "PENDING",
    IN_PROGRESS: "PROCESSING",
    DONE: "SUCCEEDED",
    CANCELED: "CANCELED",
    ABORTED: "FAILED",
  };
  return statusMap[status];
}

// í† ìŠ¤ ê²°ì œìˆ˜ë‹¨ â†’ í†µí•© ê²°ì œìˆ˜ë‹¨ìœ¼ë¡œ ë§¤í•‘
function mapTossMethod(method: TossPaymentDto["method"]): PaymentMethod {
  const methodMap: Record<TossPaymentDto["method"], PaymentMethod> = {
    ì¹´ë“œ: "CARD",
    ê°€ìƒê³„ì¢Œ: "VIRTUAL_ACCOUNT",
    ê°„í¸ê²°ì œ: "EASY_PAY",
    ê³„ì¢Œì´ì²´: "TRANSFER",
  };
  return methodMap[method];
}

export function mapTossPaymentDtoToDomain(dto: TossPaymentDto): Payment {
  const validated = tossPaymentDtoSchema.parse(dto);

  return new Payment({
    paymentId: `toss_${validated.paymentKey}`, // ë‚´ë¶€ ID ìƒì„±
    orderId: validated.orderId,
    gateway: "toss",
    gatewayPaymentId: validated.paymentKey,
    amount: validated.totalAmount, // ì› ë‹¨ìœ„ ê·¸ëŒ€ë¡œ
    currency: validated.currency,
    status: mapTossStatus(validated.status),
    method: mapTossMethod(validated.method),
    requestedAt: new Date(validated.requestedAt), // ISO 8601 â†’ Date
    approvedAt: validated.approvedAt
      ? new Date(validated.approvedAt)
      : undefined,
    receiptUrl: validated.receipt?.url,
  });
}
```

```ts
// data/mappers/stripePaymentMapper.ts
import { z } from "zod";
import { Payment, PaymentStatus } from "@/domain/entities/Payment";
import type { StripePaymentDto } from "@/data/dto/stripePaymentDto";

const stripePaymentDtoSchema = z.object({
  id: z.string(),
  amount: z.number(),
  currency: z.string(),
  status: z.enum([
    "requires_payment_method",
    "processing",
    "succeeded",
    "canceled",
  ]),
  payment_method: z.string().nullable(),
  metadata: z.object({
    orderId: z.string(),
  }),
  created: z.number(),
  canceled_at: z.number().nullable(),
  charges: z
    .object({
      data: z.array(z.object({ receipt_url: z.string() })),
    })
    .optional(),
});

// Stripe ìƒíƒœ â†’ í†µí•© ìƒíƒœë¡œ ë§¤í•‘
function mapStripeStatus(status: StripePaymentDto["status"]): PaymentStatus {
  const statusMap: Record<StripePaymentDto["status"], PaymentStatus> = {
    requires_payment_method: "PENDING",
    processing: "PROCESSING",
    succeeded: "SUCCEEDED",
    canceled: "CANCELED",
  };
  return statusMap[status];
}

export function mapStripePaymentDtoToDomain(dto: StripePaymentDto): Payment {
  const validated = stripePaymentDtoSchema.parse(dto);

  return new Payment({
    paymentId: `stripe_${validated.id}`, // ë‚´ë¶€ ID ìƒì„±
    orderId: validated.metadata.orderId, // metadataì—ì„œ ì¶”ì¶œ
    gateway: "stripe",
    gatewayPaymentId: validated.id,
    amount: validated.amount, // ì„¼íŠ¸ ë‹¨ìœ„ ê·¸ëŒ€ë¡œ (currencyë¡œ êµ¬ë¶„)
    currency: validated.currency.toUpperCase(),
    status: mapStripeStatus(validated.status),
    method: validated.payment_method ? "CARD" : undefined, // StripeëŠ” ì¹´ë“œ ê²°ì œë§Œ ì§€ì›
    requestedAt: new Date(validated.created * 1000), // Unix timestamp â†’ Date (ë°€ë¦¬ì´ˆ ë³€í™˜)
    approvedAt:
      validated.status === "succeeded"
        ? new Date(validated.created * 1000)
        : undefined,
    canceledAt: validated.canceled_at
      ? new Date(validated.canceled_at * 1000)
      : undefined,
    receiptUrl: validated.charges?.data[0]?.receipt_url, // charges ë°°ì—´ì—ì„œ ì¶”ì¶œ
  });
}
```

`Mapper` í•¨ìˆ˜ëŠ” ë‹¤ìŒì„ ìˆ˜í–‰í•œë‹¤:

1. **ê²€ì¦**: `Zod`ë¡œ DTOì˜ í˜•ì‹ì„ ê²€ì¦í•œë‹¤
2. **ìƒíƒœ ì •ê·œí™”**: ê²Œì´íŠ¸ì›¨ì´ë³„ ìƒíƒœ(`"DONE"`, `"succeeded"`) â†’ í†µí•© ìƒíƒœ(`"SUCCEEDED"`)ë¡œ ë³€í™˜í•œë‹¤
3. **íƒ€ì… ë³€í™˜**: ISO 8601 ë¬¸ìì—´ / Unix timestamp â†’ `Date` ê°ì²´ë¡œ ë³€í™˜í•œë‹¤
4. **í•„ë“œëª… ë§¤í•‘**: ê²Œì´íŠ¸ì›¨ì´ í•„ë“œ(`paymentKey`, `id`) â†’ ë„ë©”ì¸ í•„ë“œ(`gatewayPaymentId`)ë¡œ ë³€í™˜í•œë‹¤
5. **ë°ì´í„° ì¶”ì¶œ**: ì¤‘ì²©ëœ êµ¬ì¡°ì—ì„œ í•„ìš”í•œ ê°’ ì¶”ì¶œ (`metadata.orderId`, `charges[0].receipt_url`)
6. **Entity ìƒì„±**: í†µì¼ëœ `Payment` Entityë¥¼ ìƒì„±í•œë‹¤

**í•µì‹¬ì€ ì´ê²ƒì´ë‹¤**: í† ìŠ¤ í˜ì´ë¨¼ì¸ ê°€ ê°‘ìê¸° "API v2 ì—…ë°ì´íŠ¸: `paymentKey` â†’ `paymentId`ë¡œ ë³€ê²½"ì´ë¼ê³  ê³µì§€í•˜ë©´?

```ts
// âœ… TossPaymentMapper í•œ ê³³ë§Œ ìˆ˜ì •
export function mapTossPaymentDtoToDomain(dto: TossPaymentDto): Payment {
  return new Payment({
-   gatewayPaymentId: validated.paymentKey,  // ê¸°ì¡´
+   gatewayPaymentId: validated.paymentId,   // ë³€ê²½
    // ...
  });
}
```

ë˜ëŠ” Stripeê°€ ìƒíƒœ ê°’ì„ ë³€ê²½í•˜ë©´?

```ts
// âœ… StripePaymentMapperì˜ ìƒíƒœ ë§¤í•‘ë§Œ ìˆ˜ì •
function mapStripeStatus(status: StripePaymentDto["status"]): PaymentStatus {
  const statusMap = {
-   succeeded: "SUCCEEDED",        // ê¸°ì¡´
+   payment_successful: "SUCCEEDED", // ë³€ê²½
    // ...
  };
}
```

`Mapper` í•¨ìˆ˜ **ë”± ëª‡ ì¤„**ë§Œ ê³ ì¹˜ë©´ ëœë‹¤. `Presentation`, `Domain`, `UseCase` ë ˆì´ì–´ëŠ” ì „í˜€ ìˆ˜ì •í•˜ì§€ ì•Šì•„ë„ ëœë‹¤. ë„ì…ë¶€ì—ì„œ ì–¸ê¸‰í•œ "10ê°œ íŒŒì¼ ìˆ˜ì • â†’ 1ê°œ íŒŒì¼ ìˆ˜ì •"ì´ ë°”ë¡œ ì´ê²ƒì´ë‹¤.

---

ë°ì´í„°ë¥¼ ë³€í™˜í–ˆìœ¼ë‹ˆ, ì´ì œ ì´ ë°ì´í„°ë¡œ ë¬´ì—‡ì„ í• ì§€ ì •ì˜í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ ì‚´í´ë³´ì.

## Domain Layer: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì˜ ì¤‘ì‹¬

`Domain` ë ˆì´ì–´ëŠ” í´ë¦° ì•„í‚¤í…ì²˜ì˜ **í•µì‹¬**ì´ë‹¤. UIë„ ëª¨ë¥´ê³ , APIë„ ëª¨ë¥´ê³ , ì˜¤ì§ **ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™**ë§Œ ë‹´ë‹¹í•œë‹¤.

**ì¤‘ìš”í•œ ì›ì¹™**:

- **Domainì€ Coreë§Œ importí•œë‹¤**: `Data`, `Infrastructure`, `Presentation` ë ˆì´ì–´ëŠ” ì ˆëŒ€ importí•˜ì§€ ì•ŠëŠ”ë‹¤
- **Repository InterfaceëŠ” Domainì— ì •ì˜í•œë‹¤**: êµ¬í˜„ì²´(`Impl`)ëŠ” `Data` Layerì— ìœ„ì¹˜í•œë‹¤

`Domain`ì€ 3ê°€ì§€ë¡œ êµ¬ì„±ëœë‹¤:

1. `Entity`: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ ë‹´ì€ ê°ì²´
2. `Repository Interface`: ë°ì´í„° ì ‘ê·¼ ì¶”ìƒí™”
3. `UseCase`: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ íë¦„

### Entity: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™

EntityëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ì™€ ê´€ë ¨ëœ **ëª¨ë“  ê·œì¹™**ì„ ë‹´ëŠ”ë‹¤. ê²°ì œ ì‹œìŠ¤í…œì—ëŠ” `Order`ì™€ `Payment` Entityê°€ ìˆë‹¤.

#### Entityì˜ ì±…ì„ ë²”ìœ„

Entityë¥¼ ì„¤ëª…í•˜ê¸° ì „ì—, **Entityê°€ ë¬´ì—‡ì„ í•˜ê³  ë¬´ì—‡ì„ í•˜ì§€ ì•ŠëŠ”ì§€** ëª…í™•íˆ í•´ë‘ì.

**Entityê°€ ì¼ë°˜ì ìœ¼ë¡œ í•˜ëŠ” ê²ƒ (âœ…)**:

1. **ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦**: ìµœì†Œ ê¸ˆì•¡, ì”ì•¡ í™•ì¸ ë“±
2. **ë„ë©”ì¸ ë¡œì§ ìº¡ìŠí™”**: `canProcessPayment()`, `canRefund()` ê°™ì€ íŒë‹¨ ë¡œì§
3. **ë¶ˆë³€ì„± ë³´ì¥**: `readonly` í•„ë“œë¡œ ì˜ëª»ëœ ìƒíƒœ ë³€ê²½ ë°©ì§€
4. **íƒ€ì… ì•ˆì •ì„± ì œê³µ**: DTOì˜ ë¶ˆì•ˆì •í•œ íƒ€ì…ì„ ì•ˆì •ì ì¸ íƒ€ì…ìœ¼ë¡œ ë³€í™˜

**Entityê°€ ë³´í†µ í•˜ì§€ ì•ŠëŠ” ê²ƒ (âŒ)**:

1. **ìƒíƒœ ì§ì ‘ ë³€ê²½**: ì„œë²„ë§Œ ìƒíƒœë¥¼ ë³€ê²½í•˜ê³ , EntityëŠ” ê²€ì¦ë§Œ ë‹´ë‹¹í•œë‹¤ (ë°±ì—”ë“œì™€ ë‹¤ë¥¸ ì )
2. **API í˜¸ì¶œ**: ì´ê²ƒì€ Repositoryì˜ ì—­í• ì´ë‹¤
3. **UI ë¡œì§**: ì´ê²ƒì€ Presentation Layerì˜ ì—­í• ì´ë‹¤
4. **ë°ì´í„° ë³€í™˜**: ì´ê²ƒì€ Mapperì˜ ì—­í• ì´ë‹¤
5. **ì™¸ë¶€ ì˜ì¡´ì„± ì°¸ì¡°**: axios, TanStack Query, React ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ importí•˜ì§€ ì•ŠëŠ”ë‹¤

**í•µì‹¬**: EntityëŠ” `"ì´ ë°ì´í„°ê°€ ìœ íš¨í•œê°€?"`ì™€ `"ì´ ì‘ì—…ì´ ê°€ëŠ¥í•œê°€?"`ë§Œ ë‹µí•œë‹¤. "ì–´ë–»ê²Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ê¹Œ?", "ì–´ë–»ê²Œ í™”ë©´ì— ë³´ì—¬ì¤„ê¹Œ?"ëŠ” ë‹¤ë¥¸ ë ˆì´ì–´ì˜ ëª«ì´ë‹¤.

ë§ˆì¹˜ ë¬¼ê±´ì„ ì‚¬ë ¤ê³  í•  ë•Œ ì ì›ì—ê²Œ ë¬»ëŠ” ê²ƒê³¼ ë¹„ìŠ·í•˜ë‹¤:

- âœ… "ì´ ê¸ˆì•¡ìœ¼ë¡œ ì‚´ ìˆ˜ ìˆë‚˜ìš”?" (canPurchase) - Entityì˜ ì—­í• 
- âŒ "ì‹ ìš©ì¹´ë“œ ê²°ì œëŠ” ì–´ë–»ê²Œ í•˜ë‚˜ìš”?" (HTTP í˜¸ì¶œ) - DataSourceì˜ ì—­í• 
- âŒ "ì˜ìˆ˜ì¦ì„ ì˜ˆì˜ê²Œ ì¶œë ¥í•´ì£¼ì„¸ìš”" (UI) - Presentationì˜ ì—­í• 

ë¬¼ë¡  í”„ë¡œì íŠ¸ì— ë”°ë¼ Entityì˜ ì±…ì„ì´ ì¡°ê¸ˆì”© ë‹¤ë¥¼ ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ìœ„ ì›ì¹™ì„ ë”°ë¥´ë©´ ë ˆì´ì–´ ê°„ ì±…ì„ì´ ëª…í™•í•´ì§„ë‹¤.

#### í”„ë¡ íŠ¸ì—”ë“œ EntityëŠ” ì™œ ë¶ˆë³€ì¸ê°€?

ë°±ì—”ë“œì™€ í”„ë¡ íŠ¸ì—”ë“œì˜ EntityëŠ” ì—­í• ì´ ë‹¤ë¥´ë‹¤.

**ë°±ì—”ë“œ Entity**: ìƒíƒœë¥¼ ì§ì ‘ ë³€ê²½í•˜ê³  DBì— ì €ì¥í•œë‹¤.

```ts
// ë°±ì—”ë“œ: Entityê°€ ìƒíƒœë¥¼ ì§ì ‘ ë³€ê²½
class Payment {
  private _status: PaymentStatus;

  approve() {
    this._status = "SUCCEEDED"; // âœ… Entityê°€ ìƒíƒœ ë³€ê²½
    this.save(); // DBì— ì €ì¥
  }
}
```

**í”„ë¡ íŠ¸ì—”ë“œ Entity**: ì„œë²„ ì‘ë‹µì„ ê²€ì¦í•˜ê³  UIì— ì „ë‹¬í•œë‹¤ (ì½ê¸° ì „ìš©).

```ts
// í”„ë¡ íŠ¸ì—”ë“œ: EntityëŠ” ê²€ì¦ë§Œ
class Payment {
  private readonly _status: PaymentStatus;

  canCancel(): boolean {
    return this._status === "PENDING"; // âœ… ê²€ì¦ë§Œ
  }
}
```

í”„ë¡ íŠ¸ì—”ë“œëŠ” **ì„œë²„ê°€ ìƒíƒœì˜ ì£¼ì¸**ì´ë‹¤. í´ë¼ì´ì–¸íŠ¸ê°€ ì„ì˜ë¡œ ìƒíƒœë¥¼ ë³€ê²½í•˜ë©´ ì„œë²„ì™€ ë¶ˆì¼ì¹˜ê°€ ë°œìƒí•œë‹¤.

ë§ˆì¹˜ ì€í–‰ ê±°ë˜ì™€ ê°™ë‹¤. ë‚´ í™”ë©´(í”„ë¡ íŠ¸ì—”ë“œ)ì— "ê²°ì œ ëŒ€ê¸°"ë¼ê³  ë³´ì—¬ë„, ì€í–‰ ì„œë²„ì—ì„œ "ê²°ì œ ì™„ë£Œ"ë¼ê³  í•˜ë©´ ì€í–‰ ì„œë²„ê°€ ì •ë‹µì´ë‹¤. í™”ë©´ì˜ ìƒíƒœë¥¼ ì„ì˜ë¡œ ë°”ê¿€ ìˆ˜ ì—†ëŠ” ê²ƒì²˜ëŸ¼, í”„ë¡ íŠ¸ì—”ë“œëŠ” ì„œë²„ ì‘ë‹µë§Œ ë¯¿ì–´ì•¼ í•œë‹¤.

| êµ¬ë¶„          | ë°±ì—”ë“œ Entity         | í”„ë¡ íŠ¸ì—”ë“œ Entity       |
| ------------- | --------------------- | ----------------------- |
| **ìƒíƒœ ë³€ê²½** | âœ… Entityê°€ ì§ì ‘ ë³€ê²½ | âŒ ì„œë²„ ì‘ë‹µìœ¼ë¡œë§Œ ë³€ê²½ |
| **ì €ì¥ì†Œ**    | DB (ì˜ì†ì„±)           | TanStack Query (ìºì‹œ)   |
| **ì—­í• **      | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰    | ê²€ì¦ + UI ì „ë‹¬          |
| **ì˜ˆì‹œ**      | `payment.approve()`   | `payment.canCancel()`   |

ìš°ë¦¬ í”„ë¡œì íŠ¸ëŠ” **ì„œë²„ ìƒíƒœ ê´€ë¦¬ë¥¼ TanStack Queryì—ê²Œ ìœ„ì„**í–ˆë‹¤. ë§Œì•½ Entityì—ì„œë„ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

```ts
// âŒ Entityê°€ ìƒíƒœë¥¼ ì§ì ‘ ë³€ê²½í•˜ë©´?
class Payment {
  private _status: PaymentStatus;

  confirm() {
    this._status = "SUCCEEDED"; // Entityê°€ ìƒíƒœ ë³€ê²½
  }
}

// ë¬¸ì œ: TanStack Query ìºì‹œì™€ Entity ìƒíƒœê°€ ë”°ë¡œ ë…¼ë‹¤!
// - Entity: _status = "SUCCEEDED"
// - TanStack Query ìºì‹œ: status = "PENDING"
// ì–´ëŠ ê²ƒì´ ì§„ì§œì¸ê°€?
```

Entityì™€ TanStack Query ìºì‹œê°€ **ê°ì ìƒíƒœë¥¼ ê´€ë¦¬**í•˜ë©´ ë¶ˆì¼ì¹˜ê°€ ë°œìƒí•œë‹¤. ë”°ë¼ì„œ EntityëŠ” `readonly`ë¡œ ë§Œë“¤ì–´ **ê²€ì¦ë§Œ ë‹´ë‹¹**í•˜ê³ , ìƒíƒœëŠ” TanStack Queryê°€ ì„œë²„ ì‘ë‹µìœ¼ë¡œë§Œ ì—…ë°ì´íŠ¸í•œë‹¤.

ì´ì œ ì‹¤ì œ Entity ì½”ë“œë¥¼ ë³´ì.

---

#### Order Entity

`Order` EntityëŠ” ì£¼ë¬¸ ì •ë³´ì™€ ê²°ì œ ì²˜ë¦¬ ê·œì¹™ì„ ë‹´ë‹¹í•œë‹¤. ì‚¬ìš©ìê°€ ì¥ë°”êµ¬ë‹ˆì—ì„œ "ê²°ì œí•˜ê¸°"ë¥¼ ëˆ„ë¥´ë©´ ì£¼ë¬¸ì´ ìƒì„±ëœë‹¤.

```ts
// domain/entities/Order.ts
export type OrderStatus = "PENDING" | "PAID" | "FAILED" | "CANCELED";

interface OrderItem {
  productId: string;
  productName: string;
  quantity: number;
  price: number;
}

interface OrderProps {
  orderId: string;
  orderName: string; // "ì•„ë©”ë¦¬ì¹´ë…¸ ì™¸ 2ê±´" ê°™ì€ ì£¼ë¬¸ ìš”ì•½
  userId: string;
  items: OrderItem[];
  totalAmount: number;
  status: OrderStatus;
  createdAt: Date;
  updatedAt: Date;
}

export class Order {
  private readonly _orderId: string;
  private readonly _orderName: string;
  private readonly _userId: string;
  private readonly _items: readonly OrderItem[];
  private readonly _totalAmount: number;
  private readonly _status: OrderStatus;
  private readonly _createdAt: Date;
  private readonly _updatedAt: Date;

  static readonly MIN_ORDER_AMOUNT = 1_000; // ìµœì†Œ ì£¼ë¬¸ ê¸ˆì•¡
  static readonly MAX_ORDER_AMOUNT = 10_000_000; // ìµœëŒ€ ì£¼ë¬¸ ê¸ˆì•¡

  constructor(props: OrderProps) {
    this._orderId = props.orderId;
    this._orderName = props.orderName;
    this._userId = props.userId;
    this._items = Object.freeze([...props.items]);
    this._totalAmount = props.totalAmount;
    this._status = props.status;
    this._createdAt = props.createdAt;
    this._updatedAt = props.updatedAt;

    // ìƒì„± ì‹œì ì— í•„ìˆ˜ ê²€ì¦ ìˆ˜í–‰
    this.validate();
  }

  private validate(): void {
    if (!this._orderId?.trim()) throw new Error("ì£¼ë¬¸ IDëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤");
    if (!this._orderName?.trim()) throw new Error("ì£¼ë¬¸ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤");
    if (!this._userId?.trim()) throw new Error("ì‚¬ìš©ì IDëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤");
    if (this._items.length === 0) throw new Error("ì£¼ë¬¸ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤");
    if (this._totalAmount < 0)
      throw new Error("ì£¼ë¬¸ ê¸ˆì•¡ì€ ìŒìˆ˜ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
  }

  get orderId() {
    return this._orderId;
  }
  get orderName() {
    return this._orderName;
  }
  get userId() {
    return this._userId;
  }
  get items() {
    return this._items;
  }
  get totalAmount() {
    return this._totalAmount;
  }
  get status() {
    return this._status;
  }
  get createdAt() {
    return this._createdAt;
  }
  get updatedAt() {
    return this._updatedAt;
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ì£¼ë¬¸ ê¸ˆì•¡ ê²€ì¦
  static validateOrderAmount(amount: number): void {
    if (amount < this.MIN_ORDER_AMOUNT) {
      throw new Error(`ìµœì†Œ ì£¼ë¬¸ ê¸ˆì•¡ì€ ${this.MIN_ORDER_AMOUNT}ì›ì…ë‹ˆë‹¤`);
    }
    if (amount > this.MAX_ORDER_AMOUNT) {
      throw new Error(`ìµœëŒ€ ì£¼ë¬¸ ê¸ˆì•¡ì€ ${this.MAX_ORDER_AMOUNT}ì›ì…ë‹ˆë‹¤`);
    }
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ê²°ì œ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
  canProcessPayment(): boolean {
    return this._status === "PENDING" && this._totalAmount > 0;
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ì·¨ì†Œ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
  canCancel(): boolean {
    return this._status === "PENDING" || this._status === "PAID";
  }
}
```

**Validation ì „ëµ**

| íŒ¨í„´                   | ëª©ì                          | í˜¸ì¶œ ì‹œì                |
| ---------------------- | ---------------------------- | ----------------------- |
| `private validate()`   | Entityì˜ í•„ìˆ˜ ë¶ˆë³€ ê·œì¹™ ê²€ì¦ | Entity ìƒì„± ì‹œ ìë™     |
| `static validateXXX()` | ì‚¬ìš©ì ì…ë ¥ ì‚¬ì „ ê²€ì¦        | UseCaseì—ì„œ ëª…ì‹œì  í˜¸ì¶œ |
| `canProcessPayment()`  | ë¹„ì¦ˆë‹ˆìŠ¤ ìƒíƒœ ê²€ì¦           | UseCase/ì»´í¬ë„ŒíŠ¸ í˜¸ì¶œ   |

**í•µì‹¬**: Constructor validationì€ ì˜ëª»ëœ ë°ì´í„°ë¡œ Entityê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ ì›ì²œ ì°¨ë‹¨í•œë‹¤. Entityë¥¼ ë°›ëŠ” ëª¨ë“  ì½”ë“œê°€ "ì´ ê°ì²´ëŠ” ìœ íš¨í•˜ë‹¤"ê³  ì‹ ë¢°í•  ìˆ˜ ìˆë‹¤.

#### Entity ë©”ì„œë“œ ì„¤ê³„ ì›ì¹™

Domain Entityì˜ ë©”ì„œë“œëŠ” **ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦**ì—ë§Œ ì§‘ì¤‘í•œë‹¤. ëª¨ë“  ê²€ì¦ ë©”ì„œë“œëŠ” Booleanì„ ë°˜í™˜í•œë‹¤.

**âœ… ì¢‹ì€ ì˜ˆì‹œ** (Boolean ë°˜í™˜):

```ts
class Order {
  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ê²°ì œ ê°€ëŠ¥ ì—¬ë¶€
  canProcessPayment(): boolean {
    return this._status === "PENDING" && this._totalAmount > 0;
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ì·¨ì†Œ ê°€ëŠ¥ ì—¬ë¶€
  canCancel(): boolean {
    return this._status === "PENDING" || this._status === "PAID";
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ìµœì†Œ ìˆ˜ëŸ‰ ì¶©ì¡± ì—¬ë¶€
  hasMinimumQuantity(minQty: number): boolean {
    const total = this.items.reduce((sum, item) => sum + item.quantity, 0);
    return total >= minQty;
  }
}
```

**âŒ ë‚˜ìœ ì˜ˆì‹œ** (ê³„ì‚°/ì§‘ê³„):

```ts
class Order {
  // âŒ ê³„ì‚° ë©”ì„œë“œ - Presentation Layerì—ì„œ ì²˜ë¦¬í•´ì•¼ í•¨
  getTotalQuantity(): number {
    return this.items.reduce((sum, item) => sum + item.quantity, 0);
  }

  // âŒ ê³„ì‚° ë©”ì„œë“œ - UseCaseì—ì„œ ì²˜ë¦¬í•´ì•¼ í•¨
  calculateTax(): number {
    return this.totalAmount * 0.1;
  }

  // âŒ í¬ë§¤íŒ… ë©”ì„œë“œ - Presentation Layerì—ì„œ ì²˜ë¦¬í•´ì•¼ í•¨
  formatOrderName(): string {
    return `${this.orderName} (${this.items.length}ê±´)`;
  }
}
```

**ì´ìœ **:

- EntityëŠ” **"ì´ ì£¼ë¬¸ì´ ìœ íš¨í•œê°€?"**ë¥¼ íŒë‹¨í•˜ëŠ” ì—­í• ì´ë‹¤
- **"ì´ ìˆ˜ëŸ‰ì´ ëª‡ ê°œì¸ê°€?"**ëŠ” Entityì˜ ê´€ì‹¬ì‚¬ê°€ ì•„ë‹ˆë‹¤
- ê³„ì‚°ì´ë‚˜ ì§‘ê³„ëŠ” UseCaseë‚˜ Presentation Layerì—ì„œ ì²˜ë¦¬í•œë‹¤
- EntityëŠ” ë¶ˆë³€ì´ë¯€ë¡œ ìƒíƒœë¥¼ ê³„ì‚°í•  í•„ìš”ê°€ ì—†ë‹¤ (Tanstack Queryê°€ ì„œë²„ ìƒíƒœ ê´€ë¦¬)

### ì£¼ë¬¸ ìƒíƒœ(OrderStatus) ì„¤ëª…

ì£¼ë¬¸ì€ `PENDING`(ëŒ€ê¸°) â†’ `PAID`(ì™„ë£Œ) ë˜ëŠ” `FAILED`(ì‹¤íŒ¨)ë¡œ ì „í™˜ëœë‹¤. ê²°ì œ ì „ ì£¼ë¬¸ì€ `PENDING` ìƒíƒœì´ë©°, ì‚¬ìš©ìê°€ í† ìŠ¤ ê²°ì œ ìœ„ì ¯ì—ì„œ ìŠ¹ì¸í•˜ë©´ `PAID`ë¡œ ë°”ë€ë‹¤. ê²°ì œ ì‹¤íŒ¨ ì‹œ `FAILED`, ì‚¬ìš©ìê°€ ì·¨ì†Œí•˜ë©´ `CANCELED`ê°€ ëœë‹¤.

---

#### Payment Entity

ê²°ì œ ì²˜ë¦¬ ë‚´ì—­ì„ ê´€ë¦¬í•˜ëŠ” Entityì´ë‹¤. í† ìŠ¤ í˜ì´ë¨¼ì¸ ì™€ StripeëŠ” API ì‘ë‹µ í˜•ì‹ì´ ë‹¤ë¥´ì§€ë§Œ, `Payment` EntityëŠ” ì´ë¥¼ **ì •ê·œí™”ëœ í˜•íƒœ**ë¡œ í†µì¼í•œë‹¤.

```ts
// domain/entities/Payment.ts
export type PaymentGateway = "toss" | "stripe";
export type PaymentStatus =
  | "PENDING"
  | "PROCESSING"
  | "SUCCEEDED"
  | "FAILED"
  | "CANCELED";
export type PaymentMethod =
  | "CARD"
  | "VIRTUAL_ACCOUNT"
  | "EASY_PAY"
  | "TRANSFER";

interface PaymentProps {
  paymentId: string; // ê²°ì œ ê³ ìœ  ID
  orderId: string; // ì—°ê²°ëœ ì£¼ë¬¸ ID
  gateway: PaymentGateway; // ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ (toss ë˜ëŠ” stripe)
  gatewayPaymentId: string; // ê²Œì´íŠ¸ì›¨ì´ì—ì„œ ë°œê¸‰í•œ ê²°ì œ ID (í† ìŠ¤ì˜ paymentKey, Stripeì˜ id)
  amount: number; // ê²°ì œ ê¸ˆì•¡ (ì› ë‹¨ìœ„ë¡œ ì •ê·œí™”)
  currency: string; // í†µí™” (KRW, USD ë“±)
  status: PaymentStatus; // ê²°ì œ ìƒíƒœ
  method?: PaymentMethod; // ê²°ì œ ìˆ˜ë‹¨
  requestedAt: Date; // ê²°ì œ ìš”ì²­ ì‹œê°
  approvedAt?: Date; // ê²°ì œ ìŠ¹ì¸ ì‹œê°
  canceledAt?: Date; // ê²°ì œ ì·¨ì†Œ ì‹œê°
  receiptUrl?: string; // ì˜ìˆ˜ì¦ URL
}

export class Payment {
  private readonly _paymentId: string;
  private readonly _orderId: string;
  private readonly _gateway: PaymentGateway;
  private readonly _gatewayPaymentId: string;
  private readonly _amount: number;
  private readonly _currency: string;
  private readonly _status: PaymentStatus;
  private readonly _method?: PaymentMethod;
  private readonly _requestedAt: Date;
  private readonly _approvedAt?: Date;
  private readonly _canceledAt?: Date;
  private readonly _receiptUrl?: string;

  constructor(props: PaymentProps) {
    this._paymentId = props.paymentId;
    this._orderId = props.orderId;
    this._gateway = props.gateway;
    this._gatewayPaymentId = props.gatewayPaymentId;
    this._amount = props.amount;
    this._currency = props.currency;
    this._status = props.status;
    this._method = props.method;
    this._requestedAt = props.requestedAt;
    this._approvedAt = props.approvedAt;
    this._canceledAt = props.canceledAt;
    this._receiptUrl = props.receiptUrl;

    this.validate();
  }

  private validate(): void {
    if (!this._paymentId?.trim()) throw new Error("ê²°ì œ IDëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤");
    if (!this._orderId?.trim()) throw new Error("ì£¼ë¬¸ IDëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤");
    if (this._amount < 0) throw new Error("ê²°ì œ ê¸ˆì•¡ì€ ìŒìˆ˜ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
  }

  get paymentId() {
    return this._paymentId;
  }
  get orderId() {
    return this._orderId;
  }
  get gateway() {
    return this._gateway;
  }
  get gatewayPaymentId() {
    return this._gatewayPaymentId;
  }
  get amount() {
    return this._amount;
  }
  get currency() {
    return this._currency;
  }
  get status() {
    return this._status;
  }
  get method() {
    return this._method;
  }
  get requestedAt() {
    return this._requestedAt;
  }
  get approvedAt() {
    return this._approvedAt;
  }
  get canceledAt() {
    return this._canceledAt;
  }
  get receiptUrl() {
    return this._receiptUrl;
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ê²°ì œ ì„±ê³µ ì—¬ë¶€
  isSucceeded(): boolean {
    return this._status === "SUCCEEDED";
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ê²°ì œ ì·¨ì†Œ ê°€ëŠ¥ ì—¬ë¶€
  canCancel(): boolean {
    return this._status === "SUCCEEDED" || this._status === "PENDING";
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ê²°ì œ ì¬ì‹œë„ ê°€ëŠ¥ ì—¬ë¶€
  canRetry(): boolean {
    return this._status === "FAILED";
  }
}
```

---

Entityë“¤ì€ ë‹¤ìŒê³¼ ê°™ì€ `ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™(ê²€ì¦ ë¡œì§)`ì„ ë‹´ëŠ”ë‹¤:

**Order Entity:**

- **ìµœì†Œ/ìµœëŒ€ ì£¼ë¬¸ ê¸ˆì•¡**: 1,000ì› ì´ìƒ, 10,000,000ì› ì´í•˜ì¸ì§€ ê²€ì¦
- **ê²°ì œ ê°€ëŠ¥ ì—¬ë¶€**: ì£¼ë¬¸ ìƒíƒœê°€ `PENDING`ì´ê³  ê¸ˆì•¡ì´ ì–‘ìˆ˜ì¸ì§€ í™•ì¸ (`canProcessPayment`)
- **ì·¨ì†Œ ê°€ëŠ¥ ì—¬ë¶€**: ì£¼ë¬¸ ìƒíƒœê°€ `PENDING` ë˜ëŠ” `PAID`ì¸ì§€ í™•ì¸ (`canCancel`)
- **ì£¼ë¬¸ ìƒí’ˆ ê²€ì¦**: ìµœì†Œ 1ê°œ ì´ìƒì˜ ìƒí’ˆì´ ìˆëŠ”ì§€ í™•ì¸

**Payment Entity:**

- **ê²°ì œ ì„±ê³µ ì—¬ë¶€**: ìƒíƒœê°€ `SUCCEEDED`ì¸ì§€ í™•ì¸ (`isSucceeded`)
- **ì·¨ì†Œ ê°€ëŠ¥ ì—¬ë¶€**: ìƒíƒœê°€ `SUCCEEDED` ë˜ëŠ” `PENDING`ì¸ì§€ í™•ì¸ (`canCancel`)
- **ì¬ì‹œë„ ê°€ëŠ¥ ì—¬ë¶€**: ìƒíƒœê°€ `FAILED`ì¸ì§€ í™•ì¸ (`canRetry`)
- **ê²Œì´íŠ¸ì›¨ì´ ë…ë¦½ì„±**: í† ìŠ¤ì™€ Stripeì˜ ì°¨ì´ë¥¼ `Payment` Entityê°€ ìˆ¨ê¸´ë‹¤ (ì •ê·œí™”)

ê¸°íšìê°€ "ìµœì†Œ ì£¼ë¬¸ ê¸ˆì•¡ì„ 2,000ì›ìœ¼ë¡œ ë°”ê¿”ì£¼ì„¸ìš”"ë¼ê³  í•˜ë©´? `MIN_ORDER_AMOUNT` í•œ ì¤„ë§Œ ë°”ê¾¸ë©´ ëœë‹¤.

```diff
// domain/entities/Order.ts
- static readonly MIN_ORDER_AMOUNT = 1_000;
+ static readonly MIN_ORDER_AMOUNT = 2_000;
```

ì»´í¬ë„ŒíŠ¸ëŠ” ê±´ë“œë¦´ í•„ìš”ê°€ ì—†ë‹¤.

---

### Repository Interface: ë°ì´í„° ì ‘ê·¼ ì¶”ìƒí™”

`Domain` LayerëŠ” ë°ì´í„°ê°€ **ì–´ë””ì„œ ì˜¤ëŠ”ì§€** ëª¨ë¥¸ë‹¤. HTTP APIì¸ì§€, localStorageì¸ì§€, sessionStorageì¸ì§€ ì•Œ í•„ìš”ê°€ ì—†ë‹¤. ë‹¨ì§€ "**ì–´ë–¤ ë°ì´í„°ê°€ í•„ìš”í•œì§€**"ë§Œ ì •ì˜í•œë‹¤.

ì´ê²ƒì´ ë°”ë¡œ `Repository Interface`ë‹¤. `Domain`ì€ ì¸í„°í˜ì´ìŠ¤ë§Œ ì •ì˜í•˜ê³ , `Data` Layerê°€ ì‹¤ì œ êµ¬í˜„ì„ ì œê³µí•œë‹¤.

```ts
// domain/repositories/PaymentRepository.ts
import type { Payment } from "@/domain/entities/Payment";
import type { PaymentGateway } from "@/domain/entities/Payment";

export interface ConfirmPaymentParams {
  orderId: string;
  paymentKey: string; // í† ìŠ¤ ê²°ì œ ìŠ¹ì¸ìš©
  amount: number;
}

export interface PaymentRepository {
  confirmPayment(
    params: ConfirmPaymentParams,
    gateway: PaymentGateway
  ): Promise<Payment>;
  getPayment(paymentId: string, gateway: PaymentGateway): Promise<Payment>;
  cancelPayment(
    paymentId: string,
    gateway: PaymentGateway,
    reason?: string
  ): Promise<Payment>;
}
```

**í•µì‹¬ì€ ë°˜í™˜ íƒ€ì…**ì´ë‹¤. `Repository Interface`ëŠ” `DTO`ê°€ ì•„ë‹Œ `Entity`ë¥¼ ë°˜í™˜í•œë‹¤. `Domain`ì€ `DTO`ì˜ ì¡´ì¬ì¡°ì°¨ ëª¨ë¥¸ë‹¤.

ì´ë ‡ê²Œ í•˜ë©´:

- `Domain`ì€ `Data`ë¥¼ ëª°ë¼ë„ ëœë‹¤: ì˜ì¡´ì„± ì—­ì „ ì›ì¹™
- **í…ŒìŠ¤íŠ¸ê°€ ì‰¬ì›Œì§„ë‹¤**: Mock Repositoryë¥¼ ì£¼ì…í•˜ë©´ ë
- **ë°ì´í„° ì†ŒìŠ¤ êµì²´ê°€ ììœ ë¡­ë‹¤**: HTTP â†’ LocalStorageë¡œ ë°”ê¿”ë„ `Domain`ì€ ëª¨ë¥¸ë‹¤

ë§ˆì¹˜ ì½˜ì„¼íŠ¸ì™€ í”ŒëŸ¬ê·¸ì˜ ê´€ê³„ë‹¤. ì½˜ì„¼íŠ¸(Interface)ëŠ” ê·œê²©ë§Œ ì •ì˜í•˜ê³ , ì–´ë–¤ ì „ê¸°(ë°ì´í„°)ê°€ ë“¤ì–´ì˜¤ë“  ìƒê´€ì—†ë‹¤.

---

### UseCase: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ íë¦„

`UseCase`ëŠ” ì—¬ëŸ¬ `Entity`ë¥¼ ì¡°í•©í•´ì„œ **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**ì„ ìˆ˜í–‰í•œë‹¤.

```ts
// domain/useCases/confirmPayment.ts
import { Order } from "@/domain/entities/Order";
import { Payment, PaymentGateway } from "@/domain/entities/Payment";
import type {
  PaymentRepository,
  ConfirmPaymentParams,
} from "@/domain/repositories/PaymentRepository";

export class ConfirmPaymentUseCase {
  constructor(private paymentRepository: PaymentRepository) {}

  async execute(
    order: Order,
    params: ConfirmPaymentParams,
    gateway: PaymentGateway
  ): Promise<Payment> {
    // 1. ì…ë ¥ê°’ ê²€ì¦
    Order.validateOrderAmount(params.amount);

    if (!order.canProcessPayment()) {
      throw new Error("ê²°ì œí•  ìˆ˜ ì—†ëŠ” ì£¼ë¬¸ ìƒíƒœì…ë‹ˆë‹¤");
    }

    if (order.totalAmount !== params.amount) {
      throw new Error("ì£¼ë¬¸ ê¸ˆì•¡ê³¼ ê²°ì œ ê¸ˆì•¡ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤");
    }

    // 2. Repository í˜¸ì¶œ (ê²Œì´íŠ¸ì›¨ì´ì— ê²°ì œ ìŠ¹ì¸ ìš”ì²­)
    const payment = await this.paymentRepository.confirmPayment(
      params,
      gateway
    );

    // 3. ê²°ì œ ì„±ê³µ í™•ì¸
    if (!payment.isSucceeded()) {
      throw new Error("ê²°ì œ ìŠ¹ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤");
    }

    return payment;
  }
}
```

`ConfirmPaymentUseCase`ëŠ” ë‹¤ìŒì„ ìˆ˜í–‰í•œë‹¤:

1. **ì…ë ¥ê°’ ê²€ì¦**: `Order` Entityì˜ ê·œì¹™ì„ ì‚¬ìš©í•´ ì£¼ë¬¸ ê¸ˆì•¡ ê²€ì¦ê³¼ ê²°ì œ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤
2. **ê¸ˆì•¡ ì¼ì¹˜ í™•ì¸**: ì£¼ë¬¸ ê¸ˆì•¡ê³¼ ì‹¤ì œ ê²°ì œ ê¸ˆì•¡ì´ ë™ì¼í•œì§€ ê²€ì¦í•œë‹¤ (ë³´ì•ˆ)
3. **Repository í˜¸ì¶œ**: `paymentRepository.confirmPayment()`ë¡œ ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ì— ìŠ¹ì¸ ìš”ì²­ì„ ë³´ë‚´ê³ , `Payment` Entityë¥¼ ë°˜í™˜ë°›ëŠ”ë‹¤

**ì¤‘ìš”í•œ ì›ì¹™**:

- `Entity`ëŠ” ë¶ˆë³€ì´ë‹¤: Tanstack Queryê°€ ì„œë²„ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ë¯€ë¡œ, EntityëŠ” ê²€ì¦ë§Œ ë‹´ë‹¹ (ìƒíƒœ ì¤‘ë³µ ë°©ì§€)
- `UseCase`ëŠ” `Entity`ë§Œ ë°›ëŠ”ë‹¤: `DTO`ë¥¼ ë³¼ ì¼ì´ ì—†ë‹¤
- **ê²Œì´íŠ¸ì›¨ì´ëŠ” `PaymentRepository`ê°€ ê²°ì •í•œë‹¤**: UseCaseëŠ” í† ìŠ¤ì¸ì§€ Stripeì¸ì§€ ëª¨ë¥¸ë‹¤

`UseCase`ëŠ” **ì–´ë–¤ UI**ë¥¼ ì“°ëŠ”ì§€, **ì–´ë–¤ HTTP í´ë¼ì´ì–¸íŠ¸**ë¥¼ ì“°ëŠ”ì§€, **ì–´ë–¤ ê²°ì œ ê²Œì´íŠ¸ì›¨ì´**ë¥¼ ì“°ëŠ”ì§€ ì „í˜€ ëª¨ë¥¸ë‹¤. ì˜¤ì§ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ ë‹´ë‹¹í•œë‹¤.

### ê²°ì œ ì·¨ì†Œ UseCase ì˜ˆì‹œ

ê²°ì œëœ ê±´ì„ ì·¨ì†Œí•˜ëŠ” ë¡œì§ë„ `UseCase`ë¡œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

```ts
// domain/useCases/cancelPayment.ts
import { Payment, PaymentGateway } from "@/domain/entities/Payment";
import type { PaymentRepository } from "@/domain/repositories/PaymentRepository";

export class CancelPaymentUseCase {
  constructor(private paymentRepository: PaymentRepository) {}

  async execute(
    payment: Payment,
    gateway: PaymentGateway,
    cancelReason?: string
  ): Promise<Payment> {
    // 1. ì·¨ì†Œ ê°€ëŠ¥ ì—¬ë¶€ ê²€ì¦
    if (!payment.canCancel()) {
      throw new Error("ì·¨ì†Œí•  ìˆ˜ ì—†ëŠ” ê²°ì œ ìƒíƒœì…ë‹ˆë‹¤");
    }

    // 2. Repository í˜¸ì¶œ (ê²Œì´íŠ¸ì›¨ì´ì— ì·¨ì†Œ ìš”ì²­)
    const canceledPayment = await this.paymentRepository.cancelPayment(
      payment.paymentId,
      gateway,
      cancelReason
    );

    // 3. ì·¨ì†Œ ì„±ê³µ í™•ì¸
    if (canceledPayment.status !== "CANCELED") {
      throw new Error("ê²°ì œ ì·¨ì†Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤");
    }

    return canceledPayment;
  }
}
```

ê²°ì œ ì·¨ì†Œ ë¡œì§ë„ **ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™**(ì·¨ì†Œ ê°€ëŠ¥ ì—¬ë¶€)ê³¼ **ë°ì´í„° ì²˜ë¦¬**(ê²Œì´íŠ¸ì›¨ì´ ìš”ì²­)ë¥¼ ë¶„ë¦¬í–ˆë‹¤. ì·¨ì†Œ ì‚¬ìœ ëŠ” ì„ íƒ ì‚¬í•­ìœ¼ë¡œ ì£¼ì…ë°›ì•„ ìœ ì—°í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

---

## DI Layer: DI Containerë¡œ ì˜ì¡´ì„± ê´€ë¦¬

ì§€ê¸ˆê¹Œì§€ `Entity`, `Repository`, `UseCase`ë¥¼ ë§Œë“¤ì—ˆë‹¤. í•˜ì§€ë§Œ ì´ ëª¨ë“  ì˜ì¡´ì„±ì„ ì–´ë–»ê²Œ ê´€ë¦¬í• ê¹Œ?

`UseCase`ëŠ” `Repository`ê°€ í•„ìš”í•˜ê³ , `Repository`ëŠ” `DataSource`ê°€ í•„ìš”í•˜ê³ , `DataSource`ëŠ” `HttpClient`ê°€ í•„ìš”í•˜ë‹¤. ë§¤ë²ˆ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±í•˜ë©´ ì½”ë“œê°€ ë³µì¡í•´ì§„ë‹¤.

ì´ë•Œ **DI Container**ë¥¼ ì‚¬ìš©í•œë‹¤. DI ContainerëŠ” **ì˜ì¡´ì„±ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬í•˜ê³ , í•„ìš”í•  ë•Œ ì£¼ì…**í•´ì¤€ë‹¤.

ë§ˆì¹˜ ê³µì¥ì—ì„œ ì œí’ˆì„ ë§Œë“¤ ë•Œ í•„ìš”í•œ ë¶€í’ˆì„ ë¯¸ë¦¬ ì¤€ë¹„í•´ë‘ëŠ” ê²ƒê³¼ ê°™ë‹¤.

```ts
// di/DIContainer.ts
import { AxiosHttpClient } from "@/infrastructure/http/AxiosHttpClient";
import { TossPaymentsDataSource } from "@/data/datasources/remote/tossPaymentsDataSource";
import { StripeDataSource } from "@/data/datasources/remote/stripeDataSource";
import { PaymentRepositoryImpl } from "@/data/repositories/PaymentRepositoryImpl";
import { ConfirmPaymentUseCase } from "@/domain/useCases/confirmPayment";
import { CancelPaymentUseCase } from "@/domain/useCases/cancelPayment";
import type { PaymentRepository } from "@/domain/repositories/PaymentRepository";
import type { HttpClient } from "@/infrastructure/http/HttpClient";

class DIContainer {
  private static _httpClient: HttpClient;
  private static _tossDataSource: TossPaymentsDataSource;
  private static _stripeDataSource: StripeDataSource;
  private static _paymentRepository: PaymentRepository;

  static get httpClient() {
    return (this._httpClient ??= new AxiosHttpClient({
      timeout: 10_000,
    }));
  }

  static get tossDataSource() {
    return (this._tossDataSource ??= new TossPaymentsDataSource(
      this.httpClient
    ));
  }

  static get stripeDataSource() {
    return (this._stripeDataSource ??= new StripeDataSource(this.httpClient));
  }

  static get paymentRepository() {
    return (this._paymentRepository ??= new PaymentRepositoryImpl(
      this.tossDataSource,
      this.stripeDataSource
    ));
  }

  // UseCases (ë§¤ë²ˆ ìƒˆë¡œ ìƒì„±)
  static get confirmPaymentUseCase() {
    return new ConfirmPaymentUseCase(this.paymentRepository);
  }

  static get cancelPaymentUseCase() {
    return new CancelPaymentUseCase(this.paymentRepository);
  }

  // í…ŒìŠ¤íŠ¸ìš©
  static setMockRepositories(paymentRepo: PaymentRepository) {
    this._paymentRepository = paymentRepo;
  }
}

export default DIContainer;
```

**ì „ëµ**: `HttpClient`, `DataSource`, `Repository`ëŠ” ì‹±ê¸€í†¤ (`??=`), `UseCase`ëŠ” ë§¤ë²ˆ ìƒˆë¡œ ìƒì„±, í…ŒìŠ¤íŠ¸ ì‹œ Mock ì£¼ì… ê°€ëŠ¥.

### ì™œ ì‹±ê¸€í†¤ì¸ê°€? ë©”ëª¨ë¦¬ ë‚­ë¹„ ë°©ì§€

DI Container ì—†ì´ ë§¤ë²ˆ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

```ts
// âŒ ì•ˆí‹°íŒ¨í„´: ì»´í¬ë„ŒíŠ¸ë§ˆë‹¤ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
function useConfirmPayment() {
  const httpClient = new AxiosHttpClient({ ... });  // ì¸ìŠ¤í„´ìŠ¤ 1
  const tossDataSource = new TossPaymentsDataSource(httpClient);
  const stripeDataSource = new StripeDataSource(httpClient);
  const repository = new PaymentRepositoryImpl(tossDataSource, stripeDataSource);
  const useCase = new ConfirmPaymentUseCase(repository);
  // ...
}

function useCancelPayment() {
  const httpClient = new AxiosHttpClient({ ... });  // ì¸ìŠ¤í„´ìŠ¤ 2 (ì¤‘ë³µ!)
  const tossDataSource = new TossPaymentsDataSource(httpClient);  // ì¤‘ë³µ!
  const stripeDataSource = new StripeDataSource(httpClient);  // ì¤‘ë³µ!
  const repository = new PaymentRepositoryImpl(tossDataSource, stripeDataSource);
  const useCase = new CancelPaymentUseCase(repository);
  // ...
}

// ë¬¸ì œ: HttpClient, DataSourceê°€ Hookë§ˆë‹¤ ìƒì„±ë¨
// - 10ê°œ Hook â†’ HttpClient 10ê°œ, TossDataSource 10ê°œ, StripeDataSource 10ê°œ
```

DI ContainerëŠ” `??=` (Nullish coalescing assignment)ë¡œ **ì‹±ê¸€í†¤**ì„ êµ¬í˜„í•œë‹¤:

```ts
// âœ… DI Container: ì‹±ê¸€í†¤ìœ¼ë¡œ 1ë²ˆë§Œ ìƒì„±
static get httpClient() {
  return (this._httpClient ??= new AxiosHttpClient({ ... }));
  // _httpClientê°€ ì—†ìœ¼ë©´ ìƒì„±, ìˆìœ¼ë©´ ê¸°ì¡´ ê²ƒ ì¬ì‚¬ìš©
}
```

**ì´ì **:

- **ë©”ëª¨ë¦¬ íš¨ìœ¨**: `HttpClient` 1ê°œë§Œ ìƒì„±, ëª¨ë“  ê³³ì—ì„œ ì¬ì‚¬ìš©
- **ì„¤ì • ì¼ê´€ì„±**: `baseURL`, `timeout` ë“± ì„¤ì •ì´ í•­ìƒ ë™ì¼
- **ì„±ëŠ¥**: ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë¹„ìš© ì ˆê°

ë§ˆì¹˜ ì‚¬ë¬´ì‹¤ì—ì„œ ë³µì‚¬ê¸° 1ëŒ€ë¥¼ ì—¬ëŸ¬ ì‚¬ëŒì´ ê³µìœ í•˜ëŠ” ê²ƒê³¼ ê°™ë‹¤. ê°ì ë³µì‚¬ê¸°ë¥¼ ì‚¬ëŠ” ê²ƒë³´ë‹¤ í›¨ì”¬ íš¨ìœ¨ì ì´ë‹¤.

### DI ì»¨í…Œì´ë„ˆ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê³ ë ¤í•˜ê¸°

ìœ„ì—ì„œ ë³¸ ìˆ˜ë™ `DI Container`ëŠ” í”„ë¡œì íŠ¸ê°€ ì‘ì„ ë•ŒëŠ” ì˜ ë™ì‘í•œë‹¤. í•˜ì§€ë§Œ ì ì°¨ íŒŒì¼ë“¤ì´ ë§ì•„ì§ˆìˆ˜ë¡ ê´€ë¦¬í•´ì•¼ í•  ì˜ì¡´ì„±ì´ ìƒë‹¹íˆ ë§ì•„ì§„ë‹¤. ì½”ë“œì˜ ë³µì¡ë„ê°€ ê¹Šì–´ì§€ëŠ” ê²ƒì´ë‹¤.

ê·¸ëŸ¼ ë” í¸í•˜ê²Œ ê´€ë¦¬í•  ìˆ˜ëŠ” ì—†ì„ê¹Œ?

ë§ˆì¹˜ ê³µì¥ì—ì„œ ë¶€í’ˆ ì°½ê³ ë¥¼ ìë™í™”í•˜ëŠ” ê²ƒì²˜ëŸ¼, ì˜ì¡´ì„± ê´€ë¦¬ë¥¼ ìë™í™”í•˜ëŠ” ë„êµ¬ë¥¼ ë„ì…í•  ìˆ˜ ìˆë‹¤. ì´ë•Œ ì˜ì¡´ì„± ê´€ë¦¬ ì»¨í…Œì´ë„ˆ ë„êµ¬ë¥¼ íŒ€ ë‚´ í˜‘ì˜ë¥¼ í†µí•´ ë„ì…í•  ìˆ˜ ìˆëŠ” ë°©í–¥ë„ ìˆë‹¤.

`TypeScript`ì—ì„œ `Elixir`(í˜¹ì€ `Nest`/`Spring`) ê°™ì€ `DI ì»¨í…Œì´ë„ˆ`ë¥¼ ì“°ê³  ì‹¶ìœ¼ë©´, ë³´í†µ ì•„ë˜ ë„¤ ê°œê°€ ì œì¼ ìì£¼ ê±°ë¡ ëœë‹¤:

> **ì°¸ê³ **: ì•„ë˜ í†µê³„ëŠ” 2025ë…„ 11ì›” ê¸°ì¤€ì´ë©°, ì½ëŠ” ì‹œì ì— ë”°ë¼ ì£¼ê°„ ë‹¤ìš´ë¡œë“œ ìˆ˜ë‚˜ GitHub Starsê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆë‹¤.

- **[InversifyJS](https://www.npmjs.com/package/inversify)**: ì£¼ê°„ ë‹¤ìš´ë¡œë“œ 1,577,520íšŒ. ê°•ë ¥í•˜ê³  ê°€ë²¼ìš´ `IoC` ì»¨í…Œì´ë„ˆ. ë°ì½”ë ˆì´í„° ê¸°ë°˜, 11.9k GitHub stars
- **[TSyringe](https://www.npmjs.com/package/tsyringe)**: ì£¼ê°„ ë‹¤ìš´ë¡œë“œ 1,071,444íšŒ. Microsoft ì œì‘ ê²½ëŸ‰ `DI` ì»¨í…Œì´ë„ˆ. ë°ì½”ë ˆì´í„° ê¸°ë°˜, 5.8k GitHub stars
- **[TypeDI](https://www.npmjs.com/package/typedi)**: ì£¼ê°„ ë‹¤ìš´ë¡œë“œ 330,893íšŒ. ê°„ë‹¨í•˜ë©´ì„œë„ ê°•ë ¥í•œ `DI` ë„êµ¬. ë°ì½”ë ˆì´í„° ê¸°ë°˜, 4.2k GitHub stars
- **[Awilix](https://www.npmjs.com/package/awilix)**: ì£¼ê°„ ë‹¤ìš´ë¡œë“œ 173,441íšŒ. `Proxy` ê¸°ë°˜ `IoC` ì»¨í…Œì´ë„ˆ. ë°ì½”ë ˆì´í„° ë¶ˆí•„ìš”, 3.7k GitHub stars

íŒ¨í‚¤ì§€ì˜ í¬ê¸°, ì„±ëŠ¥, ì„œë²„ì‚¬ì´ë“œ ì§€ì› ì—¬ë¶€ ë“± ë‹¤ì–‘í•œ ì„ íƒì§€ë¥¼ ê³ ë ¤í•´ì„œ ì„ íƒí•˜ëŠ” ê²Œ ì¢‹ë‹¤. ì´ ê¸€ì—ì„œëŠ” **Awilix**ë¥¼ ì˜ˆì‹œë¡œ ì„¤ëª…í•˜ê² ë‹¤.

**Awilixì˜ ì¥ì **:

- `Proxy` ê¸°ë°˜ìœ¼ë¡œ ìë™ ì˜ì¡´ì„± í•´ê²°
- ë°ì½”ë ˆì´í„° í•„ìš” ì—†ìŒ (`InversifyJS`, `TSyringe`, `TypeDI`ëŠ” í•„ìš”)
- ê°„ë‹¨í•œ API
- ì„œë²„ì‚¬ì´ë“œ(Node.js)ì— ìµœì í™”

#### Before: ìˆ˜ë™ DI Container

```ts
// di/DIContainer.ts
class DIContainer {
  private static _httpClient: HttpClient;
  private static _tossDataSource: TossPaymentsDataSource;
  private static _stripeDataSource: StripeDataSource;
  private static _paymentRepository: PaymentRepository;

  static get httpClient() {
    return (this._httpClient ??= new AxiosHttpClient({
      baseURL: import.meta.env.VITE_API_URL,
      timeout: 10_000,
    }));
  }

  static get tossDataSource() {
    return (this._tossDataSource ??= new TossPaymentsDataSource(
      this.httpClient
    ));
  }

  static get stripeDataSource() {
    return (this._stripeDataSource ??= new StripeDataSource(this.httpClient));
  }

  static get paymentRepository() {
    return (this._paymentRepository ??= new PaymentRepositoryImpl(
      this.tossDataSource,
      this.stripeDataSource
    ));
  }

  // ëª¨ë“  ì˜ì¡´ì„±ì„ ìˆ˜ë™ìœ¼ë¡œ ì‘ì„±í•´ì•¼ í•¨...
}
```

#### After: Awilix ì‚¬ìš©

```ts
// di/container.ts
import { createContainer, asClass } from "awilix";
import { AxiosHttpClient } from "@/infrastructure/http/axiosHttpClient";
import { TossPaymentsDataSource } from "@/data/datasources/remote/tossPaymentsDataSource";
import { StripeDataSource } from "@/data/datasources/remote/stripeDataSource";
import { PaymentRepositoryImpl } from "@/data/repositories/PaymentRepositoryImpl";
import { ConfirmPaymentUseCase } from "@/domain/useCases/confirmPayment";
import { CancelPaymentUseCase } from "@/domain/useCases/cancelPayment";

const container = createContainer();

container.register({
  // Infrastructure
  httpClient: asClass(AxiosHttpClient).singleton(),

  // DataSources
  tossDataSource: asClass(TossPaymentsDataSource).singleton(),
  stripeDataSource: asClass(StripeDataSource).singleton(),

  // Repositories
  paymentRepository: asClass(PaymentRepositoryImpl).singleton(),

  // UseCases (ë§¤ë²ˆ ìƒˆë¡œ ìƒì„±)
  confirmPaymentUseCase: asClass(ConfirmPaymentUseCase).scoped(),
  cancelPaymentUseCase: asClass(CancelPaymentUseCase).scoped(),
});

export default container;
```

```ts
// ì‚¬ìš©: presentation/hooks/useConfirmPayment.ts
import container from "@/di/container";

export function useConfirmPayment() {
  return useMutation<Payment, Error, ConfirmPaymentParams>({
    mutationFn: async ({ order, paymentKey, gateway }) => {
      // Awilixê°€ ìë™ìœ¼ë¡œ ì˜ì¡´ì„± ì£¼ì…
      const confirmPaymentUseCase = container.resolve("confirmPaymentUseCase");
      return await confirmPaymentUseCase.execute(
        order,
        { orderId: order.orderId, paymentKey, amount: order.totalAmount },
        gateway
      );
    },
  });
}
```

**ì°¨ì´ì **:

- ìˆ˜ë™ DI: ëª¨ë“  ì˜ì¡´ì„±ì„ getterë¡œ ì¼ì¼ì´ ì‘ì„±í•´ì•¼ í•¨
- Awilix: `register`ë¡œ í•œ ë²ˆë§Œ ë“±ë¡í•˜ë©´ ìë™ìœ¼ë¡œ ì˜ì¡´ì„± í•´ê²°

í•˜ì§€ë§Œ `DI ì»¨í…Œì´ë„ˆ` ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìˆ˜ëŠ” ì•„ë‹ˆë‹¤. í”„ë¡œì íŠ¸ ê·œëª¨ê°€ ì‘ê±°ë‚˜ íŒ€ì´ ìµìˆ™í•˜ì§€ ì•Šë‹¤ë©´ ìˆ˜ë™ `DI Container`ë¡œë„ ì¶©ë¶„í•˜ë‹¤. **í•„ìš”ì„±ì„ ëŠë‚„ ë•Œ ë„ì…í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤.**

---

ëª¨ë“  ë ˆì´ì–´ì˜ ì¤€ë¹„ê°€ ëë‚¬ë‹¤. ì´ì œ ì‚¬ìš©ìì™€ ì§ì ‘ ë§Œë‚˜ëŠ” UI ë ˆì´ì–´ë¥¼ ì‚´í´ë³´ì.

## Presentation Layer: UIì™€ ìƒí˜¸ì‘ìš©

`Presentation` ë ˆì´ì–´ëŠ” ì‚¬ìš©ìì™€ ì§ì ‘ ìƒí˜¸ì‘ìš©í•œë‹¤. 2ê°€ì§€ë¡œ êµ¬ì„±ëœë‹¤:

1. `Hook`: `Domain`ì˜ `UseCase`ë¥¼ í˜¸ì¶œ
2. `Component`: UIë¥¼ ë Œë”ë§

### Hook: UseCase í˜¸ì¶œ

```ts
// presentation/hooks/useConfirmPayment.ts
import { useMutation } from "@tanstack/react-query";
import DIContainer from "@/di/DIContainer";
import type { Order } from "@/domain/entities/Order";
import type { Payment, PaymentGateway } from "@/domain/entities/Payment";

interface ConfirmPaymentParams {
  order: Order;
  paymentKey: string;
  gateway: PaymentGateway;
}

export function useConfirmPayment() {
  return useMutation<Payment, Error, ConfirmPaymentParams>({
    mutationFn: async ({ order, paymentKey, gateway }) => {
      // DI Containerì—ì„œ UseCaseë¥¼ ê°€ì ¸ì˜¨ë‹¤
      const confirmPaymentUseCase = DIContainer.confirmPaymentUseCase;

      return await confirmPaymentUseCase.execute(
        order,
        {
          orderId: order.orderId,
          paymentKey,
          amount: order.totalAmount,
        },
        gateway
      );
    },
  });
}
```

`useConfirmPayment` Hookì€ `DI Container`ì—ì„œ `UseCase`ë¥¼ ê°€ì ¸ì˜¨ë‹¤. ì˜ì¡´ì„±ì„ ì™¸ë¶€ì—ì„œ ì£¼ì…ë°›ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, **ì¤‘ì•™ ì§‘ì¤‘ì‹ìœ¼ë¡œ ê´€ë¦¬**í•œë‹¤.

### Component: UI ë Œë”ë§

```ts
// presentation/components/CheckoutButton.tsx
import { useConfirmPayment } from "@/presentation/hooks/useConfirmPayment";
import type { Order } from "@/domain/entities/Order";
import type { PaymentGateway } from "@/domain/entities/Payment";

interface CheckoutButtonProps {
  order: Order;
  paymentKey: string;
  gateway: PaymentGateway;
}

export function CheckoutButton({
  order,
  paymentKey,
  gateway,
}: CheckoutButtonProps) {
  const { mutate, isPending, error } = useConfirmPayment();

  const handleConfirm = () => {
    mutate(
      { order, paymentKey, gateway },
      {
        onSuccess: (payment) => {
          alert(`ê²°ì œ ìŠ¹ì¸ ì™„ë£Œ! ì£¼ë¬¸ë²ˆí˜¸: ${payment.orderId}`);
        },
      }
    );
  };

  return (
    <div>
      <button
        onClick={handleConfirm}
        disabled={isPending || !order.canProcessPayment()}
      >
        {isPending
          ? "ê²°ì œ ìŠ¹ì¸ ì¤‘..."
          : `${gateway === "toss" ? "í† ìŠ¤" : "Stripe"} ê²°ì œ ìŠ¹ì¸`}
      </button>
      {error && <p style={{ color: "red" }}>{error.message}</p>}
    </div>
  );
}
```

`CheckoutButton` ì»´í¬ë„ŒíŠ¸ëŠ” **UIë§Œ** ë‹´ë‹¹í•œë‹¤. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§(`order.canProcessPayment()`)ì€ `Entity`ê°€ ì œê³µí•˜ê³ , ê²°ì œ ìŠ¹ì¸ ë¡œì§ì€ `UseCase`ì— ìœ„ì„í•˜ë©°, `UseCase`ëŠ” `DI Container`ê°€ ì œê³µí•œë‹¤.

### ì˜ì¡´ì„± ì£¼ì…

"ì–´? `UseCase`ë¥¼ ì–´ë””ì„œ ê°€ì ¸ì™”ì§€?"

ì•ì—ì„œ ë§Œë“  **DI Container**ì—ì„œ ê°€ì ¸ì˜¨ë‹¤! Hookì—ì„œ `DIContainer.confirmPaymentUseCase`ë¥¼ í˜¸ì¶œí•˜ë©´, ëª¨ë“  ì˜ì¡´ì„±ì´ ìë™ìœ¼ë¡œ ì£¼ì…ëœ `UseCase`ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.

**ì˜ì¡´ì„± ì²´ì¸**:

```
CheckoutButton (Component)
  â†’ useConfirmPayment (Hook)
    â†’ DIContainer.confirmPaymentUseCase (DI Container)
      â†’ ConfirmPaymentUseCase (UseCase)
        â†’ PaymentRepository (Repository)
          â†’ TossDataSource / StripeDataSource (DataSource)
            â†’ HttpClient (Infrastructure)
```

ì»´í¬ë„ŒíŠ¸ëŠ” í† ìŠ¤ì¸ì§€ Stripeì¸ì§€ë§Œ ì„ íƒí•˜ê³ , ë‚˜ë¨¸ì§€ëŠ” DI Containerê°€ ì•Œì•„ì„œ ì²˜ë¦¬í•œë‹¤.

**ì™œ DI Containerê°€ ì¤‘ìš”í• ê¹Œ?**

ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ì§ì ‘ ìƒì„±í•˜ë©´ **í…ŒìŠ¤íŠ¸ê°€ ë§¤ìš° ì–´ë µë‹¤**. í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ì‹¤ì œ `HttpClient`ë¥¼ ëª¨í‚¹í•˜ê±°ë‚˜, í…ŒìŠ¤íŠ¸ìš© ì„œë²„ë¥¼ ë„ì›Œì•¼ í•œë‹¤.

```ts
// âŒ ë‚˜ìœ ì˜ˆì‹œ: ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ìƒì„±
function ConfirmButton({ order, paymentKey, gateway }: Props) {
  // ì»´í¬ë„ŒíŠ¸ ì•ˆì—ì„œ ì§ì ‘ ìƒì„±
  const httpClient = new AxiosHttpClient();
  const tossDataSource = new TossPaymentsDataSource(httpClient);
  const stripeDataSource = new StripeDataSource(httpClient);
  const paymentRepo = new PaymentRepositoryImpl(
    tossDataSource,
    stripeDataSource
  );
  const useCase = new ConfirmPaymentUseCase(paymentRepo);

  const handleConfirm = async () => {
    await useCase.execute(
      order,
      { orderId: order.orderId, paymentKey, amount: order.totalAmount },
      gateway
    );
  };
  // ...
}

// ë¬¸ì œì :
// 1. ì‹¤ì œ í† ìŠ¤/Stripe APIë¥¼ í˜¸ì¶œí•¨ (í…ŒìŠ¤íŠ¸ê°€ ëŠë¦¬ê³  ë¶ˆì•ˆì •)
// 2. Mockìœ¼ë¡œ ë°”ê¿€ ë°©ë²•ì´ ì—†ìŒ
// 3. ë„¤íŠ¸ì›Œí¬ ì—†ìœ¼ë©´ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨
```

DI Containerë¥¼ ì‚¬ìš©í•˜ë©´ **ì¤‘ì•™ ì§‘ì¤‘ì‹ìœ¼ë¡œ ì˜ì¡´ì„±ì„ ê´€ë¦¬**í•˜ê³ , **í…ŒìŠ¤íŠ¸ ì‹œ Mockìœ¼ë¡œ êµì²´**í•  ìˆ˜ ìˆë‹¤.

#### í…ŒìŠ¤íŠ¸ì—ì„œ Mock ì£¼ì…

```ts
// ConfirmButton.test.tsx
import { test, expect, vi, beforeEach, afterEach } from "vitest";
import { render, fireEvent, screen } from "@testing-library/react";
import { ConfirmButton } from "./ConfirmButton";
import DIContainer from "@/di/DIContainer";
import type { PaymentRepository } from "@/domain/repositories/PaymentRepository";
import { Payment } from "@/domain/entities/Payment";
import { Order } from "@/domain/entities/Order";

// Mock Repository ìƒì„±
const mockPaymentRepository: PaymentRepository = {
  confirmPayment: vi.fn().mockResolvedValue(
    new Payment({
      paymentId: "toss_test123",
      orderId: "order_456",
      gateway: "toss",
      gatewayPaymentId: "test123",
      amount: 15_000,
      currency: "KRW",
      status: "SUCCEEDED",
      method: "CARD",
      requestedAt: new Date("2025-01-08T10:00:00"),
      approvedAt: new Date("2025-01-08T10:01:00"),
    })
  ),
  getPayment: vi.fn(),
  cancelPayment: vi.fn(),
};

beforeEach(() => {
  // í…ŒìŠ¤íŠ¸ ì „ì— Mock Repository ì£¼ì…
  DIContainer.setMockRepositories(mockPaymentRepository);
});

afterEach(() => {
  // í…ŒìŠ¤íŠ¸ í›„ DI Container ì´ˆê¸°í™”
  DIContainer.reset();
  vi.clearAllMocks();
});

test("ê²°ì œ ìŠ¹ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ UseCase í˜¸ì¶œ", async () => {
  const order = new Order({
    orderId: "order_456",
    orderName: "í…ŒìŠ¤íŠ¸ ìƒí’ˆ",
    totalAmount: 15_000,
    status: "PENDING",
    createdAt: new Date(),
  });

  render(
    <ConfirmButton order={order} paymentKey="test_key_123" gateway="toss" />
  );

  fireEvent.click(screen.getByText("í† ìŠ¤ ê²°ì œ ìŠ¹ì¸"));

  // Mock Repositoryê°€ ì˜¬ë°”ë¥´ê²Œ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ê²€ì¦
  await vi.waitFor(() => {
    expect(mockPaymentRepository.confirmPayment).toHaveBeenCalledWith(
      { orderId: "order_456", paymentKey: "test_key_123", amount: 15_000 },
      "toss"
    );
  });
});
```

DI Container ë•ë¶„ì— **ì‹¤ì œ APIë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šê³ ë„** ì»´í¬ë„ŒíŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤. `setMockRepositories`ë¡œ Mockì„ ì£¼ì…í•˜ê³ , `reset()`ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ë©´ ëœë‹¤.

### Adapter: Entityë¥¼ UIì— ë§ê²Œ ê°€ê³µ (ì„ íƒ)

ëŒ€ë¶€ë¶„ì˜ ê²½ìš° Entityë¥¼ ê·¸ëŒ€ë¡œ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ë©´ ëœë‹¤. í•˜ì§€ë§Œ **ë³µì¡í•œ UI ë¡œì§**ì´ë‚˜ **ì—¬ëŸ¬ Entityë¥¼ ì¡°í•©**í•´ì•¼ í•  ë•ŒëŠ” `Adapter`ë¥¼ ì‚¬ìš©í•œë‹¤.

`Adapter`ëŠ” Entityë¥¼ UIì— ìµœì í™”ëœ í˜•íƒœë¡œ ë³€í™˜í•œë‹¤. ë§ˆì¹˜ ì½˜ì„¼íŠ¸ ì–´ëŒ‘í„°ì²˜ëŸ¼, Entity(220V)ë¥¼ UI(110V)ì— ë§ê²Œ ë³€í™˜í•˜ëŠ” ì—­í• ì´ë‹¤.

AdapterëŠ” Mapperì™€ ë§ˆì°¬ê°€ì§€ë¡œ classê°€ ì•„ë‹Œ **ìˆœìˆ˜ í•¨ìˆ˜**ë¡œ êµ¬í˜„í•œë‹¤.

#### ê³µí†µ ìœ í‹¸ í•¨ìˆ˜: formatters.ts

ì—¬ëŸ¬ Adapterì—ì„œ ë°˜ë³µ ì‚¬ìš©ë˜ëŠ” í¬ë§·íŒ… ë¡œì§ì€ ê³µí†µ ìœ í‹¸ í•¨ìˆ˜ë¡œ ë¶„ë¦¬í•œë‹¤.

```ts
// presentation/utils/formatters.ts
import type { PaymentStatus } from "@/domain/entities/Payment";

type SupportedCurrency = "KRW" | "USD";

// í†µí™”ë³„ í¬ë§·í„° (ì‹±ê¸€í†¤ íŒ¨í„´)
const CURRENCY_FORMATTERS: Record<SupportedCurrency, Intl.NumberFormat> = {
  KRW: new Intl.NumberFormat("ko-KR", {
    style: "currency",
    currency: "KRW",
    maximumFractionDigits: 0,
  }),
  USD: new Intl.NumberFormat("en-US", {
    style: "currency",
    currency: "USD",
    minimumFractionDigits: 2,
    maximumFractionDigits: 2,
  }),
};

// Stripe minor unit(ì„¼íŠ¸) â†’ major unit(ë‹¬ëŸ¬) ë³€í™˜ ê¸°ì¤€
const MINOR_UNIT_DIVISOR: Partial<Record<SupportedCurrency, number>> = {
  USD: 100, // StripeëŠ” ì„¼íŠ¸ ë‹¨ìœ„
  // KRWëŠ” ì´ë¯¸ ì› ë‹¨ìœ„ì´ë¯€ë¡œ 1
};

/**
 * ê¸ˆì•¡ì„ í†µí™” í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…
 * - KRW: ì› ë‹¨ìœ„ ê°’
 * - USD: ì„¼íŠ¸(Stripe minor unit) ë‹¨ìœ„ ê°’
 *
 * @example formatCurrency(10000, "KRW") // "â‚©10,000"
 * @example formatCurrency(9999, "USD") // "$99.99"
 */
export function formatCurrency(
  amount: number,
  currency: SupportedCurrency
): string {
  const divisor = MINOR_UNIT_DIVISOR[currency] ?? 1;
  const majorUnitAmount = amount / divisor;

  const formatter = CURRENCY_FORMATTERS[currency];
  if (formatter) {
    return formatter.format(majorUnitAmount);
  }

  // ì§€ì›í•˜ì§€ ì•ŠëŠ” í†µí™” ë°©ì–´ ì½”ë“œ
  return `${majorUnitAmount.toLocaleString()} ${currency}`;
}

// ê²°ì œ ìƒíƒœ ë ˆì´ë¸” (ìƒìˆ˜ ê°ì²´)
const PAYMENT_STATUS_LABEL: Record<PaymentStatus, string> = {
  PENDING: "ê²°ì œ ëŒ€ê¸°",
  PROCESSING: "ê²°ì œ ì§„í–‰ ì¤‘",
  SUCCEEDED: "ê²°ì œ ì™„ë£Œ",
  FAILED: "ê²°ì œ ì‹¤íŒ¨",
  CANCELED: "ê²°ì œ ì·¨ì†Œ",
} as const;

/**
 * ê²°ì œ ìƒíƒœë¥¼ í•œê¸€ë¡œ ë³€í™˜
 * @example formatPaymentStatus("SUCCEEDED") // "ê²°ì œ ì™„ë£Œ"
 */
export function formatPaymentStatus(status: PaymentStatus): string {
  return PAYMENT_STATUS_LABEL[status] ?? status;
}

/**
 * ë‚ ì§œë¥¼ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…
 * @example formatDate(new Date("2025-01-08")) // "2025-01-08"
 */
export function formatDate(date: Date): string {
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, "0");
  const day = String(date.getDate()).padStart(2, "0");

  return `${year}-${month}-${day}`;
}

/**
 * ë‚ ì§œì‹œê°„ì„ YYYY-MM-DD HH:mm í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…
 * @example formatDateTime(new Date("2025-01-08T15:30:00")) // "2025-01-08 15:30"
 */
export function formatDateTime(date: Date): string {
  const datePart = formatDate(date);
  const hours = String(date.getHours()).padStart(2, "0");
  const minutes = String(date.getMinutes()).padStart(2, "0");

  return `${datePart} ${hours}:${minutes}`;
}
```

#### ì–¸ì œ Adapterë¥¼ ì“¸ê¹Œ?

ë‹¤ìŒê³¼ ê°™ì€ ê²½ìš°ì—ë§Œ `Adapter`ë¥¼ ì‚¬ìš©í•œë‹¤:

1. **ì—¬ëŸ¬ Entityë¥¼ ì¡°í•©**í•´ì•¼ í•  ë•Œ (Order + Payment)
2. **ë³µì¡í•œ UI ë³€í™˜**ì´ í•„ìš”í•  ë•Œ (10000 â†’ "â‚©10,000", "SUCCEEDED" â†’ "ê²°ì œ ì™„ë£Œ")
3. **Entityë¥¼ ìˆœìˆ˜í•˜ê²Œ ìœ ì§€**í•˜ê³  ì‹¶ì„ ë•Œ (UI ë¡œì§ì„ Entityì— ë„£ì§€ ì•Šê¸°)

#### Adapterì˜ 3ê°€ì§€ í•µì‹¬ ì¥ì 

##### 1. UI ë¡œì§ ê²©ë¦¬

EntityëŠ” **ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™**ë§Œ ë‹´ë‹¹í•˜ê³ , UI í‘œí˜„ ë¡œì§ì€ `Adapter`ê°€ ë‹´ë‹¹í•œë‹¤.

```ts
// âŒ Entityì— UI ë¡œì§ì„ ë„£ìœ¼ë©´?
class Payment {
  getDisplayAmount(): string {
    return this.currency === "KRW"
      ? `â‚©${this.amount.toLocaleString()}`
      : `$${(this.amount / 100).toFixed(2)}`; // UI ë¡œì§ì´ Entityì—!
  }

  getDisplayStatus(): string {
    const statusMap = { SUCCEEDED: "ê²°ì œ ì™„ë£Œ", FAILED: "ê²°ì œ ì‹¤íŒ¨" };
    return statusMap[this.status]; // UI ë¡œì§ì´ Entityì—!
  }
}

// âœ… Adapter í•¨ìˆ˜ë¡œ ë¶„ë¦¬
export function adaptPaymentForView(payment: Payment) {
  return {
    displayAmount: formatCurrency(payment.amount, payment.currency), // UI ë¡œì§ì€ Adapterì—
    displayStatus: formatPaymentStatus(payment.status),
    displayGateway: payment.gateway === "toss" ? "í† ìŠ¤í˜ì´ë¨¼ì¸ " : "Stripe",
  };
}
```

ì´ë ‡ê²Œ ë¶„ë¦¬í•˜ë©´ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë™ì¼í•œ Adapter í•¨ìˆ˜ë¥¼ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

##### 2. Entity ìˆœìˆ˜ì„± ìœ ì§€

EntityëŠ” UIë¥¼ ì „í˜€ ëª¨ë¥¸ë‹¤. ë•ë¶„ì— **ì„œë²„ì™€ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë™ì¼í•œ Entity**ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```ts
// domain/entities/Order.ts (í”„ë¡ íŠ¸ì—”ë“œ - ë¶ˆë³€ íŒ¨í„´)
export class Order {
  private readonly _orderId: string; // ë¶ˆë³€
  private readonly _totalAmount: number; // ë¶ˆë³€
  private readonly _status: OrderStatus; // ë¶ˆë³€

  // âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ë§Œ ë‹´ë‹¹ (ê²€ì¦ ë¡œì§)
  canProcessPayment(): boolean {
    return this._status === "PENDING" && this._totalAmount > 0;
  }

  canCancelOrder(): boolean {
    return this._status === "PENDING" || this._status === "PAID";
  }

  // âŒ ìƒíƒœ ë³€ê²½ ë©”ì„œë“œëŠ” ì—†ìŒ (ì„œë²„ê°€ ìƒíƒœ ë³€ê²½)
  // confirmOrder() ê°™ì€ ë©”ì„œë“œ ì—†ìŒ
}
```

##### 3. í…ŒìŠ¤íŠ¸ ìš©ì´ì„±

AdapterëŠ” **ìˆœìˆ˜ í•¨ìˆ˜**ë¼ì„œ í…ŒìŠ¤íŠ¸ê°€ ì‰½ë‹¤. ê°™ì€ ì…ë ¥ì„ ë„£ìœ¼ë©´ í•­ìƒ ê°™ì€ ê²°ê³¼ê°€ ë‚˜ì˜¤ê³ , ì™¸ë¶€ ìƒíƒœë¥¼ ë³€ê²½í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤.

```ts
import { test, expect } from "vitest";
import { adaptPaymentForView } from "@/presentation/adapters/paymentAdapter";

test("paymentAdapterëŠ” ê²°ì œ ê¸ˆì•¡ê³¼ ìƒíƒœë¥¼ í¬ë§·íŒ…í•œë‹¤", () => {
  const payment = new Payment({
    paymentId: "toss_test123",
    orderId: "order_456",
    gateway: "toss",
    gatewayPaymentId: "test123",
    amount: 15_000,
    currency: "KRW",
    status: "SUCCEEDED",
    method: "CARD",
    requestedAt: new Date("2025-01-08T10:00:00"),
    approvedAt: new Date("2025-01-08T10:01:00"),
  });

  const view = adaptPaymentForView(payment);

  expect(view.displayAmount).toBe("â‚©15,000");
  expect(view.displayStatus).toBe("ê²°ì œ ì™„ë£Œ");
  expect(view.displayGateway).toBe("í† ìŠ¤í˜ì´ë¨¼ì¸ ");
});
```

#### ì˜ˆì‹œ 1: ë³µì¡í•œ UI ë³€í™˜ - paymentAdapter

ê²°ì œ ì •ë³´ë¥¼ UIì— ë§ê²Œ ê°€ê³µí•˜ëŠ” Adapter í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ë³´ì. Orderì™€ Paymentë¥¼ ì¡°í•©í•´ì„œ ê²°ì œ ìƒì„¸ í™”ë©´ì— í•„ìš”í•œ ì •ë³´ë¥¼ ë§Œë“ ë‹¤.

```ts
// presentation/adapters/paymentAdapter.ts
import type { Order } from "@/domain/entities/Order";
import type { Payment } from "@/domain/entities/Payment";
import {
  formatCurrency,
  formatPaymentStatus,
  formatDateTime,
} from "@/presentation/utils/formatters";

interface PaymentDetailView {
  // ê²°ì œ ì •ë³´
  paymentId: string;
  displayAmount: string; // "â‚©15,000" ë˜ëŠ” "$99.99"
  displayStatus: string; // "ê²°ì œ ì™„ë£Œ"
  displayGateway: string; // "í† ìŠ¤í˜ì´ë¨¼ì¸ " ë˜ëŠ” "Stripe"
  displayMethod: string; // "ì¹´ë“œ ê²°ì œ"

  // ì£¼ë¬¸ ì •ë³´
  orderId: string;
  orderName: string;

  // ë‚ ì§œ ì •ë³´
  requestedAt: string; // "2025-01-08 10:00"
  approvedAt: string | null; // "2025-01-08 10:01" ë˜ëŠ” null

  // ì•¡ì…˜ ê°€ëŠ¥ ì—¬ë¶€
  canCancel: boolean;
  canRefund: boolean;

  // ì˜ìˆ˜ì¦
  receiptUrl: string | null;
}

export function adaptPaymentDetailForView(
  order: Order,
  payment: Payment
): PaymentDetailView {
  return {
    paymentId: payment.paymentId,
    displayAmount: formatCurrency(payment.amount, payment.currency),
    displayStatus: formatPaymentStatus(payment.status),
    displayGateway: payment.gateway === "toss" ? "í† ìŠ¤í˜ì´ë¨¼ì¸ " : "Stripe",
    displayMethod: getMethodLabel(payment.method),

    orderId: order.orderId,
    orderName: order.orderName,

    requestedAt: formatDateTime(payment.requestedAt),
    approvedAt: payment.approvedAt ? formatDateTime(payment.approvedAt) : null,

    canCancel: payment.canCancel(),
    canRefund: payment.canRefund(),

    receiptUrl: payment.receiptUrl ?? null,
  };
}

function getMethodLabel(method?: string): string {
  if (!method) return "ë¯¸ì§€ì •";
  const methodMap: Record<string, string> = {
    CARD: "ì¹´ë“œ ê²°ì œ",
    VIRTUAL_ACCOUNT: "ê°€ìƒê³„ì¢Œ",
    EASY_PAY: "ê°„í¸ê²°ì œ",
    TRANSFER: "ê³„ì¢Œì´ì²´",
  };
  return methodMap[method] ?? method;
}
```

#### ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ê¸°

ì»´í¬ë„ŒíŠ¸ëŠ” Adapterë¡œ ë³€í™˜ëœ ë°ì´í„°ë¥¼ ì‚¬ìš©í•œë‹¤.

```ts
// presentation/components/PaymentDetailCard.tsx
export function PaymentDetailCard({ order, payment }: Props) {
  const view = adaptPaymentDetailForView(order, payment);

  return (
    <div className="payment-detail">
      <h3>{view.orderName}</h3>
      <div className="payment-info">
        <p className="amount">{view.displayAmount}</p>
        <p className="status">{view.displayStatus}</p>
        <p className="gateway">{view.displayGateway}</p>
        <p className="method">{view.displayMethod}</p>
      </div>
      <div className="dates">
        <p>ìš”ì²­: {view.requestedAt}</p>
        {view.approvedAt && <p>ìŠ¹ì¸: {view.approvedAt}</p>}
      </div>
      <div className="actions">
        {view.canCancel && <button>ê²°ì œ ì·¨ì†Œ</button>}
        {view.canRefund && <button>í™˜ë¶ˆ ìš”ì²­</button>}
        {view.receiptUrl && <a href={view.receiptUrl}>ì˜ìˆ˜ì¦ ë³´ê¸°</a>}
      </div>
    </div>
  );
}
```

#### Adapterë¥¼ ì“°ì§€ ì•ŠëŠ” ê²½ìš°

ë‹¨ìˆœí•œ ê²½ìš°ì—ëŠ” Entityë¥¼ ê·¸ëŒ€ë¡œ ì“´ë‹¤.

```ts
// presentation/components/SimpleCancelButton.tsx
import type { Payment } from "@/domain/entities/Payment";

interface Props {
  payment: Payment;
}

export function SimpleCancelButton({ payment }: Props) {
  // Adapter ì—†ì´ Entity ì§ì ‘ ì‚¬ìš© (ê°„ë‹¨í•  ë•Œ)
  return (
    <button disabled={!payment.canCancel()}>
      {payment.status === "PENDING" ? "ê²°ì œ ì·¨ì†Œ" : "ì·¨ì†Œ ë¶ˆê°€"}
    </button>
  );
}
```

---

## ì „ì²´ ê²°ì œ ìŠ¹ì¸ Flow: ëª¨ë“  ë ˆì´ì–´ í†µê³¼í•˜ê¸°

ì´ì œ ì‚¬ìš©ìê°€ "í† ìŠ¤ ê²°ì œ ìŠ¹ì¸" ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ **ëª¨ë“  ë ˆì´ì–´**ë¥¼ ì–´ë–»ê²Œ í†µê³¼í•˜ëŠ”ì§€ ì‚´í´ë³´ì.

### 1. ì‚¬ìš©ìê°€ ë²„íŠ¼ í´ë¦­

```ts
// Presentation Layer: Component
<button onClick={handleConfirm}>í† ìŠ¤ ê²°ì œ ìŠ¹ì¸</button>
```

### 2. Hookì´ UseCase í˜¸ì¶œ

```ts
// Presentation Layer: Hook
const payment = await confirmPaymentUseCase.execute(
  order,
  {
    orderId: order.orderId,
    paymentKey,
    amount: order.totalAmount,
  },
  "toss"
);
```

### 3. UseCaseê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰

```ts
// Domain Layer: UseCase
order.canProcessPayment(); // ì£¼ë¬¸ ìƒíƒœ ê²€ì¦
const payment = await this.paymentRepository.confirmPayment(params, gateway); // Repository í˜¸ì¶œ
return payment;
```

### 4. Repositoryê°€ DataSource ì„ íƒ ë° í˜¸ì¶œ

```ts
// Data Layer: Repository
// 1. ê²Œì´íŠ¸ì›¨ì´ì— ë§ëŠ” DataSourceì™€ Mapper ì„ íƒ
const { dataSource, mapper } = this.getGatewayContext(gateway);

// 2. DataSourceë¡œ DTO ê°€ì ¸ì˜¤ê¸°
const paymentDto = await dataSource.confirmPayment(
  params.orderId,
  params.paymentKey,
  params.amount
);

// 3. Mapperë¡œ Entity ë³€í™˜
return mapper(paymentDto);
```

### 5. DataSourceê°€ ë°±ì—”ë“œ API í˜¸ì¶œ

```ts
// Data Layer: DataSource (Toss)
return this.httpClient.post<TossPaymentDto>("/api/payments/toss/confirm", {
  paymentKey,
  orderId,
  amount,
});
```

**ì°¸ê³ **: ë°±ì—”ë“œëŠ” ì‹¤ì œ í† ìŠ¤ í˜ì´ë¨¼ì¸  APIë¥¼ í˜¸ì¶œí•œë‹¤:

```ts
// Backend APIê°€ í† ìŠ¤ í˜ì´ë¨¼ì¸  API í˜¸ì¶œ
const tossResponse = await axios.post(
  "https://api.tosspayments.com/v1/payments/confirm",
  { paymentKey, orderId, amount },
  {
    headers: {
      Authorization: `Basic ${Buffer.from(
        `${process.env.TOSS_SECRET_KEY}:`
      ).toString("base64")}`,
    },
  }
);
```

### 6. HTTP Clientê°€ ì‹¤ì œ ìš”ì²­

```ts
// Infrastructure Layer: HTTP Client
const response = await axios.post(url, data);
return response.data; // TossPaymentDto
```

### 7. ì‘ë‹µì´ ë‹¤ì‹œ ì—­ìˆœìœ¼ë¡œ ëŒì•„ì˜´

```
Infrastructure â†’ Data (DataSource) â†’ Data (Mapper) â†’ Data (Repository) â†’ Domain (Entity) â†’ Presentation
```

```ts
// Data Layer: Mapper í•¨ìˆ˜
const payment = mapTossPaymentDtoToDomain(tossPaymentDto);
```

### 8. Entityê°€ ì»´í¬ë„ŒíŠ¸ë¡œ ì „ë‹¬

```ts
// Presentation Layer: Component
alert(`ê²°ì œ ìŠ¹ì¸ ì™„ë£Œ! ì£¼ë¬¸ë²ˆí˜¸: ${payment.orderId}`);
```

### ì „ì²´ Flow ìš”ì•½

```
ğŸ‘¤ ì‚¬ìš©ì ë²„íŠ¼ í´ë¦­ (í† ìŠ¤ ê²°ì œ ìŠ¹ì¸)
  â†“
ğŸ¨ Presentation: Hook â†’ UseCase í˜¸ì¶œ
  â†“
ğŸ§  Domain: UseCase â†’ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (ì£¼ë¬¸ ê²€ì¦)
  â†“
ğŸ§  Domain: UseCase â†’ Repository í˜¸ì¶œ (gateway = "toss")
  â†“
ğŸ“¦ Data: Repository â†’ ê²Œì´íŠ¸ì›¨ì´ë³„ DataSource ì„ íƒ (TossDataSource)
  â†“
ğŸ“¦ Data: DataSource â†’ HTTP Client í˜¸ì¶œ (ë°±ì—”ë“œ API /api/payments/toss/confirm)
  â†“
ğŸŒ Infrastructure: HTTP Client â†’ ë°±ì—”ë“œ API ìš”ì²­
  â†“
ğŸ”§ Backend: í† ìŠ¤ í˜ì´ë¨¼ì¸  API í˜¸ì¶œ (https://api.tosspayments.com/v1/payments/confirm)
  â†“
ğŸ”§ Backend: ì‘ë‹µ ë°›ê³  ì •ê·œí™” â†’ TossPaymentDto ë°˜í™˜
  â†“
ğŸŒ Infrastructure: ì‘ë‹µ ë°›ìŒ (TossPaymentDto)
  â†“
ğŸ“¦ Data: Mapper í•¨ìˆ˜ â†’ DTOë¥¼ Payment Entityë¡œ ë³€í™˜
  â†“
ğŸ§  Domain: Payment Entity ë°˜í™˜
  â†“
ğŸ¨ Presentation: UI ì—…ë°ì´íŠ¸ (ì„±ê³µ ë©”ì‹œì§€)
```

---

## ìœ ì§€ë³´ìˆ˜ê°€ ì‰¬ìš´ ì´ìœ : ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤

í´ë¦° ì•„í‚¤í…ì²˜ì˜ ì§„ì§œ ê°•ì ì€ **ë³€ê²½ì— ê°•í•˜ë‹¤**ëŠ” ì ì´ë‹¤. ì‹¤ë¬´ì—ì„œ ìì£¼ ë°œìƒí•˜ëŠ” ìƒí™©ì„ í†µí•´ í™•ì¸í•´ë³´ì.

---

### ì‹œë‚˜ë¦¬ì˜¤ 1: ê¸°íšì - "ê²°ì œ ì™„ë£Œ í›„ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì£¼ì„¸ìš”"

**ìƒí™©**: ì‚¬ìš©ìê°€ ê²°ì œ ì™„ë£Œë¥¼ ëª…í™•íˆ ì¸ì§€í•  ìˆ˜ ìˆë„ë¡ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ ì¶”ê°€í•´ë‹¬ë¼ëŠ” ìš”ì²­ì´ ë“¤ì–´ì™”ë‹¤.

**í´ë¦° ì•„í‚¤í…ì²˜ ì—†ì„ ë•Œ**:

ëª¨ë“  ê²°ì œ ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¾ì•„ í† ìŠ¤íŠ¸ ë¡œì§ì„ ì¶”ê°€í•´ì•¼ í•œë‹¤.

```ts
// âŒ CheckoutButton.tsx, QuickPayButton.tsx, OrderDetailButton.tsx ë“± 10ê°œ íŒŒì¼ ìˆ˜ì •
const handleConfirm = async () => {
  const response = await axios.post("/api/payments/confirm", {});

  if (response.data.status === "DONE") {
    +toast.success("ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");
    router.push(`/orders/${orderId}`);
  }
};
```

**í´ë¦° ì•„í‚¤í…ì²˜ ìˆì„ ë•Œ**:

Hook 1ê°œë§Œ ìˆ˜ì •í•˜ë©´ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì— ìë™ ë°˜ì˜ëœë‹¤.

```diff
// âœ… presentation/hooks/useConfirmPayment.ts (1ê°œ íŒŒì¼ë§Œ ìˆ˜ì •)
  export function useConfirmPayment() {
    return useMutation({
      mutationFn: async ({ order, paymentKey, gateway }) => {
        return await DIContainer.confirmPaymentUseCase.execute(
          order,
          { paymentKey, orderId: order.orderId, amount: order.amount },
          gateway
        );
      },
      onSuccess: (payment) => {
+       toast.success("ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");
        queryClient.invalidateQueries({ queryKey: ["orders"] });
        router.push(`/orders/${payment.orderId}`);
      },
    });
  }
```

**ë³€ê²½ ë²”ìœ„**: 1ê°œ íŒŒì¼, 1ì¤„ â†’ ëª¨ë“  ê²°ì œ ë²„íŠ¼ì— ìë™ ì ìš©

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: ë°±ì—”ë“œ - "API ì‘ë‹µ í•„ë“œëª…ì´ ë°”ë€Œì—ˆì–´ìš”"

**ìƒí™©**: ë°±ì—”ë“œ íŒ€ì´ APIë¥¼ ë¦¬íŒ©í† ë§í•˜ë©´ì„œ ì‘ë‹µ í•„ë“œëª…ì„ ë³€ê²½í–ˆë‹¤.

```diff
// ë°±ì—”ë“œ API ì‘ë‹µ êµ¬ì¡° ë³€ê²½
{
-  "transaction_id": "txn_123",
+  "id": "txn_123",
   "amount": 10000,
   ...
}
```

**í´ë¦° ì•„í‚¤í…ì²˜ ì—†ì„ ë•Œ**:

ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì—ì„œ `response.data.transaction_id`ë¥¼ ì°¾ì•„ ìˆ˜ì •í•´ì•¼ í•œë‹¤.

```ts
// âŒ 15ê°œ íŒŒì¼ì—ì„œ response.data.transaction_idë¥¼ ì°¾ì•„ ìˆ˜ì •
const paymentId = response.data.transaction_id; // ì—¬ê¸°ë¥¼ ëª¨ë‘ ì°¾ì•„ì•¼ í•¨
```

**í´ë¦° ì•„í‚¤í…ì²˜ ìˆì„ ë•Œ**:

Mapper 1ê°œë§Œ ìˆ˜ì •í•˜ë©´ Domain Layer ì´ìƒì€ ì˜í–¥ë°›ì§€ ì•ŠëŠ”ë‹¤.

```diff
// âœ… data/mappers/paymentMapper.ts (1ê°œ íŒŒì¼ë§Œ ìˆ˜ì •)
  export function mapPaymentDtoToDomain(dto: PaymentDto): Payment {
    return new Payment({
-     paymentId: dto.transaction_id,
+     paymentId: dto.id,
      amount: dto.amount,
      // ...
    });
  }
```

**ë³€ê²½ ë²”ìœ„**: 1ê°œ íŒŒì¼, 1ì¤„ â†’ Domain, UseCase, Hook, ì»´í¬ë„ŒíŠ¸ëŠ” `Payment` Entityë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ ì˜í–¥ ì—†ìŒ

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: CFO - "í™˜ë¶ˆ ìµœì†Œ ê¸ˆì•¡ì„ 10,000ì›ìœ¼ë¡œ ì˜¬ë ¤ì£¼ì„¸ìš”"

**ìƒí™©**: ìˆ˜ìˆ˜ë£Œ ìµœì í™”ë¥¼ ìœ„í•´ í™˜ë¶ˆ ìµœì†Œ ê¸ˆì•¡ì„ ìƒí–¥ ì¡°ì •í•˜ê¸°ë¡œ ê²°ì •í–ˆë‹¤.

**í´ë¦° ì•„í‚¤í…ì²˜ ì—†ì„ ë•Œ**:

ì»´í¬ë„ŒíŠ¸ë§ˆë‹¤ í•˜ë“œì½”ë”©ëœ ê°’ì„ ì°¾ì•„ ìˆ˜ì •í•´ì•¼ í•œë‹¤.

```ts
// âŒ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì— í©ì–´ì§„ í•˜ë“œì½”ë”©
if (refundAmount < 5_000) {
  alert("ìµœì†Œ í™˜ë¶ˆ ê¸ˆì•¡ì€ 5,000ì›ì…ë‹ˆë‹¤");
}

// RefundModal.tsx, OrderDetail.tsx, PaymentHistory.tsx ë“±ì—ì„œ ë™ì¼í•œ ê²€ì¦ ë¡œì§ ë°˜ë³µ
```

**í´ë¦° ì•„í‚¤í…ì²˜ ìˆì„ ë•Œ**:

Entityì˜ ìƒìˆ˜ 1ê³³ë§Œ ìˆ˜ì •í•˜ë©´ ëª¨ë“  ê³³ì— ìë™ ë°˜ì˜ëœë‹¤.

```diff
// âœ… domain/entities/Payment.ts (1ê°œ íŒŒì¼ë§Œ ìˆ˜ì •)
  export class Payment {
-   static readonly MIN_REFUND_AMOUNT = 5_000;
+   static readonly MIN_REFUND_AMOUNT = 10_000;

    canRefund(amount: number): boolean {
      return amount >= Payment.MIN_REFUND_AMOUNT;
    }
  }
```

**ë³€ê²½ ë²”ìœ„**: 1ê°œ íŒŒì¼, 1ì¤„ â†’ ëª¨ë“  UseCase, Hook, ì»´í¬ë„ŒíŠ¸ì— ìë™ ë°˜ì˜

ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì´ `ë‹¨ì¼ ì§„ì‹¤ ê³µê¸‰ì›(Single Source of Truth)`ìœ¼ë¡œ ê´€ë¦¬ëœë‹¤.

---

### ì‹œë‚˜ë¦¬ì˜¤ 4: ì‹ ê·œ ê°œë°œì - "í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ì‹¶ì–´ìš”"

**ìƒí™©**: ì‹ ê·œ ì…ì‚¬í•œ ì£¼ë‹ˆì–´ ê°œë°œìê°€ ê²°ì œ ë¡œì§ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ë ¤ê³  í•œë‹¤.

**í´ë¦° ì•„í‚¤í…ì²˜ ì—†ì„ ë•Œ**:

ì»´í¬ë„ŒíŠ¸ ë Œë”ë§, Mock Router, Mock Toast ë“± ë³µì¡í•œ ì„¤ì •ì´ í•„ìš”í•˜ë‹¤.

```ts
// âŒ ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸ëŠ” ì„¤ì •ì´ ë³µì¡í•¨ (30ì¤„ ì´ìƒì˜ Mock ì„¤ì •)
import { render, screen, fireEvent } from "@testing-library/react";

test("ê²°ì œ ë²„íŠ¼ í´ë¦­ ì‹œ ê²°ì œ ìŠ¹ì¸ í˜¸ì¶œ", async () => {
  // Mock Router, Toast, Axios, QueryClient ë“± ë³µì¡í•œ ì„¤ì •
  const mockPush = vi.fn();
  vi.mock("next/navigation", () => ({ useRouter: () => ({ push: mockPush }) }));
  // ...
});
```

**í´ë¦° ì•„í‚¤í…ì²˜ ìˆì„ ë•Œ**:

ìˆœìˆ˜ í•¨ìˆ˜ë§Œ í…ŒìŠ¤íŠ¸í•˜ë©´ ë˜ë¯€ë¡œ ê°„ë‹¨í•˜ë‹¤.

```ts
// âœ… ìˆœìˆ˜ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ëŠ” ê°„ë‹¨í•¨
import { mapPaymentDtoToDomain } from "@/data/mappers/paymentMapper";

test("DTOë¥¼ Domain Entityë¡œ ë³€í™˜", () => {
  const dto: PaymentDto = {
    id: "txn_123",
    amount: 10_000,
    status: "DONE",
  };

  const payment = mapPaymentDtoToDomain(dto);

  expect(payment.paymentId).toBe("txn_123");
  expect(payment.isSucceeded()).toBe(true);
});
```

```ts
// âœ… UseCase í…ŒìŠ¤íŠ¸ë„ ê°„ë‹¨í•¨
test("ìµœì†Œ ê²°ì œ ê¸ˆì•¡ ë¯¸ë§Œì´ë©´ ì—ëŸ¬", async () => {
  const useCase = new ConfirmPaymentUseCase(mockRepository);

  await expect(useCase.execute(order, { amount: 500 }, "toss")).rejects.toThrow(
    "ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì€ 1,000ì›ì…ë‹ˆë‹¤"
  );
});
```

**ë³€ê²½ ë²”ìœ„**: í…ŒìŠ¤íŠ¸ë§Œ ì¶”ê°€ (ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ë¶ˆí•„ìš”)

**ê²°ê³¼**: ì‹ ê·œ ê°œë°œìê°€ **ì²« ì£¼ì— 30ê°œì˜ í…ŒìŠ¤íŠ¸**ë¥¼ ì‘ì„±í–ˆë‹¤. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ì•ˆì •ì„±ì´ ë³´ì¥ë˜ì–´ ë¦¬íŒ©í† ë§ì— ëŒ€í•œ ë‘ë ¤ì›€ì´ ì‚¬ë¼ì¡Œë‹¤.

---

### ì‹œë‚˜ë¦¬ì˜¤ 5: PO - "ì…ê¸ˆ ê¸°ëŠ¥ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”"

**ìƒí™©**: ê²°ì œë¿ë§Œ ì•„ë‹ˆë¼ ê³„ì¢Œ ì…ê¸ˆ ê¸°ëŠ¥ë„ í•„ìš”í•˜ë‹¤ëŠ” ìš”êµ¬ì‚¬í•­ì´ ë“¤ì–´ì™”ë‹¤.

**í´ë¦° ì•„í‚¤í…ì²˜ ì—†ì„ ë•Œ**:

ê²°ì œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë³µì‚¬í•´ì„œ ìˆ˜ì •í•˜ë‹¤ ë³´ë©´ ì½”ë“œ ì¤‘ë³µì´ ë°œìƒí•œë‹¤.

```ts
// âŒ CheckoutButton.tsxë¥¼ ë³µì‚¬í•´ì„œ DepositButton.tsx ìƒì„±
// 200ì¤„ì§œë¦¬ ì»´í¬ë„ŒíŠ¸ë¥¼ í†µì§¸ë¡œ ë³µì‚¬í•˜ê³  ì¼ë¶€ë§Œ ìˆ˜ì •
// â†’ ë²„ê·¸ ìˆ˜ì • ì‹œ ë‘ ê³³ ëª¨ë‘ ìˆ˜ì •í•´ì•¼ í•¨
```

**í´ë¦° ì•„í‚¤í…ì²˜ ìˆì„ ë•Œ**:

ìƒˆë¡œìš´ UseCaseë§Œ ì¶”ê°€í•˜ê³ , ê¸°ì¡´ Repositoryë¥¼ ì¬ì‚¬ìš©í•œë‹¤.

```ts
// âœ… ìƒˆë¡œìš´ UseCaseë§Œ ì¶”ê°€
// domain/useCases/DepositUseCase.ts
export class DepositUseCase {
  constructor(
    private depositRepository: IDepositRepository,
    private paymentRepository: IPaymentRepository // ê¸°ì¡´ Repository ì¬ì‚¬ìš©
  ) {}

  async execute(account: Account, amount: number): Promise<Deposit> {
    // ë¹„ì¦ˆë‹ˆìŠ¤ ê²€ì¦
    if (amount < Account.MIN_DEPOSIT_AMOUNT) {
      throw new Error(`ìµœì†Œ ì…ê¸ˆ ê¸ˆì•¡ì€ ${Account.MIN_DEPOSIT_AMOUNT}ì›ì…ë‹ˆë‹¤`);
    }

    // ì…ê¸ˆ ì²˜ë¦¬
    const deposit = await this.depositRepository.create(account, amount);

    // ê²°ì œ ì´ë ¥ ê¸°ë¡ (ê¸°ì¡´ Repository ì¬ì‚¬ìš©)
    await this.paymentRepository.createTransaction({
      type: "DEPOSIT",
      amount: deposit.amount,
    });

    return deposit;
  }
}
```

```ts
// âœ… Hook ì¶”ê°€
export function useDeposit() {
  return useMutation({
    mutationFn: async ({ account, amount }) => {
      return await DIContainer.depositUseCase.execute(account, amount);
    },
    onSuccess: () => {
      toast.success("ì…ê¸ˆì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");
    },
  });
}
```

**ë³€ê²½ ë²”ìœ„**: ìƒˆë¡œìš´ UseCase, Hook ì¶”ê°€ â†’ ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ë¶ˆí•„ìš”

ê¸°ì¡´ ê²€ì¦ ë¡œì§(`MIN_DEPOSIT_AMOUNT`), ì—ëŸ¬ ì²˜ë¦¬, í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ë“±ì˜ íŒ¨í„´ì„ ê·¸ëŒ€ë¡œ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

---

### ì‹œë‚˜ë¦¬ì˜¤ 6: ë™ì‹œì„± ì´ìŠˆ - "ê²°ì œ ìƒíƒœê°€ ë¶ˆì¼ì¹˜í•´ìš”"

**ìƒí™©**: ì„œë²„ì—ì„œ ê²°ì œ ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆëŠ”ë°, í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì´ì „ ê°ì²´ë¥¼ ìˆ˜ì •í•´ì„œ ë°œìƒí•œ ë²„ê·¸.

**í´ë¦° ì•„í‚¤í…ì²˜ ì—†ì„ ë•Œ**:

ì»´í¬ë„ŒíŠ¸ì—ì„œ ê°ì²´ë¥¼ ì§ì ‘ ìˆ˜ì •(mutation)í•˜ë©´ ì˜ˆìƒì¹˜ ëª»í•œ ë¶€ì‘ìš©ì´ ë°œìƒí•œë‹¤.

```ts
// âŒ ì»´í¬ë„ŒíŠ¸ì—ì„œ ê°ì²´ ì§ì ‘ ìˆ˜ì •
const payment = { id: "txn_123", status: "PENDING" };

// ë‚˜ì¤‘ì— ë‹¤ë¥¸ ê³³ì—ì„œ
payment.status = "DONE"; // mutation ë°œìƒ
// â†’ ì„œë²„ ìƒíƒœì™€ ë¶ˆì¼ì¹˜, ì—¬ëŸ¬ ê³³ì—ì„œ ë™ì¼ ê°ì²´ ì°¸ì¡° ì‹œ ë²„ê·¸
```

**í´ë¦° ì•„í‚¤í…ì²˜ ìˆì„ ë•Œ**:

Entityì˜ ëª¨ë“  ì†ì„±ì„ `readonly`ë¡œ ì„ ì–¸í•˜ì—¬ ë¶ˆë³€ì„±ì„ ë³´ì¥í•˜ê³ , ê²€ì¦ ë©”ì„œë“œë§Œ ì œê³µí•œë‹¤.

```ts
// âœ… EntityëŠ” readonlyë¡œ ë¶ˆë³€ì„± ë³´ì¥ + ê²€ì¦ ë©”ì„œë“œë§Œ ì œê³µ
export class Payment {
  readonly paymentId: string;
  readonly status: "PENDING" | "DONE" | "CANCELED" | "FAILED";
  readonly amount: number;

  static readonly MIN_AMOUNT = 1_000;

  constructor(props: Payment) {
    Object.assign(this, props);
  }

  // âœ… ê²€ì¦ ë©”ì„œë“œë§Œ ì œê³µ (boolean ë°˜í™˜)
  isSucceeded(): boolean {
    return this.status === "DONE";
  }

  canCancel(): boolean {
    return this.status === "PENDING" || this.status === "DONE";
  }

  isPayable(): boolean {
    return this.status === "PENDING" && this.amount >= Payment.MIN_AMOUNT;
  }
}
```

```ts
// âœ… ì‚¬ìš© ì˜ˆì‹œ
const payment = new Payment({
  id: "txn_123",
  status: "PENDING",
  amount: 10_000,
});

payment.status = "DONE"; // âŒ TypeScript ì»´íŒŒì¼ ì—ëŸ¬ (readonly)

// âœ… ê²€ì¦ ë©”ì„œë“œ ì‚¬ìš©
if (payment.canCancel()) {
  // ìƒíƒœ ë³€ê²½ì€ ì„œë²„ì—ì„œ ì²˜ë¦¬ (UseCaseë¥¼ í†µí•´)
  await cancelPaymentUseCase.execute(payment.paymentId);
}
```

**ë³€ê²½ ë²”ìœ„**: Entity ì„¤ê³„ ì›ì¹™ ì ìš© â†’ ì»´íŒŒì¼ íƒ€ì„ì— ë¶ˆë³€ì„± ë³´ì¥

**í•µì‹¬**: í”„ë¡ íŠ¸ì—”ë“œ EntityëŠ” **ê²€ì¦ ë©”ì„œë“œë§Œ** ì œê³µí•œë‹¤. ìƒíƒœ ë³€ê²½ì€ ì„œë²„ê°€ ë‹´ë‹¹í•˜ê³ , í”„ë¡ íŠ¸ì—”ë“œëŠ” `UseCase`ë¥¼ í†µí•´ ì„œë²„ì— ìš”ì²­í•œ í›„ ìƒˆë¡œìš´ ìƒíƒœë¥¼ ë°›ì•„ì˜¨ë‹¤.

---

## ë„ì… í›„ ê¸°ëŒ€ íš¨ê³¼

ìš°ë¦¬ íŒ€ì€ ê¸°ì¡´ `Feature Based Architecture`ì—ì„œ `Domain Based Clean Architecture`ë¡œ ì „í™˜í–ˆë‹¤.

íŒ€ì›ë“¤ì—ê²Œ ìœ„ì—ì„œ ì„¤ëª…í•œ ì¥ì ë“¤ì„ ì •ë¦¬í•´ì„œ ì „ë‹¬í–ˆë‹¤: "ì„œë²„ í•„ë“œëª…ì´ ë°”ë€Œì–´ë„ `Mapper` 1ì¤„ë§Œ ê³ ì¹˜ë©´ ëœë‹¤", "ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ `Entity`ì— ëª¨ì—¬ ìˆì–´ í…ŒìŠ¤íŠ¸ê°€ ì‰½ë‹¤", "ë ˆì´ì–´ê°€ ëª…í™•í•´ AIê°€ ì •í™•í•œ ìœ„ì¹˜ì— ì½”ë“œë¥¼ ìƒì„±í•œë‹¤".

íŠ¹íˆ ìš°ë¦¬ ì„œë¹„ìŠ¤ëŠ” `Next.js` ê¸°ë°˜ì´ë¼ ì„œë²„ í™˜ê²½ê³¼ í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ì„ ëª¨ë‘ ê³ ë ¤í•´ì•¼ í–ˆëŠ”ë°, ë ˆì´ì–´ê°€ ëª…í™•í• ìˆ˜ë¡ ê°œì„ ê³¼ ë¦¬íŒ©í† ë§ì´ í›¨ì”¬ ìˆ˜ì›”í–ˆë‹¤.

ì‚¬ì‹¤ ì œì¼ ê±±ì •í–ˆë˜ ë¶€ë¶„ì€ ë‚´ê°€ ì´ ì•„í‚¤í…ì²˜ ë³€ê²½ì„ ì£¼ë„í•œ ë§Œí¼, ê¸°ì¡´ ì½”ë“œë² ì´ìŠ¤ ì „ì²´ë¥¼ ì „í™˜í•´ì•¼ í•œë‹¤ëŠ” ì±…ì„ê°ì´ì—ˆë‹¤. í•˜ì§€ë§Œ AI Promptë¥¼ í™œìš©í•´ ì „í™˜í–ˆë”ë‹ˆ **ìƒê° ì´ìƒìœ¼ë¡œ ë¹ ë¥´ê²Œ ì„±ê³µ**í–ˆë‹¤.

ì²˜ìŒì—” íŒ€ì›ë“¤ë„ "ì¡°ê¸ˆ ê³¼í•œ ì„¤ê³„ ì•„ë‹Œê°€?" ì‹¶ì–´í–ˆì§€ë§Œ, ë³€ê²½ì´ ì¦ì€ ìš°ë¦¬ ì„œë¹„ìŠ¤ í™˜ê²½(ê¸ˆìœµì‚¬ ì •ì±… ë³€ê²½, API ì‘ë‹µ í˜•ì‹ ë³€ê²½)ì„ ê³ ë ¤í•˜ë©´ ì™œ ì´ êµ¬ì¡°ê°€ í•„ìš”í•œì§€ ì„¤ëª…í–ˆë”ë‹ˆ ì´í•´í•˜ê¸° ì‹œì‘í–ˆë‹¤.

### ì½”ë“œ ë¦¬ë·°ê°€ ì˜¤íˆë ¤ ë” ì‰¬ì›Œì§ˆ ê²ƒì´ë‹¤

íŒŒì¼ ê°œìˆ˜ëŠ” 2~3ë°° ëŠ˜ì–´ë‚˜ì§€ë§Œ, ë ˆì´ì–´ê°€ ëª…í™•í•˜ê¸° ë•Œë¬¸ì— **í•„ìš”í•œ ë¶€ë¶„ë§Œ ì„ íƒì ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆë‹¤**. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë³€ê²½ì´ë¼ë©´ `Domain/Entity`ë§Œ ë³´ë©´ ë˜ê³ , API ë³€ê²½ì´ë¼ë©´ `Data/DataSource`ë§Œ ë³´ë©´ ëœë‹¤.

íŠ¹íˆ **í…ŒìŠ¤íŠ¸ ì½”ë“œ ìœ„ì£¼ë¡œ ë¦¬ë·°**í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•´ì§„ë‹¤. êµ¬ì¡°ê°€ í…ŒìŠ¤íŠ¸í•˜ê¸° ì¢‹ê²Œ ì„¤ê³„ë˜ì–´ ìˆë‹¤ ë³´ë‹ˆ, íŒ€ì›ë“¤ì´ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë” ë§ì´ ì‘ì„±í•˜ê²Œ ë˜ì—ˆë‹¤. ë¦¬ë·°ì–´ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë¨¼ì € ë³´ê³  "ì´ ì¼€ì´ìŠ¤ë„ ì¶”ê°€í•˜ë©´ ì¢‹ê² ì–´ìš”", "ì´ ì—£ì§€ ì¼€ì´ìŠ¤ëŠ” ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ë‚˜ìš”?" ê°™ì€ ë³¸ì§ˆì ì¸ ì§ˆë¬¸ì„ í•  ìˆ˜ ìˆë‹¤. ì½”ë“œ í’ˆì§ˆì´ ìì—°ìŠ¤ëŸ½ê²Œ ë†’ì•„ì§ˆ ê²ƒìœ¼ë¡œ ê¸°ëŒ€í•œë‹¤.

### AIê°€ ì •í™•í•œ ìœ„ì¹˜ì— ì½”ë“œë¥¼ ìƒì„±í•œë‹¤

ì•„í‚¤í…ì²˜ êµ¬ì¡°ë¥¼ í”„ë¡¬í”„íŠ¸ì— ëª…í™•íˆ ì‘ì„±í•´ë‘ë©´, AIê°€ **ì •í™•íˆ ì–´ëŠ ë ˆì´ì–´ì— ì–´ë–¤ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í•˜ëŠ”ì§€** ì´í•´í•œë‹¤. ë‹¤ìŒì€ ì‹¤ì œë¡œ ì‚¬ìš©í•˜ëŠ” AI í”„ë¡¬í”„íŠ¸ ì˜ˆì‹œë‹¤:

```
# CLEAN ARCHITECTURE RULES

## DI Layer (Dependency Injection)
- MUST: Use singleton pattern (??= operator) for all instances
- MUST: Provide factory methods (static getters) for dependencies
- MUST NOT: Contain any business logic
- MUST NOT: Directly instantiate dependencies outside of getters

## Core Layer (Shared Utilities)
- MUST: Be pure, reusable utility functions
- MUST: Have zero dependencies on other layers
- MUST NOT: Import from Domain, Data, Infrastructure, or Presentation
- MUST NOT: Contain framework-specific code

## Infrastructure Layer (External Adapters)
- MUST: Implement port interfaces defined in Domain
- MUST: Handle all external system communication (HTTP, Storage, etc.)
- MUST NOT: Know about Domain entities or business rules
- MUST NOT: Transform data formats (use Data layer Mappers instead)

## Data Layer (Data Access & Transformation)
- MUST: Implement Repository interfaces from Domain
- MUST: Use Mapper to convert DTO â†” Entity
- MUST: Handle all DTO type definitions
- MUST NOT: Contain validation or business logic
- MUST NOT: Skip Mapper and directly pass DTO to Domain

## Domain Layer (Business Logic)
- MUST: Contain all business rules and validation in Entities
- MUST: Define Repository interfaces (ports)
- MUST: Be completely independent (no imports from other layers)
- MUST NOT: Call APIs or access external systems directly
- MUST NOT: Import from Data, Infrastructure, or Presentation layers

## Presentation Layer (UI & Hooks)
- MUST: Use hooks to consume UseCases
- MUST: Handle UI state and user interactions only
- MUST NOT: Contain business logic or validation
- MUST NOT: Call Repository or DataSource directly
- MUST NOT: Import DTOs (only work with Entities)

---

Example Task:
"Add minimum payment amount validation logic"

Expected AI Response:
- File: `src/Domain/Entity/Order.ts`
- Action: Add validation method to Entity class
- Reason: Business rule MUST be in Domain Layer

Example Task:
"Server changed response format: paymentKey â†’ payment_id"

Expected AI Response:
- File: `src/Data/Mapper/TossPaymentMapper.ts`
- Action: Update single line in Mapper
- Reason: DTO transformation MUST happen only in Mapper
```

í´ë” êµ¬ì¡°ê°€ ëª…í™•í•˜ì§€ ì•Šìœ¼ë©´ AIê°€ ì–´ë””ì— ì½”ë“œë¥¼ ë„£ì„ì§€ í—¤ë§¤ì§€ë§Œ, ì´ë ‡ê²Œ **ë ˆì´ì–´ë³„ MUST/MUST NOT ê·œì¹™**ì„ ëª…ì‹œí•˜ë©´ AIê°€ **ê°œë°œìê°€ ì˜ë„í•œ ëŒ€ë¡œ, ì •í•´ì§„ í‹€ ë‚´ì—ì„œ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê³  í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±**í•  ìˆ˜ ìˆë‹¤. ì•„í‚¤í…ì²˜ ê°€ì´ë“œë¼ì¸ì„ ë²—ì–´ë‚˜ì§€ ì•Šìœ¼ë©´ì„œë„ ë¹ ë¥´ê²Œ ê°œë°œí•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤.

### ì¥ê¸°ì ìœ¼ë¡œ ê¸°ëŒ€í•˜ëŠ” íš¨ê³¼

- **ì‹¬ë¦¬ì  ì•ˆì •ê°**: "ì´ê±° ê³ ì¹˜ë©´ ì–´ë”” í„°ì§ˆê¹Œ" ë¶ˆì•ˆê° ì†Œë©¸. ë³€ê²½ ë²”ìœ„ê°€ ëª…í™•í•˜ë¯€ë¡œ ë°°í¬ê°€ ë‘ë µì§€ ì•ŠìŒ
- **ì˜¨ë³´ë”© ì‹œê°„ ë‹¨ì¶•**: ìƒˆ íŒ€ì›ì´ êµ¬ì¡°ë§Œ ì´í•´í•˜ë©´ ë°”ë¡œ ê¸°ì—¬ ê°€ëŠ¥. "ì´ ê¸°ëŠ¥ì€ ì–´ë”” ìˆë‚˜ìš”?" ì§ˆë¬¸ì´ ì¤„ì–´ë“¤ ê²ƒ
- **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ì¦ê°€**: `UseCase`ëŠ” ëª¨í‚¹ ì—†ì´ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥. í…ŒìŠ¤íŠ¸ ì‘ì„±ì´ ì¦ê±°ì›Œì ¸ì„œ ì»¤ë²„ë¦¬ì§€ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ë†’ì•„ì§ˆ ê²ƒ
- **AI í™œìš©ë„ ì¦ê°€**: í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ëŠ˜ì–´ë‚˜ë‹ˆ ì¡°ê¸ˆ ë” í¸í•˜ê²Œ AIë¥¼ í™œìš©í•  ìˆ˜ ìˆë‹¤. "ë‚´ê°€ ëŒë¦° AI ë•Œë¬¸ì— ê¸°ì¡´ ì½”ë“œê°€ ë¬´ë„ˆì§€ì§€ ì•Šì„ê¹Œ?" í•˜ëŠ” ê±±ì • ì—†ì´ AIë¥¼ í™œìš©í•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤

### ê· í˜•ì¡íŒ í‰ê°€: ë§ŒëŠ¥ì€ ì•„ë‹ˆë‹¤

í´ë¦° ì•„í‚¤í…ì²˜ê°€ ë§ŒëŠ¥ì€ ì•„ë‹ˆë‹¤. **ì‘ì€ í”„ë¡œì íŠ¸**ë‚˜ **ì¼íšŒì„± í”„ë¡œí† íƒ€ì…**ì—ëŠ” ê³¼í•  ìˆ˜ ìˆë‹¤. ì´ˆê¸° ë¹„ìš©ì´ í¬ê¸° ë•Œë¬¸ì´ë‹¤.

í•˜ì§€ë§Œ **ìš°ë¦¬ ì„œë¹„ìŠ¤**ì²˜ëŸ¼ ì™¸ë¶€ ì •ì±… ë³€ê²½ì´ ì¦ê³ , íŒ€ì›ì´ ì—¬ëŸ¿ì´ë©°, ë‚˜ì²˜ëŸ¼ í”„ë¡ íŠ¸ì—”ë“œì™€ ì„œë²„ ê°œë°œì„ í•¨ê»˜ í•˜ê±°ë‚˜ ì¥ê¸° ìš´ì˜ì´ ì˜ˆì •ë˜ì–´ ìˆë‹¤ë©´ ì´ˆê¸° ë¹„ìš©ì„ ê°ìˆ˜í•  ê°€ì¹˜ê°€ ì¶©ë¶„í•˜ë‹¤.

---

## í”„ë¡ íŠ¸ì—”ë“œ vs ë°±ì—”ë“œ: Application ë ˆì´ì–´ì˜ í•„ìš”ì„±

ê°™ì€ í´ë¦° ì•„í‚¤í…ì²˜ì¸ë°, ì™œ í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œì˜ ë ˆì´ì–´ êµ¬ì¡°ê°€ ë‹¤ë¥¼ê¹Œ?

**í”„ë¡ íŠ¸ì—”ë“œ** (ì›¹/ëª¨ë°”ì¼): `Presentation â†’ Domain â† Data` **(3ê³„ì¸µ)**

**ë°±ì—”ë“œ**: `Presentation â†’ Application â†’ Domain â† Infrastructure` **(4ê³„ì¸µ)**

ì´ ì°¨ì´ëŠ” ê° í™˜ê²½ì´ ë‹¤ë£¨ëŠ” **ì±…ì„ì˜ ì°¨ì´**ì—ì„œ ë¹„ë¡¯ëœë‹¤.

### ë°±ì—”ë“œ: ë³µì¡í•œ ì›Œí¬í”Œë¡œìš° ì¡°ìœ¨ì´ í•„ìš”í•˜ë‹¤

ë°±ì—”ë“œëŠ” ì—¬ëŸ¬ ë„ë©”ì¸ì„ ì¡°ìœ¨í•˜ê³  íŠ¸ëœì­ì…˜ì„ ê´€ë¦¬í•´ì•¼ í•œë‹¤. ì£¼ë¬¸ ì²˜ë¦¬ë¥¼ ì˜ˆë¡œ ë“¤ì–´ë³´ì.

```ts
// ë°±ì—”ë“œ: Application ë ˆì´ì–´ì—ì„œ ì—¬ëŸ¬ ë„ë©”ì¸ì„ ì¡°ìœ¨
class ProcessOrderUseCase {
  async execute(orderId: number) {
    await db.transaction(async (trx) => {
      const order = await this.orderRepository.get(orderId);
      const payment = await this.paymentGateway.charge(order);
      await this.inventoryService.reserve(order.items);
      await this.deliveryService.schedule(order.address);
      await this.notificationService.send(order.userId);
    });
  }
}
```

ì£¼ë¬¸(`Order`), ê²°ì œ(`Payment`), ì¬ê³ (`Inventory`), ë°°ì†¡(`Delivery`) ë“± **ì—¬ëŸ¬ ë„ë©”ì¸ì„ ì¡°ìœ¨**í•˜ê³ , íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì–´ì•¼ í•œë‹¤. ì´ëŸ° ë³µì¡í•œ ì¡°ìœ¨ ë¡œì§ì„ `Domain`ì— ë„£ê¸°ì—ëŠ” ë„ˆë¬´ ë¬´ê²ë‹¤. ê·¸ë˜ì„œ ë°±ì—”ë“œëŠ” **ì¡°ìœ¨ ì „ë‹´ ë ˆì´ì–´**ì¸ `Application`ì„ ë”°ë¡œ ë‘ëŠ” ê²ƒì´ë‹¤.

### í”„ë¡ íŠ¸ì—”ë“œ: ëŒ€ë¶€ë¶„ ë‹¨ìˆœí•œ íë¦„ì´ë‹¤

ë°˜ë©´ í”„ë¡ íŠ¸ì—”ë“œëŠ” **ë‹¨ìˆœí•œ íë¦„**ì´ë‹¤:

1. ì„œë²„ API í˜¸ì¶œ
2. ì‘ë‹µ ë°ì´í„°ë¥¼ Entityë¡œ ë³€í™˜
3. Entity ê²€ì¦ í›„ í™”ë©´ì— í‘œì‹œ

**ë¹„ìœ **: ì›¨ì´í„°ëŠ” ì†ë‹˜ì˜ ì£¼ë¬¸ì„ ì£¼ë°©(ë°±ì—”ë“œ)ì— ì „ë‹¬í•˜ê³ , ì™„ì„±ëœ ìš”ë¦¬ë¥¼ ì„œë¹™í•œë‹¤. ì§ì ‘ ìš”ë¦¬ë¥¼ ë§Œë“¤ì§€ëŠ” ì•ŠëŠ”ë‹¤. ì£¼ë°©ì¥(ë°±ì—”ë“œ)ì´ ì—¬ëŸ¬ ìš”ë¦¬ì‚¬(ë„ë©”ì¸)ë¥¼ ì¡°ìœ¨í•´ì„œ ìš”ë¦¬ë¥¼ ì™„ì„±í•œë‹¤.

í”„ë¡ íŠ¸ì—”ë“œëŠ” `Domain` ë ˆì´ì–´ì˜ `Entity`ì™€ `UseCase`ë§Œìœ¼ë¡œ ì¶©ë¶„í•˜ë‹¤. Swift(iOS), Kotlin(Android), Flutter ê°™ì€ ëª¨ë°”ì¼ ì•±ë„ ë§ˆì°¬ê°€ì§€ë‹¤.

### í”„ë¡ íŠ¸ì—”ë“œëŠ” "ì–•ì€ Aggregate"ë§Œ ìœ ì§€í•œë‹¤

í”„ë¡ íŠ¸ì—”ë“œì—ì„œë„ ì£¼ë¬¸(`Order`)ê³¼ ì£¼ë¬¸ í•­ëª©ì²˜ëŸ¼ ì¤‘ì²©ëœ ë°ì´í„°ê°€ í•„ìš”í•  ë•Œê°€ ìˆë‹¤. í•˜ì§€ë§Œ ë°±ì—”ë“œì²˜ëŸ¼ ê¹Šê²Œ ì—®ì¸ Entity ê´€ê³„(Rich Domain Model)ëŠ” í•„ìš” ì—†ë‹¤. **ì–•ì€ Aggregate**ë§Œìœ¼ë¡œ ì¶©ë¶„í•˜ë‹¤.

**ì™œ ì–•ì€ êµ¬ì¡°ë¡œ ì¶©ë¶„í•œê°€?**

ë°±ì—”ë“œëŠ” ì£¼ë¬¸(`Order`) â†’ ê²°ì œ(`Payment`) â†’ ì¬ê³ (`Inventory`) â†’ ë°°ì†¡(`Shipping`)ì²˜ëŸ¼ ì—¬ëŸ¬ ë„ë©”ì¸ì´ ì„œë¡œ ì˜ì¡´í•˜ê³  ì¡°ìœ¨í•´ì•¼ í•œë‹¤. í•˜ì§€ë§Œ í”„ë¡ íŠ¸ì—”ë“œëŠ” **ì„œë²„ê°€ ì´ë¯¸ ì¡°ìœ¨í•œ ê²°ê³¼**ë¥¼ ë°›ì•„ì„œ í™”ë©´ì— ë³´ì—¬ì£¼ê¸°ë§Œ í•˜ë©´ ëœë‹¤. ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ì„œë²„/UseCaseì—ì„œ ì²˜ë¦¬í•œë‹¤.

```ts
// âœ… ì–•ì€ Aggregate: itemsëŠ” interface ì°¸ì¡°
interface OrderItem {
  id: string;
  name: string;
  quantity: number;
  price: number;
}

class Order {
  constructor(
    readonly orderId: string,
    readonly items: OrderItem[], // ì¸ë¼ì¸ íƒ€ì… ëŒ€ì‹  interface ì°¸ì¡°
    readonly totalAmount: number
  ) {}

  // âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦ (Boolean ë°˜í™˜)
  hasEnoughItems(): boolean {
    return (
      this.items.length > 0 && this.items.every((item) => item.quantity > 0)
    );
  }

  // âœ… ìµœì†Œ ìˆ˜ëŸ‰ ì¶©ì¡± ì—¬ë¶€
  hasMinimumQuantity(minQty: number): boolean {
    const total = this.items.reduce((sum, item) => sum + item.quantity, 0);
    return total >= minQty;
  }
}
```

```ts
// Mapperì—ì„œ DTO â†’ Entity ë³€í™˜ (itemsëŠ” ê·¸ëŒ€ë¡œ ì „ë‹¬)
function mapOrderDtoToDomain(dto: OrderDto): Order {
  return new Order(dto.order_id, dto.items, dto.total_amount);
}
```

**Entity ë©”ì„œë“œëŠ” Booleanë§Œ ë°˜í™˜í•œë‹¤**. ê³„ì‚°ì´ë‚˜ í¬ë§¤íŒ…ì€ Presentation Layerì—ì„œ ì²˜ë¦¬í•œë‹¤:

```js
// âœ… Presentation Layerì—ì„œ ê³„ì‚° ì²˜ë¦¬
function OrderSummary({ order }) {
  const totalQuantity = order.items.reduce(
    (sum, item) => sum + item.quantity,
    0
  );

  return (
    <div>
      <p>ì£¼ë¬¸ ë²ˆí˜¸: {order.orderId}</p>
      <p>ì´ ìˆ˜ëŸ‰: {totalQuantity}ê°œ</p>
      <p>ì´ ê¸ˆì•¡: {order.totalAmount.toLocaleString()}ì›</p>
    </div>
  );
}
```

**í•µì‹¬ì€ "ì¡°ìœ¨ì´ ì•„ë‹ˆë¼ ë³€í™˜"ì´ë‹¤**

ë°±ì—”ë“œì˜ `Application`ì€ **ì—¬ëŸ¬ ë„ë©”ì¸ì„ ì¡°ìœ¨**í•œë‹¤ (ì£¼ë¬¸ â†’ ê²°ì œ â†’ ì¬ê³  â†’ ë°°ì†¡).

í”„ë¡ íŠ¸ì—”ë“œëŠ” ì„œë²„ê°€ ì¡°ìœ¨í•œ ê²°ê³¼ë¥¼ **Entityë¡œ ë³€í™˜**ë§Œ í•˜ë©´ ëœë‹¤. ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì€ **ì„œë²„/UseCaseì—ì„œ ì²˜ë¦¬**í•œë‹¤.

### í•µì‹¬ ì°¨ì´

| êµ¬ë¶„            | ë°±ì—”ë“œ                     | í”„ë¡ íŠ¸ì—”ë“œ                            |
| --------------- | -------------------------- | ------------------------------------- |
| **ë ˆì´ì–´ ìˆ˜**   | 4ê³„ì¸µ (`Application` í¬í•¨) | 3ê³„ì¸µ (`Application` ì—†ìŒ)            |
| **íŠ¸ëœì­ì…˜**    | ì—¬ëŸ¬ DB ì‘ì—… ë¬¶ê¸° í•„ìš”     | ì—†ìŒ (ì„œë²„ì—ì„œ ì²˜ë¦¬)                  |
| **ë„ë©”ì¸ ì¡°í•©** | ì£¼ë¬¸+ê²°ì œ+ì¬ê³ +ë°°ì†¡ ì¡°ìœ¨   | ì„œë²„ê°€ ì¡°ìœ¨í•œ ê²°ê³¼ë§Œ ë°›ìŒ             |
| **Entity ê´€ê³„** | Rich Domain Model          | ì–•ì€ Aggregate (plain object ì¤‘ì²©)    |
| **ì˜ˆì™¸ ì¼€ì´ìŠ¤** | -                          | ì˜¤í”„ë¼ì¸ ì•± ë“± íŠ¹ìˆ˜í•œ ê²½ìš° 4ê³„ì¸µ ê°€ëŠ¥ |

ë°±ì—”ë“œëŠ” **ë³µì¡í•œ ì›Œí¬í”Œë¡œìš°ë¥¼ ì¡°ìœ¨**í•´ì•¼ í•˜ë¯€ë¡œ `Application` ë ˆì´ì–´ê°€ í•„ìš”í•˜ë‹¤. í”„ë¡ íŠ¸ì—”ë“œëŠ” **ì„œë²„ê°€ ì¡°ìœ¨í•œ ê²°ê³¼ë¥¼ í‘œì‹œ**í•˜ëŠ” ì—­í• ì´ë¯€ë¡œ ëŒ€ë¶€ë¶„ 3ê³„ì¸µë§Œìœ¼ë¡œ ì¶©ë¶„í•˜ë‹¤.

**ì˜ˆì™¸**: Notion, Google Docsì²˜ëŸ¼ ë¡œì»¬ DBì™€ ì„œë²„ DBë¥¼ ë™ê¸°í™”í•˜ê±°ë‚˜, WebSocket + REST API ì¡°í•©, ì—¬ëŸ¬ ì™¸ë¶€ SDKë¥¼ ì¡°ìœ¨í•´ì•¼ í•˜ëŠ” íŠ¹ìˆ˜í•œ ê²½ìš°ì—ëŠ” í”„ë¡ íŠ¸ì—”ë“œë„ 4ê³„ì¸µ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

---

## í•µì‹¬ ì •ë¦¬

í´ë¦° ì•„í‚¤í…ì²˜ë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ ì •ë¦¬í•˜ë©´: **ì—­í• ì„ ë¶„ë¦¬í•´ì„œ ë³€ê²½ì— ê°•í•œ êµ¬ì¡°ë¥¼ ë§Œë“œëŠ” ê²ƒ**ì´ë‹¤.

### 3ê°œ í•µì‹¬ ë ˆì´ì–´ (Swift/Kotlin/Flutterì™€ ë™ì¼)

**í•µì‹¬ ë ˆì´ì–´**:

- **Presentation** (UI ìƒí˜¸ì‘ìš©) - í›…ê³¼ ì»´í¬ë„ŒíŠ¸ë¡œ UI ê´€ë¦¬
- **Domain** (ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™) - ê²€ì¦ ë¡œì§, ì—”í‹°í‹°, ìœ ìŠ¤ì¼€ì´ìŠ¤ ë“± í•µì‹¬ ë¡œì§
- **Data** (ì™¸ë¶€ ë°ì´í„° ë³€í™˜) - API í˜¸ì¶œ + DTO â†” Entity ë³€í™˜

**ë³´ì¡° êµ¬ì„±ìš”ì†Œ**:

- **DI** (ì˜ì¡´ì„± ì£¼ì…) - ëª¨ë“  ë ˆì´ì–´ë¥¼ ì¡°í•©í•˜ê³  ì£¼ì…
- **Infrastructure** (ì™¸ë¶€ ì„¸ê³„ ê²©ë¦¬) - HTTP í´ë¼ì´ì–¸íŠ¸, ìŠ¤í† ë¦¬ì§€ ë“± ì™¸ë¶€ ë„êµ¬ ì¶”ìƒí™”
- **Core** (ê³µí†µ ê¸°ëŠ¥) - ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì“°ëŠ” ìˆœìˆ˜ ìœ í‹¸ë¦¬í‹°

### í•µì‹¬ ì›ì¹™ 5ê°€ì§€

1. **Domainì€ ì™„ì „íˆ ë…ë¦½** - ë‹¤ë¥¸ ë ˆì´ì–´ë¥¼ importí•˜ì§€ ì•ŠìŒ
2. **ì˜ì¡´ì„±ì€ í•­ìƒ ì•ˆìª½ìœ¼ë¡œ** - Presentation â†’ Domain â† Data
3. **EntityëŠ” ë¶ˆë³€** - ì„œë²„ê°€ ìƒíƒœì˜ ì£¼ì¸, í”„ë¡ íŠ¸ì—”ë“œëŠ” ê²€ì¦ë§Œ ë‹´ë‹¹
4. **DTOì™€ EntityëŠ” ë¶„ë¦¬** - íƒë°° ìƒì(DTO)ë¥¼ ëœ¯ì–´ì„œ ìƒí’ˆ(Entity)ì„ êº¼ë‚¸ë‹¤
5. **ë³€í™˜ì€ Mapperê°€ ìœ ì¼** - DTO â†” Entity ë³€í™˜ì€ Mapperë§Œ í†µê³¼

### Data Layerì˜ ì±…ì„ ë¶„ë¦¬

`Repository`ëŠ” ë‘ ê°€ì§€ ì±…ì„ì„ ë¶„ë¦¬í•œë‹¤:

- **DataSource**: API í˜¸ì¶œë§Œ ë‹´ë‹¹ (ì—”ë“œí¬ì¸íŠ¸ ê´€ë¦¬)
- **Mapper**: DTO â†” Entity ë³€í™˜ë§Œ ë‹´ë‹¹ (ì„œë²„ ë³€ê²½ í¡ìˆ˜)

ì´ë ‡ê²Œ ë¶„ë¦¬í•˜ë©´ ì„œë²„ ë³€ê²½ ì‹œ ì˜í–¥ ë²”ìœ„ê°€ ëª…í™•í•˜ë‹¤:

- API ì—”ë“œí¬ì¸íŠ¸ ë³€ê²½ â†’ DataSourceë§Œ ìˆ˜ì •
- ì‘ë‹µ í•„ë“œëª… ë³€ê²½ â†’ Mapperë§Œ ìˆ˜ì •

### ì•„í‚¤í…ì²˜ëŠ” ë„êµ¬ë‹¤, ì‘í’ˆì´ ì•„ë‹ˆë‹¤

í´ë¦° ì•„í‚¤í…ì²˜ë¥¼ ë„ì…í•˜ê¸° ì „ì— ëª…ì‹¬í•´ì•¼ í•  ê²ƒì´ ìˆë‹¤.

**ì™„ë²½í•œ ì•„í‚¤í…ì²˜ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.** ì˜¤ëŠ˜ì˜ ìš”êµ¬ì‚¬í•­ì— ë§ëŠ” êµ¬ì¡°ê°€ ìˆì„ ë¿ì´ë‹¤.

6ê°œì›” ë’¤ ìš”êµ¬ì‚¬í•­ì´ ë°”ë€Œë©´? êµ¬ì¡°ë„ ë°”ë€” ìˆ˜ ìˆë‹¤. ê·¸ê²Œ ìì—°ìŠ¤ëŸ¬ìš´ ê²ƒì´ë‹¤. ì•„í‚¤í…ì²˜ëŠ” **ë³€ê²½ì„ ìœ„í•´ ì¡´ì¬**í•œë‹¤. ë³€ê²½ì„ ë§‰ê¸° ìœ„í•œ ê²ƒì´ ì•„ë‹ˆë‹¤.

í´ë¦° ì•„í‚¤í…ì²˜ì˜ ì§„ì§œ ê°€ì¹˜ëŠ” "ì™„ë²½í•œ êµ¬ì¡°"ë¥¼ ë§Œë“œëŠ” ê²ƒì´ ì•„ë‹ˆë¼, **ë³€ê²½í•˜ê¸° ì‰¬ìš´ êµ¬ì¡°**ë¥¼ ë§Œë“œëŠ” ê²ƒì´ë‹¤. ë ˆì´ì–´ë¥¼ ë‚˜ëˆ„ê³  ì±…ì„ì„ ë¶„ë¦¬í•˜ëŠ” ì´ìœ ë„ ê²°êµ­ í•˜ë‚˜ë‹¤. 6ê°œì›” ë’¤ì—ë„ ë‘ë ¤ì›€ ì—†ì´ ì½”ë“œë¥¼ ê³ ì¹  ìˆ˜ ìˆë„ë¡.

ê·¸ëŸ¬ë‹ˆ ì²˜ìŒë¶€í„° ì™„ë²½í•˜ê²Œ ë§Œë“¤ë ¤ í•˜ì§€ ë§ˆë¼. ì˜¤ëŠ˜ í•„ìš”í•œ ë ˆì´ì–´ë¶€í„° ì‹œì‘í•˜ê³ , í•„ìš”í•  ë•Œ í™•ì¥í•˜ë©´ ëœë‹¤. ì½”ë“œëŠ” ë‹¹ì‹ ì„ ìœ„í•´ ì¡´ì¬í•œë‹¤. ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ê´œì°®ë‹¤.

### ì–¸ì œ ë„ì…í•˜ë©´ ì¢‹ì„ê¹Œ?

ë‹¤ìŒ ìƒí™©ì´ë¼ë©´ í´ë¦° ì•„í‚¤í…ì²˜ê°€ ë¹›ì„ ë°œí•œë‹¤:

- ê¸°íšì´ ìì£¼ ë°”ë€ŒëŠ” ì„œë¹„ìŠ¤
- 6ê°œì›” ì´ìƒ ìš´ì˜í•  í”„ë¡œì íŠ¸
- í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ í•„ìš”í•œ ê²½ìš°
- í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œë¥¼ í•¨ê»˜ ê°œë°œí•˜ëŠ” ê²½ìš°

### í”„ë¡ íŠ¸ì—”ë“œ vs ë°±ì—”ë“œ, ì™œ ë ˆì´ì–´ ìˆ˜ê°€ ë‹¤ë¥¼ê¹Œ?

Swift, Kotlin, Flutter ê°™ì€ ëª¨ë°”ì¼ ì•±ë„ **ê¸°ë³¸ì ìœ¼ë¡œ 3ê³„ì¸µ êµ¬ì¡°**ë¥¼ ì‚¬ìš©í•œë‹¤.

í”„ë¡ íŠ¸ì—”ë“œ(ì›¹/ëª¨ë°”ì¼)ëŠ” **ì„œë²„ê°€ ì¡°ìœ¨í•œ ê²°ê³¼ë¥¼ ë°›ì•„ í‘œì‹œ**í•˜ëŠ” ì—­í• ì´ë¯€ë¡œ ì¼ë°˜ì ìœ¼ë¡œ `Application` ë ˆì´ì–´ ì—†ì´ 3ê³„ì¸µë§Œìœ¼ë¡œ ì¶©ë¶„í•˜ë‹¤. ë³µì¡í•œ ì—”í‹°í‹° ê´€ê³„(ì£¼ë¬¸-ì£¼ë¬¸í•­ëª©, ì‚¬ìš©ì-ê¶Œí•œ ë“±)ë„ Domain Layerì˜ `Entity` ì°¸ì¡°ë¡œ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

ë°˜ë©´ ë°±ì—”ë“œëŠ” **ì—¬ëŸ¬ ë„ë©”ì¸ì„ ì¡°ìœ¨**(ì£¼ë¬¸+ê²°ì œ+ì¬ê³ +ë°°ì†¡)í•´ì•¼ í•˜ë¯€ë¡œ ì¼ë°˜ì ìœ¼ë¡œ `Application` ë ˆì´ì–´ê°€ í•„ìš”í•˜ë‹¤.

### ì´ ê¸€ì„ ì½ì€ ë‹¹ì‹ ì´ ë‚´ì¼ í•  ì¼

í´ë¦° ì•„í‚¤í…ì²˜ê°€ í•„ìš”í•´ ë³´ì´ëŠ”ê°€? **í•˜ì§€ë§Œ ì´ê²ƒì€ ì„ íƒì´ë‹¤.**

ì¢‹ì€ ì•„í‚¤í…ì²˜ë¥¼ ì„ íƒí•œë‹¤ê³  ìë™ìœ¼ë¡œ ì¢‹ì€ ì„œë¹„ìŠ¤ê°€ ë§Œë“¤ì–´ì§€ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. ì•„í‚¤í…ì²˜ëŠ” ë„êµ¬ì¼ ë¿ì´ë‹¤. ë‹¤ë§Œ ì˜¬ë°”ë¥¸ ì•„í‚¤í…ì²˜ëŠ” ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ì½”ë“œë¥¼ ë” ê²¬ê³ í•˜ê²Œ ë§Œë“¤ê³ , ë³€ê²½ì„ ë” ì•ˆì „í•˜ê²Œ ë§Œë“œëŠ” ë° ë„ì›€ì„ ì¤€ë‹¤.

**ê°€ì¥ ì¤‘ìš”í•œ ê²ƒì€ íŒ€ì˜ í•©ì˜ë‹¤.** í˜¼ì ê²°ì •í•˜ì§€ ë§ê³ , íŒ€ì›ë“¤ê³¼ í•¨ê»˜ ë‹¤ìŒ ì§ˆë¬¸ë“¤ì„ ë…¼ì˜í•´ë³´ì.

**1. íŒ€ê³¼ ë¨¼ì € ë…¼ì˜í•˜ì**

ì•„í‚¤í…ì²˜ëŠ” í˜¼ì ê²°ì •í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë‹¤. íŒ€ì›ë“¤ê³¼ í•¨ê»˜:

- í˜„ì¬ ì–´ë–¤ ë¬¸ì œê°€ ìˆëŠ”ì§€ ê³µìœ í•˜ê³ 
- í´ë¦° ì•„í‚¤í…ì²˜ê°€ ê·¸ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆì„ì§€ ë…¼ì˜í•˜ê³ 
- íŒ€ ì „ì²´ê°€ ë™ì˜í•  ë•Œë§Œ ì‹œì‘í•˜ì

í•©ì˜ ì—†ì´ ì‹œì‘í•˜ë©´ ì˜¤íˆë ¤ íŒ€ì— ë¶€ë‹´ì´ ë  ìˆ˜ ìˆë‹¤.

**2. í”„ë¡œì íŠ¸ ìƒí™©ì„ íŒë‹¨í•´ë³´ì**

íŒ€ì´ ë™ì˜í–ˆë‹¤ë©´, í”„ë¡œì íŠ¸ ìƒí™©ì„ í•¨ê»˜ ì‚´í´ë³´ì:

- 6ê°œì›” ì´ìƒ ìš´ì˜í•  í”„ë¡œì íŠ¸ì¸ê°€?
- ê¸°íš ë³€ê²½ì´ ë¹ˆë²ˆí•œ ì„œë¹„ìŠ¤ì¸ê°€?
- ì—¬ëŸ¬ ëª…ì´ í˜‘ì—…í•˜ëŠ” ì½”ë“œë² ì´ìŠ¤ì¸ê°€?

í•˜ë‚˜ë¼ë„ "ì˜ˆ"ë¼ë©´ ì‹œë„í•´ë³¼ ê°€ì¹˜ê°€ ìˆë‹¤. í•˜ì§€ë§Œ ëª¨ë‘ "ì•„ë‹ˆì˜¤"ë¼ë©´, ë” ë‹¨ìˆœí•œ êµ¬ì¡°ê°€ ë‚˜ì„ ìˆ˜ ìˆë‹¤.

**3. ì‘ì€ ë¶€ë¶„ë¶€í„° ì‹œë„í•´ë³´ì**

ì²˜ìŒë¶€í„° ì „ì²´ë¥¼ ë°”ê¿€ í•„ìš”ëŠ” ì—†ë‹¤. ê°€ì¥ ìì£¼ ë°”ë€ŒëŠ” ë¶€ë¶„ í•˜ë‚˜ë§Œ ê³¨ë¼ì„œ ì‹œì‘í•˜ì:

- API ë³€ê²½ì´ ì¦ë‹¤ë©´ â†’ `Data` ë ˆì´ì–´ë¶€í„°
- ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì´ ë³µì¡í•˜ë‹¤ë©´ â†’ `Domain` ë ˆì´ì–´ë¶€í„°
- UIê°€ ìì£¼ ë°”ë€ë‹¤ë©´ â†’ `Presentation` ë ˆì´ì–´ë¶€í„°

ì‘ì€ ì„±ê³µ ê²½í—˜ì´ ìŒ“ì´ë©´, ìì—°ìŠ¤ëŸ½ê²Œ í™•ì¥í•  ìˆ˜ ìˆë‹¤.

### ë§ˆì§€ë§‰ìœ¼ë¡œ

í´ë¦° ì•„í‚¤í…ì²˜ëŠ” ë§ŒëŠ¥ì´ ì•„ë‹ˆë‹¤. ì¢‹ì€ ì•„í‚¤í…ì²˜ë¥¼ ì„ íƒí•œë‹¤ê³  í•´ì„œ ìë™ìœ¼ë¡œ ì¢‹ì€ ì œí’ˆì´ ë§Œë“¤ì–´ì§€ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. ë¹„ì¦ˆë‹ˆìŠ¤ ê°€ì¹˜, ì‚¬ìš©ì ê²½í—˜, íŒ€ ë¬¸í™” ê°™ì€ ê²ƒë“¤ì´ í›¨ì”¬ ë” ì¤‘ìš”í•  ìˆ˜ ìˆë‹¤.

ê·¸ëŸ¼ì—ë„ í´ë¦° ì•„í‚¤í…ì²˜ë¥¼ ì„ íƒí•˜ëŠ” ì´ìœ ëŠ” **ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ìœ ë¦¬í•´ì§€ê¸° ë•Œë¬¸**ì´ë‹¤:

- **ë³€ê²½í•˜ê¸° ì‰¬ì›Œì§„ë‹¤**: ìš”êµ¬ì‚¬í•­ì´ ë°”ë€Œì–´ë„ ìˆ˜ì • ë²”ìœ„ê°€ ëª…í™•í•˜ë‹¤
- **í…ŒìŠ¤íŠ¸ê°€ ì‰¬ì›Œì§„ë‹¤**: ì˜ì¡´ì„±ì´ ë¶„ë¦¬ë˜ì–´ ìˆì–´ í…ŒìŠ¤íŠ¸ ì‘ì„±ì´ ê°„ë‹¨í•˜ë‹¤
- **í˜‘ì—…ì´ í¸í•´ì§„ë‹¤**: ë ˆì´ì–´ êµ¬ì¡°ë¡œ íŒ€ì›ë“¤ì´ ë™ì‹œì— ì‘ì—…í•  ìˆ˜ ìˆë‹¤
- **ë‘ë ¤ì›€ì´ ì‚¬ë¼ì§„ë‹¤**: "ì´ê±° ê³ ì¹˜ë©´ ì–´ë”” í„°ì§ˆê¹Œ" ê±±ì • ì—†ì´ ì½”ë“œë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤

ì´ˆê¸°ì—ëŠ” íŒŒì¼ì´ ë§ì•„ì§€ê³  ë³µì¡í•´ ë³´ì¼ ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ 6ê°œì›”, 1ë…„ì´ ì§€ë‚˜ë©´ ì´ êµ¬ì¡°ê°€ ì–¼ë§ˆë‚˜ ê²¬ê³ í•œì§€ ì²´ê°í•˜ê²Œ ëœë‹¤.

**ì™„ë²½í•œ ì•„í‚¤í…ì²˜ëŠ” ì—†ë‹¤.** ì˜¤ëŠ˜ë³´ë‹¤ ì¡°ê¸ˆ ë‚˜ì€ êµ¬ì¡°ë¥¼ ë§Œë“¤ê³ , íŒ€ê³¼ í•¨ê»˜ ì ì§„ì ìœ¼ë¡œ ê°œì„ í•´ë‚˜ê°€ì. ê·¸ê²ƒìœ¼ë¡œ ì¶©ë¶„í•˜ë‹¤.
