---
title: ë¦¬ì•¡íŠ¸ í´ë¦° ì•„í‚¤í…ì²˜ - 6ê°œ ë ˆì´ì–´ë¡œ ì„¤ê³„í•˜ëŠ” ìœ ì§€ë³´ìˆ˜ì„±
date: 2025-11-09
updatedDate: 2025-11-12
tags:
  [
    ë¦¬ì•¡íŠ¸,
    React,
    í´ë¦° ì•„í‚¤í…ì²˜,
    Clean Architecture,
    í”„ë¡ íŠ¸ì—”ë“œ ì•„í‚¤í…ì²˜,
    Repository íŒ¨í„´,
    Mapper,
    TanStack Query,
    Domain,
    Entity,
  ]
category: DEVELOPMENT
image: "/images/react-clean-architecture/thumbnail.webp"
---

ìš°ë¦¬ íŒ€ì´ ë§Œë“œëŠ” ì„œë¹„ìŠ¤ëŠ” ì™¸ë¶€ ì¹´ë“œì‚¬ì™€ í˜‘ì—…í•˜ì—¬ ì»¤ìŠ¤í…€ ë””ìì¸ ì¹´ë“œë¥¼ ì œì‘í•˜ê³ , ì´ë¥¼ ê´€ë¦¬í•˜ëŠ” ì‚¬ë‚´ SaaS íˆ´ì´ë‹¤.

ì²˜ìŒì—” "ë¹ ë¥´ê²Œ ì‘ë™í•˜ëŠ” ì½”ë“œ"ê°€ ëª©í‘œì˜€ë‹¤. í•„ìš”í•œ APIê°€ ì—†ìœ¼ë©´ ì—¬ëŸ¬ APIë¥¼ ì¡°í•©í–ˆê³ , ë°ì´í„° ì‹±í¬ê°€ ì•ˆ ë§ìœ¼ë©´ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì§ì ‘ ì²˜ë¦¬í–ˆë‹¤. ì»´í¬ë„ŒíŠ¸ ì•ˆì— `fetch` í˜¸ì¶œì´ ëŠ˜ì–´ë‚¬ê³ , ê²€ì¦ ë¡œì§ì´ ì—¬ê¸°ì €ê¸° ì¤‘ë³µëë‹¤.

ë¬¸ì œëŠ” **ì™¸ë¶€ ì¹´ë“œì‚¬ ì‚¬ì •ìœ¼ë¡œ APIê°€ ê°‘ìê¸° ë°”ë€” ìˆ˜ ìˆë‹¤**ëŠ” ì ì´ì—ˆë‹¤. ìì£¼ ë°”ë€Œì§€ëŠ” ì•Šì§€ë§Œ, í•œ ë²ˆ ë°”ë€Œë©´ íŒŒê¸‰ë ¥ì´ ì»¸ë‹¤. í•„ë“œëª…ì´ ë°”ë€Œë©´ `response.data.wallet_balance`ë¥¼ ì‚¬ìš©í•˜ëŠ” 10ê°œ ì»´í¬ë„ŒíŠ¸ë¥¼ ëª¨ë‘ ì°¾ì•„ ìˆ˜ì •í•´ì•¼ í–ˆë‹¤. í•˜ë‚˜ë¼ë„ ë†“ì¹˜ë©´ ëŸ°íƒ€ì„ ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤.

ë” í° ë¬¸ì œëŠ” **ê¸°íšì´ ê³„ì† ë°”ë€ë‹¤**ëŠ” ì ì´ì—ˆë‹¤. ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì´ 1,000ì›ì—ì„œ 5,000ì›ìœ¼ë¡œ ë°”ë€Œë©´, ê²€ì¦ ë¡œì§ì´ ì¤‘ë³µëœ 5ê°œ ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¾ì•„ ìˆ˜ì •í•´ì•¼ í–ˆë‹¤.

ì´ëŸ° ë°˜ë³µ ì†ì—ì„œ ìš°ë¦¬ëŠ” ê¹¨ë‹¬ì•˜ë‹¤. "ì™¸ë¶€ ì˜ì¡´ì„±ì„ ê²©ë¦¬í•˜ì§€ ì•Šìœ¼ë©´, ë³€ê²½ ë¹„ìš©ì€ ê³„ì† ëŠ˜ì–´ë‚œë‹¤." ì„œë²„ë‚˜ ì•± ê°œë°œì—ì„œëŠ” í´ë¦° ì•„í‚¤í…ì²˜ë¡œ ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•œë‹¤ëŠ” ê±¸ ì•Œì•˜ì§€ë§Œ, ë¦¬ì•¡íŠ¸ì—ì„œëŠ” ê´€ë ¨ ìë£Œê°€ ë§ì§€ ì•Šì•˜ë‹¤.

`Flutter`, `Kotlin`, `Swift` ê°™ì€ ê°ì²´ ì§€í–¥ ìƒíƒœê³„ë¥¼ ì°¸ê³ í•´ ìš°ë¦¬ íŒ€ ìƒí™©ì— ë§ëŠ” í´ë¦° ì•„í‚¤í…ì²˜ë¥¼ ë§Œë“¤ì—ˆë‹¤. ê²°ê³¼ëŠ” ì–´ë• ì„ê¹Œ?

ì™¸ë¶€ APIê°€ ë°”ë€Œì–´ë„ **`Mapper` 1ê°œ íŒŒì¼ë§Œ ìˆ˜ì •**í•˜ë©´ ë˜ëŠ” êµ¬ì¡°ê°€ ë§Œë“¤ì–´ì¡Œë‹¤. ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì´ ë°”ë€Œì–´ë„ **`Entity` ë©”ì„œë“œ 1ì¤„ë§Œ ìˆ˜ì •**í•˜ë©´ ëë‹¤. ì—¬ëŸ¬ APIë¥¼ ì¡°í•©í•˜ë˜ ë³µì¡í•œ ë¡œì§ë„ `UseCase`ë¡œ ê¹”ë”í•˜ê²Œ ì •ë¦¬ëë‹¤.

ì–´ë–»ê²Œ ì´ëŸ° ë³€í™”ê°€ ê°€ëŠ¥í–ˆì„ê¹Œ? ë¨¼ì € ê¸°ì¡´ ë°©ì‹ì˜ ë¬¸ì œì ë¶€í„° ì‚´í´ë³´ì.

---

## ê¸°ì¡´ ë°©ì‹ì˜ í•œê³„ì 

ì´ëŸ° ì‚¬ë¡€ë¡œ í•œ ë²ˆ ì´í•´í•´ë³´ì. ê²°ì œ ëŒ€í–‰ì‚¬ ì˜ˆì¹˜ê¸ˆìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ ê²°ì œë¥¼ ì²˜ë¦¬í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ìˆë‹¤.

```ts
// í´ë¦° ì•„í‚¤í…ì²˜ë¥¼ ì ìš©í•˜ì§€ ì•Šì€ ì½”ë“œ
import { useQuery } from "@tanstack/react-query";
import axios from "axios";

interface Props {
  paymentGatewayId: number;
  userId: number;
  paymentAmount: number;
}

export function ProcessPaymentButton({
  paymentGatewayId,
  userId,
  paymentAmount,
}: Props) {
  // ğŸ¤” í•œê³„ 1: HTTP í´ë¼ì´ì–¸íŠ¸ê°€ ì»´í¬ë„ŒíŠ¸ì— ì§ì ‘ ì˜ì¡´
  const { data: paymentGateway } = useQuery({
    queryKey: ["paymentGateway", paymentGatewayId],
    queryFn: async () => {
      const response = await axios.get(
        `/api/payment-gateways/${paymentGatewayId}`
      );
      return response.data;
    },
  });

  const { mutate, isPending } = useMutation({
    mutationFn: async () => {
      // ğŸ¤” í•œê³„ 2: ê²€ì¦ ë¡œì§ì´ ì—¬ëŸ¬ ê³³ì— ì¤‘ë³µ
      if (!paymentGateway) {
        throw new Error("ê²°ì œ ëŒ€í–‰ì‚¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
      }

      // ğŸ¤” í•œê³„ 3: ì„œë²„ ì‘ë‹µ í˜•ì‹ì— ì§ì ‘ ì˜ì¡´
      if (paymentGateway.wallet_balance <= 0) {
        throw new Error("ì˜ˆì¹˜ê¸ˆ ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤");
      }

      if (paymentAmount < 1_000) {
        throw new Error("ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì€ 1,000ì›ì…ë‹ˆë‹¤");
      }

      // ğŸ¤” í•œê³„ 1: HTTP í´ë¼ì´ì–¸íŠ¸ê°€ ì»´í¬ë„ŒíŠ¸ì— ì§ì ‘ ì˜ì¡´
      const response = await axios.post("/api/payments/process", {
        payment_gateway_id: paymentGatewayId,
        user_id: userId,
        payment_amount: paymentAmount,
      });

      return response.data;
    },
    onSuccess: (data) => {
      // ğŸ¤” í•œê³„ 3: ì„œë²„ ì‘ë‹µ í˜•ì‹ì— ì§ì ‘ ì˜ì¡´
      alert(`ê²°ì œ ì²˜ë¦¬ ì™„ë£Œ! ê²°ì œ ID: ${data.payment_id}`);
    },
    onError: (error) => {
      alert(error.message || "ê²°ì œ ì²˜ë¦¬ ì‹¤íŒ¨");
    },
  });

  return (
    <button onClick={() => mutate()} disabled={isPending}>
      {isPending ? "ê²°ì œ ì¤‘..." : "ê²°ì œ ì²˜ë¦¬"}
    </button>
  );
}
```

### í•œê³„ 1: HTTP í´ë¼ì´ì–¸íŠ¸ êµì²´ê°€ ì–´ë µë‹¤

í”„ë¡œì íŠ¸ ì´ˆê¸°ì—ëŠ” `axios`ë¥¼ ì‚¬ìš©í–ˆë‹¤. ê·¸ëŸ°ë° ë²ˆë“¤ í¬ê¸°ë¥¼ ì¤„ì´ê¸° ìœ„í•´ `fetch`ë¡œ ë°”ê¾¸ê¸°ë¡œ í–ˆë‹¤ê³  ê°€ì •í•´ë³´ì.

**í˜„ì¬ êµ¬ì¡° (`axios` ì§ì ‘ ì‚¬ìš©)**:

```ts
// PaymentGatewayList.tsx
const { data } = useQuery({
  queryKey: ["paymentGateway", id],
  queryFn: async () => {
    const response = await axios.get(`/api/payment-gateways/${id}`);
    return response.data;
  },
});

// PaymentForm.tsx
const mutation = useMutation({
  mutationFn: async (data) => {
    const response = await axios.post("/api/payments/process", data);
    return response.data;
  },
});

// TransactionHistory.tsx
const { data } = useQuery({
  queryKey: ["transactions"],
  queryFn: async () => {
    const response = await axios.get("/api/transactions");
    return response.data;
  },
});

// ì‹¤ì œë¡œëŠ” 10ê°œ ì´ìƒì˜ ì»´í¬ë„ŒíŠ¸ì—ì„œ axiosë¥¼ ì§ì ‘ ì‚¬ìš©
```

`axios`ë¥¼ `fetch`ë¡œ ë°”ê¾¸ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ?

**ë¬¸ì œì **:

- `axios`ë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¾ì•„ì•¼ í•¨ (10ê°œ ì´ìƒ)
- ê° ì»´í¬ë„ŒíŠ¸ë§ˆë‹¤ ì—ëŸ¬ ì²˜ë¦¬ ë°©ì‹ì´ ë‹¤ë¦„ (`axios`ëŠ” ìë™ìœ¼ë¡œ ì—ëŸ¬ ë˜ì§, `fetch`ëŠ” ìˆ˜ë™ í™•ì¸)
- í…ŒìŠ¤íŠ¸ ì½”ë“œë„ ëª¨ë‘ ìˆ˜ì • í•„ìš” (`axios` ëª¨í‚¹ â†’ `fetch` ëª¨í‚¹)

**ì‹¤ì œ ë³€ê²½ ì‹œ ì‘ì—…ëŸ‰**:

```ts
// AS-IS (axios)
const response = await axios.post("/api/payments", data);
return response.data; // ìë™ìœ¼ë¡œ JSON íŒŒì‹±ë¨

// TO-BE (fetch)
const response = await fetch("/api/payments", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(data),
});

if (!response.ok) {
  throw new Error("Network response was not ok"); // ì—ëŸ¬ ì²˜ë¦¬ ì§ì ‘ ì¶”ê°€
}

return await response.json(); // JSON íŒŒì‹± ì§ì ‘ í˜¸ì¶œ
```

ì´ëŸ° ë³€ê²½ì„ 10ê°œ ì´ìƒì˜ íŒŒì¼ì—ì„œ ë°˜ë³µí•´ì•¼ í•œë‹¤. ë†“ì¹˜ëŠ” ê³³ì´ ìƒê¸°ë©´ ëŸ°íƒ€ì„ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.

**í•µì‹¬ ë¬¸ì œ**: HTTP í´ë¼ì´ì–¸íŠ¸ê°€ ì»´í¬ë„ŒíŠ¸ì— ì§ì ‘ ê²°í•©ë˜ì–´ ìˆì–´ì„œ, êµì²´ ì‹œ ì „ì²´ ì½”ë“œë² ì´ìŠ¤ë¥¼ ìˆ˜ì •í•´ì•¼ í•œë‹¤.

### í•œê³„ 2: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ë³€ê²½ ì‹œ ì—¬ëŸ¬ íŒŒì¼ ìˆ˜ì •

ê²°ì œ ì‹œìŠ¤í…œì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ ìƒê°í•´ë³´ì. "ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì€ 1,000ì› ì´ìƒì´ì–´ì•¼ í•œë‹¤"ëŠ” ê·œì¹™ì´ ìˆë‹¤.

**í˜„ì¬ êµ¬ì¡° (ê·œì¹™ì´ ì—¬ëŸ¬ ê³³ì— í©ì–´ì§)**:

```ts
// PaymentForm.tsx
const handleSubmit = (amount: number) => {
  if (amount < 1000) {
    showError("ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì€ 1,000ì›ì…ë‹ˆë‹¤");
    return;
  }
  // ...
};

// usePaymentValidation.ts
export function validatePaymentAmount(amount: number) {
  if (amount < 1000) {
    throw new Error("ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì€ 1,000ì›ì…ë‹ˆë‹¤");
  }
}

// PaymentSummary.tsx
const isValidAmount = paymentAmount >= 1000;

// payment.test.ts
describe("ê²°ì œ ê¸ˆì•¡ ê²€ì¦", () => {
  it("1,000ì› ë¯¸ë§Œì´ë©´ ì—ëŸ¬", () => {
    expect(() => validatePayment(999)).toThrow();
  });
});
```

ì´ì œ ê¸°íšíŒ€ì—ì„œ ìš”ì²­ì´ ì™”ë‹¤: `"ìµœì†Œ ê¸ˆì•¡ì„ 5,000ì›ìœ¼ë¡œ ë³€ê²½í•´ì£¼ì„¸ìš”"`

**ë³€ê²½í•´ì•¼ í•  ê³³**:

1. `PaymentForm.tsx`: `if (amount < 1000)` â†’ `if (amount < 5000)`
2. `usePaymentValidation.ts`: `if (amount < 1000)` â†’ `if (amount < 5000)`
3. `PaymentSummary.tsx`: `paymentAmount >= 1000` â†’ `paymentAmount >= 5000`
4. `payment.test.ts`: `validatePayment(999)` â†’ `validatePayment(4999)`
5. ì—ëŸ¬ ë©”ì‹œì§€ë„ ëª¨ë‘ ìˆ˜ì •: "1,000ì›" â†’ "5,000ì›"

**ë¬¸ì œì **:

- ê·œì¹™ì´ 4ê³³ ì´ìƒì— í©ì–´ì ¸ ìˆìŒ
- í•˜ë‚˜ë¼ë„ ë†“ì¹˜ë©´ ê²€ì¦ ë¡œì§ì´ ì¼ê´€ë˜ì§€ ì•ŠìŒ
- ë‚˜ì¤‘ì— "ìµœì†Œ ê¸ˆì•¡ì„ ê²°ì œ ìˆ˜ë‹¨ë³„ë¡œ ë‹¤ë¥´ê²Œ í•´ì£¼ì„¸ìš”" ìš”ì²­ì´ ì˜¤ë©´? (ì˜ˆ: ì¹´ë“œ 10,000ì›, ê³„ì¢Œì´ì²´ 5,000ì›)
- ê° íŒŒì¼ì„ ë‹¤ì‹œ ì°¾ì•„ì„œ ì¡°ê±´ë¬¸ì„ ì¶”ê°€í•´ì•¼ í•¨

**í•µì‹¬ ë¬¸ì œ**: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì´ í•œ ê³³ì— ëª¨ì—¬ ìˆì§€ ì•Šì•„ì„œ, ê·œì¹™ ë³€ê²½ ì‹œ ì˜í–¥ ë²”ìœ„ë¥¼ ì¶”ì í•˜ê¸° ì–´ë µë‹¤.

### í•œê³„ 3: ì„œë²„ ì‘ë‹µ í˜•ì‹ ë³€ê²½ ì‹œ ì˜í–¥ ë²”ìœ„ê°€ ë„“ë‹¤

ì„œë²„ APIì˜ ì‘ë‹µ í˜•ì‹ì´ ë°”ë€” ìˆ˜ ìˆë‹¤. ë°±ì—”ë“œ íŒ€ì—ì„œ "í•„ë“œëª…ì„ camelCaseë¡œ í†µì¼í•˜ê² ìŠµë‹ˆë‹¤"ë¼ê³  ê³µì§€í–ˆë‹¤ê³  ê°€ì •í•˜ì.

**ë³€ê²½ ë‚´ìš©**:

```ts
// AS-IS (ì„œë²„ ì‘ë‹µ)
{
  "payment_gateway_id": "pg_001",
  "payment_amount": 10000,
  "user_id": "user_123"
}

// TO-BE (ì„œë²„ ì‘ë‹µ)
{
  "paymentGatewayId": "pg_001",
  "paymentAmount": 10000,
  "userId": "user_123"
}
```

**í˜„ì¬ êµ¬ì¡° (ì„œë²„ í˜•ì‹ì„ ì§ì ‘ ì‚¬ìš©)**:

```ts
// PaymentGatewayList.tsx
const { data: gateway } = useQuery({
  queryKey: ["paymentGateway", id],
  queryFn: async () => {
    const response = await axios.get(`/api/payment-gateways/${id}`);
    return response.data; // ì„œë²„ í˜•ì‹ ê·¸ëŒ€ë¡œ ì‚¬ìš©
  },
});

return <div>{gateway.payment_gateway_id}</div>; // âŒ ê¹¨ì§

// PaymentForm.tsx
const mutation = useMutation({
  mutationFn: async (data) => {
    await axios.post("/api/payments/process", {
      payment_gateway_id: data.gatewayId, // âŒ í•„ë“œëª… ë¶ˆì¼ì¹˜
      payment_amount: data.amount,
      user_id: data.userId,
    });
  },
});

// TransactionHistory.tsx
const transactions = data.map((tx) => ({
  id: tx.payment_gateway_id, // âŒ ê¹¨ì§
  amount: tx.payment_amount,
}));

// usePaymentSummary.ts
const total = payments.reduce((sum, p) => sum + p.payment_amount, 0); // âŒ ê¹¨ì§
```

**ë³€ê²½í•´ì•¼ í•  ê³³**:

1. ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì—ì„œ `payment_gateway_id` â†’ `paymentGatewayId` ì°¾ì•„ ìˆ˜ì •
2. API ìš”ì²­ ì‹œ ì„œë²„ê°€ ê¸°ëŒ€í•˜ëŠ” í˜•ì‹ìœ¼ë¡œ ë³€í™˜
3. íƒ€ì… ì •ì˜ íŒŒì¼ (`types/payment.ts`) ìˆ˜ì •
4. í…ŒìŠ¤íŠ¸ ì½”ë“œì˜ mock ë°ì´í„° ëª¨ë‘ ìˆ˜ì •

**ë¬¸ì œì **:

- ì„œë²„ ì‘ë‹µì„ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ê³³ì„ ì°¾ì•„ì•¼ í•¨
- TypeScriptë¥¼ ì“°ë”ë¼ë„ `any` íƒ€ì…ì´ë©´ ëŸ°íƒ€ì„ì— ì—ëŸ¬ ë°œìƒ
- ì„œë²„ í˜•ì‹ê³¼ í´ë¼ì´ì–¸íŠ¸ í˜•ì‹ì´ ì„ì—¬ ìˆì–´ì„œ ì¶”ì  ì–´ë ¤ì›€

**í•µì‹¬ ë¬¸ì œ**: ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ì— ë³€í™˜ ë ˆì´ì–´ê°€ ì—†ì–´ì„œ, ì„œë²„ ë³€ê²½ì´ ì „ì²´ ì½”ë“œë² ì´ìŠ¤ì— ì§ì ‘ ì˜í–¥ì„ ì¤€ë‹¤.

### í•œê³„ 4: ì±…ì„ì´ ëª…í™•íˆ ë¶„ë¦¬ë˜ì§€ ì•ŠëŠ”ë‹¤

"í›…ìœ¼ë¡œ ë¶„ë¦¬í•˜ë©´ ë˜ì§€ ì•Šë‚˜?" ë§ë‹¤. í›…ìœ¼ë¡œ ì¬ì‚¬ìš©ì€ í•´ê²°í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ **ì–´ë””ê¹Œì§€ ë¶„ë¦¬**í•´ì•¼ í• ê¹Œ?

**í›…ìœ¼ë¡œ ë¶„ë¦¬í•œ ê²½ìš°**:

```ts
// usePaymentProcess.ts
function usePaymentProcess() {
  return useMutation({
    mutationFn: async (data) => {
      // â¶ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (Domain)
      if (data.payment_amount < 1000) {
        throw new Error("ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì€ 1,000ì›ì…ë‹ˆë‹¤");
      }

      // â· API í˜¸ì¶œ (Infrastructure)
      const response = await axios.post("/api/payments", {
        // â¸ ì„œë²„ í˜•ì‹ ë³€í™˜ (Data)
        payment_gateway_id: data.paymentGatewayId,
        payment_amount: data.paymentAmount,
        user_id: data.userId,
      });

      return response.data; // â¹ ì„œë²„ ì‘ë‹µ ê·¸ëŒ€ë¡œ ë°˜í™˜
    },
  });
}
```

ì´ í›…ì€ **4ê°€ì§€ ì±…ì„**ì´ ë’¤ì„ì—¬ ìˆë‹¤:

- â¶ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ (ìµœì†Œ ê¸ˆì•¡ ê²€ì¦)
- â· í†µì‹  ë°©ì‹ (`axios`)
- â¸ ë°ì´í„° ë³€í™˜ (snake_case â†” camelCase)
- â¹ ì„œë²„ ì‘ë‹µ ì²˜ë¦¬

**ë³€ê²½ ì‹œë‚˜ë¦¬ì˜¤ë³„ ì˜í–¥**:

| ë³€ê²½ ì‚¬í•­                  | ìˆ˜ì •í•´ì•¼ í•  ê³³   | í…ŒìŠ¤íŠ¸ ì˜í–¥                          |
| -------------------------- | ---------------- | ------------------------------------ |
| `axios` â†’ `fetch`          | í›… ë‚´ë¶€ ìˆ˜ì •     | API ëª¨í‚¹ ë°©ì‹ ë³€ê²½                   |
| ìµœì†Œ ê¸ˆì•¡ ê·œì¹™ ë³€ê²½        | í›… ë‚´ë¶€ ìˆ˜ì •     | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í…ŒìŠ¤íŠ¸ë„ API ëª¨í‚¹ í•„ìš” |
| ì„œë²„ í•„ë“œëª… ë³€ê²½           | í›… ë‚´ë¶€ ìˆ˜ì •     | mock ë°ì´í„° í˜•ì‹ ë³€ê²½                |
| ê²°ì œ ìˆ˜ë‹¨ë³„ ë‹¤ë¥¸ ìµœì†Œ ê¸ˆì•¡ | í›… ì „ì²´ ë¦¬íŒ©í† ë§ | ëª¨ë“  í…ŒìŠ¤íŠ¸ ì˜í–¥                     |

**í›… ë¶„ë¦¬ì˜ í•œê³„**:

```ts
// ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ í…ŒìŠ¤íŠ¸í•˜ê³  ì‹¶ì–´ë„...
describe("ê²°ì œ ê¸ˆì•¡ ê²€ì¦", () => {
  it("1,000ì› ë¯¸ë§Œì´ë©´ ì—ëŸ¬", async () => {
    // âŒ axios ëª¨í‚¹ í•„ìš”
    // âŒ ì„œë²„ ì‘ë‹µ í˜•ì‹ ì•Œì•„ì•¼ í•¨
    // âŒ API ì—”ë“œí¬ì¸íŠ¸ ì•Œì•„ì•¼ í•¨

    mockAxios.post.mockRejectedValue(new Error("..."));

    const { result } = renderHook(() => usePaymentProcess());
    await result.current.mutate({ payment_amount: 999 });

    // ê²€ì¦ ë¡œì§ë§Œ í…ŒìŠ¤íŠ¸í•˜ê³  ì‹¶ì€ë°, ì¸í”„ë¼ ì „ì²´ë¥¼ ëª¨í‚¹í•´ì•¼ í•¨
  });
});
```

**í´ë¦° ì•„í‚¤í…ì²˜ì™€ì˜ ì°¨ì´**:

í´ë¦° ì•„í‚¤í…ì²˜ëŠ” ê° ì±…ì„ì„ **ë ˆì´ì–´ë¡œ ëª…ì‹œì  ë¶„ë¦¬**í•œë‹¤:

```ts
// Domain Layer (ìˆœìˆ˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
class PaymentAmount {
  validate() {
    if (this.value < 1000) throw new Error("ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì€ 1,000ì›ì…ë‹ˆë‹¤");
  }
}

// Use Case Layer (ì‹œë‚˜ë¦¬ì˜¤)
class ProcessPaymentUseCase {
  async execute(amount: PaymentAmount) {
    amount.validate(); // ê²€ì¦ë§Œ í˜¸ì¶œ
    return await this.repository.save(...); // ì €ì¥ì€ ìœ„ì„
  }
}

// Infrastructure Layer (axios, fetch ë“±)
class HttpPaymentRepository {
  async save(payment) {
    return await axios.post(...); // í†µì‹  ë°©ì‹ ê²©ë¦¬
  }
}
```

**ì°¨ì´ì **:

- **í›…**: ë¡œì§ ì¬ì‚¬ìš© âœ…, ì±…ì„ ë¶„ë¦¬ â–³
- **í´ë¦° ì•„í‚¤í…ì²˜**: ë¡œì§ ì¬ì‚¬ìš© âœ…, ì±…ì„ ë¶„ë¦¬ âœ…, ë³€ê²½ ì´ìœ  ëª…ì‹œ âœ…

í›…ìœ¼ë¡œë„ ì¶©ë¶„íˆ ì˜ ì„¤ê³„í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ í´ë¦° ì•„í‚¤í…ì²˜ëŠ” **ì™œ ë¶„ë¦¬í•˜ëŠ”ì§€**, **ì–´ë””ê¹Œì§€ ë¶„ë¦¬í•˜ëŠ”ì§€**ë¥¼ ëª…í™•íˆ ì œì‹œí•œë‹¤. í”„ë¡œì íŠ¸ê°€ ì»¤ì§ˆìˆ˜ë¡ ì´ ëª…í™•ì„±ì´ í° ì°¨ì´ë¥¼ ë§Œë“ ë‹¤.

---

ë¦¬ì•¡íŠ¸ í”„ë¡œì íŠ¸ì—ì„œ í´ë¦° ì•„í‚¤í…ì²˜ë¥¼ ì–´ë–»ê²Œ êµ¬í˜„í• ê¹Œ? 6ê°œ ë ˆì´ì–´ë¡œ ì—­í• ì„ ë¶„ë¦¬í•œ êµ¬ì¡°ë¥¼ ì‚´í´ë³´ì:

![ë¦¬ì•¡íŠ¸ í´ë¦° ì•„í‚¤í…ì²˜ - 6ê°œ ë ˆì´ì–´ë¡œ ì—­í• ì„ ë¶„ë¦¬í•´ì„œ ë³€ê²½ì— ê°•í•œ êµ¬ì¡° ë§Œë“¤ê¸°](/images/react-clean-architecture/thumbnail.webp)

ì´ ë‹¤ì´ì–´ê·¸ë¨ì²˜ëŸ¼ ê° ë ˆì´ì–´ëŠ” ëª…í™•í•œ ì—­í• ì„ ê°€ì§€ê³ , ì˜ì¡´ì„±ì€ í•­ìƒ ì•ˆìª½ìœ¼ë¡œ í–¥í•œë‹¤. ê° ë ˆì´ì–´ê°€ ë…ë¦½ì ìœ¼ë¡œ ì¡´ì¬í•˜ë©´ì„œë„ ì„œë¡œ í˜‘ë ¥í•˜ëŠ” êµ¬ì¡°ë‹¤.

## í´ë¦° ì•„í‚¤í…ì²˜ë€?

í´ë¦° ì•„í‚¤í…ì²˜ëŠ” ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ êµ¬ì¡°ë‹¤. í•µì‹¬ì€ **ì—­í• ì„ ë¶„ë¦¬**í•˜ëŠ” ê²ƒì´ë‹¤.

ë§ˆì¹˜ ì˜¨ë¼ì¸ ì‡¼í•‘ëª°ì„ ë– ì˜¬ë ¤ë³´ì. ì‡¼í•‘ëª°ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì—­í• ì´ ìˆë‹¤:

- **ê³ ê°**: ìƒí’ˆì„ ì£¼ë¬¸í•œë‹¤
- **ì¬ê³  ê´€ë¦¬**: ì¬ê³ ë¥¼ í™•ì¸í•˜ê³  ì—…ë°ì´íŠ¸í•œë‹¤
- **ê²°ì œ ì‹œìŠ¤í…œ**: ê²°ì œë¥¼ ì²˜ë¦¬í•œë‹¤
- **ë°°ì†¡ ì‹œìŠ¤í…œ**: ìƒí’ˆì„ ë°°ë‹¬í•œë‹¤

ê°ìì˜ ì—­í• ì´ ëª…í™•í•˜ê³ , ì„œë¡œ ë…ë¦½ì ì´ë‹¤. ê²°ì œ ì‹œìŠ¤í…œì´ ë°”ë€Œì–´ë„ ì¬ê³  ê´€ë¦¬ëŠ” ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ”ë‹¤. ë°°ì†¡ ì—…ì²´ê°€ ë°”ë€Œì–´ë„ ê³ ê° ì¸í„°í˜ì´ìŠ¤ëŠ” ê·¸ëŒ€ë¡œë‹¤.

í´ë¦° ì•„í‚¤í…ì²˜ë„ ë§ˆì°¬ê°€ì§€ë‹¤. ì½”ë“œë¥¼ **6ê°œì˜ ë ˆì´ì–´**ë¡œ ë‚˜ëˆ„ê³ , ê° ë ˆì´ì–´ëŠ” ëª…í™•í•œ ì—­í• ì„ ê°€ì§„ë‹¤.

### 6ê°œ ë ˆì´ì–´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Presentation Layer (React)                  â”‚
â”‚  Components, Pages, Hooks, State (Zustand + TanStack)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ depends on
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Application Layer (Business Flow)                â”‚
â”‚        Use Cases, DTOs, Business Orchestration          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ depends on
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Infrastructure Layer (External Services)          â”‚
â”‚  Repository Impl, Data Sources, Mappers, HTTP Client    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ depends on
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Domain Layer (Business Rules)                  â”‚
â”‚        Entities, Repository Interfaces, Value Objects   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ depends on
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Core Layer (Cross-cutting Concerns)             â”‚
â”‚       BaseEntity, BaseValueObject, Common Errors        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

               DI Layer (Dependency Injection)
          Awilix Container - ëª¨ë“  ë ˆì´ì–´ì˜ ì˜ì¡´ì„± ê´€ë¦¬
                   â† ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì‚¬ìš©
```

- `Presentation`: UIì™€ ì‚¬ìš©ì ìƒí˜¸ì‘ìš© (React ì»´í¬ë„ŒíŠ¸, ì»¤ìŠ¤í…€ í›…)
- `Application`: ë¹„ì¦ˆë‹ˆìŠ¤ í”Œë¡œìš° ê´€ë¦¬ (Use Caseë¡œ ì—¬ëŸ¬ ë„ë©”ì¸ ì¡°í•©)
- `Infrastructure`: ì™¸ë¶€ ì‹œìŠ¤í…œ í†µì‹  (Repository êµ¬í˜„, API í˜¸ì¶œ, Mapperë¡œ ë°ì´í„° ë³€í™˜)
- `Domain`: ìˆœìˆ˜ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ (Entity, Repository ì¸í„°í˜ì´ìŠ¤)
- `Core`: ê³µí†µ ë² ì´ìŠ¤ í´ë˜ìŠ¤ì™€ íƒ€ì… (BaseEntity, ì—ëŸ¬ íƒ€ì…)
- `DI`: ì˜ì¡´ì„± ì£¼ì… ì»¨í…Œì´ë„ˆ (Awilixë¡œ ìƒëª…ì£¼ê¸° ê´€ë¦¬)

í•µì‹¬ì€ `Domain`ì´ **ì™„ì „íˆ ë…ë¦½ì **ì´ë¼ëŠ” ì ì´ë‹¤. `Domain`ì€ UIê°€ ì–´ë–»ê²Œ ìƒê²¼ëŠ”ì§€, APIê°€ ì–´ë–¤ í˜•ì‹ì¸ì§€ ì „í˜€ ëª¨ë¥¸ë‹¤. ì˜¤ì§ **ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™**ë§Œ ë‹´ë‹¹í•œë‹¤.

`Application` ë ˆì´ì–´ëŠ” ì—¬ëŸ¬ ë„ë©”ì¸ì„ ì¡°í•©í•˜ì—¬ ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ í”Œë¡œìš°ë¥¼ êµ¬í˜„í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ê²°ì œ ì²˜ë¦¬ëŠ” "ê²°ì œ ëŒ€í–‰ì‚¬ ì¡°íšŒ â†’ ì”ì•¡ í™•ì¸ â†’ ê²°ì œ ì‹¤í–‰"ì´ë¼ëŠ” í”Œë¡œìš°ê°€ í•„ìš”í•œë°, ì´ëŸ° ì¡°ìœ¨ì€ `Application`ì—ì„œ ë‹´ë‹¹í•œë‹¤.

### ì˜ì¡´ì„± ë°©í–¥

```
Presentation â†’ Application â†’ Infrastructure â†’ Domain â†’ Core
                   â†‘              â†‘              â†‘
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          DI (ì˜ì¡´ì„± ì£¼ì…)
```

ì˜ì¡´ì„±ì€ **í•­ìƒ ì•ˆìª½(Core)ìœ¼ë¡œ** í–¥í•œë‹¤. ê° ë ˆì´ì–´ëŠ” ìì‹ ë³´ë‹¤ ì•ˆìª½ ë ˆì´ì–´ë§Œ ì˜ì¡´í•œë‹¤:

- `Presentation`ì€ `Application`ì—ë§Œ ì˜ì¡´ (DIë¥¼ í†µí•´)
- `Application`ì€ `Domain` ì¸í„°í˜ì´ìŠ¤ì—ë§Œ ì˜ì¡´
- `Infrastructure`ëŠ” `Domain`ì„ êµ¬í˜„í•˜ê³  ì˜ì¡´
- `Domain`ì€ `Core`ë§Œ ì˜ì¡´
- `Core`ëŠ” ì•„ë¬´ê²ƒë„ ì˜ì¡´í•˜ì§€ ì•ŠìŒ

`DI` ë ˆì´ì–´ëŠ” ëª¨ë“  ë ˆì´ì–´ë¥¼ ê°€ë¡œì§€ë¥´ë©° ì˜ì¡´ì„±ì„ ì£¼ì…í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `Presentation`ì—ì„œ Use Caseê°€ í•„ìš”í•˜ë©´ DI ì»¨í…Œì´ë„ˆì—ì„œ ê°€ì ¸ì˜¨ë‹¤. ì´ë•Œ `Presentation`ì€ `Infrastructure`ë¥¼ ì§ì ‘ importí•˜ì§€ ì•ŠëŠ”ë‹¤.

**í•µì‹¬ ì›ì¹™**:

- `Domain`ì€ **ìˆœìˆ˜í•˜ë‹¤**: `Core`ë¥¼ ì œì™¸í•œ ì–´ë–¤ ë ˆì´ì–´ë„ importí•˜ì§€ ì•ŠëŠ”ë‹¤
- **Repository InterfaceëŠ” Domainì—**: `Infrastructure`ëŠ” ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ **êµ¬í˜„**í•œë‹¤
- **ì˜ì¡´ì„± ì—­ì „**: ê³ ìˆ˜ì¤€(`Domain`)ì´ ì €ìˆ˜ì¤€(`Infrastructure`)ì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤
- **Presentationì€ Infrastructure ê¸ˆì§€**: ì ˆëŒ€ ì§ì ‘ importí•˜ì§€ ì•Šê³ , DIë¥¼ í†µí•´ì„œë§Œ ì‚¬ìš©

Uncle Bobì´ ì œì‹œí•œ í´ë¦° ì•„í‚¤í…ì²˜ì˜ ê³µì‹ ë‹¤ì´ì–´ê·¸ë¨ì„ ì‚´í´ë³´ì:

![Uncle Bobì˜ í´ë¦° ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ - ë™ì‹¬ì› êµ¬ì¡°ë¡œ ë ˆì´ì–´ê°€ ë‚˜ë‰˜ì–´ì ¸ ìˆê³ , ì˜ì¡´ì„±ì€ í•­ìƒ ì•ˆìª½ìœ¼ë¡œ í–¥í•œë‹¤](/images/react-clean-architecture/clean-architecture.webp)

ìœ„ ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ í•µì‹¬ì€ **ì˜ì¡´ì„± ë°©í–¥**ì´ë‹¤. í™”ì‚´í‘œê°€ ëª¨ë‘ ì•ˆìª½(ì¤‘ì‹¬ì˜ Entities/Use Cases)ì„ ê°€ë¦¬í‚¨ë‹¤. ë°”ê¹¥ìª½ ë ˆì´ì–´(UI, DB, ì™¸ë¶€ ì„œë¹„ìŠ¤)ëŠ” ì•ˆìª½ì„ ì˜ì¡´í•˜ì§€ë§Œ, ì•ˆìª½ì€ ë°”ê¹¥ì„ ì „í˜€ ëª¨ë¥¸ë‹¤. ì´ê²ƒì´ ë°”ë¡œ `ì˜ì¡´ì„± ì—­ì „ ì›ì¹™(Dependency Inversion Principle)`ì´ë‹¤.

ìš°ë¦¬ í”„ë¡œì íŠ¸ëŠ” ì´ êµ¬ì¡°ë¥¼ React ìƒíƒœê³„ì— ë§ê²Œ 6ê°œ ë ˆì´ì–´ë¡œ ì¬êµ¬ì„±í–ˆë‹¤. í•˜ì§€ë§Œ í•µì‹¬ ì² í•™ì€ ë™ì¼í•˜ë‹¤: `Domain`ì€ ìˆœìˆ˜í•˜ê³ , ì˜ì¡´ì„±ì€ í•­ìƒ ì•ˆìª½ìœ¼ë¡œ íë¥¸ë‹¤.

> ğŸ’¡ ë” ìì„¸í•œ ë‚´ìš©ì€ Uncle Bobì˜ [Clean Architecture ë¸”ë¡œê·¸](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)ë¥¼ ì°¸ê³ í•˜ì.

ì´ê²Œ ì™œ ì¤‘ìš”í• ê¹Œ? `Domain`ì— ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë„£ìœ¼ë©´, UIê°€ ë°”ë€Œë“  APIê°€ ë°”ë€Œë“  `Domain`ì€ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ”ë‹¤. ë§ˆì¹˜ ì˜¨ë¼ì¸ ì‡¼í•‘ëª°ì—ì„œ ë°°ì†¡ ì—…ì²´ë¥¼ ë³€ê²½í•´ë„ ì¬ê³  ê´€ë¦¬ë‚˜ ê²°ì œ ì²˜ë¦¬ ë¡œì§ì€ ê·¸ëŒ€ë¡œì¸ ê²ƒì²˜ëŸ¼.

ê°œë…ì„ ì´í•´í–ˆìœ¼ë‹ˆ, ì´ì œ ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œ ì–´ë–»ê²Œ êµ¬í˜„í•˜ëŠ”ì§€ ë³´ì.

---

## í´ë” êµ¬ì¡°

ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œ í´ë¦° ì•„í‚¤í…ì²˜ë¥¼ ì–´ë–»ê²Œ í´ë”ë¡œ í‘œí˜„í• ê¹Œ? ê° ë ˆì´ì–´ì˜ ì—­í• ì´ ëª…í™•íˆ ë“œëŸ¬ë‚˜ëŠ” êµ¬ì¡°ë¥¼ ì‚´í´ë³´ì.

### ì†Œê·œëª¨ í”„ë¡œì íŠ¸ êµ¬ì¡° (ê¶Œì¥)

í”„ë¡œì íŠ¸ ì´ˆê¸° ë‹¨ê³„ë‚˜ ê¸°ëŠ¥ì´ ë‹¨ìˆœí•˜ë‹¤ë©´ ë ˆì´ì–´ë³„ë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œ ì¶©ë¶„í•˜ë‹¤.

```
src/
â”œâ”€â”€ core/                                 # ê³µí†µ ê¸°ëŠ¥ (ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì°¸ì¡° ê°€ëŠ¥)
â”‚   â”œâ”€â”€ constants/
â”‚   â”‚   â””â”€â”€ app-constants.ts              # ì „ì—­ ìƒìˆ˜ (í†µí™”, ë‚ ì§œ í˜•ì‹ ë“±)
â”‚   â”œâ”€â”€ errors/
â”‚   â”‚   â””â”€â”€ AppError.ts                   # ì „ì—­ ì—ëŸ¬ (ëª¨ë“  ë„ë©”ì¸ ê³µí†µ)
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â””â”€â”€ BaseEntity.ts                 # ëª¨ë“  Entityê°€ ìƒì†í•˜ëŠ” ë² ì´ìŠ¤ í´ë˜ìŠ¤
â”‚   â”œâ”€â”€ value-objects/
â”‚   â”‚   â””â”€â”€ BaseValueObject.ts            # ëª¨ë“  Value Object ë² ì´ìŠ¤ í´ë˜ìŠ¤
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ date-utils.ts                 # ë‚ ì§œ ìœ í‹¸
â”‚       â””â”€â”€ currency-utils.ts             # í†µí™” ìœ í‹¸
â”‚
â”œâ”€â”€ domain/                               # ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ (ì™¸ë¶€ ì˜ì¡´ì„± ì—†ìŒ)
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”œâ”€â”€ PaymentGateway.ts             # ê²°ì œ ìˆ˜ë‹¨ Entity (ìˆœìˆ˜ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™)
â”‚   â”‚   â””â”€â”€ User.ts                       # ì‚¬ìš©ì Entity
â”‚   â”œâ”€â”€ value-objects/
â”‚   â”‚   â””â”€â”€ Money.ts                      # ê¸ˆì•¡ Value Object (ê²€ì¦ ë¡œì§ í¬í•¨)
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”œâ”€â”€ IPaymentGatewayRepository.ts  # Repository ì¸í„°í˜ì´ìŠ¤ (Infrastructureê°€ êµ¬í˜„)
â”‚   â”‚   â””â”€â”€ IUserRepository.ts            # Repository ì¸í„°í˜ì´ìŠ¤
â”‚   â””â”€â”€ errors/
â”‚       â””â”€â”€ PaymentError.ts               # ê²°ì œ ë„ë©”ì¸ ì—ëŸ¬
â”‚
â”œâ”€â”€ application/                          # ë¹„ì¦ˆë‹ˆìŠ¤ í”Œë¡œìš° (Use Case)
â”‚   â”œâ”€â”€ use-cases/
â”‚   â”‚   â”œâ”€â”€ ProcessPaymentUseCase.ts      # ê²°ì œ ì²˜ë¦¬ Use Case
â”‚   â”‚   â””â”€â”€ ProcessRefundUseCase.ts       # í™˜ë¶ˆ ì²˜ë¦¬ Use Case
â”‚   â””â”€â”€ dto/
â”‚       â”œâ”€â”€ ProcessPaymentDto.ts          # Use Case ì…ë ¥/ì¶œë ¥ DTO
â”‚       â””â”€â”€ ProcessRefundDto.ts           # Use Case ì…ë ¥/ì¶œë ¥ DTO
â”‚
â”œâ”€â”€ infrastructure/                       # ì™¸ë¶€ ì‹œìŠ¤í…œ í†µì‹ 
â”‚   â”œâ”€â”€ http/
â”‚   â”‚   â”œâ”€â”€ fetch-http-client.ts          # Fetch API ê¸°ë°˜ HTTP í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â””â”€â”€ axios-http-client.ts          # Axios ê¸°ë°˜ HTTP í´ë¼ì´ì–¸íŠ¸
â”‚   â”œâ”€â”€ storage/
â”‚   â”‚   â”œâ”€â”€ local-storage.ts              # localStorage ì¶”ìƒí™”
â”‚   â”‚   â””â”€â”€ session-storage.ts            # sessionStorage ì¶”ìƒí™”
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ PaymentGatewayRepository.ts   # Repository êµ¬í˜„ì²´
â”‚   â”œâ”€â”€ datasources/
â”‚   â”‚   â””â”€â”€ payment-api.datasource.ts     # API í˜¸ì¶œ (REST/GraphQL ì „í™˜ ëŒ€ë¹„)
â”‚   â”œâ”€â”€ mappers/
â”‚   â”‚   â””â”€â”€ payment-gateway.mapper.ts     # DTO â†” Entity ë³€í™˜ (ìˆœìˆ˜ í•¨ìˆ˜)
â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ request/
â”‚   â”‚   â”‚   â””â”€â”€ PaymentRequestDto.ts      # API ìš”ì²­ DTO
â”‚   â”‚   â””â”€â”€ response/
â”‚   â”‚       â””â”€â”€ PaymentResponseDto.ts     # API ì‘ë‹µ DTO (ì„œë²„ í˜•íƒœ ê·¸ëŒ€ë¡œ)
â”‚   â””â”€â”€ configs/
â”‚       â””â”€â”€ tanstack-query.config.ts      # TanStack Query ì„¤ì •
â”‚
â”œâ”€â”€ presentation/                         # UI ë ˆì´ì–´ (React ì»´í¬ë„ŒíŠ¸, í›…)
â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”œâ”€â”€ components/                   # ì¬ì‚¬ìš© ê°€ëŠ¥í•œ UI ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â””â”€â”€ PaymentButton.tsx
â”‚   â”‚   â”œâ”€â”€ sections/                     # ê¸°ëŠ¥ ë‹¨ìœ„ ì„¹ì…˜ (Suspense í¬í•¨)
â”‚   â”‚   â”‚   â””â”€â”€ PaymentSection.tsx
â”‚   â”‚   â””â”€â”€ views/                        # í˜ì´ì§€ ë ˆì´ì•„ì›ƒ
â”‚   â”‚       â””â”€â”€ PaymentView.tsx
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ useProcessPayment.ts          # Use Caseë¥¼ í˜¸ì¶œí•˜ëŠ” í›… (DI ì‚¬ìš©)
â”‚   â”œâ”€â”€ adapters/
â”‚   â”‚   â””â”€â”€ payment-ui.adapter.ts         # Entity â†’ UI í‘œì‹œìš© ë³€í™˜ (í¬ë§·íŒ…)
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ payment-ui.types.ts           # UI ì „ìš© íƒ€ì…
â”‚   â”œâ”€â”€ constants/
â”‚   â”‚   â””â”€â”€ query-keys.ts                 # TanStack Query Key ìƒìˆ˜
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â””â”€â”€ payment-form.schema.ts        # Zod í¼ ê²€ì¦ ìŠ¤í‚¤ë§ˆ
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ format-currency.ts            # UI í¬ë§·íŒ… ìœ í‹¸
â”‚
â””â”€â”€ di/                                   # ì˜ì¡´ì„± ì£¼ì…
    â””â”€â”€ container.ts                      # Awilix DI Container (ëª¨ë“  ì˜ì¡´ì„± ê´€ë¦¬)
```

### ì¤‘ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸ êµ¬ì¡° (ë„ë©”ì¸ ë¶„ë¦¬)

ê¸°ëŠ¥ì´ ë³µì¡í•˜ê³  ë‹¤ì–‘í•´ì§€ë©´ ë„ë©”ì¸ë³„ë¡œ í´ë”ë¥¼ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤.

```
src/
â”œâ”€â”€ domains/
â”‚   â”œâ”€â”€ payment/                          # ê²°ì œ ë„ë©”ì¸
â”‚   â”‚   â”œâ”€â”€ core/                         # ë„ë©”ì¸ ê³µí†µ ê¸°ëŠ¥
â”‚   â”‚   â”‚   â”œâ”€â”€ base/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ BaseEntity.ts         # ì—”í‹°í‹° ê¸°ë³¸ í´ë˜ìŠ¤
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ BaseValueObject.ts    # Value Object ê¸°ë³¸ í´ë˜ìŠ¤
â”‚   â”‚   â”‚   â””â”€â”€ errors/
â”‚   â”‚   â”‚       â””â”€â”€ BasePaymentError.ts   # ë„ë©”ì¸ ê³µí†µ ì—ëŸ¬
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ domain/                       # ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ (ì™¸ë¶€ ì˜ì¡´ì„± ì—†ìŒ)
â”‚   â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PaymentGateway.ts     # ê²°ì œ ìˆ˜ë‹¨ Entity
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ PaymentTransaction.ts # ê²°ì œ ê±°ë˜ Entity
â”‚   â”‚   â”‚   â”œâ”€â”€ value-objects/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Money.ts              # ê¸ˆì•¡ Value Object
â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ IPaymentGatewayRepository.ts  # Repository ì¸í„°í˜ì´ìŠ¤
â”‚   â”‚   â”‚   â””â”€â”€ errors/
â”‚   â”‚   â”‚       â””â”€â”€ PaymentError.ts       # ë„ë©”ì¸ ì—ëŸ¬
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ application/                  # ë¹„ì¦ˆë‹ˆìŠ¤ í”Œë¡œìš°
â”‚   â”‚   â”‚   â”œâ”€â”€ use-cases/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProcessPaymentUseCase.ts      # ê²°ì œ ì²˜ë¦¬
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ProcessRefundUseCase.ts       # í™˜ë¶ˆ ì²˜ë¦¬
â”‚   â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚   â”‚       â”œâ”€â”€ ProcessPaymentDto.ts          # Use Case DTO
â”‚   â”‚   â”‚       â””â”€â”€ ProcessRefundDto.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ infrastructure/               # ì™¸ë¶€ ì‹œìŠ¤í…œ í†µì‹ 
â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ PaymentGatewayRepository.ts   # Repository êµ¬í˜„ì²´
â”‚   â”‚   â”‚   â”œâ”€â”€ datasources/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ payment-api.datasource.ts     # API í˜¸ì¶œ
â”‚   â”‚   â”‚   â”œâ”€â”€ mappers/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ payment-gateway.mapper.ts     # DTO â†” Entity ë³€í™˜ (ìˆœìˆ˜ í•¨ìˆ˜)
â”‚   â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚   â”‚       â”œâ”€â”€ request/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ PaymentRequestDto.ts
â”‚   â”‚   â”‚       â””â”€â”€ response/
â”‚   â”‚   â”‚           â””â”€â”€ PaymentResponseDto.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ di/                           # ì˜ì¡´ì„± ì£¼ì… ì»¨í…Œì´ë„ˆ
â”‚   â”‚   â”‚   â””â”€â”€ payment-container.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ presentation/                 # UI ë ˆì´ì–´
â”‚   â”‚       â”œâ”€â”€ ui/
â”‚   â”‚       â”‚   â”œâ”€â”€ views/                # í˜ì´ì§€ ë ˆë²¨ ë ˆì´ì•„ì›ƒ
â”‚   â”‚       â”‚   â”œâ”€â”€ sections/             # ê¸°ëŠ¥ ì„¹ì…˜
â”‚   â”‚       â”‚   â””â”€â”€ components/           # ì¬ì‚¬ìš© ì»´í¬ë„ŒíŠ¸
â”‚   â”‚       â”œâ”€â”€ adapters/                 # Entity â†’ UI íƒ€ì… ë³€í™˜ (7ê°œ+ ë©”ì„œë“œ)
â”‚   â”‚       â”œâ”€â”€ hooks/
â”‚   â”‚       â”‚   â””â”€â”€ queries/              # TanStack Query í›…
â”‚   â”‚       â”œâ”€â”€ types/                    # UI ì „ìš© íƒ€ì…
â”‚   â”‚       â”œâ”€â”€ constants/                # ì¿¼ë¦¬ í‚¤, ìƒìˆ˜
â”‚   â”‚       â”œâ”€â”€ schemas/                  # ê²€ì¦ ìŠ¤í‚¤ë§ˆ (Zod ë“±)
â”‚   â”‚       â””â”€â”€ utils/                    # Presentation ìœ í‹¸ë¦¬í‹°
â”‚   â”‚
â”‚   â”œâ”€â”€ user/                             # ì‚¬ìš©ì ë„ë©”ì¸
â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ application/
â”‚   â”‚   â”œâ”€â”€ infrastructure/
â”‚   â”‚   â”œâ”€â”€ di/
â”‚   â”‚   â””â”€â”€ presentation/
â”‚   â”‚
â”‚   â””â”€â”€ cafeteria/                        # ì‹ë‹¹ ë„ë©”ì¸
â”‚       â”œâ”€â”€ core/
â”‚       â”œâ”€â”€ domain/
â”‚       â”œâ”€â”€ application/
â”‚       â”œâ”€â”€ infrastructure/
â”‚       â”œâ”€â”€ di/
â”‚       â””â”€â”€ presentation/
â”‚
â”œâ”€â”€ core/                                 # ì „ì—­ ê³µí†µ ê¸°ëŠ¥
â”‚   â”œâ”€â”€ base/
â”‚   â”‚   â”œâ”€â”€ BaseEntity.ts                 # ì „ì—­ ì—”í‹°í‹° ê¸°ë³¸ í´ë˜ìŠ¤
â”‚   â”‚   â””â”€â”€ BaseValueObject.ts            # ì „ì—­ Value Object ê¸°ë³¸ í´ë˜ìŠ¤
â”‚   â”œâ”€â”€ constants/                        # ì „ì—­ ìƒìˆ˜ (ëª¨ë“  ë„ë©”ì¸ì´ ì‚¬ìš©)
â”‚   â”œâ”€â”€ errors/                           # ì „ì—­ ì—ëŸ¬
â”‚   â””â”€â”€ utils/                            # ì „ì—­ ìœ í‹¸ë¦¬í‹°
â”‚
â””â”€â”€ infrastructure/                       # ì „ì—­ ì™¸ë¶€ ì„œë¹„ìŠ¤
    â”œâ”€â”€ http/                             # HTTP í´ë¼ì´ì–¸íŠ¸
    â”œâ”€â”€ storage/                          # ë¡œì»¬ ìŠ¤í† ë¦¬ì§€
    â””â”€â”€ configs/                          # í™˜ê²½ ì„¤ì •
```

### ì–´ë–¤ êµ¬ì¡°ë¥¼ ì„ íƒí•´ì•¼ í• ê¹Œ?

**ì†Œê·œëª¨ êµ¬ì¡°ë¡œ ì‹œì‘í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.** ë‹¤ìŒ ê¸°ì¤€ì„ ì°¸ê³ í•˜ì:

| í”„ë¡œì íŠ¸ ìƒí™©                  | ê¶Œì¥ êµ¬ì¡°            | ì´ìœ                                          |
| ------------------------------ | -------------------- | -------------------------------------------- |
| **ì´ˆê¸° ë‹¨ê³„, ë‹¨ìˆœí•œ CRUD**     | ì†Œê·œëª¨ (ë ˆì´ì–´ ë¶„ë¦¬) | ë¹ ë¥¸ ê°œë°œ, íŒ€ì› ëˆ„êµ¬ë‚˜ ì‰½ê²Œ ì´í•´             |
| **ê¸°ëŠ¥ì´ ë³µì¡í•˜ê³  ë‹¤ì–‘í•´ì§€ë©´** | ë„ë©”ì¸ ë¶„ë¦¬ ê²€í†      | íŒŒì¼ì´ ë§ì•„ì§€ê³  íŒ€ ë¶„ì—…ì´ í•„ìš”í•  ë•Œ          |
| **ëª…í™•í•œ ë„ë©”ì¸ ê²½ê³„ ì¡´ì¬**    | ë„ë©”ì¸ ë¶„ë¦¬          | ê²°ì œ/ì‚¬ìš©ì/ì‹ë‹¹ì²˜ëŸ¼ ë…ë¦½ì  ê°œë°œì´ í•„ìš”í•  ë•Œ |

**ë„ë©”ì¸ ë¶„ë¦¬ì˜ ì¥ì **:

- ê° ë„ë©”ì¸ì´ ë…ë¦½ì ìœ¼ë¡œ ê°œë°œ ê°€ëŠ¥
- íŒ€ì›ë³„ë¡œ ë„ë©”ì¸ ë‹´ë‹¹ ë¶„ì—…ì´ ì‰¬ì›€
- ë§ˆì´í¬ë¡œ í”„ë¡ íŠ¸ì—”ë“œ ì „í™˜ ì‹œ ìœ ë¦¬

**ë„ë©”ì¸ ë¶„ë¦¬ì˜ ë‹¨ì **:

- í´ë” êµ¬ì¡°ê°€ ë³µì¡í•´ì§
- ë„ë©”ì¸ ê²½ê³„ ì„¤ì •ì´ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŒ (ê²°ì œì™€ ì‚¬ìš©ìë¥¼ ë¶„ë¦¬í•´ì•¼ í• ê¹Œ?)

ëŒ€ë¶€ë¶„ì˜ í”„ë¡œì íŠ¸ëŠ” **ì†Œê·œëª¨ êµ¬ì¡°ë¡œ ì‹œì‘**í•˜ê³ , ê¸°ëŠ¥ì´ ëŠ˜ì–´ë‚˜ë©´ **ë„ë©”ì¸ë³„ë¡œ ì ì§„ì ìœ¼ë¡œ ë¶„ë¦¬**í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.

---

ì´ì œ ê° ë ˆì´ì–´ì˜ ì—­í• ê³¼ ì‹¤ì œ ì½”ë“œë¥¼ ì‚´í´ë³´ì.

---

## Core Layer: ê³µí†µ ê¸°ëŠ¥ì˜ ì¤‘ì‹¬

`Core` ë ˆì´ì–´ëŠ” ì¡°ê¸ˆ íŠ¹ë³„í•˜ë‹¤. **ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ” ê³µí†µ ê¸°ëŠ¥**ì„ ë‹´ê³  ìˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ í´ë¦° ì•„í‚¤í…ì²˜ì—ì„œëŠ” ì˜ì¡´ì„±ì´ ì•ˆìª½ìœ¼ë¡œ í–¥í•˜ì§€ë§Œ, `Core`ëŠ” ì˜ˆì™¸ë‹¤.

ì™œ í•„ìš”í• ê¹Œ? ìƒìˆ˜, ì—ëŸ¬, ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ì²˜ëŸ¼ ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì½”ë“œë¥¼ ë§¤ë²ˆ ê° ë ˆì´ì–´ì— ì¤‘ë³µí•´ì„œ ë§Œë“¤ í•„ìš”ê°€ ìˆì„ê¹Œ? ê·¸ë ‡ì§€ ì•Šë‹¤. `Core`ì— í•œ ë²ˆë§Œ ì •ì˜í•˜ê³  ëª¨ë“  ë ˆì´ì–´ì—ì„œ ê°€ì ¸ë‹¤ ì“°ë©´ ëœë‹¤.

### Constants: ì „ì—­ ìƒìˆ˜

`Core`ì—ëŠ” **ëª¨ë“  ë„ë©”ì¸ì´ ì‚¬ìš©í•˜ëŠ” ì „ì—­ ìƒìˆ˜**ë§Œ ë‹´ëŠ”ë‹¤. íŠ¹ì • ë„ë©”ì¸ë§Œ ì‚¬ìš©í•˜ëŠ” ìƒìˆ˜ëŠ” `domain/config/`ì— ë„£ì–´ì•¼ í•œë‹¤.

```ts
// core/constants/app-constants.ts
export const CURRENCY_UNIT = "ì›"; // í†µí™” ë‹¨ìœ„ (ëª¨ë“  ë„ë©”ì¸ì—ì„œ ì‚¬ìš©)
export const DATE_FORMAT = "YYYY-MM-DD"; // ë‚ ì§œ í˜•ì‹
export const DEFAULT_PAGE_SIZE = 20; // ê¸°ë³¸ í˜ì´ì§€ í¬ê¸°
```

ê²°ì œ ê´€ë ¨ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì€ `Domain` ë ˆì´ì–´ì— ìœ„ì¹˜í•œë‹¤:

```ts
// domain/config/payment-constants.ts
export const MIN_PAYMENT_AMOUNT = 1_000; // ìµœì†Œ ê²°ì œ ê¸ˆì•¡
export const MAX_PAYMENT_AMOUNT = 1_000_000; // ìµœëŒ€ ê²°ì œ ê¸ˆì•¡
```

### BaseEntity: Entityì˜ ê¸°ë³¸ í´ë˜ìŠ¤

ëª¨ë“  Entityê°€ ê³µí†µìœ¼ë¡œ ê°€ì ¸ì•¼ í•  ê¸°ëŠ¥ì„ `BaseEntity`ì— ì •ì˜í•œë‹¤.

```ts
// core/base/BaseEntity.ts
export abstract class BaseEntity<T> {
  constructor(public readonly id: T) {}

  equals(other: BaseEntity<T>): boolean {
    return this.id === other.id;
  }
}
```

ì´ì œ EntityëŠ” `BaseEntity`ë¥¼ ìƒì†ë°›ì•„ ì‚¬ìš©í•œë‹¤:

```ts
// domain/entities/PaymentGateway.ts
import { BaseEntity } from "@/core/base/BaseEntity";

export class PaymentGateway extends BaseEntity<string> {
  constructor(
    id: string,
    public readonly name: string,
    public readonly isActive: boolean
  ) {
    super(id);
  }
}
```

### BaseValueObject: Value Objectì˜ ê¸°ë³¸ í´ë˜ìŠ¤

Value ObjectëŠ” ë¶ˆë³€ì„±ê³¼ ë™ë“±ì„± ë¹„êµë¥¼ ë³´ì¥í•´ì•¼ í•œë‹¤. `BaseValueObject`ì— ì´ ê¸°ëŠ¥ì„ êµ¬í˜„í•œë‹¤:

```ts
// core/base/BaseValueObject.ts
export abstract class BaseValueObject<T> {
  constructor(protected readonly value: T) {}

  equals(other: BaseValueObject<T>): boolean {
    return JSON.stringify(this.value) === JSON.stringify(other.value);
  }

  getValue(): T {
    return this.value;
  }
}
```

Value ObjectëŠ” ë„ë©”ì¸ ê·œì¹™ì„ ìº¡ìŠí™”í•œë‹¤:

```ts
// domain/value-objects/Money.ts
import { BaseValueObject } from "@/core/base/BaseValueObject";

export class Money extends BaseValueObject<number> {
  constructor(amount: number) {
    if (amount < 0) {
      throw new Error("ê¸ˆì•¡ì€ 0 ì´ìƒì´ì–´ì•¼ í•œë‹¤");
    }
    super(amount);
  }

  add(other: Money): Money {
    return new Money(this.value + other.getValue());
  }

  subtract(other: Money): Money {
    return new Money(this.value - other.getValue());
  }
}
```

### Errors: ì»¤ìŠ¤í…€ ì—ëŸ¬

`Core`ì—ëŠ” **ëª¨ë“  ë„ë©”ì¸ì´ ì‚¬ìš©í•˜ëŠ” ì „ì—­ ì—ëŸ¬**ë§Œ ë‹´ëŠ”ë‹¤:

```ts
// core/errors/AppError.ts
export class AppError extends Error {
  constructor(public code: string, message: string) {
    super(message);
    this.name = "AppError";
  }
}

export class NetworkError extends AppError {
  constructor() {
    super("NETWORK_ERROR", "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤");
  }
}

export class UnauthorizedError extends AppError {
  constructor() {
    super("UNAUTHORIZED", "ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìë‹¤");
  }
}
```

### ì—ëŸ¬ëŠ” ì–´ëŠ ë ˆì´ì–´ì— ë„£ì–´ì•¼ í• ê¹Œ?

**Core ì—ëŸ¬**: ëª¨ë“  ë„ë©”ì¸ì´ ì‚¬ìš©í•˜ëŠ” ì „ì—­ ì—ëŸ¬

```ts
// core/errors/AppError.ts
export class AppError extends Error { ... }
export class NetworkError extends AppError { ... }
export class UnauthorizedError extends AppError { ... }
```

**Domain ì—ëŸ¬**: íŠ¹ì • ë„ë©”ì¸ì—ë§Œ ê´€ë ¨ëœ ì—ëŸ¬

```ts
// domain/errors/PaymentError.ts
import { AppError } from "@/core/errors/AppError";

export class InsufficientBalanceError extends AppError {
  constructor(required: number, current: number) {
    super(
      "INSUFFICIENT_BALANCE",
      `ì”ì•¡ ë¶€ì¡±: í•„ìš” ${required}ì›, í˜„ì¬ ${current}ì›`
    );
  }
}

export class InvalidPaymentAmountError extends AppError {
  constructor(amount: number) {
    super("INVALID_PAYMENT_AMOUNT", `ìœ íš¨í•˜ì§€ ì•Šì€ ê¸ˆì•¡: ${amount}ì›`);
  }
}
```

**ì›ì¹™**: ëª¨ë“  ë„ë©”ì¸ì—ì„œ ì“°ë©´ Core, íŠ¹ì • ë„ë©”ì¸ë§Œ ì“°ë©´ Domain

---

### Validators: ê²€ì¦ ë¡œì§

ê²€ì¦ ë¡œì§ë„ ë§ˆì°¬ê°€ì§€ë‹¤. **ì „ì—­ ê²€ì¦**ì€ `Core`ì—, **ë„ë©”ì¸ ê²€ì¦**ì€ `Domain`ì— ìœ„ì¹˜í•œë‹¤.

```ts
// domain/validators/payment-validator.ts
import {
  MIN_PAYMENT_AMOUNT,
  MAX_PAYMENT_AMOUNT,
} from "../config/payment-constants";

export const validatePaymentAmount = (amount: number): void => {
  if (amount < MIN_PAYMENT_AMOUNT) {
    throw new Error(`ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì€ ${MIN_PAYMENT_AMOUNT}ì›ì…ë‹ˆë‹¤`);
  }
  if (amount > MAX_PAYMENT_AMOUNT) {
    throw new Error(`ìµœëŒ€ ê²°ì œ ê¸ˆì•¡ì€ ${MAX_PAYMENT_AMOUNT}ì›ì…ë‹ˆë‹¤`);
  }
};
```

### Utils: ê³µí†µ ìœ í‹¸ë¦¬í‹°

```ts
// core/utils/formatters.ts
export const formatCurrency = (amount: number): string => {
  return amount.toLocaleString("ko-KR");
};

export const formatPayment = (payment: number): string => {
  return `${formatCurrency(payment)}ì›`;
};
```

`Core` ë ˆì´ì–´ëŠ” **ìˆœìˆ˜ í•¨ìˆ˜ì™€ ìƒìˆ˜**ë§Œ ë‹´ëŠ”ë‹¤. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ë‚˜ ì™¸ë¶€ ì˜ì¡´ì„±ì„ ê°€ì§€ë©´ ì•ˆ ëœë‹¤. ê·¸ë˜ì•¼ ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

---

## Infrastructure Layer: ì™¸ë¶€ ì„¸ê³„ì™€ì˜ ê²©ë¦¬

`Infrastructure` ë ˆì´ì–´ëŠ” ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë‚˜ HTTP í´ë¼ì´ì–¸íŠ¸ë¥¼ ì¶”ìƒí™”í•œë‹¤. ì™œ í•„ìš”í• ê¹Œ?

ë§Œì•½ `axios`ë¥¼ ì§ì ‘ ì“°ë‹¤ê°€ `fetch`ë¡œ ë°”ê¾¸ê³  ì‹¶ë‹¤ë©´? ëª¨ë“  ì½”ë“œë¥¼ ìˆ˜ì •í•´ì•¼ í•œë‹¤. í•˜ì§€ë§Œ ì¶”ìƒí™”í•´ë‘ë©´ êµ¬í˜„ì²´ë§Œ ë°”ê¾¸ë©´ ëœë‹¤.

```ts
// infrastructure/http/httpClient.ts
export interface HttpClient {
  get<T>(url: string): Promise<T>;
  post<T>(url: string, data: unknown): Promise<T>;
  put<T>(url: string, data: unknown): Promise<T>;
  delete<T>(url: string): Promise<T>;
}
```

ì´ê±´ `ì¸í„°í˜ì´ìŠ¤`ë‹¤. êµ¬í˜„ì²´ëŠ” ë”°ë¡œ ë§Œë“ ë‹¤.

```ts
// infrastructure/http/axiosHttpClient.ts
import axios from "axios";
import type { HttpClient } from "./httpClient";

export class AxiosHttpClient implements HttpClient {
  async get<T>(url: string): Promise<T> {
    const response = await axios.get(url);
    return response.data;
  }

  async post<T>(url: string, data: unknown): Promise<T> {
    const response = await axios.post(url, data);
    return response.data;
  }

  // put, deleteë„ ìœ ì‚¬í•˜ê²Œ êµ¬í˜„
}
```

ì´ì œ `axios`ì—ì„œ `fetch`ë¡œ ë°”ê¾¸ê³  ì‹¶ìœ¼ë©´? ìƒˆë¡œìš´ êµ¬í˜„ì²´ë§Œ ë§Œë“¤ë©´ ëœë‹¤.

```ts
// infrastructure/http/fetchHttpClient.ts
import type { HttpClient } from "./httpClient";

export class FetchHttpClient implements HttpClient {
  async get<T>(url: string): Promise<T> {
    const response = await fetch(url);
    return response.json();
  }

  async post<T>(url: string, data: unknown): Promise<T> {
    const response = await fetch(url, {
      method: "POST",
      body: JSON.stringify(data),
      headers: { "Content-Type": "application/json" },
    });
    return response.json();
  }

  // put, deleteë„ ìœ ì‚¬í•˜ê²Œ êµ¬í˜„
}
```

ë‚˜ë¨¸ì§€ ì½”ë“œëŠ” `HttpClient` ì¸í„°í˜ì´ìŠ¤ë§Œ ì˜ì¡´í•˜ë¯€ë¡œ **ì•„ë¬´ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ”ë‹¤**.

---

## Application Layer: ë¹„ì¦ˆë‹ˆìŠ¤ í”Œë¡œìš° ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜

`Application` ë ˆì´ì–´ëŠ” **ë¹„ì¦ˆë‹ˆìŠ¤ í”Œë¡œìš°ë¥¼ ì¡°ìœ¨**í•œë‹¤. Entityê°€ ë‹¨ì¼ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ ë‹´ë‹¹í•œë‹¤ë©´, Use CaseëŠ” **ì—¬ëŸ¬ Entityì™€ Repositoryë¥¼ ì¡°í•©**í•´ì„œ í•˜ë‚˜ì˜ ì™„ì „í•œ ë¹„ì¦ˆë‹ˆìŠ¤ íë¦„ì„ ë§Œë“ ë‹¤.

**ì¤‘ìš”í•œ ì›ì¹™**:

- **Applicationì€ Domainì—ë§Œ ì˜ì¡´í•œë‹¤**: Entity, Repository Interfaceë§Œ ì‚¬ìš©í•œë‹¤
- **Use CaseëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ íë¦„ì„ í‘œí˜„í•œë‹¤**: "ê²°ì œ ì²˜ë¦¬", "í™˜ë¶ˆ ì²˜ë¦¬" ê°™ì€ ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤
- **Infrastructureë¥¼ ëª¨ë¥¸ë‹¤**: API, DB, HTTP í´ë¼ì´ì–¸íŠ¸ë¥¼ ì§ì ‘ ì•Œì§€ ëª»í•œë‹¤

`Application` ë ˆì´ì–´ëŠ” 2ê°€ì§€ë¡œ êµ¬ì„±ëœë‹¤:

1. `Use Case`: ë¹„ì¦ˆë‹ˆìŠ¤ í”Œë¡œìš°ë¥¼ ì‹¤í–‰í•œë‹¤
2. `DTO`: Use Caseì˜ ì…ë ¥/ì¶œë ¥ ë°ì´í„°ë¥¼ ì •ì˜í•œë‹¤

### Use Case: ë¹„ì¦ˆë‹ˆìŠ¤ í”Œë¡œìš° ì¡°ìœ¨

Use CaseëŠ” "ì‚¬ìš©ìê°€ ì‹œìŠ¤í…œì—ì„œ ë¬´ì—‡ì„ í•˜ê³  ì‹¶ì€ì§€"ë¥¼ ì½”ë“œë¡œ í‘œí˜„í•œ ê²ƒì´ë‹¤. ë§ˆì¹˜ ë ˆìŠ¤í† ë‘ì—ì„œ ì†ë‹˜ì´ "ìŠ¤í…Œì´í¬ ì„¸íŠ¸ë¥¼ ì£¼ë¬¸"í•˜ë©´, ì£¼ë°©ì¥ì´ ìŠ¤í…Œì´í¬ë¥¼ êµ½ê³ (Entity), ìƒëŸ¬ë“œë¥¼ ì¤€ë¹„í•˜ê³ (Entity), ìŒë£Œë¥¼ ë”°ë¥´ëŠ”(Entity) ì „ì²´ ê³¼ì •ì„ ì¡°ìœ¨í•˜ëŠ” ê²ƒê³¼ ê°™ë‹¤.

Entityê°€ **ë‹¨ì¼ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™**ì„ ë‹´ë‹¹í•œë‹¤ë©´, Use CaseëŠ” **ì—¬ëŸ¬ Entityì™€ Repositoryë¥¼ ì¡°í•©**í•´ì„œ **í•˜ë‚˜ì˜ ì™„ì „í•œ ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤**ë¥¼ ë§Œë“ ë‹¤.

```ts
// application/use-cases/ProcessPaymentUseCase.ts
import type { PaymentGatewayRepository } from "@/domain/repositories/PaymentGatewayRepository";
import type { UserRepository } from "@/domain/repositories/UserRepository";
import { Money } from "@/domain/value-objects/Money";

export interface ProcessPaymentDto {
  userId: number;
  paymentGatewayId: number;
  amount: number;
}

export interface ProcessPaymentResult {
  success: boolean;
  updatedBalance: number;
  message: string;
}

export class ProcessPaymentUseCase {
  constructor(
    private paymentGatewayRepository: PaymentGatewayRepository,
    private userRepository: UserRepository
  ) {}

  async execute(dto: ProcessPaymentDto): Promise<ProcessPaymentResult> {
    // 1. ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
    const user = await this.userRepository.getUser(dto.userId);

    // 2. ê²°ì œ ëŒ€í–‰ì‚¬ ì •ë³´ ì¡°íšŒ
    const paymentGateway = await this.paymentGatewayRepository.getPaymentGateway(
      dto.paymentGatewayId
    );

    // 3. ê²°ì œ ê¸ˆì•¡ì„ Value Objectë¡œ ë³€í™˜
    const paymentAmount = new Money(dto.amount);

    // 4. ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦ (Entityì˜ ë©”ì„œë“œ í™œìš©)
    if (!user.canMakePayment(paymentAmount)) {
      return {
        success: false,
        updatedBalance: user.paymentBalance,
        message: "ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤",
      };
    }

    if (!paymentGateway.canProcessPayment(paymentAmount)) {
      return {
        success: false,
        updatedBalance: user.paymentBalance,
        message: "ê²°ì œ ëŒ€í–‰ì‚¬ ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤",
      };
    }

    // 5. Repositoryë¥¼ í†µí•´ ê²°ì œ ì²˜ë¦¬
    const updatedUser = await this.paymentGatewayRepository.processPayment(
      dto.paymentGatewayId,
      dto.userId,
      dto.amount
    );

    // 6. ê²°ê³¼ ë°˜í™˜
    return {
      success: true,
      updatedBalance: updatedUser.paymentBalance,
      message: "ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤",
    };
  }
}
```

**Use Caseì˜ ì±…ì„**:

1. **ì—¬ëŸ¬ Repositoryë¥¼ ì¡°ìœ¨í•œë‹¤**: Userì™€ PaymentGateway ì •ë³´ë¥¼ ëª¨ë‘ ê°€ì ¸ì˜¨ë‹¤
2. **Entityì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ í™œìš©í•œë‹¤**: `user.canMakePayment()`, `paymentGateway.canProcessPayment()`
3. **ë¹„ì¦ˆë‹ˆìŠ¤ í”Œë¡œìš°ë¥¼ í‘œí˜„í•œë‹¤**: ì¡°íšŒ â†’ ê²€ì¦ â†’ ì²˜ë¦¬ â†’ ê²°ê³¼ ë°˜í™˜
4. **Infrastructureë¥¼ ëª¨ë¥¸ë‹¤**: API í˜¸ì¶œ ë°©ì‹, DB êµ¬í˜„ ë°©ì‹ì„ ì „í˜€ ëª¨ë¥¸ë‹¤

Use CaseëŠ” Entityì™€ Repository Interfaceë§Œ ì˜ì¡´í•œë‹¤. "ì–´ë–»ê²Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ì§€", "ì–´ë–¤ HTTP í´ë¼ì´ì–¸íŠ¸ë¥¼ ì“°ëŠ”ì§€"ëŠ” ì „í˜€ ëª¨ë¥¸ë‹¤. ì´ê²ƒì´ í´ë¦° ì•„í‚¤í…ì²˜ì˜ í•µì‹¬ì´ë‹¤.

```ts
// application/use-cases/ProcessRefundUseCase.ts
import type { PaymentGatewayRepository } from "@/domain/repositories/PaymentGatewayRepository";
import type { UserRepository } from "@/domain/repositories/UserRepository";
import { Money } from "@/domain/value-objects/Money";

export interface ProcessRefundDto {
  userId: number;
  paymentGatewayId: number;
  refundAmount: number;
}

export interface ProcessRefundResult {
  success: boolean;
  updatedBalance: number;
  message: string;
}

export class ProcessRefundUseCase {
  constructor(
    private paymentGatewayRepository: PaymentGatewayRepository,
    private userRepository: UserRepository
  ) {}

  async execute(dto: ProcessRefundDto): Promise<ProcessRefundResult> {
    // 1. ì‚¬ìš©ìì™€ ê²°ì œ ëŒ€í–‰ì‚¬ ì •ë³´ ì¡°íšŒ
    const [user, paymentGateway] = await Promise.all([
      this.userRepository.getUser(dto.userId),
      this.paymentGatewayRepository.getPaymentGateway(dto.paymentGatewayId),
    ]);

    // 2. í™˜ë¶ˆ ê¸ˆì•¡ì„ Value Objectë¡œ ë³€í™˜
    const refundAmount = new Money(dto.refundAmount);

    // 3. ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦
    if (!paymentGateway.canProcessRefund(refundAmount)) {
      return {
        success: false,
        updatedBalance: user.paymentBalance,
        message: "í™˜ë¶ˆ ì²˜ë¦¬ ê°€ëŠ¥ ê¸ˆì•¡ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤",
      };
    }

    // 4. í™˜ë¶ˆ ì²˜ë¦¬
    const updatedUser = await this.paymentGatewayRepository.processRefund(
      dto.paymentGatewayId,
      dto.userId,
      dto.refundAmount
    );

    // 5. ê²°ê³¼ ë°˜í™˜
    return {
      success: true,
      updatedBalance: updatedUser.paymentBalance,
      message: "í™˜ë¶ˆì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤",
    };
  }
}
```

Use CaseëŠ” **í´ë˜ìŠ¤**ë¡œ êµ¬í˜„í•œë‹¤. ì™œ í•¨ìˆ˜ê°€ ì•„ë‹ˆë¼ í´ë˜ìŠ¤ì¼ê¹Œ?

1. **ì˜ì¡´ì„± ì£¼ì…**: ìƒì„±ìì—ì„œ Repositoryë¥¼ ì£¼ì…ë°›ëŠ”ë‹¤
2. **í…ŒìŠ¤íŠ¸ ìš©ì´ì„±**: Repositoryë¥¼ Mockìœ¼ë¡œ êµì²´í•˜ê¸° ì‰½ë‹¤
3. **ì¬ì‚¬ìš©ì„±**: ê°™ì€ Use Caseë¥¼ ì—¬ëŸ¬ ê³³ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤

### Application DTO: Use Caseì˜ ì…ì¶œë ¥ íƒ€ì…

Use Caseì˜ ì…ë ¥ê³¼ ì¶œë ¥ íƒ€ì…ì„ ì •ì˜í•œë‹¤. Infrastructure DTO(ì„œë²„ ì‘ë‹µ)ì™€ êµ¬ë¶„í•˜ê¸° ìœ„í•´ Application DTOë¼ê³  ë¶€ë¥¸ë‹¤.

```ts
// application/dto/ProcessPaymentDto.ts
export interface ProcessPaymentDto {
  userId: number;
  paymentGatewayId: number;
  amount: number;
}

export interface ProcessPaymentResult {
  success: boolean;
  updatedBalance: number;
  message: string;
}
```

```ts
// application/dto/ProcessRefundDto.ts
export interface ProcessRefundDto {
  userId: number;
  paymentGatewayId: number;
  refundAmount: number;
}

export interface ProcessRefundResult {
  success: boolean;
  updatedBalance: number;
  message: string;
}
```

**Application DTO vs Infrastructure DTO**:

- **Application DTO**: Use Caseì˜ ì…ì¶œë ¥ íƒ€ì… (ë„ë©”ì¸ ê´€ì )
- **Infrastructure DTO**: ì„œë²„ ì‘ë‹µ íƒ€ì… (API ê´€ì )

Application DTOëŠ” "ë¹„ì¦ˆë‹ˆìŠ¤ ê´€ì ì—ì„œ í•„ìš”í•œ ë°ì´í„°"ë§Œ ë‹´ëŠ”ë‹¤. ì„œë²„ê°€ ë³´ë‚´ëŠ” `created_at`, `updated_at` ê°™ì€ ë©”íƒ€ë°ì´í„°ëŠ” Use Caseì— ë¶ˆí•„ìš”í•˜ë©´ í¬í•¨í•˜ì§€ ì•ŠëŠ”ë‹¤.

---

## Infrastructure Layer: ì™¸ë¶€ ì„¸ê³„ì™€ì˜ ì†Œí†µ

`Infrastructure` ë ˆì´ì–´ëŠ” **ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ í†µì‹ **í•˜ëŠ” ì—­í• ì„ í•œë‹¤. API í˜¸ì¶œ, DB ì ‘ê·¼, íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼ ë“± ëª¨ë“  "ì™¸ë¶€ ì˜ì¡´ì„±"ì´ ì—¬ê¸°ì— ëª¨ì¸ë‹¤.

**ì¤‘ìš”í•œ ì›ì¹™**:

- **InfrastructureëŠ” Domain Interfaceë¥¼ êµ¬í˜„í•œë‹¤**: Repository ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œë‹¤
- **DTO â†” Entity ë³€í™˜ì„ ë‹´ë‹¹í•œë‹¤**: Mapperê°€ ë³€í™˜ì„ ìˆ˜í–‰í•œë‹¤
- **ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì˜ì¡´í•œë‹¤**: axios, fetch, prisma ë“±ì„ ì‚¬ìš©í•œë‹¤

`Infrastructure` ë ˆì´ì–´ëŠ” 4ê°€ì§€ë¡œ êµ¬ì„±ëœë‹¤:

1. `Repository Implementation`: Domainì˜ Repository ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œë‹¤
2. `DataSource`: API ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•œë‹¤
3. `Mapper`: DTO â†” Entity ë³€í™˜ì„ ë‹´ë‹¹í•œë‹¤ (ìˆœìˆ˜ í•¨ìˆ˜)
4. `DTO`: ì„œë²„ ì‘ë‹µ íƒ€ì…ì„ ì •ì˜í•œë‹¤

### Repository: Domain ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„

```ts
// infrastructure/repositories/PaymentGatewayRepositoryImpl.ts
import type { PaymentGatewayRepository } from "@/domain/repositories/PaymentGatewayRepository";
import type { PaymentGatewayDataSource } from "@/infrastructure/datasources/paymentGatewayDataSource";
import type { PaymentGateway } from "@/domain/entities/PaymentGateway";
import type { User } from "@/domain/entities/User";
import { mapPaymentGatewayDtoToDomain } from "@/infrastructure/mappers/paymentGatewayMapper";
import { mapUserDtoToDomain } from "@/infrastructure/mappers/userMapper";

export class PaymentGatewayRepositoryImpl implements PaymentGatewayRepository {
  constructor(private paymentGatewayDataSource: PaymentGatewayDataSource) {}

  async getPaymentGateway(paymentGatewayId: number): Promise<PaymentGateway> {
    const paymentGatewayDto =
      await this.paymentGatewayDataSource.getPaymentGateway(paymentGatewayId);
    return mapPaymentGatewayDtoToDomain(paymentGatewayDto);
  }

  /**
   * ê²°ì œë¥¼ ì²˜ë¦¬í•˜ê³  ì—…ë°ì´íŠ¸ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ë°˜í™˜í•œë‹¤.
   * ì„œë²„ëŠ” ê²°ì œ ì²˜ë¦¬ í›„ ë³€ê²½ëœ User ì •ë³´ë¥¼ ì‘ë‹µìœ¼ë¡œ ë³´ë‚¸ë‹¤.
   */
  async processPayment(
    paymentGatewayId: number,
    userId: number,
    paymentAmount: number
  ): Promise<User> {
    const userDto = await this.paymentGatewayDataSource.processPayment(
      paymentGatewayId,
      userId,
      paymentAmount
    );
    return mapUserDtoToDomain(userDto);
  }
}
```

### Infrastructureê°€ Domainì— ì˜ì¡´í•˜ëŠ” ê²ƒì€ ì˜ì¡´ì„± ì—­ì „ ì›ì¹™(DIP) ìœ„ë°˜ì´ ì•„ë‹ˆë‹¤

ì½”ë“œë¥¼ ë³´ë©´ `PaymentGatewayRepositoryImpl`ì´ Domainì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ importí•œë‹¤:

```ts
import type { PaymentGatewayRepository } from "@/domain/repositories/PaymentGatewayRepository";
```

ì´ê²Œ ì˜ì¡´ì„± ì—­ì „ ì›ì¹™(DIP) ìœ„ë°˜ ì•„ë‹Œê°€? **ì•„ë‹ˆë‹¤!**

- âŒ DIP ìœ„ë°˜: `êµ¬ì²´ í´ë˜ìŠ¤`ì— ì˜ì¡´
- âœ… DIP ì¤€ìˆ˜: `ì¸í„°í˜ì´ìŠ¤`ì— ì˜ì¡´

Infrastructure LayerëŠ” Domainì˜ `ì¸í„°í˜ì´ìŠ¤`ë¥¼ êµ¬í˜„í•˜ëŠ” ê²ƒì´ë¯€ë¡œ ì •ìƒì´ë‹¤.

**í•µì‹¬**: Domainì€ Infrastructureë¥¼ ì „í˜€ ëª¨ë¥¸ë‹¤. Domainì€ "PaymentGatewayRepositoryImpl"ì˜ ì¡´ì¬ì¡°ì°¨ ëª¨ë¥¸ë‹¤. Domainì€ "PaymentGatewayRepository ì¸í„°í˜ì´ìŠ¤"ë§Œ ì•ˆë‹¤.

ì´ê²ƒì´ `ì˜ì¡´ì„± ì—­ì „ ì›ì¹™(Dependency Inversion Principle)`ì´ë‹¤.

---

```ts
// infrastructure/repositories/UserRepositoryImpl.ts
import type { UserRepository } from "@/domain/repositories/UserRepository";
import type { UserDataSource } from "@/infrastructure/datasources/userDataSource";
import type { User } from "@/domain/entities/User";
import { mapUserDtoToDomain } from "@/infrastructure/mappers/userMapper";

export class UserRepositoryImpl implements UserRepository {
  constructor(private userDataSource: UserDataSource) {}

  async getUser(userId: number): Promise<User> {
    const userDto = await this.userDataSource.getUser(userId);
    return mapUserDtoToDomain(userDto);
  }

  async processPayment(userId: number, paymentAmount: number): Promise<User> {
    const userDto = await this.userDataSource.processPayment(
      userId,
      paymentAmount
    );
    return mapUserDtoToDomain(userDto);
  }

  async convertPoints(userId: number, paymentAmount: number): Promise<User> {
    const userDto = await this.userDataSource.convertPoints(
      userId,
      paymentAmount
    );
    return mapUserDtoToDomain(userDto);
  }
}
```

**ì¤‘ìš”í•œ ì›ì¹™**:

- **Repository interfaceëŠ” `Domain`ì—, implementationì€ `Infrastructure`ì—**: `Domain`ì€ "ì–´ë–»ê²Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ì§€"ëŠ” ëª°ë¼ë„ ëœë‹¤
- **DTO â†’ Entity ë³€í™˜ì€ `Repository`ì˜ ì±…ì„**: `Use Case`ëŠ” `Entity`ë§Œ ë°›ëŠ”ë‹¤
- **`DataSource`ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤**: API í˜¸ì¶œì€ `DataSource`ê°€ ë‹´ë‹¹í•œë‹¤

ê·¸ë ‡ë‹¤ë©´ `DataSource`ëŠ” ë¬´ì—‡ì¼ê¹Œ?

### DataSource: ë„¤íŠ¸ì›Œí¬ í†µì‹  ë‹´ë‹¹

`DataSource`ëŠ” **API ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•˜ê³  DTOë¥¼ ë°˜í™˜í•˜ëŠ” ì—­í• **ì„ í•œë‹¤.

ë§ˆì¹˜ ë¬¼ë¥˜ì„¼í„° ì§ì›ì´ ì„ ë°˜ì—ì„œ ìƒí’ˆì„ ì§‘ì–´ ë°•ìŠ¤ì— ë‹´ê¸°ë§Œ í•˜ëŠ” ê²ƒì²˜ëŸ¼, `DataSource`ëŠ” APIë¥¼ í˜¸ì¶œí•´ì„œ DTOë¥¼ ê·¸ëŒ€ë¡œ ë°˜í™˜í•˜ê¸°ë§Œ í•œë‹¤.

### DataSourceë¥¼ ë¶„ë¦¬í•˜ëŠ” ì´ìœ 

`DataSource`ëŠ” "ë°ì´í„°ë¥¼ ì–´ë””ì„œ ê°€ì ¸ì˜¬ì§€"ë¥¼ ê²©ë¦¬í•œë‹¤. ì§€ê¸ˆì€ REST APIì§€ë§Œ ë‚˜ì¤‘ì— GraphQL, Firebase, Supabaseë¡œ ë°”ë€” ìˆ˜ ìˆë‹¤.

```ts
// ì‹œë‚˜ë¦¬ì˜¤ 1: REST â†’ GraphQL ì „í™˜
class GraphQLPaymentDataSource {
  async getPaymentGateway(id: number) {
    const query = `{ paymentGateway(id: ${id}) { id balance currency } }`;
    return this.graphqlClient.query(query);
  }
}

// ì‹œë‚˜ë¦¬ì˜¤ 2: REST â†’ Firebase ì „í™˜
class FirebasePaymentDataSource {
  async getPaymentGateway(id: number) {
    const doc = await firebase
      .firestore()
      .collection("payment_gateways")
      .doc(id.toString())
      .get();
    return doc.data();
  }
}

// ì‹œë‚˜ë¦¬ì˜¤ 3: REST â†’ Supabase ì „í™˜
class SupabasePaymentDataSource {
  async getPaymentGateway(id: number) {
    const { data } = await supabase
      .from("payment_gateways")
      .select("*")
      .eq("id", id)
      .single();
    return data;
  }
}
```

ì´ëŸ° ë³€ê²½ì´ ìˆì–´ë„ `Repository`, `Mapper`, `UseCase`ëŠ” ì „í˜€ ì˜í–¥ë°›ì§€ ì•ŠëŠ”ë‹¤. **`DataSource`ë§Œ êµì²´í•˜ë©´ ëœë‹¤.**

### DataSourceë¥¼ ìƒëµí•  ìˆ˜ë„ ìˆë‹¤

í”„ë¡œì íŠ¸ê°€ ì‘ê³ , APIê°€ ë‹¨ìˆœí•˜ë©°, ë°ì´í„° ì†ŒìŠ¤ ì „í™˜ ê°€ëŠ¥ì„±ì´ ì „í˜€ ì—†ë‹¤ë©´ `Repository`ì—ì„œ ì§ì ‘ í˜¸ì¶œí•´ë„ ëœë‹¤:

```ts
// DataSource ìƒëµ ë²„ì „
export class PaymentRepositoryImpl implements PaymentRepository {
  constructor(private httpClient: HttpClient) {}

  async getPaymentGateway(id: number): Promise<PaymentGateway> {
    const dto = await this.httpClient.get(`/api/payment-gateways/${id}`);
    return mapDtoToDomain(dto); // ë°”ë¡œ ë³€í™˜
  }
}
```

**ìš°ë¦¬ í”„ë¡œì íŠ¸**: ì¤‘ê°„ ê·œëª¨ì´ê³  í™•ì¥ ê°€ëŠ¥ì„±ì„ ê³ ë ¤í•´ì„œ `DataSource` ë ˆì´ì–´ ìœ ì§€ âœ…

```ts
// infrastructure/datasources/paymentGatewayDataSource.ts
import type { HttpClient } from "@/infrastructure/http/HttpClient";
import type { PaymentGatewayDto } from "@/infrastructure/dto/paymentGatewayDto";

export class PaymentGatewayDataSource {
  constructor(private httpClient: HttpClient) {}

  async getPaymentGateway(
    paymentGatewayId: number
  ): Promise<PaymentGatewayDto> {
    return this.httpClient.get<PaymentGatewayDto>(
      `/api/payment-gateways/${paymentGatewayId}`
    );
  }

  async processPayment(
    paymentGatewayId: number,
    userId: number,
    paymentAmount: number
  ): Promise<PaymentGatewayDto> {
    return this.httpClient.post<PaymentGatewayDto>("/api/payments/process", {
      payment_gateway_id: paymentGatewayId,
      user_id: userId,
      payment_amount: paymentAmount,
    });
  }
}
```

```ts
// infrastructure/datasources/userDataSource.ts
import type { HttpClient } from "@/infrastructure/http/HttpClient";
import type { UserDto } from "@/infrastructure/dto/userDto";

export class UserDataSource {
  constructor(private httpClient: HttpClient) {}

  async getUser(userId: number): Promise<UserDto> {
    return this.httpClient.get<UserDto>(`/api/users/${userId}`);
  }

  async convertPoints(userId: number, paymentAmount: number): Promise<UserDto> {
    return this.httpClient.post<UserDto>("/api/users/convert-points", {
      user_id: userId,
      payment_amount: paymentAmount,
    });
  }
}
```

### DataSourceëŠ” ì¸í„°í˜ì´ìŠ¤ê°€ í•„ìš”í• ê¹Œ?

**ëŒ€ë¶€ë¶„ì€ `êµ¬ì²´ í´ë˜ìŠ¤`ë¡œ ì¶©ë¶„**í•˜ë‹¤. í•˜ì§€ë§Œ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ì „í™˜í•  ê°€ëŠ¥ì„±ì´ ìˆë‹¤ë©´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“ ë‹¤.

```ts
// âœ… ì¸í„°í˜ì´ìŠ¤ê°€ í•„ìš”í•œ ê²½ìš°: ì—¬ëŸ¬ êµ¬í˜„ì²´ ì¡´ì¬
interface PaymentDataSource {
  getPaymentGateway(id: number): Promise<PaymentGatewayDto>;
}

class RestPaymentDataSource implements PaymentDataSource { ... }
class GraphQLPaymentDataSource implements PaymentDataSource { ... }
class FirebasePaymentDataSource implements PaymentDataSource { ... }
```

```ts
// âœ… êµ¬ì²´ í´ë˜ìŠ¤ë¡œ ì¶©ë¶„í•œ ê²½ìš°: êµ¬í˜„ì²´ 1ê°œë§Œ ì¡´ì¬
export class PaymentGatewayDataSource {
  constructor(private httpClient: HttpClient) {}
  async getPaymentGateway(id: number) { ... }
}
```

**ìš°ë¦¬ í”„ë¡œì íŠ¸**: REST APIë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ `êµ¬ì²´ í´ë˜ìŠ¤` âœ…

---

`DataSource`ëŠ” 3ê°€ì§€ ì›ì¹™ì„ ë”°ë¥¸ë‹¤:

1. **DTOë§Œ ë°˜í™˜í•œë‹¤**: `Entity`ê°€ ì•„ë‹Œ `DTO`ë¥¼ ë°˜í™˜í•œë‹¤. ë³€í™˜ì€ `Mapper`ì˜ ëª«ì´ë‹¤.
2. **`HttpClient` ì¸í„°í˜ì´ìŠ¤ì— ì˜ì¡´í•œë‹¤**: `axios`ë‚˜ `fetch`ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤. `HttpClient` ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ HTTP í´ë¼ì´ì–¸íŠ¸ë¥¼ ì¶”ìƒí™”í•œë‹¤.
3. **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ í¬í•¨í•˜ì§€ ì•ŠëŠ”ë‹¤**: API í˜¸ì¶œë§Œ ë‹´ë‹¹í•œë‹¤.

`DataSource`ì™€ `HttpClient`ì˜ ê´€ê³„ë¥¼ ë³´ë©´, `axios`ì¸ì§€ `fetch`ì¸ì§€ëŠ” `DataSource`ë„ ëª¨ë¥¸ë‹¤. ì´ê²ƒì´ ë°”ë¡œ ì˜ì¡´ì„± ì—­ì „ ì›ì¹™ì´ë‹¤.

ë°±ì—”ë“œê°€ ë°”ë€Œë©´ ì–´ë–»ê²Œ ë ê¹Œ? ì²˜ìŒì—” Spring Bootë¥¼ ì“°ë‹¤ê°€ Firebaseë¡œ ë°”ê¾¸ê±°ë‚˜, Nest.jsë¡œ ì „í™˜í•˜ê±°ë‚˜, Supabaseë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•œë‹¤ë©´? **`DataSource` ë•ë¶„ì— ê±±ì •í•  í•„ìš”ê°€ ì—†ë‹¤.** `Repository`, `Mapper`, `Entity`ëŠ” ê±´ë“œë¦¬ì§€ ì•Šê³  `DataSource`ë§Œ êµì²´í•˜ë©´ ëœë‹¤. ì´ê²ƒì´ ë°”ë¡œ í´ë¦° ì•„í‚¤í…ì²˜ì˜ í•µì‹¬ ì¥ì ì´ë‹¤.

### DTO: ì„œë²„ ì‘ë‹µ íƒ€ì…

ì„œë²„ê°€ ë³´ë‚´ëŠ” ë°ì´í„° í˜•ì‹ì„ ì •ì˜í•œë‹¤.

```ts
// infrastructure/dto/paymentGatewayDto.ts
export interface PaymentGatewayDto {
  payment_gateway_id: number; // PGì‚¬ ê³ ìœ  ID
  payment_gateway_name: string; // PGì‚¬ ì´ë¦„
  wallet_balance: number; // ì˜ˆì¹˜ê¸ˆ ì”ì•¡
  created_at: string; // ìƒì„± ì‹œê°
  updated_at: string; // ìˆ˜ì • ì‹œê°
}

// infrastructure/dto/userDto.ts
export interface UserDto {
  user_id: number; // ì‚¬ìš©ì ê³ ìœ  ID
  user_name: string; // ì‚¬ìš©ì ì´ë¦„
  payment_gateway_id: number; // ì‚¬ìš© ì¤‘ì¸ PGì‚¬ ID
  payment_balance: number; // ê²°ì œ ì”ì•¡
  wallet_balance: number; // ì§€ê°‘ ì”ì•¡
  created_at: string; // ìƒì„± ì‹œê°
  updated_at: string; // ìˆ˜ì • ì‹œê°
}

// infrastructure/dto/paymentTransactionDto.ts
export interface PaymentTransactionDto {
  transaction_id: string; // ê±°ë˜ ê³ ìœ  ID
  user_id: number; // ì‚¬ìš©ì ID
  payment_gateway_id: number; // PGì‚¬ ID
  transaction_type: "process" | "convert"; // ê±°ë˜ ìœ í˜•
  amount: number; // ê±°ë˜ ê¸ˆì•¡
  balance_after: number; // ê±°ë˜ í›„ ì”ì•¡
  created_at: string; // ê±°ë˜ ì‹œê°
}
```

> **ì°¸ê³ **: ëª¨ë…¸ë ˆí¬ í™˜ê²½ì´ë¼ë©´ `packages/types`ì²˜ëŸ¼ ë³„ë„ íŒ¨í‚¤ì§€ë¡œ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤. ì„œë²„ê°€ Swagger ë¬¸ì„œë¥¼ ì™„ì „í•˜ê²Œ ì‘ì„±í–ˆë‹¤ë©´ [`openapi-typescript`](https://openapi-ts.dev/)ë‚˜ [`orval`](https://orval.dev/) ê°™ì€ ë„êµ¬ë¡œ íƒ€ì…ì„ ìë™ ìƒì„±í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤. ì§ì ‘ ì„ ì–¸í•˜ë©´ íœ´ë¨¼ ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

ê·¸ëŸ°ë° ì„œë²„ íŒ€ì—ì„œ ê°‘ìê¸° `"ê¸°íšì´ ë°”ë€Œì–´ì„œ payment_gateway_id í•„ë“œë¥¼ gateway_idë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤"`ë¼ê³  í†µë³´í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ? ê¸°ì¡´ ë°©ì‹ì´ë¼ë©´ í•´ë‹¹ í•„ë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¾ì•„ì„œ ìˆ˜ì •í•´ì•¼ í•œë‹¤. í•˜ì§€ë§Œ í´ë¦° ì•„í‚¤í…ì²˜ì—ì„œëŠ” ë‹¨ **í•œ ê³³**ë§Œ ê³ ì¹˜ë©´ ëœë‹¤. ë°”ë¡œ `Mapper`ë‹¤.

---

### Mapper: ì„œë²„ ë³€ê²½ì˜ ì¶©ê²©ì„ í¡ìˆ˜í•˜ëŠ” ì™„ì¶©ì¬

`Mapper`ëŠ” ì„œë²„ì™€ ìš°ë¦¬ ì½”ë“œ ì‚¬ì´ì˜ **ë²ˆì—­ê¸°**ë‹¤. ì„œë²„ê°€ `payment_gateway_id`ë¥¼ ë³´ë‚´ë“  `gateway_id`ë¥¼ ë³´ë‚´ë“ , ìš°ë¦¬ ì½”ë“œëŠ” ì „í˜€ ì‹ ê²½ ì“°ì§€ ì•ŠëŠ”ë‹¤. `Mapper`ê°€ ëª¨ë“  ë³€ê²½ì„ **í•œ ê³³ì—ì„œ ì²˜ë¦¬**í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

ë§ˆì¹˜ í•´ì™¸ì—ì„œ ì‚° ì „ìì œí’ˆì„ ì‚¬ìš©í•  ë•Œ **ë©€í‹° ì–´ëŒ‘í„°**ë¥¼ ì“°ëŠ” ê²ƒê³¼ ë¹„ìŠ·í•˜ë‹¤. í•´ì™¸ ì „ìì œí’ˆ(ì„œë²„)ì˜ í”ŒëŸ¬ê·¸ ëª¨ì–‘ì´ ë°”ë€Œì–´ë„, ë©€í‹° ì–´ëŒ‘í„°(Mapper)ë§Œ ìˆìœ¼ë©´ ìš°ë¦¬ ì½˜ì„¼íŠ¸(Domain, Presentation)ëŠ” ê·¸ëŒ€ë¡œ ì“¸ ìˆ˜ ìˆë‹¤.

MapperëŠ” classê°€ ì•„ë‹Œ `ìˆœìˆ˜ í•¨ìˆ˜`ë¡œ êµ¬í˜„í•œë‹¤. ìƒíƒœë¥¼ ê°€ì§ˆ í•„ìš”ê°€ ì—†ê³ , ë‹¨ìˆœíˆ ë°ì´í„°ë¥¼ ë³€í™˜í•˜ëŠ” ì—­í• ë§Œ í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

```ts
// infrastructure/mappers/paymentGatewayMapper.ts
import { z } from "zod";
import { PaymentGateway } from "@/domain/entities/PaymentGateway";
import type { PaymentGatewayDto } from "@/infrastructure/dto/paymentGatewayDto";

// 1. DTO ê²€ì¦ ìŠ¤í‚¤ë§ˆ
const paymentGatewayDtoSchema = z.object({
  payment_gateway_id: z.number(),
  payment_gateway_name: z.string(),
  wallet_balance: z.number(),
  created_at: z.string(),
  updated_at: z.string(),
});

// DTO â†’ Entity ë³€í™˜ í•¨ìˆ˜
export function mapPaymentGatewayDtoToDomain(
  dto: PaymentGatewayDto
): PaymentGateway {
  // 1. DTO ê²€ì¦
  const validated = paymentGatewayDtoSchema.parse(dto);

  // 2. Entity ìƒì„± (snake_case â†’ camelCase)
  return new PaymentGateway({
    id: validated.payment_gateway_id,
    name: validated.payment_gateway_name,
    walletBalance: validated.wallet_balance,
    createdAt: new Date(validated.created_at),
    updatedAt: new Date(validated.updated_at),
  });
}

// Entity â†’ DTO ë³€í™˜ í•¨ìˆ˜ (API ìš”ì²­ ì‹œ)
export function mapPaymentGatewayDomainToDto(
  paymentGateway: PaymentGateway
): PaymentGatewayDto {
  return {
    payment_gateway_id: paymentGateway.id,
    payment_gateway_name: paymentGateway.name,
    wallet_balance: paymentGateway.walletBalance,
    created_at: paymentGateway.createdAt.toISOString(),
    updated_at: paymentGateway.updatedAt.toISOString(),
  };
}
```

```ts
// infrastructure/mappers/userMapper.ts
import { z } from "zod";
import { User } from "@/domain/entities/User";
import type { UserDto } from "@/infrastructure/dto/userDto";

const userDtoSchema = z.object({
  user_id: z.number(),
  user_name: z.string(),
  payment_gateway_id: z.number(),
  payment_balance: z.number(),
  wallet_balance: z.number(),
  created_at: z.string(),
  updated_at: z.string(),
});

export function mapUserDtoToDomain(dto: UserDto): User {
  const validated = userDtoSchema.parse(dto);

  return new User({
    id: validated.user_id,
    name: validated.user_name,
    gatewayId: validated.payment_gateway_id,
    paymentBalance: validated.payment_balance,
    walletBalance: validated.wallet_balance,
    createdAt: new Date(validated.created_at),
    updatedAt: new Date(validated.updated_at),
  });
}
```

```ts
// infrastructure/mappers/paymentTransactionMapper.ts
import { z } from "zod";
import { PaymentTransaction } from "@/domain/entities/PaymentTransaction";
import type { PaymentTransactionDto } from "@/infrastructure/dto/paymentTransactionDto";

const paymentTransactionDtoSchema = z.object({
  transaction_id: z.string(),
  user_id: z.number(),
  payment_gateway_id: z.number(),
  transaction_type: z.enum(["process", "convert"]),
  amount: z.number(),
  balance_after: z.number(),
  created_at: z.string(),
});

export function mapPaymentTransactionDtoToDomain(
  dto: PaymentTransactionDto
): PaymentTransaction {
  const validated = paymentTransactionDtoSchema.parse(dto);

  return new PaymentTransaction({
    id: validated.transaction_id,
    userId: validated.user_id,
    paymentGatewayId: validated.payment_gateway_id,
    // ì„œë²„ì˜ "process" â†’ ë„ë©”ì¸ì˜ "payment"ë¡œ ë§¤í•‘ (ìš©ì–´ í†µì¼)
    type: validated.transaction_type === "process" ? "payment" : "refund",
    amount: validated.amount,
    balanceAfter: validated.balance_after,
    createdAt: new Date(validated.created_at),
  });
}
```

`Mapper` í•¨ìˆ˜ëŠ” ë‹¤ìŒì„ ìˆ˜í–‰í•œë‹¤:

1. **ê²€ì¦**: `Zod`ë¡œ DTOì˜ í˜•ì‹ì„ ê²€ì¦í•œë‹¤
2. **í•„ë“œëª… ë§¤í•‘**: ì„œë²„ í•„ë“œ(`payment_gateway_id`) â†’ ë„ë©”ì¸ í•„ë“œ(`id`)ë¡œ ë³€í™˜í•œë‹¤
3. **ë„¤ì´ë° ë³€í™˜**: `snake_case` â†’ `camelCase`ë¡œ ë³€í™˜í•œë‹¤
4. **íƒ€ì… ë³€í™˜**: `string` â†’ `Date`ì²˜ëŸ¼ íƒ€ì…ì„ ë³€í™˜í•œë‹¤
5. **Entity ìƒì„±**: `Domain`ì˜ `PaymentGateway`, `User`, `PaymentTransaction` Entityë¥¼ ìƒì„±í•œë‹¤

**í•µì‹¬ì€ ì´ê²ƒì´ë‹¤**: ì„œë²„ê°€ `payment_gateway_id â†’ gateway_id`ë¡œ í•„ë“œëª…ì„ ë°”ê¾¸ë©´?

```ts
// âœ… Mapper í•œ ê³³ë§Œ ìˆ˜ì •
export function mapPaymentGatewayDtoToDomain(dto: PaymentGatewayDto): PaymentGateway {
  return new PaymentGateway({
-   id: validated.payment_gateway_id,  // ê¸°ì¡´
+   id: validated.gateway_id,           // ë³€ê²½
    name: validated.payment_gateway_name,
    walletBalance: validated.wallet_balance,
    // ...
  });
}
```

`Mapper` í•¨ìˆ˜ **ë”± 1ì¤„**ë§Œ ê³ ì¹˜ë©´ ëœë‹¤. `Presentation`, `Domain`, `Application` ë ˆì´ì–´ëŠ” ì „í˜€ ìˆ˜ì •í•˜ì§€ ì•Šì•„ë„ ëœë‹¤. ë„ì…ë¶€ì—ì„œ ì–¸ê¸‰í•œ "10ê°œ íŒŒì¼ ìˆ˜ì • â†’ 1ê°œ íŒŒì¼ ìˆ˜ì •"ì´ ë°”ë¡œ ì´ê²ƒì´ë‹¤.

---

## Domain Layer: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì˜ ì¤‘ì‹¬

`Domain` ë ˆì´ì–´ëŠ” í´ë¦° ì•„í‚¤í…ì²˜ì˜ **í•µì‹¬**ì´ë‹¤. UIë„ ëª¨ë¥´ê³ , APIë„ ëª¨ë¥´ê³ , ì˜¤ì§ **ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™**ë§Œ ë‹´ë‹¹í•œë‹¤.

**ì¤‘ìš”í•œ ì›ì¹™**:

- **Domainì€ Coreë§Œ importí•œë‹¤**: `Application`, `Infrastructure`, `Presentation` ë ˆì´ì–´ëŠ” ì ˆëŒ€ importí•˜ì§€ ì•ŠëŠ”ë‹¤
- **Domainì€ ì™¸ë¶€ ì˜ì¡´ì„±ì´ ì—†ë‹¤**: ìˆœìˆ˜í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ë§Œ ë‹´ëŠ”ë‹¤
- **Repository InterfaceëŠ” Domainì— ì •ì˜í•œë‹¤**: êµ¬í˜„ì²´ëŠ” `Infrastructure` Layerì— ìœ„ì¹˜í•œë‹¤

`Domain`ì€ 4ê°€ì§€ë¡œ êµ¬ì„±ëœë‹¤:

1. `Entity`: ê³ ìœ  ì‹ë³„ìë¥¼ ê°€ì§„ ë¹„ì¦ˆë‹ˆìŠ¤ ê°ì²´
2. `Value Object`: ë¶ˆë³€ì„±ì„ ê°€ì§„ ê°’ ê°ì²´ (ë„ë©”ì¸ ê·œì¹™ ìº¡ìŠí™”)
3. `Repository Interface`: ë°ì´í„° ì ‘ê·¼ ì¶”ìƒí™”
4. `Errors`: ë„ë©”ì¸ ì—ëŸ¬

### Entity: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™

EntityëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ì™€ ê´€ë ¨ëœ **ëª¨ë“  ê·œì¹™**ì„ ë‹´ëŠ”ë‹¤. ê²°ì œ ëŒ€í–‰ì‚¬ ì‹œìŠ¤í…œì—ëŠ” `PaymentGateway`ì™€ `User` Entityê°€ ìˆë‹¤.

#### PaymentGateway Entity

`PaymentGateway` EntityëŠ” ê²°ì œ ëŒ€í–‰ì‚¬ì˜ ì˜ˆì¹˜ê¸ˆê³¼ ê²°ì œ ì²˜ë¦¬ ê·œì¹™ì„ ë‹´ë‹¹í•œë‹¤.

```ts
// domain/entities/PaymentGateway.ts
interface PaymentGatewayProps {
  id: number;
  name: string;
  walletBalance: number;
  createdAt: Date;
  updatedAt: Date;
}

export class PaymentGateway {
  private readonly _id: number;
  private readonly _name: string;
  private readonly _walletBalance: number;
  private readonly _createdAt: Date;
  private readonly _updatedAt: Date;

  static readonly MIN_PAYMENT_AMOUNT = 1_000;
  static readonly MAX_PAYMENT_AMOUNT = 1_000_000;

  constructor(props: PaymentGatewayProps) {
    this._id = props.id;
    this._name = props.name;
    this._walletBalance = props.walletBalance;
    this._createdAt = props.createdAt;
    this._updatedAt = props.updatedAt;

    // ìƒì„± ì‹œì ì— í•„ìˆ˜ ê²€ì¦ ìˆ˜í–‰
    this.validate();
  }

  private validate(): void {
    if (this._id <= 0) throw new Error("ê²°ì œ ëŒ€í–‰ì‚¬ IDëŠ” ì–‘ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤");
    if (!this._name?.trim()) throw new Error("ê²°ì œ ëŒ€í–‰ì‚¬ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤");
    if (this._walletBalance < 0)
      throw new Error("ì˜ˆì¹˜ê¸ˆ ì”ì•¡ì€ ìŒìˆ˜ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
  }

  get id() {
    return this._id;
  }
  get name() {
    return this._name;
  }
  get walletBalance() {
    return this._walletBalance;
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ì˜ˆì¹˜ê¸ˆ ì”ì•¡ í™•ì¸
  canProcessPayment(amount: number): boolean {
    return this._walletBalance >= amount;
  }

  // ì‚¬ìš©ì ì…ë ¥ ê²€ì¦ (UseCaseì—ì„œ í˜¸ì¶œ)
  static validatePaymentAmount(amount: number): void {
    if (amount < this.MIN_PAYMENT_AMOUNT) {
      throw new Error(`ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì€ ${this.MIN_PAYMENT_AMOUNT}ì›ì…ë‹ˆë‹¤`);
    }
    if (amount > this.MAX_PAYMENT_AMOUNT) {
      throw new Error(`ìµœëŒ€ ê²°ì œ ê¸ˆì•¡ì€ ${this.MAX_PAYMENT_AMOUNT}ì›ì…ë‹ˆë‹¤`);
    }
  }

  static validateDepositAmount(amount: number): void {
    if (amount <= 0) {
      throw new Error("ì¶©ì „ ê¸ˆì•¡ì€ 0ì›ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤");
    }
  }
}
```

**Validation ì „ëµ**

| íŒ¨í„´                   | ëª©ì                          | í˜¸ì¶œ ì‹œì                |
| ---------------------- | ---------------------------- | ----------------------- |
| `private validate()`   | Entityì˜ í•„ìˆ˜ ë¶ˆë³€ ê·œì¹™ ê²€ì¦ | Entity ìƒì„± ì‹œ ìë™     |
| `static validateXXX()` | ì‚¬ìš©ì ì…ë ¥ ì‚¬ì „ ê²€ì¦        | UseCaseì—ì„œ ëª…ì‹œì  í˜¸ì¶œ |

**í•µì‹¬**: Constructor validationì€ ì˜ëª»ëœ ë°ì´í„°ë¡œ Entityê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ ì›ì²œ ì°¨ë‹¨í•œë‹¤. Entityë¥¼ ë°›ëŠ” ëª¨ë“  ì½”ë“œê°€ "ì´ ê°ì²´ëŠ” ìœ íš¨í•˜ë‹¤"ê³  ì‹ ë¢°í•  ìˆ˜ ìˆë‹¤

### Entity ë©”ì„œë“œëŠ” booleanì„ ë°˜í™˜í•œë‹¤

Entity ë©”ì„œë“œëŠ” `íŒë‹¨ ê²°ê³¼(boolean)`ë¥¼ ë°˜í™˜í•œë‹¤. í…ìŠ¤íŠ¸ë‚˜ í¬ë§·íŒ…ì€ Presentationì˜ Adapter ì—­í• ì´ë‹¤.

```ts
// âœ… ì¢‹ì€ ì˜ˆ: boolean ë°˜í™˜
class PaymentGateway {
  canProcessPayment(amount: number): boolean {
    return this.balance >= amount;
  }
}

// âŒ ë‚˜ìœ ì˜ˆ: í…ìŠ¤íŠ¸ ë°˜í™˜ (Adapter ì—­í•  ì¹¨ë²”)
class PaymentGateway {
  getPaymentStatusMessage(amount: number): string {
    return this.balance >= amount ? "ê²°ì œ ê°€ëŠ¥í•©ë‹ˆë‹¤" : "ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤";
  }
}
```

**ì›ì¹™**:

- Entity â†’ boolean íŒë‹¨
- Adapter â†’ í…ìŠ¤íŠ¸ ë³€í™˜

---

#### User Entity

`User` EntityëŠ” ì‚¬ìš©ìì˜ ê²°ì œ ë‚´ì—­ê³¼ ì§€ê°‘ ì”ì•¡ ê´€ë¦¬ ê·œì¹™ì„ ë‹´ë‹¹í•œë‹¤.

```ts
// domain/entities/User.ts
interface UserProps {
  id: number;
  name: string;
  gatewayId: number;
  paymentBalance: number; // ê²°ì œ ëŒ€í–‰ì‚¬ì—ì„œ ê´€ë¦¬í•˜ëŠ” ì‚¬ìš©ìì˜ ì˜ˆì¹˜ê¸ˆ ì”ì•¡
  walletBalance: number; // ì‚¬ìš©ì ê°œì¸ ì§€ê°‘ì˜ í™˜ë¶ˆ ê°€ëŠ¥ ì”ì•¡
  createdAt: Date;
  updatedAt: Date;
}

export class User {
  private readonly _id: number; // ì‚¬ìš©ì ê³ ìœ  ID
  private readonly _name: string; // ì‚¬ìš©ì ì´ë¦„
  private readonly _gatewayId: number; // PGì‚¬ ID
  private _paymentBalance: number; // ê²°ì œ ëŒ€í–‰ì‚¬ì—ì„œ ê´€ë¦¬í•˜ëŠ” ì‚¬ìš©ìì˜ ì˜ˆì¹˜ê¸ˆ ì”ì•¡
  private _walletBalance: number; // ì‚¬ìš©ì ê°œì¸ ì§€ê°‘ì˜ í™˜ë¶ˆ ê°€ëŠ¥ ì”ì•¡
  private readonly _createdAt: Date; // ë“±ë¡ ì‹œê°
  private _updatedAt: Date; // ì—…ë°ì´íŠ¸ ì‹œê°

  constructor(props: UserProps) {
    this._id = props.id;
    this._name = props.name;
    this._gatewayId = props.gatewayId;
    this._paymentBalance = props.paymentBalance;
    this._walletBalance = props.walletBalance;
    this._createdAt = props.createdAt;
    this._updatedAt = props.updatedAt;
  }

  // Getter
  get id() {
    return this._id;
  }
  get name() {
    return this._name;
  }
  get gatewayId() {
    return this._gatewayId;
  }
  get paymentBalance() {
    return this._paymentBalance;
  }
  get walletBalance() {
    return this._walletBalance;
  }
  get createdAt() {
    return this._createdAt;
  }
  get updatedAt() {
    return this._updatedAt;
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ê²°ì œ ê¸ˆì•¡ ê²€ì¦
  static validatePaymentAmount(amount: number): void {
    if (amount <= 0) {
      throw new Error("ê²°ì œ ê¸ˆì•¡ì€ 0ì›ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤");
    }
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: í™˜ë¶ˆ ê°€ëŠ¥ ì—¬ë¶€
  canRefund(amount: number, minRefundAmount: number): boolean {
    return this._paymentBalance >= amount && amount >= minRefundAmount;
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ì§€ê°‘ ì”ì•¡ ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€
  canUseWallet(amount: number): boolean {
    return this._walletBalance >= amount;
  }
}
```

**ë‹¤ì‹œ ê°•ì¡°**: `canRefund`, `canUseWallet` ê°™ì€ ë©”ì„œë“œëŠ” **booleanë§Œ ë°˜í™˜**í•œë‹¤. "í™˜ë¶ˆ ê°€ëŠ¥", "í™˜ë¶ˆ ë¶ˆê°€" ê°™ì€ ë©”ì‹œì§€ëŠ” Adapterì—ì„œ ì²˜ë¦¬í•œë‹¤.

### ì”ì•¡ í•„ë“œ ìƒì„¸ ì„¤ëª…

`paymentBalance`ëŠ” í™˜ë¶ˆ ê°€ëŠ¥í•œ ê¸ˆì•¡, `walletBalance`ëŠ” í™˜ë¶ˆë°›ì•„ ì ë¦½ëœ ì˜ˆì¹˜ê¸ˆì´ë‹¤. 10,000ì› ê²°ì œ â†’ 5,000ì› í™˜ë¶ˆí•˜ë©´, `paymentBalance`: 5,000ì› (ì°¨ê°), `walletBalance`: 5,000ì› (ì ë¦½)ìœ¼ë¡œ **í˜„ê¸ˆ ê²°ì œ ê¸ˆì•¡**ê³¼ **ì˜ˆì¹˜ê¸ˆ**ì„ êµ¬ë¶„í•œë‹¤.

---

**PaymentTransaction Entity:**

ê²°ì œ ê±°ë˜ ë‚´ì—­ì„ ê´€ë¦¬í•˜ëŠ” Entityì´ë‹¤.

```ts
// domain/entities/PaymentTransaction.ts
type TransactionType = "payment" | "refund"; // payment: ê²°ì œ, refund: í™˜ë¶ˆ

interface PaymentTransactionProps {
  id: string;
  userId: number;
  gatewayId: number;
  type: TransactionType;
  amount: number;
  balanceAfter: number;
  createdAt: Date;
}

export class PaymentTransaction {
  private readonly _id: string; // ê±°ë˜ ê³ ìœ  ID (UUID, ì¤‘ë³µ ë°©ì§€ìš© ì‹ë³„ì)
  private readonly _userId: number; // ê±°ë˜ë¥¼ ìˆ˜í–‰í•œ ì‚¬ìš©ì ID
  private readonly _gatewayId: number; // ê±°ë˜ë¥¼ ì²˜ë¦¬í•œ ê²°ì œ ëŒ€í–‰ì‚¬ ID
  private readonly _type: TransactionType; // ê±°ë˜ ìœ í˜• (payment: ê²°ì œ, refund: í™˜ë¶ˆ)
  private readonly _amount: number; // ê±°ë˜ ê¸ˆì•¡
  private readonly _balanceAfter: number; // ê±°ë˜ í›„ ì”ì•¡ (ì´ ê±°ë˜ ì´í›„ ë‚¨ì€ ì‚¬ìš©ì ì”ì•¡)
  private readonly _createdAt: Date; // ê±°ë˜ ë°œìƒ ì‹œê°

  constructor(props: PaymentTransactionProps) {
    this._id = props.id;
    this._userId = props.userId;
    this._gatewayId = props.gatewayId;
    this._type = props.type;
    this._amount = props.amount;
    this._balanceAfter = props.balanceAfter;
    this._createdAt = props.createdAt;
  }

  // Getterë“¤
  get id(): string {
    return this._id; // ê±°ë˜ ì¡°íšŒ, ì˜ìˆ˜ì¦ ì¶œë ¥ ë“±ì— ì‚¬ìš©
  }

  get userId(): number {
    return this._userId; // ì‚¬ìš©ìë³„ ê±°ë˜ ë‚´ì—­ í•„í„°ë§ì— ì‚¬ìš©
  }

  get gatewayId(): number {
    return this._gatewayId; // PGì‚¬ë³„ ê±°ë˜ í†µê³„, í•„í„°ë§ì— ì‚¬ìš©
  }

  get type(): TransactionType {
    return this._type; // ê±°ë˜ ìœ í˜• í‘œì‹œ (ê²°ì œ/í™˜ë¶ˆ ì•„ì´ì½˜, ìƒ‰ìƒ êµ¬ë¶„ ë“±)
  }

  get amount(): number {
    return this._amount; // ê±°ë˜ ê¸ˆì•¡ í‘œì‹œ, í†µê³„ ê³„ì‚°ì— ì‚¬ìš©
  }

  get balanceAfter(): number {
    return this._balanceAfter; // ê±°ë˜ í›„ ì”ì•¡ í‘œì‹œ, ì”ì•¡ ë³€í™” ì¶”ì ì— ì‚¬ìš©
  }

  get createdAt(): Date {
    return this._createdAt; // ê±°ë˜ ë°œìƒ ì‹œê° í‘œì‹œ, ê±°ë˜ ë‚´ì—­ ì‹œê°„ìˆœ ì •ë ¬ì— ì‚¬ìš©
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ê²°ì œ ê±°ë˜ ìƒì„±
  static createPaymentTransaction(
    userId: number,
    gatewayId: number,
    amount: number,
    balanceAfter: number
  ): PaymentTransaction {
    if (amount <= 0) {
      throw new Error("ê²°ì œ ê¸ˆì•¡ì€ 0ì›ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤");
    }

    return new PaymentTransaction({
      id: crypto.randomUUID(), // ê³ ìœ  ID ìƒì„±
      userId,
      gatewayId,
      type: "payment",
      amount,
      balanceAfter,
      createdAt: new Date(),
    });
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: í™˜ë¶ˆ ê±°ë˜ ìƒì„±
  static createRefundTransaction(
    userId: number,
    gatewayId: number,
    amount: number,
    balanceAfter: number
  ): PaymentTransaction {
    if (amount <= 0) {
      throw new Error("í™˜ë¶ˆ ê¸ˆì•¡ì€ 0ì›ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤");
    }

    return new PaymentTransaction({
      id: crypto.randomUUID(),
      userId,
      gatewayId,
      type: "refund",
      amount,
      balanceAfter,
      createdAt: new Date(),
    });
  }
}
```

---

Entityë“¤ì€ ì•ì„œ ì„¤ëª…í•œ `ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™(ê²€ì¦ ë¡œì§)`ì„ ë‹´ëŠ”ë‹¤. ìƒì„±ìì—ì„œ í•„ìˆ˜ ë¶ˆë³€ ê·œì¹™ì„ ê²€ì¦í•˜ê³ , ì •ì  ë©”ì„œë“œë¡œ ì‚¬ìš©ì ì…ë ¥ì„ ì‚¬ì „ ê²€ì¦í•˜ëŠ” Validation ì „ëµì„ ë”°ë¥¸ë‹¤.

ê¸°íšìê°€ "ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì„ 2,000ì›ìœ¼ë¡œ ë°”ê¿”ì£¼ì„¸ìš”"ë¼ê³  í•˜ë©´? `MIN_PAYMENT_AMOUNT` í•œ ì¤„ë§Œ ë°”ê¾¸ë©´ ëœë‹¤.

```diff
// domain/entities/PaymentGateway.ts
- static readonly MIN_PAYMENT_AMOUNT = 1_000;
+ static readonly MIN_PAYMENT_AMOUNT = 2_000;
```

ì»´í¬ë„ŒíŠ¸ëŠ” ê±´ë“œë¦´ í•„ìš”ê°€ ì—†ë‹¤.

---

### EntityëŠ” ì™œ ë¶ˆë³€ì¸ê°€?

ìš°ë¦¬ í”„ë¡œì íŠ¸ëŠ” **ì„œë²„ ìƒíƒœ ê´€ë¦¬ë¥¼ Tanstack Queryì—ê²Œ ìœ„ì„**í–ˆë‹¤. ë§Œì•½ Entity classì—ì„œë„ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

```ts
// âŒ Entityê°€ ìƒíƒœë¥¼ ì§ì ‘ ë³€ê²½í•˜ë©´?
class User {
  private _balance: number;

  deposit(amount: number) {
    this._balance += amount; // Entityê°€ ìƒíƒœ ë³€ê²½
  }
}

// ë¬¸ì œ: Tanstack Query ìºì‹œì™€ Entity ìƒíƒœê°€ ë”°ë¡œ ë…¼ë‹¤!
// - Entity: _balance = 10000
// - Tanstack Query ìºì‹œ: balance = 5000
// ì–´ëŠ ê²ƒì´ ì§„ì§œì¸ê°€?
```

Entityì™€ Tanstack Query ìºì‹œê°€ **ê°ì ìƒíƒœë¥¼ ê´€ë¦¬**í•˜ë©´ ë¶ˆì¼ì¹˜ê°€ ë°œìƒí•œë‹¤. ë”°ë¼ì„œ EntityëŠ” `readonly`ë¡œ ë§Œë“¤ì–´ **ê²€ì¦ë§Œ ë‹´ë‹¹**í•˜ê³ , ìƒíƒœëŠ” Tanstack Queryê°€ ì„œë²„ ì‘ë‹µìœ¼ë¡œë§Œ ì—…ë°ì´íŠ¸í•œë‹¤.

```ts
// âœ… í”„ë¡ íŠ¸ì—”ë“œ Entity: readonly + ê²€ì¦ ë©”ì„œë“œë§Œ
class User {
  private readonly _balance: number;

  canDeposit(amount: number): boolean {
    return amount > 0; // ê²€ì¦ë§Œ
  }
}

// UseCaseê°€ ì„œë²„ì— ìš”ì²­ â†’ Tanstack Queryê°€ ìºì‹œ ì—…ë°ì´íŠ¸
const updatedUser = await userRepository.deposit(user.id, amount);
```

ë°±ì—”ë“œ EntityëŠ” ìƒíƒœ ë³€ê²½ ë©”ì„œë“œë¥¼ ê°€ì§€ë©°(Mutable), Repositoryê°€ ë³€ê²½ëœ Entityë¥¼ DBì— ì €ì¥í•œë‹¤. ë°˜ë©´ í”„ë¡ íŠ¸ì—”ë“œ EntityëŠ” ë¶ˆë³€(Immutable)ì´ê³ , Tanstack Queryê°€ ì„œë²„ ì‘ë‹µìœ¼ë¡œ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤.

| í™˜ê²½               | Entity íŠ¹ì„± | ìƒíƒœ ê´€ë¦¬             | ì˜ì†ì„±                 |
| ------------------ | ----------- | --------------------- | ---------------------- |
| ë°±ì—”ë“œ (ORM)       | Mutable     | Entityê°€ ìƒíƒœ ë³€ê²½    | Repositoryê°€ DB ì €ì¥   |
| í”„ë¡ íŠ¸ì—”ë“œ (React) | Immutable   | TanStack Queryê°€ ê´€ë¦¬ | ì„œë²„ ì‘ë‹µìœ¼ë¡œ ì—…ë°ì´íŠ¸ |

---

### Repository Interface: ë°ì´í„° ì ‘ê·¼ ì¶”ìƒí™”

`Domain` LayerëŠ” ë°ì´í„°ê°€ **ì–´ë””ì„œ ì˜¤ëŠ”ì§€** ëª¨ë¥¸ë‹¤. HTTP APIì¸ì§€, LocalStorageì¸ì§€, IndexedDBì¸ì§€ ì•Œ í•„ìš”ê°€ ì—†ë‹¤. ë‹¨ì§€ "**ì–´ë–¤ ë°ì´í„°ê°€ í•„ìš”í•œì§€**"ë§Œ ì •ì˜í•œë‹¤.

ì´ê²ƒì´ ë°”ë¡œ `Repository Interface`ë‹¤. `Domain`ì€ ì¸í„°í˜ì´ìŠ¤ë§Œ ì •ì˜í•˜ê³ , `Data` Layerê°€ ì‹¤ì œ êµ¬í˜„ì„ ì œê³µí•œë‹¤.

```ts
// domain/repositories/PaymentGatewayRepository.ts
import type { PaymentGateway } from "@/domain/entities/PaymentGateway";
import type { User } from "@/domain/entities/User";

export interface PaymentGatewayRepository {
  getPaymentGateway(gatewayId: number): Promise<PaymentGateway>; // Entity ë°˜í™˜
  processPayment(
    gatewayId: number,
    userId: number,
    paymentAmount: number
  ): Promise<User>; // Entity ë°˜í™˜
}
```

```ts
// domain/repositories/UserRepository.ts
import type { User } from "@/domain/entities/User";

export interface UserRepository {
  getUser(userId: number): Promise<User>;
  processPayment(userId: number, paymentAmount: number): Promise<User>;
  processRefund(userId: number, refundAmount: number): Promise<User>;
}
```

**í•µì‹¬ì€ ë°˜í™˜ íƒ€ì…**ì´ë‹¤. `Repository Interface`ëŠ” `DTO`ê°€ ì•„ë‹Œ `Entity`ë¥¼ ë°˜í™˜í•œë‹¤. `Domain`ì€ `DTO`ì˜ ì¡´ì¬ì¡°ì°¨ ëª¨ë¥¸ë‹¤.

**ë ˆì´ì–´ë³„ ì—­í• **:

- **Domain**: ì¸í„°í˜ì´ìŠ¤ë§Œ ì •ì˜ (`domain/repositories/`)
- **Infrastructure**: ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„ (`infrastructure/repositories/`)

```ts
// Domainì€ "ë¬´ì—‡ì´ í•„ìš”í•œì§€"ë§Œ ì •ì˜
// domain/repositories/PaymentGatewayRepository.ts
export interface PaymentGatewayRepository {
  getPaymentGateway(id: number): Promise<PaymentGateway>;
}

// InfrastructureëŠ” "ì–´ë–»ê²Œ ê°€ì ¸ì˜¬ì§€" êµ¬í˜„
// infrastructure/repositories/PaymentGatewayRepositoryImpl.ts
export class PaymentGatewayRepositoryImpl implements PaymentGatewayRepository {
  constructor(private dataSource: PaymentGatewayDataSource) {}

  async getPaymentGateway(id: number): Promise<PaymentGateway> {
    const dto = await this.dataSource.getPaymentGateway(id);
    return mapDtoToEntity(dto); // DTO â†’ Entity ë³€í™˜
  }
}
```

ì´ë ‡ê²Œ í•˜ë©´:

- **`Domain`ì€ `Data`ë¥¼ ëª°ë¼ë„ ëœë‹¤**: `ì˜ì¡´ì„± ì—­ì „ ì›ì¹™`
- **í…ŒìŠ¤íŠ¸ê°€ ì‰¬ì›Œì§„ë‹¤**: Mock Repositoryë¥¼ ì£¼ì…í•˜ë©´ ë
- **ë°ì´í„° ì†ŒìŠ¤ êµì²´ê°€ ììœ ë¡­ë‹¤**: HTTP â†’ LocalStorageë¡œ ë°”ê¿”ë„ `Domain`ì€ ëª¨ë¥¸ë‹¤

ë§ˆì¹˜ ì½˜ì„¼íŠ¸ì™€ í”ŒëŸ¬ê·¸ì˜ ê´€ê³„ë‹¤. ì½˜ì„¼íŠ¸(Interface)ëŠ” ê·œê²©ë§Œ ì •ì˜í•˜ê³ , ì–´ë–¤ ì „ê¸°(ë°ì´í„°)ê°€ ë“¤ì–´ì˜¤ë“  ìƒê´€ì—†ë‹¤.

---

### Value Object: ë„ë©”ì¸ ê·œì¹™ì„ ìº¡ìŠí™”í•˜ëŠ” ë¶ˆë³€ ê°ì²´

Value ObjectëŠ” Entityì™€ ë‹¬ë¦¬ **ê³ ìœ  ì‹ë³„ìê°€ ì—†ê³ **, **ê°’ ìì²´ë¡œ ë™ë“±ì„±ì„ íŒë‹¨**í•˜ëŠ” ê°ì²´ë‹¤.

#### ì™œ Value Objectê°€ í•„ìš”í• ê¹Œ?

ì›ì‹œ íƒ€ì…(`number`, `string`)ë§Œ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒ ë¬¸ì œê°€ ë°œìƒí•œë‹¤:

**ë¬¸ì œ 1: ìœ íš¨ì„± ê²€ì¦ì´ ì—¬ê¸°ì €ê¸° í©ì–´ì§„ë‹¤**

```ts
// âŒ ë‚˜ìœ ì˜ˆì‹œ: ê²€ì¦ ë¡œì§ì´ ì—¬ê¸°ì €ê¸° ì¤‘ë³µë¨
function processPayment(amount: number) {
  if (amount < 0) throw new Error("ê¸ˆì•¡ì€ 0 ì´ìƒì´ì–´ì•¼ í•œë‹¤");
  if (amount < 1_000) throw new Error("ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì€ 1,000ì›ì´ë‹¤");
  // ...
}

function refundPayment(amount: number) {
  if (amount < 0) throw new Error("ê¸ˆì•¡ì€ 0 ì´ìƒì´ì–´ì•¼ í•œë‹¤"); // ì¤‘ë³µ!
  // ...
}
```

**ë¬¸ì œ 2: ì˜ë¯¸ ì—†ëŠ” ì—°ì‚°ì´ ê°€ëŠ¥í•˜ë‹¤**

```ts
const price = 10000; // ê°€ê²©
const temperature = 25; // ì˜¨ë„

// âŒ íƒ€ì… ì‹œìŠ¤í…œì´ ì´ ì˜ëª»ëœ ì—°ì‚°ì„ ë§‰ì§€ ëª»í•œë‹¤
const result = price + temperature; // ê°€ê²© + ì˜¨ë„?
```

**ë¬¸ì œ 3: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì´ ë„ë©”ì¸ ê°ì²´ ë°–ì— í©ì–´ì§„ë‹¤**

```ts
// âŒ ê¸ˆì•¡ ê³„ì‚° ë¡œì§ì´ ë„ë©”ì¸ ê°ì²´ ë°–ì— ìˆë‹¤
const totalPrice = price1 + price2 + price3;
const discountedPrice = totalPrice * 0.9;
```

#### Value Objectë¡œ í•´ê²°í•˜ê¸°

Value ObjectëŠ” **ë„ë©”ì¸ ê·œì¹™ì„ ìº¡ìŠí™”**í•´ì„œ ìœ„ ë¬¸ì œë¥¼ ëª¨ë‘ í•´ê²°í•œë‹¤:

```ts
// domain/value-objects/Money.ts
import { BaseValueObject } from "@/core/base/BaseValueObject";

export class Money extends BaseValueObject<number> {
  private static readonly MIN_AMOUNT = 0;

  constructor(amount: number) {
    if (amount < Money.MIN_AMOUNT) {
      throw new Error(`ê¸ˆì•¡ì€ ${Money.MIN_AMOUNT} ì´ìƒì´ì–´ì•¼ í•œë‹¤`);
    }
    super(amount);
  }

  // âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ì—°ì‚°ì„ Value Object ì•ˆì— ìº¡ìŠí™”
  add(other: Money): Money {
    return new Money(this.value + other.getValue());
  }

  subtract(other: Money): Money {
    return new Money(this.value - other.getValue());
  }

  multiply(rate: number): Money {
    return new Money(Math.floor(this.value * rate));
  }

  isGreaterThan(other: Money): boolean {
    return this.value > other.getValue();
  }

  isLessThan(other: Money): boolean {
    return this.value < other.getValue();
  }
}
```

ì´ì œ ì½”ë“œê°€ í›¨ì”¬ ì•ˆì „í•˜ê³  ëª…í™•í•´ì§„ë‹¤:

```ts
// âœ… ì¢‹ì€ ì˜ˆì‹œ: íƒ€ì… ì•ˆì „ì„±ê³¼ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì´ ë³´ì¥ë¨
const price = new Money(10000);
const discount = new Money(1000);

// âœ… Moneyë¼ë¦¬ë§Œ ì—°ì‚° ê°€ëŠ¥ (íƒ€ì… ì•ˆì „ì„±)
const finalPrice = price.subtract(discount);

// âœ… ìƒì„± ì‹œì ì— ê²€ì¦ë¨
const invalidMoney = new Money(-100); // Error: ê¸ˆì•¡ì€ 0 ì´ìƒì´ì–´ì•¼ í•œë‹¤

// âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì´ ë„ë©”ì¸ ê°ì²´ ì•ˆì— ìˆìŒ
if (price.isGreaterThan(discount)) {
  // ...
}
```

#### Entityì—ì„œ Value Object ì‚¬ìš©í•˜ê¸°

EntityëŠ” Value Objectë¥¼ í•„ë“œë¡œ ê°€ì§ˆ ìˆ˜ ìˆë‹¤:

```ts
// domain/entities/PaymentGateway.ts
import { BaseEntity } from "@/core/base/BaseEntity";
import { Money } from "@/domain/value-objects/Money";

export class PaymentGateway extends BaseEntity<string> {
  constructor(
    id: string,
    public readonly name: string,
    private readonly walletBalance: Money // âœ… ì›ì‹œ íƒ€ì… ëŒ€ì‹  Value Object
  ) {
    super(id);
  }

  // âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ê²°ì œ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
  canProcessPayment(amount: Money): boolean {
    return this.walletBalance.isGreaterThan(amount) ||
           this.walletBalance.equals(amount);
  }

  getBalance(): Money {
    return this.walletBalance;
  }
}
```

#### Value Objectë¥¼ ì–¸ì œ ì‚¬ìš©í•´ì•¼ í• ê¹Œ?

ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ Value Objectë¡œ ë§Œë“¤ì–´ë¼:

1. **ìœ íš¨ì„± ê²€ì¦ì´ í•„ìš”í•œ ê°’**: ì´ë©”ì¼, ì „í™”ë²ˆí˜¸, ê¸ˆì•¡ ë“±
2. **ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ ê°€ì§„ ê°’**: ê¸ˆì•¡ ê³„ì‚°, ë‚ ì§œ ë²”ìœ„ ê²€ì¦ ë“±
3. **ì—¬ëŸ¬ ê³³ì—ì„œ ì‚¬ìš©ë˜ëŠ” ê°’**: ê²€ì¦ ë¡œì§ ì¤‘ë³µì„ ë°©ì§€
4. **íƒ€ì… ì•ˆì „ì„±ì´ ì¤‘ìš”í•œ ê°’**: ê°€ê²©ê³¼ ì˜¨ë„ë¥¼ êµ¬ë¶„í•˜ê³  ì‹¶ì„ ë•Œ

**Value Object ì˜ˆì‹œ**:

```ts
// domain/value-objects/Email.ts
export class Email extends BaseValueObject<string> {
  private static readonly EMAIL_REGEX = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  constructor(email: string) {
    if (!Email.EMAIL_REGEX.test(email)) {
      throw new Error("ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì´ë‹¤");
    }
    super(email.toLowerCase());
  }
}

// domain/value-objects/PhoneNumber.ts
export class PhoneNumber extends BaseValueObject<string> {
  constructor(phone: string) {
    const cleaned = phone.replace(/[^0-9]/g, "");
    if (cleaned.length !== 11) {
      throw new Error("ì „í™”ë²ˆí˜¸ëŠ” 11ìë¦¬ì—¬ì•¼ í•œë‹¤");
    }
    super(cleaned);
  }

  format(): string {
    const value = this.getValue();
    return `${value.slice(0, 3)}-${value.slice(3, 7)}-${value.slice(7)}`;
  }
}
```

#### Value Objectì˜ í•µì‹¬ ì›ì¹™

1. **ë¶ˆë³€ì„±**: í•œ ë²ˆ ìƒì„±ë˜ë©´ ê°’ì„ ë³€ê²½í•  ìˆ˜ ì—†ë‹¤
2. **ê°’ ë™ë“±ì„±**: `id`ê°€ ì•„ë‹Œ **ê°’ ìì²´**ë¡œ ê°™ì€ì§€ ë¹„êµí•œë‹¤
3. **ìê°€ ê²€ì¦**: ìƒì„± ì‹œì ì— ìœ íš¨ì„±ì„ ê²€ì¦í•œë‹¤
4. **ìº¡ìŠí™”**: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ Value Object ì•ˆì— ìˆ¨ê¸´ë‹¤

Value Objectê°€ ì—†ìœ¼ë©´ ê²€ì¦ ë¡œì§ì´ ì½”ë“œ ê³³ê³³ì— í©ì–´ì§€ê³ , íƒ€ì… ì•ˆì „ì„±ì´ ë³´ì¥ë˜ì§€ ì•Šìœ¼ë©°, ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì´ ë„ë©”ì¸ ê°ì²´ ë°–ì—ì„œ ê´€ë¦¬ëœë‹¤. Value Objectë¥¼ ì‚¬ìš©í•˜ë©´ ë„ë©”ì¸ ê·œì¹™ì´ í•œ ê³³ì— ëª¨ì´ê³ , ì½”ë“œê°€ í›¨ì”¬ ì•ˆì „í•˜ê³  ëª…í™•í•´ì§„ë‹¤.

---

## DI Layer: DI Containerë¡œ ì˜ì¡´ì„± ê´€ë¦¬

ì§€ê¸ˆê¹Œì§€ `Entity`, `Repository`, `Use Case`ë¥¼ ë§Œë“¤ì—ˆë‹¤. í•˜ì§€ë§Œ ì´ ëª¨ë“  ì˜ì¡´ì„±ì„ ì–´ë–»ê²Œ ê´€ë¦¬í• ê¹Œ?

`Use Case`ëŠ” `Repository`ê°€ í•„ìš”í•˜ê³ , `Repository`ëŠ” `DataSource`ê°€ í•„ìš”í•˜ê³ , `DataSource`ëŠ” `HttpClient`ê°€ í•„ìš”í•˜ë‹¤. ë§¤ë²ˆ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±í•˜ë©´ ì½”ë“œê°€ ë³µì¡í•´ì§„ë‹¤.

ì´ë•Œ **DI Container**ë¥¼ ì‚¬ìš©í•œë‹¤. DI ContainerëŠ” **ì˜ì¡´ì„±ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬í•˜ê³ , í•„ìš”í•  ë•Œ ì£¼ì…**í•´ì¤€ë‹¤.

ë§ˆì¹˜ ê³µì¥ì—ì„œ ì œí’ˆì„ ë§Œë“¤ ë•Œ í•„ìš”í•œ ë¶€í’ˆì„ ë¯¸ë¦¬ ì¤€ë¹„í•´ë‘ëŠ” ê²ƒê³¼ ê°™ë‹¤.

```ts
// di/DIContainer.ts
import { HttpClient } from "@/infrastructure/http/HttpClient";
import { PaymentGatewayDataSource } from "@/infrastructure/datasources/paymentGatewayDataSource";
import { UserDataSource } from "@/infrastructure/datasources/userDataSource";
import { PaymentGatewayRepositoryImpl } from "@/infrastructure/repositories/PaymentGatewayRepositoryImpl";
import { UserRepositoryImpl } from "@/infrastructure/repositories/UserRepositoryImpl";
import { ProcessPaymentUseCase } from "@/application/use-cases/ProcessPaymentUseCase";
import { ProcessRefundUseCase } from "@/application/use-cases/ProcessRefundUseCase";
import type { PaymentGatewayRepository } from "@/domain/repositories/PaymentGatewayRepository";
import type { UserRepository } from "@/domain/repositories/UserRepository";

class DIContainer {
  private static _httpClient: HttpClient;
  private static _paymentGatewayDataSource: PaymentGatewayDataSource;
  private static _userDataSource: UserDataSource;
  private static _paymentGatewayRepository: PaymentGatewayRepository;
  private static _userRepository: UserRepository;

  static get httpClient() {
    return (this._httpClient ??= new AxiosHttpClient({
      baseURL: import.meta.env.VITE_API_URL,
      timeout: 10_000,
    }));
  }

  static get paymentGatewayDataSource() {
    return (this._paymentGatewayDataSource ??= new PaymentGatewayDataSource(
      this.httpClient
    ));
  }

  static get userDataSource() {
    return (this._userDataSource ??= new UserDataSource(this.httpClient));
  }

  static get paymentGatewayRepository() {
    return (this._paymentGatewayRepository ??= new PaymentGatewayRepositoryImpl(
      this.paymentGatewayDataSource
    ));
  }

  static get userRepository() {
    return (this._userRepository ??= new UserRepositoryImpl(
      this.userDataSource
    ));
  }

  // Use Cases (ë§¤ë²ˆ ìƒˆë¡œ ìƒì„±)
  static get processPaymentUseCase() {
    return new ProcessPaymentUseCase(
      this.paymentGatewayRepository,
      this.userRepository
    );
  }

  static get processRefundUseCase() {
    return new ProcessRefundUseCase(
      this.paymentGatewayRepository,
      this.userRepository
    );
  }

  // í…ŒìŠ¤íŠ¸ìš©
  static setMockRepositories(pgRepo, userRepo) {
    this._paymentGatewayRepository = pgRepo;
    this._userRepository = userRepo;
  }
}

export default DIContainer;
```

**ì „ëµ**: `HttpClient`, `DataSource`, `Repository`ëŠ” ì‹±ê¸€í†¤ (`??=`), `UseCase`ëŠ” ë§¤ë²ˆ ìƒˆë¡œ ìƒì„±, í…ŒìŠ¤íŠ¸ ì‹œ Mock ì£¼ì… ê°€ëŠ¥.

### DI ë¼ì´ë¸ŒëŸ¬ë¦¬ í™œìš©í•˜ê¸°

ìœ„ ë°©ì‹ì€ ì´ˆê¸° í”„ë¡œì íŠ¸ì— ì í•©í•˜ë‹¤. í•˜ì§€ë§Œ í”„ë¡œì íŠ¸ê°€ ì»¤ì§€ë©´ DIContainer íŒŒì¼ì´ ë¹„ëŒ€í•´ì§€ê³  ê´€ë¦¬ê°€ ì–´ë ¤ì›Œì§„ë‹¤.

ì„œë²„ í”„ë ˆì„ì›Œí¬(NestJS, Spring)ë‚˜ ëª¨ë°”ì¼ í”„ë ˆì„ì›Œí¬(Flutter, Swift, Android)ëŠ” ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ DI ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì ê·¹ í™œìš©í•œë‹¤. í”„ë¡ íŠ¸ì—”ë“œì—ì„œë„ ë§ˆì°¬ê°€ì§€ë¡œ DI ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë„ì…í•˜ë©´ ì˜ì¡´ì„± ê´€ë¦¬ê°€ í›¨ì”¬ ì‰¬ì›Œì§„ë‹¤.

**ëŒ€í‘œì ì¸ DI ë¼ì´ë¸ŒëŸ¬ë¦¬** (2025ë…„ 11ì›” ê¸°ì¤€):

- **[Awilix](https://github.com/jeffijoe/awilix)** - ê°„ë‹¨í•˜ê³  ì§ê´€ì ì¸ IoC ì»¨í…Œì´ë„ˆ (11.3k stars)
- **[InversifyJS](https://github.com/inversify/InversifyJS)** - ë°ì½”ë ˆì´í„° ê¸°ë°˜ DI (11.2k stars)
- **[TypeDI](https://github.com/typestack/typedi)** - ì‹¬í”Œí•˜ê³  ê°•ë ¥í•œ DI (4.3k stars)
- **[TSyringe](https://github.com/microsoft/tsyringe)** - Microsoftì˜ ê²½ëŸ‰ DI (5.3k stars)

ì´ ì¤‘ Awilixë¥¼ ì‚¬ìš©í•œ ì˜ˆì‹œë¥¼ ì‚´í´ë³´ì.

#### Before: ìˆ˜ë™ DI Container

```ts
// di/DIContainer.ts
class DIContainer {
  private static _httpClient?: HttpClient;
  private static _paymentGatewayDataSource?: PaymentGatewayDataSource;
  private static _paymentGatewayRepository?: PaymentGatewayRepository;

  static get httpClient() {
    return (this._httpClient ??= new AxiosHttpClient());
  }

  static get paymentGatewayDataSource() {
    return (this._paymentGatewayDataSource ??= new PaymentGatewayDataSourceImpl(
      this.httpClient
    ));
  }

  static get paymentGatewayRepository() {
    return (this._paymentGatewayRepository ??= new PaymentGatewayRepositoryImpl(
      this.paymentGatewayDataSource
    ));
  }

  static get processPaymentUseCase() {
    return new ProcessPaymentUseCase(
      this.paymentGatewayRepository,
      this.userRepository
    );
  }

  // ì˜ì¡´ì„±ì´ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ì½”ë“œê°€ ê¸¸ì–´ì§„ë‹¤...
}
```

**ë¬¸ì œì **:

- ì˜ì¡´ì„±ì´ ì¶”ê°€ë  ë•Œë§ˆë‹¤ getter ë©”ì„œë“œë¥¼ ì§ì ‘ ì‘ì„±í•´ì•¼ í•œë‹¤
- ìƒëª…ì£¼ê¸° ê´€ë¦¬(ì‹±ê¸€í†¤, ë§¤ë²ˆ ìƒì„±)ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•œë‹¤
- í…ŒìŠ¤íŠ¸ ì‹œ Mock êµì²´ê°€ ë²ˆê±°ë¡­ë‹¤

#### After: Awilix ì‚¬ìš©

```ts
// di/container.ts
import { createContainer, asClass, InjectionMode } from "awilix";

export const container = createContainer({
  injectionMode: InjectionMode.PROXY,
});

// ì˜ì¡´ì„± ë“±ë¡ (ì‹±ê¸€í†¤)
container.register({
  // Infrastructure
  httpClient: asClass(AxiosHttpClient).singleton(),

  // DataSource
  paymentGatewayDataSource: asClass(PaymentGatewayDataSource).singleton(),
  userDataSource: asClass(UserDataSource).singleton(),

  // Repository
  paymentGatewayRepository: asClass(PaymentGatewayRepositoryImpl).singleton(),
  userRepository: asClass(UserRepositoryImpl).singleton(),

  // Use Case (ë§¤ë²ˆ ìƒˆë¡œ ìƒì„±)
  processPaymentUseCase: asClass(ProcessPaymentUseCase).transient(),
  processRefundUseCase: asClass(ProcessRefundUseCase).transient(),
});

// ì‚¬ìš©
const useCase = container.cradle.processPaymentUseCase;
```

**ê°œì„ ì **:

- âœ… **ì„ ì–¸ì  ë“±ë¡**: `asClass().singleton()`ìœ¼ë¡œ ìƒëª…ì£¼ê¸°ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ê´€ë¦¬
- âœ… **ìë™ ì£¼ì…**: ìƒì„±ì íŒŒë¼ë¯¸í„° ì´ë¦„ìœ¼ë¡œ ìë™ ì˜ì¡´ì„± í•´ê²°
- âœ… **í…ŒìŠ¤íŠ¸ ìš©ì´ì„±**: Mock êµì²´ê°€ ê°„ë‹¨í•´ì§„ë‹¤

#### í…ŒìŠ¤íŠ¸ ì‹œ Mock êµì²´

```ts
// presentation/hooks/useProcessPayment.test.ts
import { container } from "@/di/container";

describe("useProcessPayment", () => {
  beforeEach(() => {
    // Mock Repositoryë¡œ êµì²´
    container.register({
      paymentGatewayRepository: asValue(mockPaymentGatewayRepository),
      userRepository: asValue(mockUserRepository),
    });
  });

  afterEach(() => {
    container.dispose(); // í…ŒìŠ¤íŠ¸ í›„ ì •ë¦¬
  });

  it("ê²°ì œ í”„ë¡œì„¸ìŠ¤ê°€ ì •ìƒ ë™ì‘í•œë‹¤", async () => {
    const { result } = renderHook(() => useProcessPayment());
    // ... í…ŒìŠ¤íŠ¸ ë¡œì§
  });
});
```

**í…ŒìŠ¤íŠ¸ ê°œì„ ì **:

- Mock êµì²´: `container.register()`ë¡œ ê°„ë‹¨í•˜ê²Œ êµì²´
- í…ŒìŠ¤íŠ¸ ê²©ë¦¬: `container.dispose()`ë¡œ ê° í…ŒìŠ¤íŠ¸ ë…ë¦½ì„± ë³´ì¥
- ì„¤ì • ì¬ì‚¬ìš©: ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ì—ì„œ ë™ì¼í•œ Mock ì„¤ì • ê³µìœ  ê°€ëŠ¥

í”„ë¡œì íŠ¸ ê·œëª¨ê°€ ì»¤ì§€ê³  ì˜ì¡´ì„± ê´€ë¦¬ê°€ ë³µì¡í•´ì§„ë‹¤ë©´, DI ë¼ì´ë¸ŒëŸ¬ë¦¬ ë„ì…ì„ ê³ ë ¤í•´ë³´ì.

### ì™œ ì‹±ê¸€í†¤ì¸ê°€? ë©”ëª¨ë¦¬ ë‚­ë¹„ ë°©ì§€

DI Container ì—†ì´ ë§¤ë²ˆ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

```ts
// âŒ ì•ˆí‹°íŒ¨í„´: ì»´í¬ë„ŒíŠ¸ë§ˆë‹¤ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
function useProcessPayment() {
  const httpClient = new AxiosHttpClient({ ... });  // ì¸ìŠ¤í„´ìŠ¤ 1
  const dataSource = new PaymentDataSource(httpClient);
  const repository = new PaymentRepositoryImpl(dataSource);
  const useCase = new ProcessPaymentUseCase(repository);
  // ...
}

function useProcessRefund() {
  const httpClient = new AxiosHttpClient({ ... });  // ì¸ìŠ¤í„´ìŠ¤ 2 (ì¤‘ë³µ!)
  const dataSource = new UserDataSource(httpClient);
  const repository = new UserRepositoryImpl(dataSource);
  const useCase = new ProcessRefundUseCase(repository);
  // ...
}

// ë¬¸ì œ: HttpClientê°€ ì»´í¬ë„ŒíŠ¸ë§ˆë‹¤ ìƒì„±ë¨
// - 10ê°œ ì»´í¬ë„ŒíŠ¸ â†’ HttpClient 10ê°œ
// - ë©”ëª¨ë¦¬ ë‚­ë¹„ + ì„¤ì • ë¶ˆì¼ì¹˜ ê°€ëŠ¥
```

DI ContainerëŠ” `??=` (Nullish coalescing assignment)ë¡œ **ì‹±ê¸€í†¤**ì„ êµ¬í˜„í•œë‹¤:

```ts
// âœ… DI Container: ì‹±ê¸€í†¤ìœ¼ë¡œ 1ë²ˆë§Œ ìƒì„±
static get httpClient() {
  return (this._httpClient ??= new AxiosHttpClient({ ... }));
  // _httpClientê°€ ì—†ìœ¼ë©´ ìƒì„±, ìˆìœ¼ë©´ ê¸°ì¡´ ê²ƒ ì¬ì‚¬ìš©
}
```

**ì´ì **:

- **ë©”ëª¨ë¦¬ íš¨ìœ¨**: `HttpClient` 1ê°œë§Œ ìƒì„±, ëª¨ë“  ê³³ì—ì„œ ì¬ì‚¬ìš©
- **ì„¤ì • ì¼ê´€ì„±**: `baseURL`, `timeout` ë“± ì„¤ì •ì´ í•­ìƒ ë™ì¼
- **ì„±ëŠ¥**: ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë¹„ìš© ì ˆê°

ë§ˆì¹˜ ì‚¬ë¬´ì‹¤ì—ì„œ ë³µì‚¬ê¸° 1ëŒ€ë¥¼ ì—¬ëŸ¬ ì‚¬ëŒì´ ê³µìœ í•˜ëŠ” ê²ƒê³¼ ê°™ë‹¤. ê°ì ë³µì‚¬ê¸°ë¥¼ ì‚¬ëŠ” ê²ƒë³´ë‹¤ í›¨ì”¬ íš¨ìœ¨ì ì´ë‹¤.

---

## Presentation Layer: UIì™€ ìƒí˜¸ì‘ìš©

`Presentation` ë ˆì´ì–´ëŠ” ì‚¬ìš©ìì™€ ì§ì ‘ ìƒí˜¸ì‘ìš©í•œë‹¤. 2ê°€ì§€ë¡œ êµ¬ì„±ëœë‹¤:

1. `Hook`: `Application`ì˜ `Use Case`ë¥¼ í˜¸ì¶œ
2. `Component`: UIë¥¼ ë Œë”ë§

### Hook: Use Case í˜¸ì¶œ

```ts
// presentation/hooks/useProcessPayment.ts
import { useMutation } from "@tanstack/react-query";
import DIContainer from "@/di/DIContainer";
import type { ProcessPaymentDto, ProcessPaymentResult } from "@/application/use-cases/ProcessPaymentUseCase";

export function useProcessPayment() {
  return useMutation<ProcessPaymentResult, Error, ProcessPaymentDto>({
    mutationFn: async (dto: ProcessPaymentDto) => {
      // DI Containerì—ì„œ Use Caseë¥¼ ê°€ì ¸ì˜¨ë‹¤
      const processPaymentUseCase = DIContainer.processPaymentUseCase;
      return await processPaymentUseCase.execute(dto);
    },
  });
}
```

`useProcessPayment` Hookì€ `DI Container`ì—ì„œ `Use Case`ë¥¼ ê°€ì ¸ì˜¨ë‹¤. ì˜ì¡´ì„±ì„ ì™¸ë¶€ì—ì„œ ì£¼ì…ë°›ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, **ì¤‘ì•™ ì§‘ì¤‘ì‹ìœ¼ë¡œ ê´€ë¦¬**í•œë‹¤.

### Component: UI ë Œë”ë§

```ts
// presentation/components/PaymentButton.tsx
import { useProcessPayment } from "@/presentation/hooks/useProcessPayment";

interface PaymentButtonProps {
  paymentGatewayId: number;
  userId: number;
  paymentAmount: number;
}

export function PaymentButton({
  paymentGatewayId,
  userId,
  paymentAmount,
}: PaymentButtonProps) {
  const { mutate, isPending, error } = useProcessPayment();

  const handleClick = () => {
    // DTO ê°ì²´ë¥¼ ìƒì„±í•´ì„œ Use Caseì— ì „ë‹¬
    mutate(
      {
        userId,
        paymentGatewayId,
        amount: paymentAmount,
      },
      {
        onSuccess: (result) => {
          alert(`${result.message} (ì”ì•¡: ${result.updatedBalance}ì›)`);
        },
      }
    );
  };

  return (
    <div>
      <button onClick={handleClick} disabled={isPending}>
        {isPending ? "ê²°ì œ ì¤‘..." : "ê²°ì œí•˜ê¸°"}
      </button>
      {error && <p style={{ color: "red" }}>{error.message}</p>}
    </div>
  );
}
```

`PaymentButton` ì»´í¬ë„ŒíŠ¸ëŠ” **UIë§Œ** ë‹´ë‹¹í•œë‹¤. DTOë¥¼ ìƒì„±í•´ì„œ Hookì— ì „ë‹¬í•˜ê³ , ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ `Use Case`ì— ìœ„ì„í•œë‹¤. `Use Case`ëŠ” `DI Container`ê°€ ì œê³µí•œë‹¤.

### ì˜ì¡´ì„± ì£¼ì…

"ì–´? `UseCase`ë¥¼ ì–´ë””ì„œ ê°€ì ¸ì™”ì§€?"

ì•ì—ì„œ ë§Œë“  **DI Container**ì—ì„œ ê°€ì ¸ì˜¨ë‹¤! Hookì—ì„œ `DIContainer.processPaymentUseCase`ë¥¼ í˜¸ì¶œí•˜ë©´, ëª¨ë“  ì˜ì¡´ì„±ì´ ìë™ìœ¼ë¡œ ì£¼ì…ëœ `UseCase`ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.

**ì™œ DI Containerê°€ ì¤‘ìš”í• ê¹Œ?**

ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ì§ì ‘ ìƒì„±í•˜ë©´ **í…ŒìŠ¤íŠ¸ê°€ ë§¤ìš° ì–´ë µë‹¤**. í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ì‹¤ì œ `HttpClient`ë¥¼ ëª¨í‚¹í•˜ê±°ë‚˜, í…ŒìŠ¤íŠ¸ìš© ì„œë²„ë¥¼ ë„ì›Œì•¼ í•œë‹¤.

```ts
// âŒ ë‚˜ìœ ì˜ˆì‹œ: ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ìƒì„±
function PaymentButton({ paymentGatewayId, userId, paymentAmount }: Props) {
  // ì»´í¬ë„ŒíŠ¸ ì•ˆì—ì„œ ì§ì ‘ ìƒì„±
  const httpClient = new AxiosHttpClient();
  const paymentGatewayDataSource = new PaymentGatewayDataSource(httpClient);
  const userDataSource = new UserDataSource(httpClient);
  const paymentGatewayRepo = new PaymentGatewayRepositoryImpl(
    paymentGatewayDataSource
  );
  const userRepo = new UserRepositoryImpl(userDataSource);
  const useCase = new ProcessPaymentUseCase(paymentGatewayRepo, userRepo);

  const handleProcessPayment = async () => {
    await useCase.execute({ userId, paymentGatewayId, amount: paymentAmount });
  };
  // ...
}

// ë¬¸ì œì :
// 1. ì‹¤ì œ APIë¥¼ í˜¸ì¶œí•¨ (í…ŒìŠ¤íŠ¸ê°€ ëŠë¦¬ê³  ë¶ˆì•ˆì •)
// 2. Mockìœ¼ë¡œ ë°”ê¿€ ë°©ë²•ì´ ì—†ìŒ
// 3. ë„¤íŠ¸ì›Œí¬ ì—†ìœ¼ë©´ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨
```

DI Containerë¥¼ ì‚¬ìš©í•˜ë©´ **ì¤‘ì•™ ì§‘ì¤‘ì‹ìœ¼ë¡œ ì˜ì¡´ì„±ì„ ê´€ë¦¬**í•˜ê³ , **í…ŒìŠ¤íŠ¸ ì‹œ Mockìœ¼ë¡œ êµì²´**í•  ìˆ˜ ìˆë‹¤.

#### í…ŒìŠ¤íŠ¸ì—ì„œ Mock ì£¼ì…

```ts
// presentation/components/PaymentButton.test.tsx
import { test, expect, vi, beforeEach, afterEach } from "vitest";
import { render, fireEvent, screen } from "@testing-library/react";
import { PaymentButton } from "./PaymentButton";
import DIContainer from "@/di/DIContainer";
import type { ProcessPaymentUseCase } from "@/application/use-cases/ProcessPaymentUseCase";

// Mock Use Case ìƒì„±
const mockProcessPaymentUseCase: ProcessPaymentUseCase = {
  execute: vi.fn().mockResolvedValue({
    success: true,
    updatedBalance: 1_500, // ê²°ì œ í›„ ì”ì•¡
    message: "ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤",
  }),
} as any;

beforeEach(() => {
  // í…ŒìŠ¤íŠ¸ ì „ì— Mock Use Case ì£¼ì…
  vi.spyOn(DIContainer, "processPaymentUseCase", "get").mockReturnValue(
    mockProcessPaymentUseCase
  );
});

afterEach(() => {
  // í…ŒìŠ¤íŠ¸ í›„ DI Container ì´ˆê¸°í™”
  vi.clearAllMocks();
});

test("ê²°ì œ ë²„íŠ¼ í´ë¦­ ì‹œ Use Case í˜¸ì¶œ", async () => {
  render(
    <PaymentButton paymentGatewayId={1} userId={1} paymentAmount={500} />
  );

  fireEvent.click(screen.getByText("ê²°ì œí•˜ê¸°"));

  // Mock Use Caseê°€ ì˜¬ë°”ë¥¸ DTOë¡œ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ê²€ì¦
  await vi.waitFor(() => {
    expect(mockProcessPaymentUseCase.execute).toHaveBeenCalledWith({
      userId: 1,
      paymentGatewayId: 1,
      amount: 500,
    });
  });
});
```

DI Container ë•ë¶„ì— **ì‹¤ì œ APIë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šê³ ë„** ì»´í¬ë„ŒíŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤. `vi.spyOn`ìœ¼ë¡œ Use Case getterë¥¼ ëª¨í‚¹í•˜ë©´ í…ŒìŠ¤íŠ¸ê°€ ê°„ë‹¨í•´ì§„ë‹¤.

### Adapter: Entityë¥¼ UIì— ë§ê²Œ ê°€ê³µ (ì„ íƒ)

ëŒ€ë¶€ë¶„ì˜ ê²½ìš° Entityë¥¼ ê·¸ëŒ€ë¡œ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ë©´ ëœë‹¤. í•˜ì§€ë§Œ **ë³µì¡í•œ UI ë¡œì§**ì´ë‚˜ **ì—¬ëŸ¬ Entityë¥¼ ì¡°í•©**í•´ì•¼ í•  ë•ŒëŠ” `Adapter`ë¥¼ ì‚¬ìš©í•œë‹¤.

`Adapter`ëŠ” Entityë¥¼ UIì— ìµœì í™”ëœ í˜•íƒœë¡œ ë³€í™˜í•œë‹¤. ë§ˆì¹˜ ì½˜ì„¼íŠ¸ ì–´ëŒ‘í„°ì²˜ëŸ¼, Entity(220V)ë¥¼ UI(110V)ì— ë§ê²Œ ë³€í™˜í•˜ëŠ” ì—­í• ì´ë‹¤.

**Entity vs Adapter ì—­í•  êµ¬ë¶„**:

- **Entity**: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ê³¼ íŒë‹¨ (boolean ë°˜í™˜)
  ```ts
  user.canRefund(amount, minAmount); // â†’ true/false
  ```
- **Adapter**: UI í‘œí˜„ê³¼ í¬ë§·íŒ… (í…ìŠ¤íŠ¸, ìƒ‰ìƒ, ì¡°í•©)
  ```ts
  canProcessRefund: user.canRefund(...), // â†’ boolean
  minConversionMessage: "ìµœì†Œ 10,000ì› ì´ìƒ", // â†’ í…ìŠ¤íŠ¸
  displayBalance: "500P" // â†’ í¬ë§·íŒ…
  ```

AdapterëŠ” Mapperì™€ ë§ˆì°¬ê°€ì§€ë¡œ classê°€ ì•„ë‹Œ **ìˆœìˆ˜ í•¨ìˆ˜**ë¡œ êµ¬í˜„í•œë‹¤.

#### ê³µí†µ ìœ í‹¸ í•¨ìˆ˜: formatters.ts

ì—¬ëŸ¬ Adapterì—ì„œ ë°˜ë³µ ì‚¬ìš©ë˜ëŠ” í¬ë§·íŒ… ë¡œì§ì€ ê³µí†µ ìœ í‹¸ í•¨ìˆ˜ë¡œ ë¶„ë¦¬í•œë‹¤.

```ts
// presentation/utils/formatters.ts

/**
 * ê²°ì œ ê¸ˆì•¡ì„ í¬ë§·íŒ…
 * @example formatPayments(500) // "500P"
 */
export function formatPayments(payments: number): string {
  return `${payments.toLocaleString()}P`;
}

/**
 * ë‚ ì§œë¥¼ í•œêµ­ í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…
 * @example formatDate(new Date()) // "2025-01-08"
 */
export function formatDate(date: Date): string {
  return date.toLocaleDateString("ko-KR");
}

/**
 * ë‚ ì§œì‹œê°„ì„ í•œêµ­ í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…
 * @example formatDateTime(new Date()) // "2025-01-08 15:30"
 */
export function formatDateTime(date: Date): string {
  return date.toLocaleString("ko-KR", {
    year: "numeric",
    month: "2-digit",
    day: "2-digit",
    hour: "2-digit",
    minute: "2-digit",
  });
}
```

#### ì–¸ì œ Adapterë¥¼ ì“¸ê¹Œ?

ë‹¤ìŒê³¼ ê°™ì€ ê²½ìš°ì—ë§Œ `Adapter`ë¥¼ ì‚¬ìš©í•œë‹¤:

1. **ì—¬ëŸ¬ Entityë¥¼ ì¡°í•©**í•´ì•¼ í•  ë•Œ (User + PaymentGateway)
2. **ë³µì¡í•œ UI ë³€í™˜**ì´ í•„ìš”í•  ë•Œ (ìˆ«ì â†’ "500P", ë‚ ì§œ â†’ "2025-01-08")
3. **Entityë¥¼ ìˆœìˆ˜í•˜ê²Œ ìœ ì§€**í•˜ê³  ì‹¶ì„ ë•Œ (UI ë¡œì§ì„ Entityì— ë„£ì§€ ì•Šê¸°)

#### Adapterì˜ 3ê°€ì§€ í•µì‹¬ ì¥ì 

##### 1. UI ë¡œì§ ê²©ë¦¬

EntityëŠ” **ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™**ë§Œ ë‹´ë‹¹í•˜ê³ , UI í‘œí˜„ ë¡œì§ì€ `Adapter`ê°€ ë‹´ë‹¹í•œë‹¤.

```ts
// âŒ Entityì— UI ë¡œì§ì„ ë„£ìœ¼ë©´?
class User {
  getDisplayPayments(): string {
    return `${this.paymentBalance.toLocaleString()}P`; // UI ë¡œì§ì´ Entityì—!
  }

  getDisplayWallet(): string {
    return `${this.walletBalance.toLocaleString()}ì›`; // UI ë¡œì§ì´ Entityì—!
  }
}

// âœ… Adapter í•¨ìˆ˜ë¡œ ë¶„ë¦¬
export function adaptUserForView(user: User) {
  return {
    displayPaymentBalance: formatPayments(user.paymentBalance), // UI ë¡œì§ì€ Adapterì—
    displayWalletBalance: formatCurrency(user.walletBalance),
  };
}
```

ì´ë ‡ê²Œ ë¶„ë¦¬í•˜ë©´ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë™ì¼í•œ Adapter í•¨ìˆ˜ë¥¼ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

##### 2. Entity ìˆœìˆ˜ì„± ìœ ì§€

EntityëŠ” UIë¥¼ ì „í˜€ ëª¨ë¥¸ë‹¤. ë•ë¶„ì— **ì„œë²„ì™€ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë™ì¼í•œ Entity**ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```ts
// domain/entities/User.ts (í”„ë¡ íŠ¸ì—”ë“œ - ë¶ˆë³€ íŒ¨í„´)
export class User {
  private readonly _paymentBalance: number; // ë¶ˆë³€
  private readonly _walletBalance: number; // ë¶ˆë³€

  // âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ë§Œ ë‹´ë‹¹ (ê²€ì¦ ë¡œì§)
  canRefund(amount: number, minRefundAmount: number): boolean {
    return this._paymentBalance >= amount && amount >= minRefundAmount;
  }

  canUseWallet(amount: number): boolean {
    return this._walletBalance >= amount;
  }

  // âŒ ìƒíƒœ ë³€ê²½ ë©”ì„œë“œëŠ” ì—†ìŒ (ì„œë²„ê°€ ìƒíƒœ ë³€ê²½)
  // processRefundToBalance() ê°™ì€ ë©”ì„œë“œ ì—†ìŒ
}
```

##### 3. í…ŒìŠ¤íŠ¸ ìš©ì´ì„±

AdapterëŠ” **ìˆœìˆ˜ í•¨ìˆ˜**ë¼ì„œ í…ŒìŠ¤íŠ¸ê°€ ì‰½ë‹¤. ê°™ì€ ì…ë ¥ì„ ë„£ìœ¼ë©´ í•­ìƒ ê°™ì€ ê²°ê³¼ê°€ ë‚˜ì˜¤ê³ , ì™¸ë¶€ ìƒíƒœë¥¼ ë³€ê²½í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤.

```ts
import { test, expect } from "vitest";
import { adaptUserForView } from "@/presentation/adapters/userAdapter";

test("userAdapterëŠ” ê²°ì œ ê¸ˆì•¡ê³¼ ì§€ê°‘ ì”ì•¡ì„ í¬ë§·íŒ…í•œë‹¤", () => {
  const user = new User({
    id: 1,
    name: "ê¹€ì‚¬ìš©ì",
    gatewayId: 1,
    paymentBalance: 5_000,
    walletBalance: 10_000,
    createdAt: new Date(),
    updatedAt: new Date(),
  });

  const view = adaptUserForView(user, paymentGateway, 5_000);

  expect(view.displayPaymentBalance).toBe("5,000P");
  expect(view.displayWalletBalance).toBe("10,000ì›");
});
```

#### ì˜ˆì‹œ 1: ë³µì¡í•œ UI ë³€í™˜ - userAdapter

ì‚¬ìš©ì ì •ë³´ë¥¼ UIì— ë§ê²Œ ê°€ê³µí•˜ëŠ” Adapter í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ë³´ì.

```ts
// presentation/adapters/userAdapter.ts
import type { User } from "@/domain/entities/User";
import type { PaymentGateway } from "@/domain/entities/PaymentGateway";
import {
  formatCurrency,
  formatPayments,
  formatDate,
} from "@/presentation/utils/formatters";

interface UserView {
  userId: number;
  userName: string;
  paymentGatewayName: string;
  displayPaymentBalance: string; // "5,000P"
  displayWalletBalance: string; // "10,000ì›"
  canProcessRefund: boolean;
  minConversionMessage: string; // "ìµœì†Œ 5,000ì›ë¶€í„° ì „í™˜ ê°€ëŠ¥"
  lastUpdated: string; // "2025-01-08"
}

export function adaptUserForView(
  user: User,
  paymentGateway: PaymentGateway,
  minConversionAmount: number
): UserView {
  return {
    userId: user.id,
    userName: user.name,
    paymentGatewayName: paymentGateway.name,
    displayPaymentBalance: formatPayments(user.paymentBalance),
    displayWalletBalance: formatCurrency(user.walletBalance),
    canProcessRefund: user.canRefund(user.paymentBalance, minConversionAmount),
    minConversionMessage: getConversionMessage(minConversionAmount),
    lastUpdated: formatDate(user.updatedAt),
  };
}

function getConversionMessage(minAmount: number): string {
  return `ìµœì†Œ ${formatCurrency(minAmount)}ë¶€í„° ì „í™˜ ê°€ëŠ¥`;
}
```

#### ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ê¸°

ì»´í¬ë„ŒíŠ¸ëŠ” Adapterë¡œ ë³€í™˜ëœ ë°ì´í„°ë¥¼ ì‚¬ìš©í•œë‹¤.

```ts
// presentation/components/UserCard.tsx
export function UserCard({ user, paymentGateway, minConversionAmount }: Props) {
  const view = adaptUserForView(user, paymentGateway, minConversionAmount);

  return (
    <div className="user-card">
      <h3>{view.userName}</h3>
      <p className="payments">{view.displayPaymentBalance}</p>
      <p className="wallet">{view.displayWalletBalance}</p>
    </div>
  );
}
```

#### Adapterë¥¼ ì“°ì§€ ì•ŠëŠ” ê²½ìš°

ë‹¨ìˆœí•œ ê²½ìš°ì—ëŠ” Entityë¥¼ ê·¸ëŒ€ë¡œ ì“´ë‹¤.

```ts
// presentation/components/SimpleRefundButton.tsx
import type { User } from "@/domain/entities/User";

interface Props {
  user: User;
  minConversionAmount: number;
}

export function SimpleRefundButton({ user, minConversionAmount }: Props) {
  // Adapter ì—†ì´ Entity ì§ì ‘ ì‚¬ìš© (ê°„ë‹¨í•  ë•Œ)
  return (
    <button
      disabled={!user.canRefund(user.paymentBalance, minConversionAmount)}
    >
      {user.paymentBalance}P í™˜ë¶ˆí•˜ê¸°
    </button>
  );
}
```

---

## ì „ì²´ ê²°ì œ ì²˜ë¦¬ Flow: ëª¨ë“  ë ˆì´ì–´ í†µê³¼í•˜ê¸°

ì´ì œ ê´€ë¦¬ìê°€ "ê²°ì œ ì²˜ë¦¬" ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ **ëª¨ë“  ë ˆì´ì–´**ë¥¼ ì–´ë–»ê²Œ í†µê³¼í•˜ëŠ”ì§€ ì‚´í´ë³´ì.

### 1. ê´€ë¦¬ìê°€ ë²„íŠ¼ í´ë¦­

```ts
// Presentation Layer: Component
<button onClick={handleClick}>ê²°ì œ ì²˜ë¦¬</button>
```

### 2. Hookì´ Use Case í˜¸ì¶œ

```ts
// Presentation Layer: Hook
const result = await processPaymentUseCase.execute({
  userId,
  paymentGatewayId: gatewayId,
  amount: paymentAmount,
});
```

### 3. Use Caseê°€ ë¹„ì¦ˆë‹ˆìŠ¤ í”Œë¡œìš° ì‹¤í–‰

```ts
// Application Layer: Use Case
const user = await this.userRepository.getUser(dto.userId);
const paymentGateway = await this.paymentGatewayRepository.getPaymentGateway(
  dto.paymentGatewayId
);

// Domain Entityì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦
const paymentAmount = new Money(dto.amount);
if (!user.canMakePayment(paymentAmount)) {
  return { success: false, message: "ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤" };
}
if (!paymentGateway.canProcessPayment(paymentAmount)) {
  return { success: false, message: "ê²°ì œ ëŒ€í–‰ì‚¬ ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤" };
}

// Repositoryë¥¼ í†µí•´ ê²°ì œ ì²˜ë¦¬
const updatedUser = await this.paymentGatewayRepository.processPayment(
  dto.paymentGatewayId,
  dto.userId,
  dto.amount
);
```

### 4. Repositoryê°€ DataSource í˜¸ì¶œ

```ts
// Infrastructure Layer: Repository
const userDto = await this.paymentGatewayDataSource.processPayment(
  paymentGatewayId,
  userId,
  amount
);
return mapUserDtoToDomain(userDto); // DTO â†’ Entity ë³€í™˜
```

### 5. DataSourceê°€ API í˜¸ì¶œ

```ts
// Infrastructure Layer: DataSource
return this.httpClient.post<UserDto>("/api/payments/process", {
  payment_gateway_id: paymentGatewayId,
  user_id: userId,
  payment_amount: amount,
});
```

### 6. HTTP Clientê°€ ì‹¤ì œ ìš”ì²­

```ts
// Infrastructure Layer: HTTP Client
const response = await axios.post(url, data);
return response.data;
```

### 7. ì‘ë‹µì´ ë‹¤ì‹œ ì—­ìˆœìœ¼ë¡œ ëŒì•„ì˜´

```
Core (HTTP Client) â†’ Infrastructure (DataSource) â†’ Infrastructure (Repository + Mapper) â†’ Application (Use Case) â†’ Presentation
```

```ts
// Infrastructure Layer: Mapper í•¨ìˆ˜
const user = mapUserDtoToDomain(userDto);
```

### 8. ê²°ê³¼ê°€ ì»´í¬ë„ŒíŠ¸ë¡œ ì „ë‹¬

```ts
// Application Layer: Use Case Result
return {
  success: true,
  updatedBalance: updatedUser.paymentBalance,
  message: "ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤",
};

// Presentation Layer: Component
alert(`${result.message} (ì”ì•¡: ${result.updatedBalance}ì›)`);
```

### ì „ì²´ Flow ìš”ì•½

```
ğŸ‘¤ ê´€ë¦¬ì ë²„íŠ¼ í´ë¦­
  â†“
ğŸ¨ Presentation: Hook â†’ Use Case í˜¸ì¶œ (DTO ì „ë‹¬)
  â†“
ğŸ”„ Application: Use Case â†’ Repositoryë¡œ Entity ì¡°íšŒ
  â†“
ğŸ§  Domain: Entityì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦
  â†“
ğŸ”„ Application: Repositoryë¥¼ í†µí•´ ê²°ì œ ì²˜ë¦¬ ìš”ì²­
  â†“
ğŸ“¦ Infrastructure: Repository â†’ DataSource í˜¸ì¶œ
  â†“
ğŸŒ Core: HTTP Client â†’ API ìš”ì²­
  â†“
ğŸŒ Core: ì‘ë‹µ ë°›ìŒ (DTO)
  â†“
ğŸ“¦ Infrastructure: Mapper í•¨ìˆ˜ â†’ DTOë¥¼ Entityë¡œ ë³€í™˜
  â†“
ğŸ“¦ Infrastructure: Entityë¥¼ Repositoryê°€ ë°˜í™˜
  â†“
ğŸ”„ Application: Use Case â†’ ê²°ê³¼ë¥¼ DTOë¡œ ë³€í™˜í•´ì„œ ë°˜í™˜
  â†“
ğŸ¨ Presentation: UI ì—…ë°ì´íŠ¸
```

---

## ìœ ì§€ë³´ìˆ˜ê°€ ì‰¬ìš´ ì´ìœ : ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤

í´ë¦° ì•„í‚¤í…ì²˜ì˜ ì§„ì§œ ê°•ì ì€ **ë³€ê²½ì— ê°•í•˜ë‹¤**ëŠ” ì ì´ë‹¤. ì‹¤ì œ ìƒí™©ì„ ì‚´í´ë³´ì.

### ì‹œë‚˜ë¦¬ì˜¤ 1: ê¸°íšì - "ê²°ì œ ì²˜ë¦¬ í›„ ì„±ê³µ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì£¼ì„¸ìš”"

#### Before (í´ë¦° ì•„í‚¤í…ì²˜ ì—†ì„ ë•Œ)

```js
// âŒ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¾ì•„ì„œ ê°ê° ìˆ˜ì •í•´ì•¼ í•¨
// components/ProcessPaymentButton.jsx
const handleClick = async () => {
  const response = await axios.post("/api/process-payment", data);
  toast.success("ê²°ì œë¥¼ ì²˜ë¦¬í–ˆë‹¤"); // â† ì¶”ê°€
};

// components/QuickPaymentButton.jsx
const handleQuickPayment = async () => {
  const response = await axios.post("/api/quick-payment", data);
  toast.success("ë¹ ë¥¸ ê²°ì œë¥¼ ì²˜ë¦¬í–ˆë‹¤"); // â† ì¶”ê°€
};

// components/RecurringPaymentButton.jsx
const handleRecurring = async () => {
  const response = await axios.post("/api/recurring-payment", data);
  toast.success("ì •ê¸° ê²°ì œë¥¼ ì²˜ë¦¬í–ˆë‹¤"); // â† ì¶”ê°€
};
```

#### After (í´ë¦° ì•„í‚¤í…ì²˜)

```ts
// âœ… Hook 1ê°œë§Œ ìˆ˜ì •í•˜ë©´ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì— ì ìš©ë¨
// presentation/hooks/useProcessPayment.ts
export function useProcessPayment() {
  return useMutation<ProcessPaymentResult, Error, ProcessPaymentDto>({
    mutationFn: async (dto: ProcessPaymentDto) => {
      const processPaymentUseCase = DIContainer.processPaymentUseCase;
      return await processPaymentUseCase.execute(dto);
    },
+   onSuccess: () => {
+     toast.success("ê²°ì œë¥¼ ì²˜ë¦¬í–ˆë‹¤");
+   },
  });
}
```

**ë³€ê²½ ë²”ìœ„**: Hook 1ê°œ íŒŒì¼ (ëª¨ë“  ê²°ì œ ì²˜ë¦¬ ë²„íŠ¼ì— ìë™ ì ìš©)

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì„œë²„ - "API ì‘ë‹µ êµ¬ì¡°ê°€ ë°”ë€Œì—ˆì–´ìš”"

ì„œë²„ê°€ `transaction_id` ëŒ€ì‹  `id`ë¥¼ ë³´ë‚´ê¸° ì‹œì‘í–ˆë‹¤.

#### Before (í´ë¦° ì•„í‚¤í…ì²˜ ì—†ì„ ë•Œ)

```js
// âŒ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ìˆ˜ì •í•´ì•¼ í•¨
// components/ProcessPaymentButton.jsx
const transactionId = response.data.transaction_id; // â† ì—¬ê¸°
alert(`ê²°ì œ ì²˜ë¦¬ ì™„ë£Œ! ID: ${transactionId}`);

// components/PaymentHistory.jsx
const id = item.transaction_id; // â† ì—¬ê¸°ë„

// components/TransactionDetail.jsx
const transactionId = transaction.transaction_id; // â† ì—¬ê¸°ë„
```

#### After (í´ë¦° ì•„í‚¤í…ì²˜)

```diff
// âœ… Infrastructure Layerì˜ Mapper í•¨ìˆ˜ë§Œ ìˆ˜ì •
// infrastructure/mappers/paymentTransactionMapper.ts
  export function mapPaymentTransactionDtoToDomain(dto: PaymentTransactionDto): PaymentTransaction {
    return new PaymentTransaction({
-     id: dto.transaction_id,
+     id: dto.id,
      gatewayId: dto.gateway_id,
      userId: dto.user_id,
      amount: dto.amount,
      // ...
    });
  }
```

**ë³€ê²½ ë²”ìœ„**: Infrastructure Layerì˜ Mapper í•¨ìˆ˜ 1ê°œ íŒŒì¼

ë‚˜ë¨¸ì§€ ì½”ë“œëŠ” `PaymentTransaction` Entityì˜ `id` ì†ì„±ë§Œ ì“°ë¯€ë¡œ **ì•„ë¬´ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ”ë‹¤**.

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: ê¸°íšì - "í™˜ë¶ˆ ìµœì†Œ ê¸ˆì•¡ì„ 5,000ì›ì—ì„œ 10,000ì›ìœ¼ë¡œ ë°”ê¿”ì£¼ì„¸ìš”"

#### Before (í´ë¦° ì•„í‚¤í…ì²˜ ì—†ì„ ë•Œ)

```js
// âŒ ì»´í¬ë„ŒíŠ¸ ê³³ê³³ì˜ ifë¬¸ì„ ì°¾ì•„ì„œ ìˆ˜ì •
// components/RefundButton.jsx
if (amount < 5_000) {
  alert("ìµœì†Œ í™˜ë¶ˆ ê¸ˆì•¡ì€ 5,000ì›ì…ë‹ˆë‹¤");
}

// components/RefundForm.jsx
if (payment < 5_000) {
  return "ìµœì†Œ 5,000ì› ì´ìƒ";
}

// components/PaymentInput.jsx
<input min={5_000} />;
```

#### After (í´ë¦° ì•„í‚¤í…ì²˜)

```diff
// âœ… Domain Layerì˜ Entity 1ì¤„ë§Œ ìˆ˜ì •
// domain/entities/User.ts
- static readonly MIN_REFUND_AMOUNT = 5_000;
+ static readonly MIN_REFUND_AMOUNT = 10_000;
```

**ë³€ê²½ ë²”ìœ„**: Domain Layerì˜ Entity 1ì¤„

ëª¨ë“  ê³³ì—ì„œ `User.MIN_REFUND_AMOUNT`ë¥¼ ì°¸ì¡°í•˜ë¯€ë¡œ **ìë™ìœ¼ë¡œ ì ìš©**ëœë‹¤.

---

### ì‹œë‚˜ë¦¬ì˜¤ 4: ê°œë°œì - "í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ì‹¶ì–´ìš”"

#### Before (í´ë¦° ì•„í‚¤í…ì²˜ ì—†ì„ ë•Œ)

```js
// âŒ í…ŒìŠ¤íŠ¸ ë³µì¡í•¨ (API, ì„œë²„ ì‘ë‹µ í˜•ì‹, ì—”ë“œí¬ì¸íŠ¸ ë“± ëª¨ë‘ ëª¨í‚¹ í•„ìš”)
// import { test } from "vitest";
test("í™˜ë¶ˆ ë²„íŠ¼ í´ë¦­ ì‹œ í™˜ë¶ˆ", async () => {
  // axios ëª¨í‚¹ â†’ ì„œë²„ ì‘ë‹µ í˜•ì‹ â†’ snake_case ì²˜ë¦¬ â†’ ...
  // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ í…ŒìŠ¤íŠ¸í•˜ê³  ì‹¶ì€ë° API ì˜ì¡´ì„±ì´ ë„ˆë¬´ ë§ë‹¤
});
```

#### After (í´ë¦° ì•„í‚¤í…ì²˜)

```ts
// âœ… Domain Layer ë…ë¦½ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
import { test, expect } from "vitest";
import { User } from "@/domain/entities/User";

test("ìµœì†Œ í™˜ë¶ˆ ê¸ˆì•¡ ë¯¸ë§Œì´ë©´ í™˜ë¶ˆ ë¶ˆê°€", () => {
  const user = new User({
    id: 1,
    name: "ê¹€ì‚¬ìš©ì",
    gatewayId: 1,
    paymentBalance: 8_000,
    walletBalance: 0,
    createdAt: new Date(),
    updatedAt: new Date(),
  });

  expect(user.canRefund(8_000, 10_000)).toBe(false);
});
```

```ts
// âœ… Use Case í…ŒìŠ¤íŠ¸ (Repository ëª¨í‚¹)
test("ê²°ì œ ëŒ€í–‰ì‚¬ ì”ì•¡ ë¶€ì¡± ì‹œ ì‹¤íŒ¨", async () => {
  const mockPaymentGatewayRepository = {
    getPaymentGateway: vi.fn().mockResolvedValue(
      new PaymentGateway({
        id: 1,
        name: "í…ŒìŠ¤íŠ¸ê²°ì œëŒ€í–‰ì‚¬",
        walletBalance: 3_000,
        createdAt: new Date(),
        updatedAt: new Date(),
      })
    ),
    processPayment: vi.fn(),
  };
  const mockUserRepository = {
    getUser: vi.fn().mockResolvedValue(
      new User({
        id: 1,
        name: "ê¹€ì‚¬ìš©ì",
        gatewayId: 1,
        paymentBalance: 10_000,
        walletBalance: 0,
        createdAt: new Date(),
        updatedAt: new Date(),
      })
    ),
  };

  const useCase = new ProcessPaymentUseCase(
    mockPaymentGatewayRepository,
    mockUserRepository
  );

  const result = await useCase.execute({
    userId: 1,
    paymentGatewayId: 1,
    amount: 5_000,
  });

  expect(result.success).toBe(false);
  expect(result.message).toBe("ê²°ì œ ëŒ€í–‰ì‚¬ ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤");
});
```

**ë³€ê²½ ë²”ìœ„**: í…ŒìŠ¤íŠ¸ë§Œ ì¶”ê°€ (ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ë¶ˆí•„ìš”)

---

### ì‹œë‚˜ë¦¬ì˜¤ 5: ê¸°íšì - "ì˜ˆì¹˜ê¸ˆ ì¶©ì „ ê¸°ëŠ¥ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”"

ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì¶”ê°€í•  ë•Œ í´ë¦° ì•„í‚¤í…ì²˜ì˜ ì§„ê°€ê°€ ë“œëŸ¬ë‚œë‹¤.

#### Before (í´ë¦° ì•„í‚¤í…ì²˜ ì—†ì„ ë•Œ)

```js
// âŒ ì—¬ëŸ¬ ê³³ì„ ìˆ˜ì •í•´ì•¼ í•¨
// components/DepositButton.js
const handleDeposit = async () => {
  // ì¶©ì „ ë¡œì§ì„ ì²˜ìŒë¶€í„° ì‘ì„±
  if (depositAmount <= 0) {
    alert("ì¶©ì „ ê¸ˆì•¡ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤");
    return;
  }

  const response = await axios.post(`/api/payment-gateways/deposit`, {
    payment_gateway_id: gatewayId,
    amount: depositAmount,
  });
  // ...
};

// components/QuickDepositButton.jsx
// ë˜‘ê°™ì€ ì¶©ì „ ë¡œì§ ë³µì‚¬...

// components/WalletPage.jsx
// ë˜ ë˜‘ê°™ì€ ì¶©ì „ ë¡œì§ ë³µì‚¬...
```

#### After (í´ë¦° ì•„í‚¤í…ì²˜)

í´ë¦° ì•„í‚¤í…ì²˜ì—ì„œëŠ” **ê° ë ˆì´ì–´ì— í•„ìš”í•œ ë¶€ë¶„ë§Œ ì¶”ê°€**í•˜ë©´ ëœë‹¤.

```ts
// Application Layer: Use Case ì¶”ê°€
export interface DepositDto {
  paymentGatewayId: number;
  amount: number;
}

export interface DepositResult {
  success: boolean;
  updatedBalance: number;
  message: string;
}

export class DepositToGatewayUseCase {
  constructor(private paymentGatewayRepository: PaymentGatewayRepository) {}

  async execute(dto: DepositDto): Promise<DepositResult> {
    const gateway = await this.paymentGatewayRepository.getPaymentGateway(
      dto.paymentGatewayId
    );

    if (dto.amount <= 0 || dto.amount > 10_000_000) {
      return {
        success: false,
        updatedBalance: gateway.walletBalance,
        message: "ì¶©ì „ ê¸ˆì•¡ì€ 0ì›~1,000ë§Œì›ì´ì–´ì•¼ í•©ë‹ˆë‹¤",
      };
    }

    const updatedGateway = await this.paymentGatewayRepository.deposit(
      dto.paymentGatewayId,
      dto.amount
    );

    return {
      success: true,
      updatedBalance: updatedGateway.walletBalance,
      message: "ì¶©ì „ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤",
    };
  }
}

// Presentation Layer: Hook ì¶”ê°€
export function useDeposit() {
  return useMutation<DepositResult, Error, DepositDto>({
    mutationFn: (dto) => DIContainer.depositToGatewayUseCase.execute(dto),
    onSuccess: (result) => {
      if (result.success) {
        toast.success(result.message);
      }
    },
  });
}
```

**ë³€ê²½ ë²”ìœ„**: ê° ë ˆì´ì–´ì— 1ê°œ íŒŒì¼ì”© ì¶”ê°€ (ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ì—†ìŒ). ë¡œì§ì„ ë³µì‚¬í•˜ì§€ ì•Šê³  ì¬ì‚¬ìš©í•œë‹¤.

---

### ì‹œë‚˜ë¦¬ì˜¤ 6: ê°œë°œì - "ê²°ì œì™€ í™˜ë¶ˆì„ ë™ì‹œì— ëˆ„ë¥´ë©´ ìƒíƒœê°€ ê¼¬ì—¬ìš”"

ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œ ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œë‹¤. ì‚¬ìš©ìê°€ "ê²°ì œ" ë²„íŠ¼ì„ ëˆ„ë¥´ê³ , ì‘ë‹µì´ ì˜¤ê¸° ì „ì— "í™˜ë¶ˆ" ë²„íŠ¼ì„ ë˜ ëˆ„ë¥´ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

#### ë¬¸ì œ: í´ë¼ì´ì–¸íŠ¸ê°€ ìƒíƒœë¥¼ ì§ì ‘ ë³€ê²½í•˜ë©´ ë™ê¸°í™” ë¬¸ì œ ë°œìƒ

```ts
// âŒ Entityê°€ ì§ì ‘ ìƒíƒœë¥¼ ë³€ê²½ â†’ ì„œë²„ì™€ ë¶ˆì¼ì¹˜
user.receivePayment(5_000); // í´ë¼ì´ì–¸íŠ¸: 15,000
// ì„œë²„ ì‘ë‹µ (ìˆ˜ìˆ˜ë£Œ ì°¨ê°): 14,950 â†’ ìƒíƒœ ë¶ˆì¼ì¹˜!
```

#### í•´ê²°: EntityëŠ” readonly, ì„œë²„ê°€ ìƒíƒœ ê²°ì •

ì•ì„œ ì„¤ëª…í•œ ê²ƒì²˜ëŸ¼, EntityëŠ” ë¶ˆë³€(`readonly`)ìœ¼ë¡œ ë§Œë“¤ì–´ **ê²€ì¦ë§Œ ë‹´ë‹¹**í•˜ê³ , Tanstack Queryê°€ ì„œë²„ ì‘ë‹µìœ¼ë¡œ ìƒíƒœë¥¼ ê´€ë¦¬í•œë‹¤. ì´ë ‡ê²Œ í•˜ë©´ Entityì™€ ìºì‹œì˜ ë¶ˆì¼ì¹˜ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.

---

### ìœ ì§€ë³´ìˆ˜ ë¹„ìš© ë¹„êµ

| ë³€ê²½ ì‚¬í•­           | Before (ì•ˆí‹°íŒ¨í„´)                           | After (í´ë¦° ì•„í‚¤í…ì²˜)                      |
| ------------------- | ------------------------------------------- | ------------------------------------------ |
| ë²„íŠ¼ ìƒ‰ìƒ ë³€ê²½      | ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ ìˆ˜ì •                          | Presentation ë ˆì´ì–´ë§Œ                      |
| API ì‘ë‹µ í˜•ì‹ ë³€ê²½  | ì„œë²„ì—ì„œ ë³€ê²½ëœ í•„ë“œëª… ëª¨ë“  ì»´í¬ë„ŒíŠ¸ ìˆ˜ì •   | Infrastructure ë ˆì´ì–´(Mapper)ë§Œ            |
| ìµœì†Œ ê¸ˆì•¡ ê·œì¹™ ë³€ê²½ | ì»´í¬ë„ŒíŠ¸ë§ˆë‹¤ í•˜ë“œì½”ë”©ëœ ê²€ì¦ ë¡œì§ ìˆ˜ì •      | Domain ë ˆì´ì–´(Entity) ìƒìˆ˜ 1ì¤„             |
| í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±    | ì»´í¬ë„ŒíŠ¸ê°€ API/ì „ì—­ ìƒíƒœ ì˜ì¡´ìœ¼ë¡œ ëª¨í‚¹ ë³µì¡ | Application/Domain ë ˆì´ì–´ ìˆœìˆ˜ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ |
| í™˜ë¶ˆ ê¸°ëŠ¥ ì¶”ê°€      | ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì— ì¤‘ë³µ ë¡œì§ ë³µì‚¬              | Application ë ˆì´ì–´ì— Use Case ì¶”ê°€         |
| ìƒˆ ê²°ì œ ìˆ˜ë‹¨ ì¶”ê°€   | ì „ì²´ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë¶„ê¸° ì²˜ë¦¬ ì¶”ê°€            | Infrastructure ë ˆì´ì–´(DataSource)ë§Œ        |
| axios â†’ fetch ë³€ê²½  | ëª¨ë“  API í˜¸ì¶œ ì½”ë“œ ìˆ˜ì •                     | Core ë ˆì´ì–´(HttpClient)ë§Œ                  |

---

## ë„ì… í›„ ê¸°ëŒ€ íš¨ê³¼

ìš°ë¦¬ íŒ€ì€ ê¸°ì¡´ `Feature Based Architecture`ì—ì„œ `Domain Based Clean Architecture`ë¡œ ì „í™˜í–ˆë‹¤.

íŒ€ì›ë“¤ì—ê²Œ ìœ„ì—ì„œ ì„¤ëª…í•œ ì¥ì ë“¤ì„ ì •ë¦¬í•´ì„œ ì „ë‹¬í–ˆë‹¤: "ì„œë²„ í•„ë“œëª…ì´ ë°”ë€Œì–´ë„ `Mapper` 1ì¤„ë§Œ ê³ ì¹˜ë©´ ëœë‹¤", "ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ `Entity`ì— ëª¨ì—¬ ìˆì–´ í…ŒìŠ¤íŠ¸ê°€ ì‰½ë‹¤", "ë ˆì´ì–´ê°€ ëª…í™•í•´ AIê°€ ì •í™•í•œ ìœ„ì¹˜ì— ì½”ë“œë¥¼ ìƒì„±í•œë‹¤".

íŠ¹íˆ ìš°ë¦¬ ì„œë¹„ìŠ¤ëŠ” `Next.js` ê¸°ë°˜ì´ë¼ ì„œë²„ í™˜ê²½ê³¼ í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ì„ ëª¨ë‘ ê³ ë ¤í•´ì•¼ í–ˆëŠ”ë°, ë ˆì´ì–´ê°€ ëª…í™•í• ìˆ˜ë¡ ê°œì„ ê³¼ ë¦¬íŒ©í† ë§ì´ í›¨ì”¬ ìˆ˜ì›”í–ˆë‹¤.

ì‚¬ì‹¤ ì œì¼ ê±±ì •í–ˆë˜ ë¶€ë¶„ì€ ë‚´ê°€ ì´ ì•„í‚¤í…ì²˜ ë³€ê²½ì„ ì£¼ë„í•œ ë§Œí¼, ê¸°ì¡´ ì½”ë“œë² ì´ìŠ¤ ì „ì²´ë¥¼ ì „í™˜í•´ì•¼ í•œë‹¤ëŠ” ì±…ì„ê°ì´ì—ˆë‹¤. í•˜ì§€ë§Œ AI Promptë¥¼ í™œìš©í•´ ì „í™˜í–ˆë”ë‹ˆ **ìƒê° ì´ìƒìœ¼ë¡œ ë¹ ë¥´ê²Œ ì„±ê³µ**í–ˆë‹¤.

ì²˜ìŒì—” íŒ€ì›ë“¤ë„ "ì¡°ê¸ˆ ê³¼í•œ ì„¤ê³„ ì•„ë‹Œê°€?" ì‹¶ì–´í–ˆì§€ë§Œ, ë³€ê²½ì´ ì¦ì€ ìš°ë¦¬ ì„œë¹„ìŠ¤ í™˜ê²½(ê¸ˆìœµì‚¬ ì •ì±… ë³€ê²½, API ì‘ë‹µ í˜•ì‹ ë³€ê²½)ì„ ê³ ë ¤í•˜ë©´ ì™œ ì´ êµ¬ì¡°ê°€ í•„ìš”í•œì§€ ì„¤ëª…í–ˆë”ë‹ˆ ì´í•´í•˜ê¸° ì‹œì‘í–ˆë‹¤.

### ì½”ë“œ ë¦¬ë·°ê°€ ì˜¤íˆë ¤ ë” ì‰¬ì›Œì§ˆ ê²ƒì´ë‹¤

íŒŒì¼ ê°œìˆ˜ëŠ” 2~3ë°° ëŠ˜ì–´ë‚˜ì§€ë§Œ, ë ˆì´ì–´ê°€ ëª…í™•í•˜ê¸° ë•Œë¬¸ì— **í•„ìš”í•œ ë¶€ë¶„ë§Œ ì„ íƒì ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆë‹¤**. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë³€ê²½ì´ë¼ë©´ `Domain/Entity`ë§Œ ë³´ë©´ ë˜ê³ , API ë³€ê²½ì´ë¼ë©´ `Infrastructure/DataSource`ë§Œ ë³´ë©´ ëœë‹¤.

íŠ¹íˆ **í…ŒìŠ¤íŠ¸ ì½”ë“œ ìœ„ì£¼ë¡œ ë¦¬ë·°**í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•´ì§„ë‹¤. êµ¬ì¡°ê°€ í…ŒìŠ¤íŠ¸í•˜ê¸° ì¢‹ê²Œ ì„¤ê³„ë˜ì–´ ìˆë‹¤ ë³´ë‹ˆ, íŒ€ì›ë“¤ì´ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë” ë§ì´ ì‘ì„±í•˜ê²Œ ë˜ì—ˆë‹¤. ë¦¬ë·°ì–´ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë¨¼ì € ë³´ê³  "ì´ ì¼€ì´ìŠ¤ë„ ì¶”ê°€í•˜ë©´ ì¢‹ê² ì–´ìš”", "ì´ ì—£ì§€ ì¼€ì´ìŠ¤ëŠ” ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ë‚˜ìš”?" ê°™ì€ ë³¸ì§ˆì ì¸ ì§ˆë¬¸ì„ í•  ìˆ˜ ìˆë‹¤. ì½”ë“œ í’ˆì§ˆì´ ìì—°ìŠ¤ëŸ½ê²Œ ë†’ì•„ì§ˆ ê²ƒìœ¼ë¡œ ê¸°ëŒ€í•œë‹¤.

### AIê°€ ì •í™•í•œ ìœ„ì¹˜ì— ì½”ë“œë¥¼ ìƒì„±í•œë‹¤

ì•„í‚¤í…ì²˜ êµ¬ì¡°ë¥¼ í”„ë¡¬í”„íŠ¸ì— ëª…í™•íˆ ì‘ì„±í•´ë‘ë©´, AIê°€ **ì •í™•íˆ ì–´ëŠ ë ˆì´ì–´ì— ì–´ë–¤ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í•˜ëŠ”ì§€** ì´í•´í•œë‹¤.

<details>
<summary>ì „ì²´ AI í”„ë¡¬í”„íŠ¸ ì˜ˆì‹œ í¼ì³ë³´ê¸°</summary>

```
# CLEAN ARCHITECTURE RULES

## Core Layer (Shared Utilities)
- MUST: Be pure, reusable utility functions
- MUST: Have zero dependencies on other layers
- MUST NOT: Import from Domain, Infrastructure, Application, or Presentation
- MUST NOT: Contain framework-specific code

## Domain Layer (Business Logic)
- MUST: Contain all business rules and validation in Entities
- MUST: Define Repository interfaces (ports)
- MUST: Be completely independent (no imports from other layers)
- MUST NOT: Call APIs or access external systems directly
- MUST NOT: Import from Infrastructure, Application, or Presentation layers

## Infrastructure Layer (Data Access & Transformation)
- MUST: Implement Repository interfaces from Domain
- MUST: Use Mapper (pure functions) to convert DTO â†” Entity
- MUST: Handle all DTO type definitions and API communication
- MUST: Implement DataSource classes for external system access
- MUST NOT: Contain validation or business logic
- MUST NOT: Skip Mapper and directly pass DTO to Domain

## Application Layer (Business Flow)
- MUST: Contain Use Cases that orchestrate business flows
- MUST: Accept and return DTOs for input/output
- MUST: Call Repository interfaces to perform operations
- MUST NOT: Know about Infrastructure implementations
- MUST NOT: Contain UI logic or API communication code

## Presentation Layer (UI & Hooks)
- MUST: Use hooks to consume Use Cases
- MUST: Handle UI state and user interactions only
- MUST: Pass DTOs to Use Cases and receive Result DTOs
- MUST NOT: Contain business logic or validation
- MUST NOT: Call Repository or DataSource directly

## DI Layer (Dependency Injection)
- MUST: Use singleton pattern (??= operator) for all instances
- MUST: Provide factory methods (static getters) for dependencies
- MUST: Register Use Cases with their dependencies
- MUST NOT: Contain any business logic
- MUST NOT: Directly instantiate dependencies outside of getters

---

Example Task:
"Add minimum payment amount validation logic"

Expected AI Response:
- File: `src/domain/entities/PaymentGateway.ts`
- Action: Add validation method to Entity class
- Reason: Business rule MUST be in Domain Layer

Example Task:
"Server changed response format: payment_id â†’ id"

Expected AI Response:
- File: `src/infrastructure/mappers/paymentGatewayMapper.ts`
- Action: Update single line in Mapper
- Reason: DTO transformation MUST happen only in Mapper
```

</details>

í´ë” êµ¬ì¡°ê°€ ëª…í™•í•˜ì§€ ì•Šìœ¼ë©´ AIê°€ ì–´ë””ì— ì½”ë“œë¥¼ ë„£ì„ì§€ í—¤ë§¤ì§€ë§Œ, ì´ë ‡ê²Œ **ë ˆì´ì–´ë³„ MUST/MUST NOT ê·œì¹™**ì„ ëª…ì‹œí•˜ë©´ AIê°€ **ê°œë°œìê°€ ì˜ë„í•œ ëŒ€ë¡œ, ì •í•´ì§„ í‹€ ë‚´ì—ì„œ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê³  í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±**í•  ìˆ˜ ìˆë‹¤. ì•„í‚¤í…ì²˜ ê°€ì´ë“œë¼ì¸ì„ ë²—ì–´ë‚˜ì§€ ì•Šìœ¼ë©´ì„œë„ ë¹ ë¥´ê²Œ ê°œë°œí•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤.

### ì¥ê¸°ì ìœ¼ë¡œ ê¸°ëŒ€í•˜ëŠ” íš¨ê³¼

- **ì‹¬ë¦¬ì  ì•ˆì •ê°**: "ì´ê±° ê³ ì¹˜ë©´ ì–´ë”” í„°ì§ˆê¹Œ" ë¶ˆì•ˆê° ì†Œë©¸. ë³€ê²½ ë²”ìœ„ê°€ ëª…í™•í•˜ë¯€ë¡œ ë°°í¬ê°€ ë‘ë µì§€ ì•ŠìŒ
- **ì˜¨ë³´ë”© ì‹œê°„ ë‹¨ì¶•**: ìƒˆ íŒ€ì›ì´ êµ¬ì¡°ë§Œ ì´í•´í•˜ë©´ ë°”ë¡œ ê¸°ì—¬ ê°€ëŠ¥. "ì´ ê¸°ëŠ¥ì€ ì–´ë”” ìˆë‚˜ìš”?" ì§ˆë¬¸ì´ ì¤„ì–´ë“¤ ê²ƒ
- **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ì¦ê°€**: `UseCase`ëŠ” ëª¨í‚¹ ì—†ì´ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥. í…ŒìŠ¤íŠ¸ ì‘ì„±ì´ ì¦ê±°ì›Œì ¸ì„œ ì»¤ë²„ë¦¬ì§€ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ë†’ì•„ì§ˆ ê²ƒ
- **AI í™œìš©ë„ ì¦ê°€**: í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ëŠ˜ì–´ë‚˜ë‹ˆ ì¡°ê¸ˆ ë” í¸í•˜ê²Œ AIë¥¼ í™œìš©í•  ìˆ˜ ìˆë‹¤. "ë‚´ê°€ ëŒë¦° AI ë•Œë¬¸ì— ê¸°ì¡´ ì½”ë“œê°€ ë¬´ë„ˆì§€ì§€ ì•Šì„ê¹Œ?" í•˜ëŠ” ê±±ì • ì—†ì´ AIë¥¼ í™œìš©í•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤

### ê· í˜•ì¡íŒ í‰ê°€: ë§ŒëŠ¥ì€ ì•„ë‹ˆë‹¤

í´ë¦° ì•„í‚¤í…ì²˜ê°€ ë§ŒëŠ¥ì€ ì•„ë‹ˆë‹¤. **ì‘ì€ í”„ë¡œì íŠ¸**ë‚˜ **ì¼íšŒì„± í”„ë¡œí† íƒ€ì…**ì—ëŠ” ê³¼í•  ìˆ˜ ìˆë‹¤. ì´ˆê¸° ë¹„ìš©ì´ í¬ê¸° ë•Œë¬¸ì´ë‹¤.

í•˜ì§€ë§Œ **ìš°ë¦¬ ì„œë¹„ìŠ¤**ì²˜ëŸ¼ ì™¸ë¶€ ì •ì±… ë³€ê²½ì´ ì¦ê³ , íŒ€ì›ì´ ì—¬ëŸ¿ì´ë©°, ë‚˜ì²˜ëŸ¼ í”„ë¡ íŠ¸ì—”ë“œì™€ ì„œë²„ ê°œë°œì„ í•¨ê»˜ í•˜ê±°ë‚˜ ì¥ê¸° ìš´ì˜ì´ ì˜ˆì •ë˜ì–´ ìˆë‹¤ë©´ ì´ˆê¸° ë¹„ìš©ì„ ê°ìˆ˜í•  ê°€ì¹˜ê°€ ì¶©ë¶„í•˜ë‹¤.

---

## í•µì‹¬ ì •ë¦¬

í´ë¦° ì•„í‚¤í…ì²˜ë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ ì •ë¦¬í•˜ë©´: **ì—­í• ì„ ë¶„ë¦¬í•´ì„œ ë³€ê²½ì— ê°•í•œ êµ¬ì¡°ë¥¼ ë§Œë“œëŠ” ê²ƒ**ì´ë‹¤.

### 6ê°œ ë ˆì´ì–´ì™€ ì—­í• 

ì½”ë“œë¥¼ 6ê°œ ë ˆì´ì–´ë¡œ ë‚˜ëˆ  ê°ìì˜ ì±…ì„ì„ ëª…í™•íˆ í•œë‹¤:

- **`Core`** (ê³µí†µ ê¸°ë°˜) - ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì“°ëŠ” ìˆœìˆ˜ ìœ í‹¸ë¦¬í‹° (BaseEntity, BaseValueObject)
- **`Domain`** (ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™) - Entity, Value Object, Repository Interfaceë¡œ í•µì‹¬ ê·œì¹™ í‘œí˜„
- **`Infrastructure`** (ì™¸ë¶€ í†µì‹ ) - API í˜¸ì¶œ, DTO ì •ì˜, Mapperë¡œ DTO â†” Entity ë³€í™˜, Repository êµ¬í˜„
- **`Application`** (ë¹„ì¦ˆë‹ˆìŠ¤ í”Œë¡œìš°) - Use Caseë¡œ ì—¬ëŸ¬ Repositoryë¥¼ ì¡°í•©í•´ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ íë¦„ êµ¬ì„±
- **`Presentation`** (UI ìƒí˜¸ì‘ìš©) - Hookìœ¼ë¡œ Use Case í˜¸ì¶œ, Componentë¡œ UI ë Œë”ë§
- **`DI`** (ì˜ì¡´ì„± ì£¼ì…) - ëª¨ë“  ë ˆì´ì–´ë¥¼ ì—°ê²°í•˜ê³  ì˜ì¡´ì„± ì£¼ì…

### í•µì‹¬ ì›ì¹™ 3ê°€ì§€

1. `Domain`ì€ **ì™„ì „íˆ ë…ë¦½** - ë‹¤ë¥¸ ë ˆì´ì–´ë¥¼ importí•˜ì§€ ì•ŠìŒ
2. **ì˜ì¡´ì„±ì€ í•­ìƒ ì•ˆìª½ìœ¼ë¡œ** - Presentation â†’ Application â†’ Domain â† Infrastructure
3. **ë³€í™˜ì€ Mapperê°€ ìœ ì¼** - DTOì™€ Entity ì‚¬ì´ëŠ” Infrastructureì˜ Mapperë§Œ í†µê³¼

### í•µì‹¬ ì›ì¹™

ìš°ë¦¬ í”„ë¡œì íŠ¸ì— ì ìš©í•œ í´ë¦° ì•„í‚¤í…ì²˜ì˜ í•µì‹¬ ì›ì¹™ì€ ë‹¤ìŒê³¼ ê°™ë‹¤:

#### 1. Domainì€ ì™„ì „íˆ ë…ë¦½

`Domain` ë ˆì´ì–´ëŠ” ë‹¤ë¥¸ ë ˆì´ì–´ë¥¼ importí•˜ì§€ ì•ŠëŠ”ë‹¤. `axios`, `react`, `tanstack-query` ê°™ì€ ì™¸ë¶€ ì˜ì¡´ì„±ë„ ì—†ë‹¤. ìˆœìˆ˜í•œ TypeScriptë§Œìœ¼ë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ í‘œí˜„í•œë‹¤.

ì´ë ‡ê²Œ í•˜ë©´ Domain ë¡œì§ì„ ë°±ì—”ë“œë¡œ ì˜®ê¸°ê±°ë‚˜, ë‹¤ë¥¸ í”„ë ˆì„ì›Œí¬ë¡œ í¬íŒ…í•  ë•Œ ê·¸ëŒ€ë¡œ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

#### 2. Entityê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ ë‹´ëŠ”ë‹¤

ê²€ì¦ ë¡œì§, ê³„ì‚° ë¡œì§, ìƒíƒœ ë³€ê²½ ê·œì¹™ì€ ëª¨ë‘ Entityì— ìˆë‹¤. ì»´í¬ë„ŒíŠ¸ëŠ” Entity ë©”ì„œë“œë§Œ í˜¸ì¶œí•˜ë©´ ëœë‹¤.

```ts
// domain/entities/PaymentGateway.ts
canProcessPayment(amount: number): boolean {
  const MIN_PAYMENT = 5_000;
  return this._walletBalance >= amount && amount >= MIN_PAYMENT;
}
```

ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì´ ë°”ë€Œë©´ Entityë§Œ ìˆ˜ì •í•˜ë©´ ëœë‹¤. ì»´í¬ë„ŒíŠ¸ë¥¼ ë’¤ì§ˆ í•„ìš”ê°€ ì—†ë‹¤.

#### 3. Mapperê°€ ìœ ì¼í•œ ë³€í™˜ ì§€ì 

ì„œë²„ ì‘ë‹µ(DTO)ê³¼ ë„ë©”ì¸ ê°ì²´(Entity) ì‚¬ì´ì˜ ë³€í™˜ì€ ì˜¤ì§ Infrastructureì˜ Mapperë§Œ ë‹´ë‹¹í•œë‹¤.

```ts
// infrastructure/mappers/paymentGatewayMapper.ts
export function mapPaymentGatewayDtoToDomain(dto: PaymentGatewayDto) {
  return new PaymentGateway({
    walletBalance: validated.wallet_balance, // snake_case â†’ camelCase
  });
}
```

API í•„ë“œëª…ì´ ë°”ë€Œë©´ Mapperë§Œ ìˆ˜ì •í•˜ë©´ ëœë‹¤. 10ê°œ ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¾ì•„ ìˆ˜ì •í•  í•„ìš”ê°€ ì—†ë‹¤.

#### 4. DataSourceê°€ ì™¸ë¶€ APIë¥¼ ê²©ë¦¬

`axios.get()`, `axios.post()` ê°™ì€ HTTP í˜¸ì¶œì€ Infrastructureì˜ DataSourceì—ë§Œ ìˆë‹¤.

```ts
// infrastructure/datasources/paymentGatewayDataSource.ts
async getPaymentGateway(id: number): Promise<PaymentGatewayDto> {
  const response = await this.httpClient.get(`/api/payment-gateways/${id}`);
  return response.data;
}
```

ì¹´ë“œì‚¬ API ë²„ì „ì´ v1ì—ì„œ v2ë¡œ ë°”ë€Œì–´ë„ DataSourceë§Œ ìˆ˜ì •í•˜ë©´ ëœë‹¤. Application, Domain, Presentationì€ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ”ë‹¤.

#### 5. Repositoryê°€ ë°ì´í„° ì ‘ê·¼ì„ ì¶”ìƒí™”

Use CaseëŠ” "ì–´ë””ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ì§€" ëª¨ë¥¸ë‹¤. ê·¸ì € Domainì˜ Repository ì¸í„°í˜ì´ìŠ¤ë§Œ ì•ˆë‹¤.

```ts
// domain/repositories/PaymentGatewayRepository.ts
export interface PaymentGatewayRepository {
  getPaymentGateway(id: number): Promise<PaymentGateway>;
}

// infrastructure/repositories/PaymentGatewayRepositoryImpl.ts
export class PaymentGatewayRepositoryImpl implements PaymentGatewayRepository {
  async getPaymentGateway(id: number): Promise<PaymentGateway> {
    const dto = await this.dataSource.getPaymentGateway(id);
    return mapPaymentGatewayDtoToDomain(dto);
  }
}
```

ë‚˜ì¤‘ì— ì„œë²„ API ëŒ€ì‹  IndexedDBë‚˜ LocalStorageì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ ë°”ê¿€ ìˆ˜ ìˆë‹¤. Use CaseëŠ” ìˆ˜ì •í•  í•„ìš”ê°€ ì—†ë‹¤.

#### 6. Use Caseê°€ ë¹„ì¦ˆë‹ˆìŠ¤ í”Œë¡œìš°ë¥¼ ì¡°ìœ¨

ì—¬ëŸ¬ Repositoryë¥¼ ì¡°í•©í•´ì„œ í•˜ë‚˜ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ íë¦„ì„ ì™„ì„±í•˜ëŠ” ê±´ Application ë ˆì´ì–´ì˜ Use Case ì—­í• ì´ë‹¤.

```ts
// application/use-cases/ProcessPaymentUseCase.ts
export class ProcessPaymentUseCase {
  async execute(dto: ProcessPaymentDto): Promise<ProcessPaymentResult> {
    const gateway = await this.gatewayRepo.getPaymentGateway(dto.paymentGatewayId);
    const user = await this.userRepo.getUser(dto.userId);

    const paymentAmount = new Money(dto.amount);
    if (!gateway.canProcessPayment(paymentAmount)) {
      throw new Error("ê²°ì œ ë¶ˆê°€");
    }

    return this.transactionRepo.create(...);
  }
}
```

ì´ ë¡œì§ì€ Presentation(ì»´í¬ë„ŒíŠ¸)ì— ìˆìœ¼ë©´ ì•ˆ ëœë‹¤. UIëŠ” "ì–¸ì œ ì‹¤í–‰í• ì§€"ë§Œ ê²°ì •í•˜ê³ , "ì–´ë–»ê²Œ ì‹¤í–‰í•˜ëŠ”ì§€"ëŠ” UseCaseì— ë§¡ê¸´ë‹¤.

#### 7. Presentationì€ UIë§Œ ë‹´ë‹¹

ì»´í¬ë„ŒíŠ¸ëŠ” "ë¬´ì—‡ì„ ë³´ì—¬ì¤„ì§€"ë§Œ ì•ˆë‹¤. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ UseCaseì— ìœ„ì„í•œë‹¤.

```ts
export function ProcessPaymentButton() {
  const { execute, isPending } = useProcessPayment();

  return (
    <button onClick={execute} disabled={isPending}>
      {isPending ? "ê²°ì œ ì¤‘..." : "ê²°ì œ ì²˜ë¦¬"}
    </button>
  );
}
```

ë²„íŠ¼ì´ ëˆŒë ¸ì„ ë•Œ "ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚˜ëŠ”ì§€"ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ëª¨ë¥¸ë‹¤. ê·¸ë˜ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì´ ë°”ë€Œì–´ë„ ì»´í¬ë„ŒíŠ¸ëŠ” ìˆ˜ì •í•  í•„ìš”ê°€ ì—†ë‹¤.

---

ì´ 7ê°€ì§€ ì›ì¹™ì´ "ë³€ê²½ì— ê°•í•œ êµ¬ì¡°"ë¥¼ ë§Œë“ ë‹¤.

### ì‹¤ì œ ìœ ì§€ë³´ìˆ˜ ë¹„ìš© ë¹„êµ

ê¸€ ì „ì²´ì—ì„œ ë‹¤ë¤˜ë˜ ê²°ì œ ëŒ€í–‰ì‚¬(`PaymentGateway`) ì˜ˆì‹œë¡œ ì‹¤ì œ ë³€ê²½ ë¹„ìš©ì„ ë¹„êµí•´ë³´ì.

**ì‹œë‚˜ë¦¬ì˜¤ 1: API í•„ë“œëª… ë³€ê²½** (`wallet_balance` â†’ `available_balance`ë¡œ ë³€ê²½)

- `Before (í´ë¦° ì•„í‚¤í…ì²˜ ì—†ì´)`: `ProcessPaymentButton.tsx`, `PaymentStatusCard.tsx`, `RefundModal.tsx` ë“± `response.data.wallet_balance`ë¥¼ ì‚¬ìš©í•˜ëŠ” 10ê°œ ì»´í¬ë„ŒíŠ¸ë¥¼ ëª¨ë‘ ì°¾ì•„ ìˆ˜ì •í•´ì•¼ í•œë‹¤. í•˜ë‚˜ë¼ë„ ë†“ì¹˜ë©´ ëŸ°íƒ€ì„ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤
- `After (í´ë¦° ì•„í‚¤í…ì²˜ ì ìš©)`: `PaymentGatewayMapper.ts` 1ê°œ íŒŒì¼ì˜ ë§¤í•‘ ë¡œì§ë§Œ ìˆ˜ì •í•˜ë©´ ëœë‹¤. ëª¨ë“  ì»´í¬ë„ŒíŠ¸ëŠ” `PaymentGateway` Entityë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ”ë‹¤

```ts
// infrastructure/mappers/paymentGatewayMapper.ts
export function mapPaymentGatewayDtoToDomain(dto: PaymentGatewayDto) {
  return new PaymentGateway({
    // ...
-   walletBalance: validated.wallet_balance,  // ê¸°ì¡´
+   walletBalance: validated.available_balance,  // ë³€ê²½
  });
}
```

**ì‹œë‚˜ë¦¬ì˜¤ 2: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ë³€ê²½** (ìµœì†Œ ê²°ì œ ê¸ˆì•¡ 1,000ì› â†’ 5,000ì›ìœ¼ë¡œ ë³€ê²½)

- `Before (í´ë¦° ì•„í‚¤í…ì²˜ ì—†ì´)`: ê²€ì¦ ë¡œì§ì´ `ProcessPaymentButton.tsx`, `QuickPaymentForm.tsx`, `PaymentAmountInput.tsx` ë“± 5ê°œ ì»´í¬ë„ŒíŠ¸ì— ì¤‘ë³µë˜ì–´ ìˆë‹¤. ê° íŒŒì¼ì„ ì°¾ì•„ `1_000`ì„ `5_000`ìœ¼ë¡œ ìˆ˜ì •í•´ì•¼ í•œë‹¤
- `After (í´ë¦° ì•„í‚¤í…ì²˜ ì ìš©)`: `PaymentGateway.ts` Entityì˜ `canProcessPayment()` ë©”ì„œë“œ **1ì¤„**ë§Œ ìˆ˜ì •í•˜ë©´ ëœë‹¤

```ts
// domain/entities/PaymentGateway.ts
canProcessPayment(amount: number): boolean {
- const MIN_PAYMENT = 1_000;  // ê¸°ì¡´
+ const MIN_PAYMENT = 5_000;  // ë³€ê²½
  return this._walletBalance >= amount && amount >= MIN_PAYMENT;
}
```

**ì‹œë‚˜ë¦¬ì˜¤ 3: ì™¸ë¶€ API ë³€ê²½** (ê²°ì œ ëŒ€í–‰ì‚¬ API v1 â†’ v2ë¡œ ì—…ê·¸ë ˆì´ë“œ)

- `Before (í´ë¦° ì•„í‚¤í…ì²˜ ì—†ì´)`: APIë¥¼ í˜¸ì¶œí•˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì—ì„œ ì—”ë“œí¬ì¸íŠ¸(`/v1/payments` â†’ `/v2/payments`)ì™€ ìš”ì²­/ì‘ë‹µ í˜•ì‹ì„ ìˆ˜ì •í•´ì•¼ í•œë‹¤. ê° ì»´í¬ë„ŒíŠ¸ë§ˆë‹¤ `fetch` í˜¸ì¶œ ë¶€ë¶„ì„ ì°¾ì•„ ê³ ì³ì•¼ í•œë‹¤
- `After (í´ë¦° ì•„í‚¤í…ì²˜ ì ìš©)`: `PaymentGatewayDataSource.ts`ì™€ `PaymentGatewayMapper.ts`ë§Œ ìˆ˜ì •í•˜ë©´ ëœë‹¤. `Domain`ê³¼ `Presentation` ë ˆì´ì–´ëŠ” API ë²„ì „ì„ ì•Œ í•„ìš”ê°€ ì—†ìœ¼ë¯€ë¡œ ë³€ê²½ì´ í•„ìš” ì—†ë‹¤

ì´ì²˜ëŸ¼ ë³€ê²½ ë²”ìœ„ê°€ ëª…í™•í•˜ê³  ì¢ì•„ì§„ë‹¤. ë§ˆì¹˜ ë¬¼ë¥˜ì„¼í„°ì˜ **í•œ êµ¬ì—­ë§Œ ê°œì„ **í•˜ë©´ ë˜ëŠ” ê²ƒê³¼ ê°™ë‹¤.

---

## ë§ˆì§€ë§‰ìœ¼ë¡œ

í´ë¦° ì•„í‚¤í…ì²˜ëŠ” ì´ˆê¸° ë¹„ìš©ì´ ìˆë‹¤. íŒŒì¼ì´ ë§ì•„ì§€ê³  êµ¬ì¡°ê°€ ë³µì¡í•´ ë³´ì¸ë‹¤.

í•˜ì§€ë§Œ ì´ê±´ **"ì½”ë“œë¥¼ ì˜ˆì˜ê²Œ ì •ë¦¬í•˜ê¸° ìœ„í•œ ê²ƒ"ì´ ì•„ë‹ˆë‹¤.** í´ë¦° ì•„í‚¤í…ì²˜ì˜ ì§„ì§œ ëª©ì ì€ **ë³€í™”ì— ê°•í•œ êµ¬ì¡°**ë¥¼ ë§Œë“œëŠ” ê²ƒì´ë‹¤.

### ìš°ë¦¬ê°€ ì–»ì€ ê²ƒ

- **ë³€ê²½ì— ê°•í•˜ë‹¤**: API í•„ë“œëª…ì´ ë°”ë€Œì–´ë„ `Mapper`ë§Œ ìˆ˜ì •í•˜ë©´ ëœë‹¤. ì»´í¬ë„ŒíŠ¸ë¥¼ ë’¤ì§€ë©° `response.data.xxx`ë¥¼ ì°¾ì•„ ìˆ˜ì •í•  í•„ìš”ê°€ ì—†ë‹¤
- **í…ŒìŠ¤íŠ¸ê°€ ì‰½ë‹¤**: `UseCase`ëŠ” ì˜ì¡´ì„±ì´ ì£¼ì…ë˜ë¯€ë¡œ Mock Repositoryë§Œ ì „ë‹¬í•˜ë©´ ìˆœìˆ˜ í•¨ìˆ˜ì²˜ëŸ¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤
- **AI í™œìš©ì´ ì¢‹ë‹¤**: ë ˆì´ì–´ë³„ ê·œì¹™ì´ ëª…í™•í•˜ë¯€ë¡œ AIê°€ ì •í•´ì§„ í‹€ ì•ˆì—ì„œ ì½”ë“œë¥¼ ìƒì„±í•œë‹¤
- **ì½”ë“œ ìˆ˜ì •ì˜ ë‘ë ¤ì›€ì´ ì‚¬ë¼ì§„ë‹¤**: ë³€ê²½ ë²”ìœ„ê°€ ëª…í™•í•˜ë¯€ë¡œ "ì´ê±° ê³ ì¹˜ë©´ ì–´ë”” í„°ì§ˆê¹Œ?" ê±±ì • ì—†ì´ ë°°í¬í•  ìˆ˜ ìˆë‹¤

### í•µì‹¬ì€ "ì‹¤ìš©"ì´ë‹¤

> "ì½”ë“œëŠ” ì‘í’ˆì´ ì•„ë‹ˆë¼ ë„êµ¬ë‹¤."

ê¹¨ë—í•œ êµ¬ì¡°ëŠ” ì½”ë“œì˜ ì•„ë¦„ë‹¤ì›€ì„ ìœ„í•œ ê²ƒì´ ì•„ë‹ˆë¼, **ë” ë‚˜ì€ í˜‘ì—…ê³¼ ë” ë¹ ë¥¸ ë³€í™”ë¥¼ ìœ„í•œ íˆ¬ì**ë‹¤.

ì²˜ìŒë¶€í„° ì™„ë²½í•œ êµ¬ì¡°ë¥¼ ë§Œë“¤ í•„ìš”ëŠ” ì—†ë‹¤. ì‘ë™í•˜ëŠ” ì´ˆì•ˆì—ì„œ ì¶œë°œí•´ ì ì§„ì ìœ¼ë¡œ ë‹¤ë“¬ìœ¼ë©´ ëœë‹¤. "ì´ ì»´í¬ë„ŒíŠ¸ê°€ ë„ˆë¬´ ë§ì€ ê±¸ ì•Œê³  ìˆë‹¤"ê³  ëŠê»´ì§ˆ ë•Œ, "APIê°€ ë°”ë€Œë©´ ì—¬ëŸ¬ ê³³ì„ ìˆ˜ì •í•´ì•¼ í•œë‹¤"ê³  ëŠê»´ì§ˆ ë•Œ, ê·¸ë•Œ ë ˆì´ì–´ë¥¼ ë¶„ë¦¬í•˜ë©´ ëœë‹¤.

ê²°êµ­ íŒ€ ì „ì²´ì˜ ë§Œì¡±ë„ê°€ ë†’ì•„ì§„ë‹¤. "ì´ê±° ê³ ì¹˜ë©´ ì–´ë”” í„°ì§ˆê¹Œ", "ê¸°íšì´ ë³€ê²½ë˜ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ"ì— ëŒ€í•œ ê±±ì •ì„ ì™„ì „íˆ ì—†ì• ì§€ëŠ” ëª»í•˜ì§€ë§Œ, ì–´ëŠ ì •ë„ ì¤„ì´ë©° ê°œë°œí•  ìˆ˜ ìˆëŠ” ê²ƒ.

ì´ê²ƒì´ ê²¬ê³ í•œ ì•„í‚¤í…ì²˜ì˜ ê°€ì¥ í° ê°€ì¹˜ë¼ê³  ìƒê°í•œë‹¤.
