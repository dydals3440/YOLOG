---
title: ë¦¬ì•¡íŠ¸ í´ë¦° ì•„í‚¤í…ì²˜ - 6ê°œ ë ˆì´ì–´ë¡œ ì„¤ê³„í•˜ëŠ” ìœ ì§€ë³´ìˆ˜ì„±
date: 2025-11-09
updatedDate: 2025-11-09
tags:
  [
    ë¦¬ì•¡íŠ¸,
    React,
    í´ë¦° ì•„í‚¤í…ì²˜,
    Clean Architecture,
    í”„ë¡ íŠ¸ì—”ë“œ ì•„í‚¤í…ì²˜,
    Repository íŒ¨í„´,
    Mapper,
    TanStack Query,
    Domain,
    Entity,
  ]
category: DEVELOPMENT
image: "/images/react-clean-architecture/thumbnail.webp"
---

ê¸°íšì´ ë°”ë€” ë•Œë§ˆë‹¤ 10ê°œ ì´ìƒì˜ íŒŒì¼ì„ ìˆ˜ì •í•´ë³¸ ì  ìˆëŠ”ê°€? ì„œë²„ API í•„ë“œëª… í•˜ë‚˜ ë°”ë€Œì—ˆëŠ”ë° ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ê³ ì³ì•¼ í–ˆë˜ ê²½í—˜ì€?

ìš°ë¦¬ ëª©í‘œëŠ” ì¥í•™ì¹´ë“œ ì‚¬ìš©ìë“¤ì´ ë” ì˜ í™œìš©í•  ìˆ˜ ìˆë„ë¡ **ì‚¬ë‚´ SaaS íˆ´ë¡œ ê¸°ëŠ¥ì„ ë‚´ì¬í™”**í•˜ëŠ” ê²ƒì´ë‹¤. ì œíœ´ ì¹´ë“œì‚¬ëŠ” í˜‘ì—… ê´€ê³„ì´ê¸°ì— **ê°ì‚¬í•˜ê²Œë„ íŠ¹ì • APIë“¤ì„ ì œê³µ**ë°›ì•„ ì‚¬ìš©í•˜ê³  ìˆì§€ë§Œ, ë‹¤ë¥¸ ì™¸ë¶€ ì¹´ë“œì‚¬ ì„œë¹„ìŠ¤ì— ë¹„í•˜ë©´ **ì•„ì§ API ìì²´ê°€ ë¹ˆì•½**í•˜ë‹¤.

í•„ìš”í•œ APIë“¤ì´ ì œê³µë˜ì§€ ì•Šì•„ ìˆëŠ” APIë¡œ ë¹„íš¨ìœ¨ì ì´ì§€ë§Œ ì–´ë–»ê²Œë“  ë§Œë“¤ì–´ë‚´ê±°ë‚˜, ì¹´ë“œì‚¬ì˜ ì¼ì • ê¸°ì•½ë§Œ ë¯¿ê³  ê¸°ë‹¤ë¦¬ê³  ìˆì—ˆë‹¤. ì¼ì •ì´ ë¶ˆëª…í™•í•˜ë‹¤ ë³´ë‹ˆ **ê¸°íšì´ ìì£¼ ë°”ë€Œì—ˆë‹¤**. ì—¬ëŸ¬ APIë¥¼ ì¡°í•©í•˜ê³ , ë¶ˆí•„ìš”í•œ í˜¸ì¶œì„ ë°˜ë³µí•˜ê³ , ë°ì´í„° ì‹±í¬ë¥¼ ë§ì¶”ëŠ” ì„ì‹œ ì½”ë“œê°€ ìŒ“ì—¬ê°”ë‹¤.

íŒ€ì›ë“¤ì€ ì¦ì€ ë³€ê²½ì— ì§€ì³¤ë‹¤. **ë³€ê²½ì— ìœ ì—°í•œ êµ¬ì¡°**ê°€ í•„ìš”í–ˆë‹¤. ë‚˜ì¤‘ì— ì¹´ë“œì‚¬ê°€ ì œëŒ€ë¡œ ëœ APIë¥¼ ì œê³µí•˜ë©´ ë¹ ë¥´ê²Œ êµì²´í•  ìˆ˜ ìˆë„ë¡, **ì™¸ë¶€ ì˜ì¡´ì„±ì„ ê²©ë¦¬í•˜ëŠ” ì„¤ê³„**ê°€ í•„ìˆ˜ì˜€ë‹¤.

ì„œë²„ë‚˜ ì•± ê°œë°œì—ì„œëŠ” ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•˜ì—¬ í´ë¦° ì•„í‚¤í…ì²˜ë¡œ ì™¸ë¶€ ì˜ì¡´ì„±ì„ ê²©ë¦¬í•œë‹¤. ë¦¬ì•¡íŠ¸ì—ì„œ ë§ì´ í™œìš©í•˜ëŠ” ë°©ë²•ì€ ì•„ë‹ˆì§€ë§Œ ê°€ëŠ¥í•˜ë‹¤ê³  íŒë‹¨í–ˆê³  í´ë¦° ì•„í‚¤í…ì²˜ë¥¼ ë„ì…í•˜ë©´ ì–´ëŠì •ë„ ê°œì„ í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ì•˜ë‹¤ê³  íŒë‹¨í–ˆë‹¤.

ë„ì… í›„ ì¹´ë“œì‚¬ê°€ ì œëŒ€ë¡œ ëœ APIë¥¼ ì œê³µí•˜ë©´, **`Data` ë ˆì´ì–´ë§Œ ìˆ˜ì •**í•˜ë©´ ëœë‹¤. ì—¬ëŸ¬ APIë¥¼ ì¡°í•©í•˜ë˜ ë³µì¡í•œ ë¡œì§ì´ ì‚¬ë¼ì§„ë‹¤.

ì–´ë–»ê²Œ ì´ëŸ° ë³€í™”ê°€ ê°€ëŠ¥í–ˆì„ê¹Œ? ë¨¼ì € ê¸°ì¡´ ë°©ì‹ì˜ ë¬¸ì œì ë¶€í„° ì‚´í´ë³´ì.

---

## ê¸°ì¡´ ë°©ì‹ì˜ ë¬¸ì œì 

ì´ëŸ° ì‚¬ë¡€ë¡œ í•œë²ˆ ì´í•´í•´ë³´ì. ê²°ì œ ëŒ€í–‰ì‚¬ ì˜ˆì¹˜ê¸ˆìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ ê²°ì œë¥¼ ì²˜ë¦¬í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ìˆë‹¤.

```ts
// âŒ í´ë¦° ì•„í‚¤í…ì²˜ë¥¼ ì ìš©í•˜ì§€ ì•Šì€ ì½”ë“œ
import { useQuery } from "@tanstack/react-query";
import axios from "axios";

interface Props {
  paymentGatewayId: number;
  userId: number;
  paymentAmount: number;
}

export function ProcessPaymentButton({
  paymentGatewayId,
  userId,
  paymentAmount,
}: Props) {
  // âŒ ë¬¸ì œ 1: API ì˜ì¡´ì„± - axiosê°€ ì»´í¬ë„ŒíŠ¸ì— ì§ì ‘ ë°•í˜€ìˆìŒ
  const { data: paymentGateway } = useQuery({
    queryKey: ["paymentGateway", paymentGatewayId],
    queryFn: async () => {
      const response = await axios.get(
        `/api/payment-gateways/${paymentGatewayId}`
      );
      return response.data;
    },
  });

  const { mutate, isPending } = useMutation({
    mutationFn: async () => {
      // âŒ ë¬¸ì œ 2: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‚°ì¬ - ê²€ì¦ ë¡œì§ì´ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì— ì¤‘ë³µ
      if (!paymentGateway) {
        throw new Error("ê²°ì œ ëŒ€í–‰ì‚¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
      }

      // âŒ ë¬¸ì œ 3: ì„œë²„ ì‘ë‹µ ì˜ì¡´ - snake_caseë¥¼ ì§ì ‘ ì‚¬ìš©
      if (paymentGateway.wallet_balance <= 0) {
        throw new Error("ì˜ˆì¹˜ê¸ˆ ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤");
      }

      if (paymentAmount < 1_000) {
        throw new Error("ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì€ 1,000ì›ì…ë‹ˆë‹¤");
      }

      // âŒ ë¬¸ì œ 1: API ì˜ì¡´ì„± - axiosê°€ ì»´í¬ë„ŒíŠ¸ì— ì§ì ‘ ë°•í˜€ìˆìŒ
      const response = await axios.post("/api/payments/process", {
        payment_gateway_id: paymentGatewayId,
        user_id: userId,
        payment_amount: paymentAmount,
      });

      return response.data;
    },
    onSuccess: (data) => {
      // âŒ ë¬¸ì œ 3: ì„œë²„ ì‘ë‹µ ì˜ì¡´ - snake_caseë¥¼ ì§ì ‘ ì‚¬ìš©
      alert(`ê²°ì œ ì²˜ë¦¬ ì™„ë£Œ! ê²°ì œ ID: ${data.payment_id}`);
    },
    onError: (error) => {
      alert(error.message || "ê²°ì œ ì²˜ë¦¬ ì‹¤íŒ¨");
    },
  });

  return (
    <button onClick={() => mutate()} disabled={isPending}>
      {isPending ? "ê²°ì œ ì¤‘..." : "ê²°ì œ ì²˜ë¦¬"}
    </button>
  );
}
```

### ë¬¸ì œ 1: API ì˜ì¡´ì„±

```ts
// âŒ axiosê°€ ì»´í¬ë„ŒíŠ¸ì— ì§ì ‘ ë°•í˜€ìˆìŒ
const { data: paymentGateway } = useQuery({
  queryKey: ["paymentGateway", paymentGatewayId],
  queryFn: async () => {
    const response = await axios.get(
      `/api/payment-gateways/${paymentGatewayId}`
    );
    return response.data;
  },
});

const response = await axios.post("/api/payments/process", {
  payment_gateway_id: paymentGatewayId,
  user_id: userId,
  payment_amount: paymentAmount,
});
```

`axios`ê°€ ì»´í¬ë„ŒíŠ¸ì— ë°•í˜€ìˆë‹¤. `axios`ë¥¼ `fetch`ë¡œ ë°”ê¾¸ë ¤ë©´ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ìˆ˜ì •í•´ì•¼ í•œë‹¤. í…ŒìŠ¤íŠ¸í•  ë•Œë„ `axios` ëª¨í‚¹, ì„œë²„ ì‘ë‹µ í˜•ì‹, API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ëª¨ë‘ ì•Œì•„ì•¼ í•´ì„œ ë³µì¡í•˜ë‹¤.

### ë¬¸ì œ 2: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‚°ì¬

ê²€ì¦ ë¡œì§ì´ ì»´í¬ë„ŒíŠ¸ë§ˆë‹¤ ì¤‘ë³µëœë‹¤. "ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì„ ë°”ê¿”ì£¼ì„¸ìš”" ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¾ì•„ ìˆ˜ì •í•´ì•¼ í•œë‹¤.

### ë¬¸ì œ 3: ì„œë²„ ì‘ë‹µ í˜•ì‹ ì˜ì¡´

ì„œë²„ê°€ ê¸°íš ë³€ê²½ì´ë‚˜ ì„¤ê³„ ë³€ë™ìœ¼ë¡œ í•„ë“œëª…ì„ ë°”ê¾¸ë©´(ì˜ˆ: `payment_gateway_id` â†’ `gateway_id`), í•´ë‹¹ í•„ë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¾ì•„ì„œ ìˆ˜ì •í•´ì•¼ í•œë‹¤.

### ë¬¸ì œ 4: ë ˆì´ì–´ êµ¬ë¶„ ì—†ìŒ

"í›…ìœ¼ë¡œ ë¶„ë¦¬í•˜ë©´ ë˜ì§€ ì•Šë‚˜?" ë§ë‹¤. í›…ìœ¼ë¡œ ì¬ì‚¬ìš©ì€ í•´ê²°í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ **ì–´ë””ê¹Œì§€ ë¶„ë¦¬**í•´ì•¼ í• ê¹Œ?

```ts
// âŒ í›…ìœ¼ë¡œë§Œ ë¶„ë¦¬í•˜ë©´ ì—¬ì „íˆ ë¬¸ì œ
function usePaymentProcess() {
  return useMutation({
    mutationFn: async (data) => {
      // 1. ê²€ì¦ ë¡œì§ (Domain)
      if (data.payment_amount < MINIMUM_AMOUNT) throw new Error();

      // 2. API í˜¸ì¶œ (Infrastructure)
      const response = await axios.post("/api/payments", {
        payment_gateway_id: data.paymentGatewayId, // 3. ì„œë²„ í˜•ì‹ (Data)
        payment_amount: data.payment_amount,
      });

      return response.data;
    },
  });
}
```

ì´ í›…ì€ **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**(ê²€ì¦), **API í˜¸ì¶œ**(axios), **ì„œë²„ í˜•ì‹**(`snake_case`)ì´ ë’¤ì„ì—¬ ìˆë‹¤.

- `axios` â†’ `fetch` ë³€ê²½ ì‹œ: í›… ìˆ˜ì • í•„ìš”
- ìµœì†Œ ê¸ˆì•¡ ê·œì¹™ ë³€ê²½ ì‹œ: í›… ìˆ˜ì • í•„ìš”
- ì„œë²„ í•„ë“œëª… ë³€ê²½ ì‹œ: í›… ìˆ˜ì • í•„ìš”
- **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**: API ëª¨í‚¹ ì—†ì´ ê²€ì¦ ë¡œì§ë§Œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ì—†ìŒ

í›…ì€ **ë¡œì§ ì¬ì‚¬ìš©**ë§Œ í•´ê²°í•œë‹¤. **ì±…ì„ ë¶„ë¦¬**ëŠ” í•´ê²°í•˜ì§€ ëª»í•œë‹¤. í´ë¦° ì•„í‚¤í…ì²˜ëŠ” ê° ë ˆì´ì–´ì˜ **ë³€ê²½ ì´ìœ ë¥¼ ë¶„ë¦¬**í•œë‹¤.

---

![ë¦¬ì•¡íŠ¸ í´ë¦° ì•„í‚¤í…ì²˜ - 6ê°œ ë ˆì´ì–´ë¡œ ì—­í• ì„ ë¶„ë¦¬í•´ì„œ ë³€ê²½ì— ê°•í•œ êµ¬ì¡° ë§Œë“¤ê¸°](/images/react-clean-architecture/thumbnail.webp)

## í´ë¦° ì•„í‚¤í…ì²˜ë€?

í´ë¦° ì•„í‚¤í…ì²˜ëŠ” ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ êµ¬ì¡°ë‹¤. í•µì‹¬ì€ **ì—­í• ì„ ë¶„ë¦¬**í•˜ëŠ” ê²ƒì´ë‹¤.

ë§ˆì¹˜ ë°°ë‹¬ ì•±ì„ ë– ì˜¬ë ¤ë³´ì. ë°°ë‹¬ ì•±ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì—­í• ì´ ìˆë‹¤:

- **ê³ ê°**: ìŒì‹ì„ ì£¼ë¬¸í•œë‹¤
- **ì‹ë‹¹**: ìŒì‹ì„ ë§Œë“ ë‹¤
- **ë¼ì´ë”**: ìŒì‹ì„ ë°°ë‹¬í•œë‹¤
- **ì•±**: ì£¼ë¬¸ì„ ì „ë‹¬í•˜ê³  ìƒíƒœë¥¼ ê´€ë¦¬í•œë‹¤

ê°ìì˜ ì—­í• ì´ ëª…í™•í•˜ê³ , ì„œë¡œ ë…ë¦½ì ì´ë‹¤. ë¼ì´ë”ê°€ ë°”ë€Œì–´ë„ ì‹ë‹¹ì€ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ”ë‹¤. ì‹ë‹¹ì˜ ë©”ë‰´ê°€ ë°”ë€Œì–´ë„ ë¼ì´ë”ëŠ” ìƒê´€ì—†ë‹¤.

í´ë¦° ì•„í‚¤í…ì²˜ë„ ë§ˆì°¬ê°€ì§€ë‹¤. ì½”ë“œë¥¼ **6ê°œì˜ ë ˆì´ì–´**ë¡œ ë‚˜ëˆ„ê³ , ê° ë ˆì´ì–´ëŠ” ëª…í™•í•œ ì—­í• ì„ ê°€ì§„ë‹¤.

### 6ê°œ ë ˆì´ì–´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Presentation Layer (React)                  â”‚
â”‚  Components, Pages, Hooks, State (Zustand + TanStack)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ depends on
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Domain Layer (Business Logic)                  â”‚
â”‚     Use Cases, Entities, Repository Interfaces          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ implements
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Data Layer (API Access)                     â”‚
â”‚    Repository Impl, DTOs, Mappers, Data Sources         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ uses
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Infrastructure Layer (External Services)         â”‚
â”‚            HTTP Client (Axios), Storage                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

              Core Layer (Cross-cutting Concerns)
          Config, Constants, Utils, Errors, Validators
            â† ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì°¸ì¡° ê°€ëŠ¥
```

- `DI`: ëª¨ë“  ë ˆì´ì–´ì˜ ì˜ì¡´ì„±ì„ ì¡°í•©í•˜ê³  ì£¼ì… (Dependency Injection Container)
- `Infrastructure`: ì™¸ë¶€ ì„¸ê³„ì™€ì˜ í†µì‹  (HTTP í´ë¼ì´ì–¸íŠ¸, ë¼ì´ë¸ŒëŸ¬ë¦¬)
- `Data`: ì™¸ë¶€ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ë‚´ë¶€ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
- `Domain`: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ê³¼ ë¡œì§ (UI, API ëª¨ë¦„)
- `Presentation`: UIì™€ ìƒí˜¸ì‘ìš© (Hook, Component)
- `Core`: ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê³µí†µ ê¸°ëŠ¥ (Constants, Utils, Errors, Validators)

í•µì‹¬ì€ `Domain`ì´ **ì™„ì „íˆ ë…ë¦½ì **ì´ë¼ëŠ” ì ì´ë‹¤. `Domain`ì€ UIê°€ ì–´ë–»ê²Œ ìƒê²¼ëŠ”ì§€, APIê°€ ì–´ë–¤ í˜•ì‹ì¸ì§€ ì „í˜€ ëª¨ë¥¸ë‹¤. ì˜¤ì§ **ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™**ë§Œ ë‹´ë‹¹í•œë‹¤.

### ì˜ì¡´ì„± ë°©í–¥

```
Presentation â†’ Domain â† Data â† Infrastructure
       â†“          â†“        â†“          â†“
                  DI (ëª¨ë“  ë ˆì´ì–´ë¥¼ ì¡°í•©)
       â†“          â†“        â†“          â†“
              Core (ëª¨ë“  ë ˆì´ì–´ê°€ ì˜ì¡´ ê°€ëŠ¥)
```

ì˜ì¡´ì„±ì€ **í•­ìƒ ì•ˆìª½ìœ¼ë¡œ** í–¥í•œë‹¤. `Domain`ì€ `Core`ë§Œ ì˜ì¡´í•˜ê³ , ë‚˜ë¨¸ì§€ ë ˆì´ì–´(`Data`, `Infrastructure`, `Presentation`)ëŠ” `Domain`ì„ ì˜ì¡´í•œë‹¤.

`DI` ë ˆì´ì–´ëŠ” ê°€ì¥ ë°”ê¹¥ìª½ì— ìœ„ì¹˜í•˜ì—¬ ëª¨ë“  ë ˆì´ì–´ì˜ êµ¬ì²´ì ì¸ êµ¬í˜„ì²´ë¥¼ ì¡°í•©í•˜ê³  ì˜ì¡´ì„±ì„ ì£¼ì…í•œë‹¤. `Core` ë ˆì´ì–´ëŠ” ê³µí†µ ìœ í‹¸ë¦¬í‹°ë¡œ, ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì°¸ì¡° ê°€ëŠ¥í•˜ë‹¤.

**í•µì‹¬ ì›ì¹™**:

- **Domainì€ ìˆœìˆ˜í•˜ë‹¤**: `Core`ë¥¼ ì œì™¸í•œ ì–´ë–¤ ë ˆì´ì–´ë„ importí•˜ì§€ ì•ŠëŠ”ë‹¤
- **Repository InterfaceëŠ” Domainì—**: `Data` LayerëŠ” Domainì˜ interfaceë¥¼ **êµ¬í˜„**í•œë‹¤
- **ì˜ì¡´ì„± ì—­ì „**: ê³ ìˆ˜ì¤€(`Domain`)ì´ ì €ìˆ˜ì¤€(`Data`)ì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤

Uncle Bobì´ ì œì‹œí•œ í´ë¦° ì•„í‚¤í…ì²˜ì˜ ê³µì‹ ë‹¤ì´ì–´ê·¸ë¨ì„ ì‚´í´ë³´ì:

![Uncle Bobì˜ í´ë¦° ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ - ë™ì‹¬ì› êµ¬ì¡°ë¡œ ë ˆì´ì–´ê°€ ë‚˜ë‰˜ì–´ì ¸ ìˆê³ , ì˜ì¡´ì„±ì€ í•­ìƒ ì•ˆìª½ìœ¼ë¡œ í–¥í•œë‹¤](/images/react-clean-architecture/clean-architecture.webp)

ìœ„ ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ í•µì‹¬ì€ **ì˜ì¡´ì„± ë°©í–¥**ì´ë‹¤. í™”ì‚´í‘œê°€ ëª¨ë‘ ì•ˆìª½(ì¤‘ì‹¬ì˜ Entities/Use Cases)ì„ ê°€ë¦¬í‚¨ë‹¤. ë°”ê¹¥ìª½ ë ˆì´ì–´(UI, DB, ì™¸ë¶€ ì„œë¹„ìŠ¤)ëŠ” ì•ˆìª½ì„ ì˜ì¡´í•˜ì§€ë§Œ, ì•ˆìª½ì€ ë°”ê¹¥ì„ ì „í˜€ ëª¨ë¥¸ë‹¤. ì´ê²ƒì´ ë°”ë¡œ **ì˜ì¡´ì„± ì—­ì „ ì›ì¹™**ì´ë‹¤.

ìš°ë¦¬ í”„ë¡œì íŠ¸ëŠ” ì´ êµ¬ì¡°ë¥¼ React ìƒíƒœê³„ì— ë§ê²Œ 6ê°œ ë ˆì´ì–´ë¡œ ì¬êµ¬ì„±í–ˆë‹¤. í•˜ì§€ë§Œ í•µì‹¬ ì² í•™ì€ ë™ì¼í•˜ë‹¤: `Domain`ì€ ìˆœìˆ˜í•˜ê³ , ì˜ì¡´ì„±ì€ í•­ìƒ ì•ˆìª½ìœ¼ë¡œ íë¥¸ë‹¤.

> ğŸ’¡ ë” ìì„¸í•œ ë‚´ìš©ì€ Uncle Bobì˜ [Clean Architecture ë¸”ë¡œê·¸](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)ë¥¼ ì°¸ê³ í•˜ì.

ì´ê²Œ ì™œ ì¤‘ìš”í• ê¹Œ? `Domain`ì— ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë„£ìœ¼ë©´, UIê°€ ë°”ë€Œë“  APIê°€ ë°”ë€Œë“  `Domain`ì€ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ”ë‹¤. ë§ˆì¹˜ ì‹ë‹¹ì´ ë©”ë‰´ë¥¼ ë°”ê¿”ë„ ë¼ì´ë”ê°€ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ” ê²ƒì²˜ëŸ¼.

ê°œë…ì„ ì´í•´í–ˆìœ¼ë‹ˆ, ì´ì œ ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œ ì–´ë–»ê²Œ êµ¬í˜„í•˜ëŠ”ì§€ ë³´ì.

---

## í´ë” êµ¬ì¡°

ì‹¤ì œ í”„ë¡œì íŠ¸ì˜ í´ë” êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```
src/
â”œâ”€â”€ di/                            # ì˜ì¡´ì„± ì£¼ì… (Dependency Injection)
â”‚   â””â”€â”€ DIContainer.ts             # ëª¨ë“  ì˜ì¡´ì„±ì„ ê´€ë¦¬í•˜ëŠ” ì»¨í…Œì´ë„ˆ
â”‚
â”œâ”€â”€ core/                          # ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì°¸ì¡° ê°€ëŠ¥
â”‚   â”œâ”€â”€ constants.ts               # ì „ì—­ ìƒìˆ˜
â”‚   â”œâ”€â”€ errors/
â”‚   â”‚   â””â”€â”€ AppError.ts            # ì»¤ìŠ¤í…€ ì—ëŸ¬ í´ë˜ìŠ¤
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ formatters.ts          # ê³µí†µ í¬ë§·íŒ… í•¨ìˆ˜
â”‚   â””â”€â”€ validators/
â”‚       â””â”€â”€ paymentValidator.ts    # ê²°ì œ ê²€ì¦ ìœ í‹¸
â”‚
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ http/
â”‚   â”‚   â”œâ”€â”€ httpClient.ts          # HTTP í´ë¼ì´ì–¸íŠ¸ ì¶”ìƒí™”
â”‚   â”‚   â”œâ”€â”€ axiosHttpClient.ts     # Axios êµ¬í˜„ì²´
â”‚   â”‚   â””â”€â”€ fetchHttpClient.ts     # Fetch API êµ¬í˜„ì²´
â”‚   â””â”€â”€ external/
â”‚       â””â”€â”€ analytics.ts            # ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ datasources/
â”‚   â”‚   â”œâ”€â”€ paymentGatewayDataSource.ts   # ê²°ì œ ëŒ€í–‰ì‚¬ API í˜¸ì¶œ (Raw HTTP)
â”‚   â”‚   â””â”€â”€ userDataSource.ts             # ì‚¬ìš©ì API í˜¸ì¶œ (Raw HTTP)
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”œâ”€â”€ PaymentGatewayRepositoryImpl.ts   # PaymentGatewayRepositoryImpl (êµ¬í˜„ì²´)
â”‚   â”‚   â””â”€â”€ UserRepositoryImpl.ts             # UserRepositoryImpl (êµ¬í˜„ì²´)
â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ paymentGatewayDto.ts  # ê²°ì œ ëŒ€í–‰ì‚¬ ì„œë²„ ì‘ë‹µ íƒ€ì…
â”‚   â”‚   â””â”€â”€ userDto.ts            # ì‚¬ìš©ì ì„œë²„ ì‘ë‹µ íƒ€ì…
â”‚   â””â”€â”€ mappers/
â”‚       â”œâ”€â”€ paymentGatewayMapper.ts  # DTO â†’ Entity ë³€í™˜ í•¨ìˆ˜
â”‚       â””â”€â”€ userMapper.ts            # DTO â†’ Entity ë³€í™˜ í•¨ìˆ˜
â”‚
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”œâ”€â”€ PaymentGateway.ts     # ê²°ì œ ëŒ€í–‰ì‚¬ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™
â”‚   â”‚   â”œâ”€â”€ User.ts               # ì‚¬ìš©ì ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™
â”‚   â”‚   â””â”€â”€ Admin.ts              # ê´€ë¦¬ì ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”œâ”€â”€ PaymentGatewayRepository.ts  # ê²°ì œ ëŒ€í–‰ì‚¬ Repository Interface
â”‚   â”‚   â””â”€â”€ UserRepository.ts            # ì‚¬ìš©ì Repository Interface
â”‚   â””â”€â”€ useCases/
â”‚       â”œâ”€â”€ processPayment.ts     # ê²°ì œ ì²˜ë¦¬
â”‚       â””â”€â”€ processRefund.ts      # í™˜ë¶ˆ ì²˜ë¦¬
â”‚
â””â”€â”€ presentation/
    â”œâ”€â”€ hooks/
    â”‚   â””â”€â”€ useUserPayments.ts    # ì‚¬ìš©ì ê²°ì œ Hook
    â”œâ”€â”€ components/
    â”‚   â””â”€â”€ PaymentButton.tsx     # UI ì»´í¬ë„ŒíŠ¸
    â””â”€â”€ adapters/
        â””â”€â”€ userAdapter.ts        # Entity â†’ UI Type ë³€í™˜
```

ê° í´ë”ëŠ” ëª…í™•í•œ ì—­í• ì„ ê°€ì§„ë‹¤. ì´ì œ ê°€ì¥ ë°”ê¹¥ìª½ ë ˆì´ì–´ë¶€í„° ì°¨ë¡€ëŒ€ë¡œ ì‚´í´ë³´ì.

---

## Core Layer: ê³µí†µ ê¸°ëŠ¥ì˜ ì¤‘ì‹¬

`Core` ë ˆì´ì–´ëŠ” ì¡°ê¸ˆ íŠ¹ë³„í•˜ë‹¤. **ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ” ê³µí†µ ê¸°ëŠ¥**ì„ ë‹´ê³  ìˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ í´ë¦° ì•„í‚¤í…ì²˜ì—ì„œëŠ” ì˜ì¡´ì„±ì´ ì•ˆìª½ìœ¼ë¡œ í–¥í•˜ì§€ë§Œ, `Core`ëŠ” ì˜ˆì™¸ë‹¤.

ì™œ í•„ìš”í• ê¹Œ? ìƒìˆ˜, ì—ëŸ¬, ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ì²˜ëŸ¼ ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì½”ë“œë¥¼ ë§¤ë²ˆ ê° ë ˆì´ì–´ì— ì¤‘ë³µí•´ì„œ ë§Œë“¤ í•„ìš”ê°€ ìˆì„ê¹Œ? ê·¸ë ‡ì§€ ì•Šë‹¤. `Core`ì— í•œ ë²ˆë§Œ ì •ì˜í•˜ê³  ëª¨ë“  ë ˆì´ì–´ì—ì„œ ê°€ì ¸ë‹¤ ì“°ë©´ ëœë‹¤.

### Constants: ì „ì—­ ìƒìˆ˜

```ts
// core/constants.ts
export const MIN_PAYMENT_AMOUNT = 1_000; // ìµœì†Œ ê²°ì œ ê¸ˆì•¡
export const MAX_PAYMENT_AMOUNT = 1_000_000; // ìµœëŒ€ ê²°ì œ ê¸ˆì•¡
export const CURRENCY_UNIT = "ì›"; // í†µí™” ë‹¨ìœ„
```

### Errors: ì»¤ìŠ¤í…€ ì—ëŸ¬

```ts
// core/errors/AppError.ts
export class AppError extends Error {
  constructor(public code: string, message: string) {
    super(message);
    this.name = "AppError";
  }
}

export class InsufficientBalanceError extends AppError {
  constructor() {
    super("INSUFFICIENT_BALANCE", "ì”ì•¡ì´ ë¶€ì¡±í•˜ë‹¤");
  }
}
```

### Validators: ê²€ì¦ ë¡œì§

```ts
// core/validators/paymentValidator.ts
import { MIN_PAYMENT_AMOUNT, MAX_PAYMENT_AMOUNT } from "../constants";

export const validatePaymentAmount = (amount: number): void => {
  if (amount < MIN_PAYMENT_AMOUNT) {
    throw new Error(`ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì€ ${MIN_PAYMENT_AMOUNT}ì›ì…ë‹ˆë‹¤`);
  }
  if (amount > MAX_PAYMENT_AMOUNT) {
    throw new Error(`ìµœëŒ€ ê²°ì œ ê¸ˆì•¡ì€ ${MAX_PAYMENT_AMOUNT}ì›ì…ë‹ˆë‹¤`);
  }
};
```

### Utils: ê³µí†µ ìœ í‹¸ë¦¬í‹°

```ts
// core/utils/formatters.ts
export const formatCurrency = (amount: number): string => {
  return amount.toLocaleString("ko-KR");
};

export const formatPayment = (payment: number): string => {
  return `${formatCurrency(payment)}ì›`;
};
```

`Core` ë ˆì´ì–´ëŠ” **ìˆœìˆ˜ í•¨ìˆ˜ì™€ ìƒìˆ˜**ë§Œ ë‹´ëŠ”ë‹¤. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ë‚˜ ì™¸ë¶€ ì˜ì¡´ì„±ì„ ê°€ì§€ë©´ ì•ˆ ëœë‹¤. ê·¸ë˜ì•¼ ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

---

## Infrastructure Layer: ì™¸ë¶€ ì„¸ê³„ì™€ì˜ ê²©ë¦¬

`Infrastructure` ë ˆì´ì–´ëŠ” ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë‚˜ HTTP í´ë¼ì´ì–¸íŠ¸ë¥¼ ì¶”ìƒí™”í•œë‹¤. ì™œ í•„ìš”í• ê¹Œ?

ë§Œì•½ `axios`ë¥¼ ì§ì ‘ ì“°ë‹¤ê°€ `fetch`ë¡œ ë°”ê¾¸ê³  ì‹¶ë‹¤ë©´? ëª¨ë“  ì½”ë“œë¥¼ ìˆ˜ì •í•´ì•¼ í•œë‹¤. í•˜ì§€ë§Œ ì¶”ìƒí™”í•´ë‘ë©´ êµ¬í˜„ì²´ë§Œ ë°”ê¾¸ë©´ ëœë‹¤.

```ts
// infrastructure/http/httpClient.ts
export interface HttpClient {
  get<T>(url: string): Promise<T>;
  post<T>(url: string, data: unknown): Promise<T>;
  put<T>(url: string, data: unknown): Promise<T>;
  delete<T>(url: string): Promise<T>;
}
```

ì´ê±´ **ì¸í„°í˜ì´ìŠ¤**ë‹¤. êµ¬í˜„ì²´ëŠ” ë”°ë¡œ ë§Œë“ ë‹¤.

```ts
// infrastructure/http/axiosHttpClient.ts
import axios from "axios";
import type { HttpClient } from "./httpClient";

export class AxiosHttpClient implements HttpClient {
  async get<T>(url: string): Promise<T> {
    const response = await axios.get(url);
    return response.data;
  }

  async post<T>(url: string, data: unknown): Promise<T> {
    const response = await axios.post(url, data);
    return response.data;
  }

  // put, deleteë„ ìœ ì‚¬í•˜ê²Œ êµ¬í˜„
}
```

ì´ì œ `axios`ì—ì„œ `fetch`ë¡œ ë°”ê¾¸ê³  ì‹¶ìœ¼ë©´? ìƒˆë¡œìš´ êµ¬í˜„ì²´ë§Œ ë§Œë“¤ë©´ ëœë‹¤.

```ts
// infrastructure/http/fetchHttpClient.ts
import type { HttpClient } from "./httpClient";

export class FetchHttpClient implements HttpClient {
  async get<T>(url: string): Promise<T> {
    const response = await fetch(url);
    return response.json();
  }

  async post<T>(url: string, data: unknown): Promise<T> {
    const response = await fetch(url, {
      method: "POST",
      body: JSON.stringify(data),
      headers: { "Content-Type": "application/json" },
    });
    return response.json();
  }

  // put, deleteë„ ìœ ì‚¬í•˜ê²Œ êµ¬í˜„
}
```

ë‚˜ë¨¸ì§€ ì½”ë“œëŠ” `HttpClient` ì¸í„°í˜ì´ìŠ¤ë§Œ ì˜ì¡´í•˜ë¯€ë¡œ **ì•„ë¬´ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ”ë‹¤**.

---

## Data Layer: ì™¸ë¶€ ë°ì´í„°ë¥¼ ë‚´ë¶€ í˜•ì‹ìœ¼ë¡œ ë³€í™˜

`Data` ë ˆì´ì–´ëŠ” **Domainì˜ Repository Interfaceë¥¼ êµ¬í˜„**í•˜ê³ , **DTOë¥¼ Entityë¡œ ë³€í™˜**í•œë‹¤.

**ì¤‘ìš”í•œ ì›ì¹™**:

- **Repository Implementationì€ Dataì—**: Domainì˜ interfaceë¥¼ `implements`í•œë‹¤
- **DTO â†’ Entity ë³€í™˜ì€ Dataì˜ ì±…ì„**: Mapperë¥¼ í†µí•´ ë³€í™˜í•œë‹¤
- **Domainê³¼ Infrastructureë¥¼ ì—°ê²°**: Domainì€ "ë¬´ì—‡ì„", DataëŠ” "ì–´ë–»ê²Œ"ë¥¼ ë‹´ë‹¹í•œë‹¤

`Data` ë ˆì´ì–´ëŠ” 4ê°€ì§€ ì—­í• ì„ í•œë‹¤:

1. `Repository Impl`: Domainì˜ Repository Interfaceë¥¼ êµ¬í˜„í•œë‹¤
2. `DataSource`: APIë¥¼ í˜¸ì¶œí•˜ê³  DTOë¥¼ ë°˜í™˜í•œë‹¤
3. `DTO(Data Transfer Object)`: ì„œë²„ ì‘ë‹µ íƒ€ì…ì„ ì •ì˜í•œë‹¤
4. `Mapper`: DTOë¥¼ `Domain`ì˜ `Entity`ë¡œ ë³€í™˜í•œë‹¤

### Repository: API í˜¸ì¶œ ë¡œì§

```ts
// data/repositories/PaymentGatewayRepositoryImpl.ts
import type { PaymentGatewayRepository } from "@/domain/repositories/PaymentGatewayRepository";
import type { PaymentGatewayDataSource } from "@/data/datasources/paymentGatewayDataSource";
import type { PaymentGateway } from "@/domain/entities/PaymentGateway";
import type { User } from "@/domain/entities/User";
import { mapPaymentGatewayDtoToDomain } from "@/data/mappers/paymentGatewayMapper";
import { mapUserDtoToDomain } from "@/data/mappers/userMapper";

export class PaymentGatewayRepositoryImpl implements PaymentGatewayRepository {
  constructor(private paymentGatewayDataSource: PaymentGatewayDataSource) {}

  async getPaymentGateway(paymentGatewayId: number): Promise<PaymentGateway> {
    const paymentGatewayDto =
      await this.paymentGatewayDataSource.getPaymentGateway(paymentGatewayId);
    return mapPaymentGatewayDtoToDomain(paymentGatewayDto);
  }

  /**
   * ê²°ì œë¥¼ ì²˜ë¦¬í•˜ê³  ì—…ë°ì´íŠ¸ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ë°˜í™˜í•œë‹¤.
   * ì„œë²„ëŠ” ê²°ì œ ì²˜ë¦¬ í›„ ë³€ê²½ëœ User ì •ë³´ë¥¼ ì‘ë‹µìœ¼ë¡œ ë³´ë‚¸ë‹¤.
   */
  async processPayment(
    paymentGatewayId: number,
    userId: number,
    paymentAmount: number
  ): Promise<User> {
    const userDto = await this.paymentGatewayDataSource.processPayment(
      paymentGatewayId,
      userId,
      paymentAmount
    );
    return mapUserDtoToDomain(userDto);
  }
}
```

```ts
// data/repositories/UserRepositoryImpl.ts
import type { UserRepository } from "@/domain/repositories/UserRepository";
import type { UserDataSource } from "@/data/datasources/userDataSource";
import type { User } from "@/domain/entities/User";
import { mapUserDtoToDomain } from "@/data/mappers/userMapper";

export class UserRepositoryImpl implements UserRepository {
  constructor(private userDataSource: UserDataSource) {}

  async getUser(userId: number): Promise<User> {
    const userDto = await this.userDataSource.getUser(userId);
    return mapUserDtoToDomain(userDto);
  }

  async processPayment(userId: number, paymentAmount: number): Promise<User> {
    const userDto = await this.userDataSource.processPayment(
      userId,
      paymentAmount
    );
    return mapUserDtoToDomain(userDto);
  }

  async convertPoints(userId: number, paymentAmount: number): Promise<User> {
    const userDto = await this.userDataSource.convertPoints(
      userId,
      paymentAmount
    );
    return mapUserDtoToDomain(userDto);
  }
}
```

**ì¤‘ìš”í•œ ì›ì¹™**:

- **Repository interfaceëŠ” `Domain`ì—, implementationì€ `Data`ì—**: `Domain`ì€ "ì–´ë–»ê²Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ì§€"ëŠ” ëª°ë¼ë„ ëœë‹¤
- **DTO â†’ Entity ë³€í™˜ì€ `Repository`ì˜ ì±…ì„**: `UseCase`ëŠ” `Entity`ë§Œ ë°›ëŠ”ë‹¤
- **`DataSource`ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤**: API í˜¸ì¶œì€ `DataSource`ê°€ ë‹´ë‹¹í•œë‹¤

ê·¸ë ‡ë‹¤ë©´ `DataSource`ëŠ” ë¬´ì—‡ì¼ê¹Œ?

### DataSource: ë„¤íŠ¸ì›Œí¬ í†µì‹  ë‹´ë‹¹

`DataSource`ëŠ” **API ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•˜ê³  DTOë¥¼ ë°˜í™˜í•˜ëŠ” ì—­í• **ì„ í•œë‹¤.

ë§ˆì¹˜ íƒë°° ê¸°ì‚¬ê°€ ë¬¼ê±´ì„ ë°°ì†¡ë§Œ í•˜ê³  í¬ì¥ì„ ëœ¯ì§€ ì•ŠëŠ” ê²ƒì²˜ëŸ¼, `DataSource`ëŠ” ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸°ë§Œ í•˜ê³  ë³€í™˜í•˜ì§€ ì•ŠëŠ”ë‹¤.

```ts
// data/datasources/paymentGatewayDataSource.ts
import type { HttpClient } from "@/infrastructure/http/HttpClient";
import type { PaymentGatewayDto } from "@/data/dto/paymentGatewayDto";

export class PaymentGatewayDataSource {
  constructor(private httpClient: HttpClient) {}

  async getPaymentGateway(
    paymentGatewayId: number
  ): Promise<PaymentGatewayDto> {
    return this.httpClient.get<PaymentGatewayDto>(
      `/api/payment-gateways/${paymentGatewayId}`
    );
  }

  async processPayment(
    paymentGatewayId: number,
    userId: number,
    paymentAmount: number
  ): Promise<PaymentGatewayDto> {
    return this.httpClient.post<PaymentGatewayDto>("/api/payments/process", {
      payment_gateway_id: paymentGatewayId,
      user_id: userId,
      payment_amount: paymentAmount,
    });
  }
}
```

```ts
// data/datasources/userDataSource.ts
import type { HttpClient } from "@/infrastructure/http/HttpClient";
import type { UserDto } from "@/data/dto/userDto";

export class UserDataSource {
  constructor(private httpClient: HttpClient) {}

  async getUser(userId: number): Promise<UserDto> {
    return this.httpClient.get<UserDto>(`/api/users/${userId}`);
  }

  async convertPoints(userId: number, paymentAmount: number): Promise<UserDto> {
    return this.httpClient.post<UserDto>("/api/users/convert-points", {
      user_id: userId,
      payment_amount: paymentAmount,
    });
  }
}
```

`DataSource`ëŠ” 3ê°€ì§€ ì›ì¹™ì„ ë”°ë¥¸ë‹¤:

1. **DTOë§Œ ë°˜í™˜í•œë‹¤**: `Entity`ê°€ ì•„ë‹Œ `DTO`ë¥¼ ë°˜í™˜í•œë‹¤. ë³€í™˜ì€ `Mapper`ì˜ ëª«ì´ë‹¤.
2. **`HttpClient` ì¸í„°í˜ì´ìŠ¤ì— ì˜ì¡´í•œë‹¤**: `axios`ë‚˜ `fetch`ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤. `HttpClient` ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ HTTP í´ë¼ì´ì–¸íŠ¸ë¥¼ ì¶”ìƒí™”í•œë‹¤.
3. **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ í¬í•¨í•˜ì§€ ì•ŠëŠ”ë‹¤**: API í˜¸ì¶œë§Œ ë‹´ë‹¹í•œë‹¤.

`DataSource`ì™€ `HttpClient`ì˜ ê´€ê³„ë¥¼ ë³´ë©´, `axios`ì¸ì§€ `fetch`ì¸ì§€ëŠ” `DataSource`ë„ ëª¨ë¥¸ë‹¤. ì´ê²ƒì´ ë°”ë¡œ ì˜ì¡´ì„± ì—­ì „ ì›ì¹™ì´ë‹¤.

ë°±ì—”ë“œê°€ ë°”ë€Œë©´ ì–´ë–»ê²Œ ë ê¹Œ? ì²˜ìŒì—” Spring Bootë¥¼ ì“°ë‹¤ê°€ Firebaseë¡œ ë°”ê¾¸ê±°ë‚˜, Nest.jsë¡œ ì „í™˜í•˜ê±°ë‚˜, Supabaseë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•œë‹¤ë©´? **`DataSource` ë•ë¶„ì— ê±±ì •í•  í•„ìš”ê°€ ì—†ë‹¤.** `Repository`, `Mapper`, `Entity`ëŠ” ê±´ë“œë¦¬ì§€ ì•Šê³  `DataSource`ë§Œ êµì²´í•˜ë©´ ëœë‹¤. ì´ê²ƒì´ ë°”ë¡œ í´ë¦° ì•„í‚¤í…ì²˜ì˜ í•µì‹¬ ì¥ì ì´ë‹¤.

### DTO: ì„œë²„ ì‘ë‹µ íƒ€ì…

ì„œë²„ê°€ ë³´ë‚´ëŠ” ë°ì´í„° í˜•ì‹ì„ ì •ì˜í•œë‹¤.

```ts
// data/dto/paymentGatewayDto.ts
export interface PaymentGatewayDto {
  payment_gateway_id: number; // PGì‚¬ ê³ ìœ  ID
  payment_gateway_name: string; // PGì‚¬ ì´ë¦„
  wallet_balance: number; // ì˜ˆì¹˜ê¸ˆ ì”ì•¡
  created_at: string; // ìƒì„± ì‹œê°
  updated_at: string; // ìˆ˜ì • ì‹œê°
}

// data/dto/userDto.ts
export interface UserDto {
  user_id: number; // ì‚¬ìš©ì ê³ ìœ  ID
  user_name: string; // ì‚¬ìš©ì ì´ë¦„
  payment_gateway_id: number; // ì‚¬ìš© ì¤‘ì¸ PGì‚¬ ID
  payment_balance: number; // ê²°ì œ ì”ì•¡
  wallet_balance: number; // ì§€ê°‘ ì”ì•¡
  created_at: string; // ìƒì„± ì‹œê°
  updated_at: string; // ìˆ˜ì • ì‹œê°
}

// data/dto/paymentTransactionDto.ts
export interface PaymentTransactionDto {
  transaction_id: string; // ê±°ë˜ ê³ ìœ  ID
  user_id: number; // ì‚¬ìš©ì ID
  payment_gateway_id: number; // PGì‚¬ ID
  transaction_type: "process" | "convert"; // ê±°ë˜ ìœ í˜•
  amount: number; // ê±°ë˜ ê¸ˆì•¡
  balance_after: number; // ê±°ë˜ í›„ ì”ì•¡
  created_at: string; // ê±°ë˜ ì‹œê°
}
```

> **ì°¸ê³ **: ëª¨ë…¸ë ˆí¬ í™˜ê²½ì´ë¼ë©´ `packages/types`ì²˜ëŸ¼ ë³„ë„ íŒ¨í‚¤ì§€ë¡œ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤. ì„œë²„ê°€ Swagger ë¬¸ì„œë¥¼ ì™„ì „í•˜ê²Œ ì‘ì„±í–ˆë‹¤ë©´ [`openapi-typescript`](https://openapi-ts.dev/)ë‚˜ [`orval`](https://orval.dev/) ê°™ì€ ë„êµ¬ë¡œ íƒ€ì…ì„ ìë™ ìƒì„±í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤. ì§ì ‘ ì„ ì–¸í•˜ë©´ íœ´ë¨¼ ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

ê·¸ëŸ°ë° ì„œë²„ íŒ€ì—ì„œ ê°‘ìê¸° "ê¸°íšì´ ë°”ë€Œì–´ì„œ `payment_gateway_id` í•„ë“œë¥¼ `gateway_id`ë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤"ë¼ê³  í†µë³´í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ? ê¸°ì¡´ ë°©ì‹ì´ë¼ë©´ í•´ë‹¹ í•„ë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¾ì•„ì„œ ìˆ˜ì •í•´ì•¼ í•œë‹¤. í•˜ì§€ë§Œ í´ë¦° ì•„í‚¤í…ì²˜ì—ì„œëŠ” ë‹¨ **í•œ ê³³**ë§Œ ê³ ì¹˜ë©´ ëœë‹¤. ë°”ë¡œ `Mapper`ë‹¤.

---

### Mapper: ì„œë²„ ë³€ê²½ì˜ ì¶©ê²©ì„ í¡ìˆ˜í•˜ëŠ” ì™„ì¶©ì¬

`Mapper`ëŠ” ì„œë²„ì™€ ìš°ë¦¬ ì½”ë“œ ì‚¬ì´ì˜ **ë²ˆì—­ê¸°**ë‹¤. ì„œë²„ê°€ `payment_gateway_id`ë¥¼ ë³´ë‚´ë“  `gateway_id`ë¥¼ ë³´ë‚´ë“ , ìš°ë¦¬ ì½”ë“œëŠ” ì „í˜€ ì‹ ê²½ ì“°ì§€ ì•ŠëŠ”ë‹¤. `Mapper`ê°€ ëª¨ë“  ë³€ê²½ì„ **í•œ ê³³ì—ì„œ ì²˜ë¦¬**í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

ë§ˆì¹˜ ê±´ë¬¼ì˜ **ë©´ì§„ êµ¬ì¡°**ì™€ ë¹„ìŠ·í•˜ë‹¤. ì§€ì§„(ì„œë²„ ë³€ê²½)ì´ ì¼ì–´ë‚˜ë„ ê±´ë¬¼ ë‚´ë¶€(Domain, Presentation)ëŠ” í”ë“¤ë¦¬ì§€ ì•ŠëŠ”ë‹¤. ì¶©ê²© í¡ìˆ˜ ì¥ì¹˜(Mapper)ê°€ ëª¨ë“  ì¶©ê²©ì„ í¡ìˆ˜í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

MapperëŠ” classê°€ ì•„ë‹Œ **ìˆœìˆ˜ í•¨ìˆ˜**ë¡œ êµ¬í˜„í•œë‹¤. ìƒíƒœë¥¼ ê°€ì§ˆ í•„ìš”ê°€ ì—†ê³ , ë‹¨ìˆœíˆ ë°ì´í„°ë¥¼ ë³€í™˜í•˜ëŠ” ì—­í• ë§Œ í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

```ts
// data/mappers/paymentGatewayMapper.ts
import { z } from "zod";
import { PaymentGateway } from "@/domain/entities/PaymentGateway";
import type { PaymentGatewayDto } from "@/data/dto/paymentGatewayDto";

// 1. DTO ê²€ì¦ ìŠ¤í‚¤ë§ˆ
const paymentGatewayDtoSchema = z.object({
  payment_gateway_id: z.number(),
  payment_gateway_name: z.string(),
  wallet_balance: z.number(),
  created_at: z.string(),
  updated_at: z.string(),
});

// DTO â†’ Entity ë³€í™˜ í•¨ìˆ˜
export function mapPaymentGatewayDtoToDomain(
  dto: PaymentGatewayDto
): PaymentGateway {
  // 1. DTO ê²€ì¦
  const validated = paymentGatewayDtoSchema.parse(dto);

  // 2. Entity ìƒì„± (snake_case â†’ camelCase)
  return new PaymentGateway({
    id: validated.payment_gateway_id,
    name: validated.payment_gateway_name,
    walletBalance: validated.wallet_balance,
    createdAt: new Date(validated.created_at),
    updatedAt: new Date(validated.updated_at),
  });
}

// Entity â†’ DTO ë³€í™˜ í•¨ìˆ˜ (API ìš”ì²­ ì‹œ)
export function mapPaymentGatewayDomainToDto(
  paymentGateway: PaymentGateway
): PaymentGatewayDto {
  return {
    payment_gateway_id: paymentGateway.id,
    payment_gateway_name: paymentGateway.name,
    wallet_balance: paymentGateway.walletBalance,
    created_at: paymentGateway.createdAt.toISOString(),
    updated_at: paymentGateway.updatedAt.toISOString(),
  };
}
```

```ts
// data/mappers/userMapper.ts
import { z } from "zod";
import { User } from "@/domain/entities/User";
import type { UserDto } from "@/data/dto/userDto";

const userDtoSchema = z.object({
  user_id: z.number(),
  user_name: z.string(),
  payment_gateway_id: z.number(),
  payment_balance: z.number(),
  wallet_balance: z.number(),
  created_at: z.string(),
  updated_at: z.string(),
});

export function mapUserDtoToDomain(dto: UserDto): User {
  const validated = userDtoSchema.parse(dto);

  return new User({
    id: validated.user_id,
    name: validated.user_name,
    gatewayId: validated.payment_gateway_id,
    paymentBalance: validated.payment_balance,
    walletBalance: validated.wallet_balance,
    createdAt: new Date(validated.created_at),
    updatedAt: new Date(validated.updated_at),
  });
}
```

```ts
// data/mappers/paymentTransactionMapper.ts
import { z } from "zod";
import { PaymentTransaction } from "@/domain/entities/PaymentTransaction";
import type { PaymentTransactionDto } from "@/data/dto/paymentTransactionDto";

const paymentTransactionDtoSchema = z.object({
  transaction_id: z.string(),
  user_id: z.number(),
  payment_gateway_id: z.number(),
  transaction_type: z.enum(["process", "convert"]),
  amount: z.number(),
  balance_after: z.number(),
  created_at: z.string(),
});

export function mapPaymentTransactionDtoToDomain(
  dto: PaymentTransactionDto
): PaymentTransaction {
  const validated = paymentTransactionDtoSchema.parse(dto);

  return new PaymentTransaction({
    id: validated.transaction_id,
    userId: validated.user_id,
    paymentGatewayId: validated.payment_gateway_id,
    type: validated.transaction_type === "process" ? "payment" : "refund",
    amount: validated.amount,
    balanceAfter: validated.balance_after,
    createdAt: new Date(validated.created_at),
  });
}
```

`Mapper` í•¨ìˆ˜ëŠ” ë‹¤ìŒì„ ìˆ˜í–‰í•œë‹¤:

1. **ê²€ì¦**: `Zod`ë¡œ DTOì˜ í˜•ì‹ì„ ê²€ì¦í•œë‹¤
2. **í•„ë“œëª… ë§¤í•‘**: ì„œë²„ í•„ë“œ(`payment_gateway_id`) â†’ ë„ë©”ì¸ í•„ë“œ(`id`)ë¡œ ë³€í™˜í•œë‹¤
3. **ë„¤ì´ë° ë³€í™˜**: `snake_case` â†’ `camelCase`ë¡œ ë³€í™˜í•œë‹¤
4. **íƒ€ì… ë³€í™˜**: `string` â†’ `Date`ì²˜ëŸ¼ íƒ€ì…ì„ ë³€í™˜í•œë‹¤
5. **Entity ìƒì„±**: `Domain`ì˜ `PaymentGateway`, `User`, `PaymentTransaction` Entityë¥¼ ìƒì„±í•œë‹¤

**í•µì‹¬ì€ ì´ê²ƒì´ë‹¤**: ì„œë²„ê°€ `payment_gateway_id` â†’ `gateway_id`ë¡œ í•„ë“œëª…ì„ ë°”ê¾¸ë©´?

```ts
// âœ… Mapper í•œ ê³³ë§Œ ìˆ˜ì •
export function mapPaymentGatewayDtoToDomain(dto: PaymentGatewayDto): PaymentGateway {
  return new PaymentGateway({
-   id: validated.payment_gateway_id,  // ê¸°ì¡´
+   id: validated.gateway_id,           // ë³€ê²½
    name: validated.payment_gateway_name,
    walletBalance: validated.wallet_balance,
    // ...
  });
}
```

`Mapper` í•¨ìˆ˜ **ë”± 1ì¤„**ë§Œ ê³ ì¹˜ë©´ ëœë‹¤. `Presentation`, `Domain`, `UseCase` ë ˆì´ì–´ëŠ” ì „í˜€ ìˆ˜ì •í•˜ì§€ ì•Šì•„ë„ ëœë‹¤. ë„ì…ë¶€ì—ì„œ ì–¸ê¸‰í•œ "10ê°œ íŒŒì¼ ìˆ˜ì • â†’ 1ê°œ íŒŒì¼ ìˆ˜ì •"ì´ ë°”ë¡œ ì´ê²ƒì´ë‹¤.

---

## Domain Layer: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì˜ ì¤‘ì‹¬

`Domain` ë ˆì´ì–´ëŠ” í´ë¦° ì•„í‚¤í…ì²˜ì˜ **í•µì‹¬**ì´ë‹¤. UIë„ ëª¨ë¥´ê³ , APIë„ ëª¨ë¥´ê³ , ì˜¤ì§ **ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™**ë§Œ ë‹´ë‹¹í•œë‹¤.

**ì¤‘ìš”í•œ ì›ì¹™**:

- **Domainì€ Coreë§Œ importí•œë‹¤**: `Data`, `Infrastructure`, `Presentation` ë ˆì´ì–´ëŠ” ì ˆëŒ€ importí•˜ì§€ ì•ŠëŠ”ë‹¤
- **Repository InterfaceëŠ” Domainì— ì •ì˜í•œë‹¤**: êµ¬í˜„ì²´(`Impl`)ëŠ” `Data` Layerì— ìœ„ì¹˜í•œë‹¤

`Domain`ì€ 3ê°€ì§€ë¡œ êµ¬ì„±ëœë‹¤:

1. `Entity`: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ ë‹´ì€ ê°ì²´
2. `Repository Interface`: ë°ì´í„° ì ‘ê·¼ ì¶”ìƒí™”
3. `UseCase`: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ íë¦„

### Entity: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™

EntityëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ì™€ ê´€ë ¨ëœ **ëª¨ë“  ê·œì¹™**ì„ ë‹´ëŠ”ë‹¤. ê²°ì œ ëŒ€í–‰ì‚¬ ì‹œìŠ¤í…œì—ëŠ” `PaymentGateway`ì™€ `User` Entityê°€ ìˆë‹¤.

#### PaymentGateway Entity

`PaymentGateway` EntityëŠ” ê²°ì œ ëŒ€í–‰ì‚¬ì˜ ì˜ˆì¹˜ê¸ˆê³¼ ê²°ì œ ì²˜ë¦¬ ê·œì¹™ì„ ë‹´ë‹¹í•œë‹¤.

```ts
// domain/entities/PaymentGateway.ts
interface PaymentGatewayProps {
  id: number;
  name: string;
  walletBalance: number;
  createdAt: Date;
  updatedAt: Date;
}

export class PaymentGateway {
  private readonly _id: number;
  private readonly _name: string;
  private readonly _walletBalance: number;
  private readonly _createdAt: Date;
  private readonly _updatedAt: Date;

  static readonly MIN_PAYMENT_AMOUNT = 1_000;
  static readonly MAX_PAYMENT_AMOUNT = 1_000_000;

  constructor(props: PaymentGatewayProps) {
    this._id = props.id;
    this._name = props.name;
    this._walletBalance = props.walletBalance;
    this._createdAt = props.createdAt;
    this._updatedAt = props.updatedAt;

    // ìƒì„± ì‹œì ì— í•„ìˆ˜ ê²€ì¦ ìˆ˜í–‰
    this.validate();
  }

  private validate(): void {
    if (this._id <= 0) throw new Error("ê²°ì œ ëŒ€í–‰ì‚¬ IDëŠ” ì–‘ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤");
    if (!this._name?.trim()) throw new Error("ê²°ì œ ëŒ€í–‰ì‚¬ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤");
    if (this._walletBalance < 0)
      throw new Error("ì˜ˆì¹˜ê¸ˆ ì”ì•¡ì€ ìŒìˆ˜ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
  }

  get id() {
    return this._id;
  }
  get name() {
    return this._name;
  }
  get walletBalance() {
    return this._walletBalance;
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ì˜ˆì¹˜ê¸ˆ ì”ì•¡ í™•ì¸
  canProcessPayment(amount: number): boolean {
    return this._walletBalance >= amount;
  }

  // ì‚¬ìš©ì ì…ë ¥ ê²€ì¦ (UseCaseì—ì„œ í˜¸ì¶œ)
  static validatePaymentAmount(amount: number): void {
    if (amount < this.MIN_PAYMENT_AMOUNT) {
      throw new Error(`ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì€ ${this.MIN_PAYMENT_AMOUNT}ì›ì…ë‹ˆë‹¤`);
    }
    if (amount > this.MAX_PAYMENT_AMOUNT) {
      throw new Error(`ìµœëŒ€ ê²°ì œ ê¸ˆì•¡ì€ ${this.MAX_PAYMENT_AMOUNT}ì›ì…ë‹ˆë‹¤`);
    }
  }

  static validateDepositAmount(amount: number): void {
    if (amount <= 0) {
      throw new Error("ì¶©ì „ ê¸ˆì•¡ì€ 0ì›ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤");
    }
  }
}
```

**Validation ì „ëµ**

| íŒ¨í„´                   | ëª©ì                          | í˜¸ì¶œ ì‹œì                |
| ---------------------- | ---------------------------- | ----------------------- |
| `private validate()`   | Entityì˜ í•„ìˆ˜ ë¶ˆë³€ ê·œì¹™ ê²€ì¦ | Entity ìƒì„± ì‹œ ìë™     |
| `static validateXXX()` | ì‚¬ìš©ì ì…ë ¥ ì‚¬ì „ ê²€ì¦        | UseCaseì—ì„œ ëª…ì‹œì  í˜¸ì¶œ |

**í•µì‹¬**: Constructor validationì€ ì˜ëª»ëœ ë°ì´í„°ë¡œ Entityê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ ì›ì²œ ì°¨ë‹¨í•œë‹¤. Entityë¥¼ ë°›ëŠ” ëª¨ë“  ì½”ë“œê°€ "ì´ ê°ì²´ëŠ” ìœ íš¨í•˜ë‹¤"ê³  ì‹ ë¢°í•  ìˆ˜ ìˆë‹¤

---

#### User Entity

`User` EntityëŠ” ì‚¬ìš©ìì˜ ê²°ì œ ë‚´ì—­ê³¼ ì§€ê°‘ ì”ì•¡ ê´€ë¦¬ ê·œì¹™ì„ ë‹´ë‹¹í•œë‹¤.

```ts
// domain/entities/User.ts
interface UserProps {
  id: number;
  name: string;
  gatewayId: number;
  paymentBalance: number; // ê²°ì œ ì”ì•¡
  walletBalance: number; // ì§€ê°‘ ì”ì•¡
  createdAt: Date;
  updatedAt: Date;
}

export class User {
  private readonly _id: number; // ì‚¬ìš©ì ê³ ìœ  ID
  private readonly _name: string; // ì‚¬ìš©ì ì´ë¦„
  private readonly _gatewayId: number; // PGì‚¬ ID
  private _paymentBalance: number; // ê²°ì œ ì”ì•¡
  private _walletBalance: number; // ì§€ê°‘ ì”ì•¡
  private readonly _createdAt: Date; // ë“±ë¡ ì‹œê°
  private _updatedAt: Date; // ì—…ë°ì´íŠ¸ ì‹œê°

  constructor(props: UserProps) {
    this._id = props.id;
    this._name = props.name;
    this._gatewayId = props.gatewayId;
    this._paymentBalance = props.paymentBalance;
    this._walletBalance = props.walletBalance;
    this._createdAt = props.createdAt;
    this._updatedAt = props.updatedAt;
  }

  // Getter
  get id() {
    return this._id;
  }
  get name() {
    return this._name;
  }
  get gatewayId() {
    return this._gatewayId;
  }
  get paymentBalance() {
    return this._paymentBalance;
  }
  get walletBalance() {
    return this._walletBalance;
  }
  get createdAt() {
    return this._createdAt;
  }
  get updatedAt() {
    return this._updatedAt;
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ê²°ì œ ê¸ˆì•¡ ê²€ì¦
  static validatePaymentAmount(amount: number): void {
    if (amount <= 0) {
      throw new Error("ê²°ì œ ê¸ˆì•¡ì€ 0ì›ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤");
    }
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: í™˜ë¶ˆ ê°€ëŠ¥ ì—¬ë¶€
  canRefund(amount: number, minRefundAmount: number): boolean {
    return this._paymentBalance >= amount && amount >= minRefundAmount;
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ì§€ê°‘ ì”ì•¡ ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€
  canUseWallet(amount: number): boolean {
    return this._walletBalance >= amount;
  }
}
```

### ì”ì•¡ í•„ë“œ ìƒì„¸ ì„¤ëª…

`paymentBalance`ëŠ” í™˜ë¶ˆ ê°€ëŠ¥í•œ ê¸ˆì•¡, `walletBalance`ëŠ” í™˜ë¶ˆë°›ì•„ ì ë¦½ëœ ì˜ˆì¹˜ê¸ˆì´ë‹¤. 10,000ì› ê²°ì œ â†’ 5,000ì› í™˜ë¶ˆí•˜ë©´, `paymentBalance`: 5,000ì› (ì°¨ê°), `walletBalance`: 5,000ì› (ì ë¦½)ìœ¼ë¡œ **í˜„ê¸ˆ ê²°ì œ ê¸ˆì•¡**ê³¼ **ì˜ˆì¹˜ê¸ˆ**ì„ êµ¬ë¶„í•œë‹¤.

---

**PaymentTransaction Entity:**

ê²°ì œ ê±°ë˜ ë‚´ì—­ì„ ê´€ë¦¬í•˜ëŠ” Entityì´ë‹¤.

```ts
// domain/entities/PaymentTransaction.ts
type TransactionType = "payment" | "refund"; // payment: ê²°ì œ, refund: í™˜ë¶ˆ

interface PaymentTransactionProps {
  id: string;
  userId: number;
  gatewayId: number;
  type: TransactionType;
  amount: number;
  balanceAfter: number;
  createdAt: Date;
}

export class PaymentTransaction {
  private readonly _id: string; // ê±°ë˜ ê³ ìœ  ID (UUID, ì¤‘ë³µ ë°©ì§€ìš© ì‹ë³„ì)
  private readonly _userId: number; // ê±°ë˜ë¥¼ ìˆ˜í–‰í•œ ì‚¬ìš©ì ID
  private readonly _gatewayId: number; // ê±°ë˜ë¥¼ ì²˜ë¦¬í•œ ê²°ì œ ëŒ€í–‰ì‚¬ ID
  private readonly _type: TransactionType; // ê±°ë˜ ìœ í˜• (payment: ê²°ì œ, refund: í™˜ë¶ˆ)
  private readonly _amount: number; // ê±°ë˜ ê¸ˆì•¡
  private readonly _balanceAfter: number; // ê±°ë˜ í›„ ì”ì•¡ (ì´ ê±°ë˜ ì´í›„ ë‚¨ì€ ì‚¬ìš©ì ì”ì•¡)
  private readonly _createdAt: Date; // ê±°ë˜ ë°œìƒ ì‹œê°

  constructor(props: PaymentTransactionProps) {
    this._id = props.id;
    this._userId = props.userId;
    this._gatewayId = props.gatewayId;
    this._type = props.type;
    this._amount = props.amount;
    this._balanceAfter = props.balanceAfter;
    this._createdAt = props.createdAt;
  }

  // Getterë“¤
  get id(): string {
    return this._id; // ê±°ë˜ ì¡°íšŒ, ì˜ìˆ˜ì¦ ì¶œë ¥ ë“±ì— ì‚¬ìš©
  }

  get userId(): number {
    return this._userId; // ì‚¬ìš©ìë³„ ê±°ë˜ ë‚´ì—­ í•„í„°ë§ì— ì‚¬ìš©
  }

  get gatewayId(): number {
    return this._gatewayId; // PGì‚¬ë³„ ê±°ë˜ í†µê³„, í•„í„°ë§ì— ì‚¬ìš©
  }

  get type(): TransactionType {
    return this._type; // ê±°ë˜ ìœ í˜• í‘œì‹œ (ê²°ì œ/í™˜ë¶ˆ ì•„ì´ì½˜, ìƒ‰ìƒ êµ¬ë¶„ ë“±)
  }

  get amount(): number {
    return this._amount; // ê±°ë˜ ê¸ˆì•¡ í‘œì‹œ, í†µê³„ ê³„ì‚°ì— ì‚¬ìš©
  }

  get balanceAfter(): number {
    return this._balanceAfter; // ê±°ë˜ í›„ ì”ì•¡ í‘œì‹œ, ì”ì•¡ ë³€í™” ì¶”ì ì— ì‚¬ìš©
  }

  get createdAt(): Date {
    return this._createdAt; // ê±°ë˜ ë°œìƒ ì‹œê° í‘œì‹œ, ê±°ë˜ ë‚´ì—­ ì‹œê°„ìˆœ ì •ë ¬ì— ì‚¬ìš©
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ê²°ì œ ê±°ë˜ ìƒì„±
  static createPaymentTransaction(
    userId: number,
    gatewayId: number,
    amount: number,
    balanceAfter: number
  ): PaymentTransaction {
    if (amount <= 0) {
      throw new Error("ê²°ì œ ê¸ˆì•¡ì€ 0ì›ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤");
    }

    return new PaymentTransaction({
      id: crypto.randomUUID(), // ê³ ìœ  ID ìƒì„±
      userId,
      gatewayId,
      type: "payment",
      amount,
      balanceAfter,
      createdAt: new Date(),
    });
  }

  // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: í™˜ë¶ˆ ê±°ë˜ ìƒì„±
  static createRefundTransaction(
    userId: number,
    gatewayId: number,
    amount: number,
    balanceAfter: number
  ): PaymentTransaction {
    if (amount <= 0) {
      throw new Error("í™˜ë¶ˆ ê¸ˆì•¡ì€ 0ì›ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤");
    }

    return new PaymentTransaction({
      id: crypto.randomUUID(),
      userId,
      gatewayId,
      type: "refund",
      amount,
      balanceAfter,
      createdAt: new Date(),
    });
  }
}
```

---

Entityë“¤ì€ ë‹¤ìŒê³¼ ê°™ì€ `ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™(ê²€ì¦ ë¡œì§)`ì„ ë‹´ëŠ”ë‹¤:

**PaymentGateway Entity:**

- **ìµœì†Œ ê²°ì œ ê¸ˆì•¡**: 100ì› ì´ìƒì¸ì§€ ê²€ì¦
- **ì˜ˆì¹˜ê¸ˆ ì”ì•¡ í™•ì¸**: ê²°ì œ ê°€ëŠ¥ ì—¬ë¶€ ê²€ì¦ (ìƒíƒœ ë³€ê²½ ì—†ìŒ)
- **ì¶©ì „ ê¸ˆì•¡ ê²€ì¦**: 0ì› ì´ˆê³¼ì¸ì§€ ê²€ì¦

**User Entity:**

- **ê²°ì œ ê¸ˆì•¡ ê²€ì¦**: 0ì› ì´ˆê³¼ì¸ì§€ ê²€ì¦
- **í™˜ë¶ˆ ê°€ëŠ¥ ì—¬ë¶€**: ì”ì•¡ ì¶©ë¶„ ì—¬ë¶€ ë° ìµœì†Œ ê¸ˆì•¡ ê²€ì¦ (ìƒíƒœ ë³€ê²½ ì—†ìŒ)
- **ì§€ê°‘ ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€**: ì§€ê°‘ ì”ì•¡ ì¶©ë¶„ ì—¬ë¶€ ê²€ì¦ (ìƒíƒœ ë³€ê²½ ì—†ìŒ)

**PaymentTransaction Entity:**

- **ê±°ë˜ ë‚´ì—­ ìƒì„±**: ê²°ì œ/í™˜ë¶ˆ ê±°ë˜ ê¸°ë¡ ìƒì„± (factory method)
- **ê¸ˆì•¡ ê²€ì¦**: ê±°ë˜ ê¸ˆì•¡ì´ 0ë³´ë‹¤ í°ì§€ í™•ì¸
- **ê±°ë˜ íƒ€ì…**: "process"(ê²°ì œ)ì™€ "convert"(í™˜ë¶ˆ) êµ¬ë¶„
- **ì™„ì „ ë¶ˆë³€ì„±**: ëª¨ë“  ì†ì„±ì´ readonly, í•œ ë²ˆ ìƒì„±ëœ ê±°ë˜ëŠ” ìˆ˜ì • ë¶ˆê°€

ê¸°íšìê°€ "ìµœì†Œ ê²°ì œ ê¸ˆì•¡ì„ 2,000ì›ìœ¼ë¡œ ë°”ê¿”ì£¼ì„¸ìš”"ë¼ê³  í•˜ë©´? `MIN_PAYMENT_AMOUNT` í•œ ì¤„ë§Œ ë°”ê¾¸ë©´ ëœë‹¤.

```diff
// domain/entities/PaymentGateway.ts
- static readonly MIN_PAYMENT_AMOUNT = 1_000;
+ static readonly MIN_PAYMENT_AMOUNT = 2_000;
```

ì»´í¬ë„ŒíŠ¸ëŠ” ê±´ë“œë¦´ í•„ìš”ê°€ ì—†ë‹¤.

---

### EntityëŠ” ì™œ ë¶ˆë³€ì¸ê°€?

ìš°ë¦¬ í”„ë¡œì íŠ¸ëŠ” **ì„œë²„ ìƒíƒœ ê´€ë¦¬ë¥¼ Tanstack Queryì—ê²Œ ìœ„ì„**í–ˆë‹¤. ë§Œì•½ Entity classì—ì„œë„ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

```ts
// âŒ Entityê°€ ìƒíƒœë¥¼ ì§ì ‘ ë³€ê²½í•˜ë©´?
class User {
  private _balance: number;

  deposit(amount: number) {
    this._balance += amount; // Entityê°€ ìƒíƒœ ë³€ê²½
  }
}

// ë¬¸ì œ: Tanstack Query ìºì‹œì™€ Entity ìƒíƒœê°€ ë”°ë¡œ ë…¼ë‹¤!
// - Entity: _balance = 10000
// - Tanstack Query ìºì‹œ: balance = 5000
// ì–´ëŠ ê²ƒì´ ì§„ì§œì¸ê°€?
```

Entityì™€ Tanstack Query ìºì‹œê°€ **ê°ì ìƒíƒœë¥¼ ê´€ë¦¬**í•˜ë©´ ë¶ˆì¼ì¹˜ê°€ ë°œìƒí•œë‹¤. ë”°ë¼ì„œ EntityëŠ” `readonly`ë¡œ ë§Œë“¤ì–´ **ê²€ì¦ë§Œ ë‹´ë‹¹**í•˜ê³ , ìƒíƒœëŠ” Tanstack Queryê°€ ì„œë²„ ì‘ë‹µìœ¼ë¡œë§Œ ì—…ë°ì´íŠ¸í•œë‹¤.

```ts
// âœ… í”„ë¡ íŠ¸ì—”ë“œ Entity: readonly + ê²€ì¦ ë©”ì„œë“œë§Œ
class User {
  private readonly _balance: number;

  canDeposit(amount: number): boolean {
    return amount > 0; // ê²€ì¦ë§Œ
  }
}

// UseCaseê°€ ì„œë²„ì— ìš”ì²­ â†’ Tanstack Queryê°€ ìºì‹œ ì—…ë°ì´íŠ¸
const updatedUser = await userRepository.deposit(user.id, amount);
```

ë°±ì—”ë“œëŠ” Entityê°€ ìƒíƒœë¥¼ ì§ì ‘ ë³€ê²½í•˜ê³  DBì— ì €ì¥í•˜ì§€ë§Œ, í”„ë¡ íŠ¸ì—”ë“œëŠ” Tanstack Queryê°€ ì„œë²„ ì‘ë‹µì„ í†µí•´ì„œë§Œ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤.
| **ìƒíƒœ ê´€ë¦¬** | ORM | TanStack Query |

---

### Repository Interface: ë°ì´í„° ì ‘ê·¼ ì¶”ìƒí™”

`Domain` LayerëŠ” ë°ì´í„°ê°€ **ì–´ë””ì„œ ì˜¤ëŠ”ì§€** ëª¨ë¥¸ë‹¤. HTTP APIì¸ì§€, LocalStorageì¸ì§€, IndexedDBì¸ì§€ ì•Œ í•„ìš”ê°€ ì—†ë‹¤. ë‹¨ì§€ "**ì–´ë–¤ ë°ì´í„°ê°€ í•„ìš”í•œì§€**"ë§Œ ì •ì˜í•œë‹¤.

ì´ê²ƒì´ ë°”ë¡œ `Repository Interface`ë‹¤. `Domain`ì€ ì¸í„°í˜ì´ìŠ¤ë§Œ ì •ì˜í•˜ê³ , `Data` Layerê°€ ì‹¤ì œ êµ¬í˜„ì„ ì œê³µí•œë‹¤.

```ts
// domain/repositories/PaymentGatewayRepository.ts
import type { PaymentGateway } from "@/domain/entities/PaymentGateway";
import type { User } from "@/domain/entities/User";

export interface PaymentGatewayRepository {
  getPaymentGateway(gatewayId: number): Promise<PaymentGateway>; // Entity ë°˜í™˜
  processPayment(
    gatewayId: number,
    userId: number,
    paymentAmount: number
  ): Promise<User>; // Entity ë°˜í™˜
}
```

```ts
// domain/repositories/UserRepository.ts
import type { User } from "@/domain/entities/User";

export interface UserRepository {
  getUser(userId: number): Promise<User>;
  processPayment(userId: number, paymentAmount: number): Promise<User>;
  processRefund(userId: number, refundAmount: number): Promise<User>;
}
```

**í•µì‹¬ì€ ë°˜í™˜ íƒ€ì…**ì´ë‹¤. `Repository Interface`ëŠ” `DTO`ê°€ ì•„ë‹Œ `Entity`ë¥¼ ë°˜í™˜í•œë‹¤. `Domain`ì€ `DTO`ì˜ ì¡´ì¬ì¡°ì°¨ ëª¨ë¥¸ë‹¤.

ì´ë ‡ê²Œ í•˜ë©´:

- **`Domain`ì€ `Data`ë¥¼ ëª°ë¼ë„ ëœë‹¤**: ì˜ì¡´ì„± ì—­ì „ ì›ì¹™
- **í…ŒìŠ¤íŠ¸ê°€ ì‰¬ì›Œì§„ë‹¤**: Mock Repositoryë¥¼ ì£¼ì…í•˜ë©´ ë
- **ë°ì´í„° ì†ŒìŠ¤ êµì²´ê°€ ììœ ë¡­ë‹¤**: HTTP â†’ LocalStorageë¡œ ë°”ê¿”ë„ `Domain`ì€ ëª¨ë¥¸ë‹¤

ë§ˆì¹˜ ì½˜ì„¼íŠ¸ì™€ í”ŒëŸ¬ê·¸ì˜ ê´€ê³„ë‹¤. ì½˜ì„¼íŠ¸(Interface)ëŠ” ê·œê²©ë§Œ ì •ì˜í•˜ê³ , ì–´ë–¤ ì „ê¸°(ë°ì´í„°)ê°€ ë“¤ì–´ì˜¤ë“  ìƒê´€ì—†ë‹¤.

---

### UseCase: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ íë¦„

`UseCase`ëŠ” ì—¬ëŸ¬ `Entity`ë¥¼ ì¡°í•©í•´ì„œ **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**ì„ ìˆ˜í–‰í•œë‹¤.

```ts
// domain/useCases/processPayment.ts
import { PaymentGateway } from "@/domain/entities/PaymentGateway";
import { User } from "@/domain/entities/User";
import type { PaymentGatewayRepository } from "@/domain/repositories/PaymentGatewayRepository";
import type { UserRepository } from "@/domain/repositories/UserRepository";

export class ProcessPaymentUseCase {
  constructor(
    private paymentGatewayRepository: PaymentGatewayRepository,
    private userRepository: UserRepository
  ) {}

  async execute(
    gateway: PaymentGateway,
    userId: number,
    paymentAmount: number
  ): Promise<User> {
    // 1. ì…ë ¥ê°’ ê²€ì¦
    PaymentGateway.validatePaymentAmount(paymentAmount);

    if (!gateway.canProcessPayment(paymentAmount)) {
      throw new Error("ì˜ˆì¹˜ê¸ˆ ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤");
    }

    // 2. Repository í˜¸ì¶œ (ì„œë²„ê°€ ìƒíƒœ ë³€ê²½)
    const user = await this.userRepository.processPayment(
      userId,
      paymentAmount
    );

    return user;
  }
}
```

`ProcessPaymentUseCase`ëŠ” ë‹¤ìŒì„ ìˆ˜í–‰í•œë‹¤:

1. **ì…ë ¥ê°’ ê²€ì¦**: `PaymentGateway` Entityì˜ ê·œì¹™ì„ ì‚¬ìš©í•´ ê²°ì œ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤
2. **Repository í˜¸ì¶œ**: `userRepository.processPayment()`ë¡œ ì„œë²„ì— ê²°ì œ ìš”ì²­ì„ ë³´ë‚´ê³ , ì„œë²„ê°€ ë³€ê²½í•œ ìµœì‹  ìƒíƒœë¥¼ `Entity`ë¡œ ë°˜í™˜ë°›ëŠ”ë‹¤

**ì¤‘ìš”í•œ ì›ì¹™**:

- **`Entity`ëŠ” ë¶ˆë³€ì´ë‹¤**: Tanstack Queryê°€ ì„œë²„ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ë¯€ë¡œ, EntityëŠ” ê²€ì¦ë§Œ ë‹´ë‹¹ (ìƒíƒœ ì¤‘ë³µ ë°©ì§€)
- **`UseCase`ëŠ” `Entity`ë§Œ ë°›ëŠ”ë‹¤**: `DTO`ë¥¼ ë³¼ ì¼ì´ ì—†ë‹¤
- **Tanstack Queryê°€ ìƒíƒœë¥¼ ê´€ë¦¬í•œë‹¤**: Entityì™€ ìºì‹œ ì‚¬ì´ì˜ ë¶ˆì¼ì¹˜ë¥¼ ë°©ì§€í•œë‹¤

`UseCase`ëŠ” **ì–´ë–¤ UI**ë¥¼ ì“°ëŠ”ì§€, **ì–´ë–¤ HTTP í´ë¼ì´ì–¸íŠ¸**ë¥¼ ì“°ëŠ”ì§€ ì „í˜€ ëª¨ë¥¸ë‹¤. ì˜¤ì§ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ ë‹´ë‹¹í•œë‹¤.

### í™˜ë¶ˆ ì²˜ë¦¬ UseCase ì˜ˆì‹œ

ê²°ì œ ê¸ˆì•¡ì„ ì§€ê°‘ ì”ì•¡ìœ¼ë¡œ í™˜ë¶ˆí•˜ëŠ” ë¡œì§ë„ `UseCase`ë¡œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

```ts
// domain/useCases/processRefund.ts
import { User } from "@/domain/entities/User";
import { PaymentGateway } from "@/domain/entities/PaymentGateway";
import type { UserRepository } from "@/domain/repositories/UserRepository";

interface ProcessRefundConfig {
  minConversionAmount: number; // ìµœì†Œ í™˜ë¶ˆ ê¸ˆì•¡ (ì„¤ì • ê°€ëŠ¥)
}

export class ProcessRefundUseCase {
  constructor(
    private userRepository: UserRepository,
    private config: ProcessRefundConfig
  ) {}

  async execute(
    user: User,
    gateway: PaymentGateway,
    refundAmount: number
  ): Promise<User> {
    // 1. ì…ë ¥ê°’ ê²€ì¦
    if (!user.canRefund(refundAmount, this.config.minConversionAmount)) {
      throw new Error("ê²°ì œ ì”ì•¡ì´ ë¶€ì¡±í•˜ê±°ë‚˜ ìµœì†Œ í™˜ë¶ˆ ê¸ˆì•¡ ë¯¸ë§Œì…ë‹ˆë‹¤");
    }

    if (!gateway.canProcessPayment(refundAmount)) {
      throw new Error("ê²°ì œ ëŒ€í–‰ì‚¬ ì˜ˆì¹˜ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤");
    }

    // 2. Repository í˜¸ì¶œ (ì„œë²„ê°€ ìƒíƒœ ë³€ê²½)
    const updatedUser = await this.userRepository.processRefund(
      user.id,
      refundAmount
    );

    return updatedUser;
  }
}
```

í™˜ë¶ˆ ì²˜ë¦¬ ë¡œì§ë„ **ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™**(í™˜ë¶ˆ ê°€ëŠ¥ ì—¬ë¶€, ìµœì†Œ ê¸ˆì•¡)ê³¼ **ë°ì´í„° ì²˜ë¦¬**(ì„œë²„ ìš”ì²­)ë¥¼ ë¶„ë¦¬í–ˆë‹¤. ìµœì†Œ í™˜ë¶ˆ ê¸ˆì•¡ì€ ì„¤ì •ìœ¼ë¡œ ì£¼ì…ë°›ì•„ ìœ ì—°í•˜ê²Œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.

---

## DI Layer: DI Containerë¡œ ì˜ì¡´ì„± ê´€ë¦¬

ì§€ê¸ˆê¹Œì§€ `Entity`, `Repository`, `UseCase`ë¥¼ ë§Œë“¤ì—ˆë‹¤. í•˜ì§€ë§Œ ì´ ëª¨ë“  ì˜ì¡´ì„±ì„ ì–´ë–»ê²Œ ê´€ë¦¬í• ê¹Œ?

`UseCase`ëŠ” `Repository`ê°€ í•„ìš”í•˜ê³ , `Repository`ëŠ” `DataSource`ê°€ í•„ìš”í•˜ê³ , `DataSource`ëŠ” `HttpClient`ê°€ í•„ìš”í•˜ë‹¤. ë§¤ë²ˆ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±í•˜ë©´ ì½”ë“œê°€ ë³µì¡í•´ì§„ë‹¤.

ì´ë•Œ **DI Container**ë¥¼ ì‚¬ìš©í•œë‹¤. DI ContainerëŠ” **ì˜ì¡´ì„±ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬í•˜ê³ , í•„ìš”í•  ë•Œ ì£¼ì…**í•´ì¤€ë‹¤.

ë§ˆì¹˜ ê³µì¥ì—ì„œ ì œí’ˆì„ ë§Œë“¤ ë•Œ í•„ìš”í•œ ë¶€í’ˆì„ ë¯¸ë¦¬ ì¤€ë¹„í•´ë‘ëŠ” ê²ƒê³¼ ê°™ë‹¤.

```ts
// di/DIContainer.ts
import { HttpClient } from "@/infrastructure/http/HttpClient";
import { PaymentGatewayDataSource } from "@/data/datasources/paymentGatewayDataSource";
import { UserDataSource } from "@/data/datasources/userDataSource";
import { PaymentGatewayRepositoryImpl } from "@/data/repositories/PaymentGatewayRepositoryImpl";
import { UserRepositoryImpl } from "@/data/repositories/UserRepositoryImpl";
import { ProcessPaymentUseCase } from "@/domain/useCases/processPayment";
import { ProcessRefundUseCase } from "@/domain/useCases/processRefund";
import type { PaymentGatewayRepository } from "@/domain/repositories/PaymentGatewayRepository";
import type { UserRepository } from "@/domain/repositories/UserRepository";

class DIContainer {
  private static _httpClient: HttpClient;
  private static _paymentGatewayDataSource: PaymentGatewayDataSource;
  private static _userDataSource: UserDataSource;
  private static _paymentGatewayRepository: PaymentGatewayRepository;
  private static _userRepository: UserRepository;

  static get httpClient() {
    return (this._httpClient ??= new AxiosHttpClient({
      baseURL: import.meta.env.VITE_API_URL,
      timeout: 10_000,
    }));
  }

  static get paymentGatewayDataSource() {
    return (this._paymentGatewayDataSource ??= new PaymentGatewayDataSource(
      this.httpClient
    ));
  }

  static get userDataSource() {
    return (this._userDataSource ??= new UserDataSource(this.httpClient));
  }

  static get paymentGatewayRepository() {
    return (this._paymentGatewayRepository ??= new PaymentGatewayRepositoryImpl(
      this.paymentGatewayDataSource
    ));
  }

  static get userRepository() {
    return (this._userRepository ??= new UserRepositoryImpl(
      this.userDataSource
    ));
  }

  // UseCases (ë§¤ë²ˆ ìƒˆë¡œ ìƒì„±)
  static get processPaymentUseCase() {
    return new ProcessPaymentUseCase(
      this.paymentGatewayRepository,
      this.userRepository
    );
  }

  static get processRefundUseCase() {
    return new ProcessRefundUseCase(this.userRepository, {
      minConversionAmount: 1_000,
    });
  }

  // í…ŒìŠ¤íŠ¸ìš©
  static setMockRepositories(pgRepo, userRepo) {
    this._paymentGatewayRepository = pgRepo;
    this._userRepository = userRepo;
  }
}

export default DIContainer;
```

**ì „ëµ**: `HttpClient`, `DataSource`, `Repository`ëŠ” ì‹±ê¸€í†¤ (`??=`), `UseCase`ëŠ” ë§¤ë²ˆ ìƒˆë¡œ ìƒì„±, í…ŒìŠ¤íŠ¸ ì‹œ Mock ì£¼ì… ê°€ëŠ¥.

### ì™œ ì‹±ê¸€í†¤ì¸ê°€? ë©”ëª¨ë¦¬ ë‚­ë¹„ ë°©ì§€

DI Container ì—†ì´ ë§¤ë²ˆ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

```ts
// âŒ ì•ˆí‹°íŒ¨í„´: ì»´í¬ë„ŒíŠ¸ë§ˆë‹¤ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
function useProcessPayment() {
  const httpClient = new AxiosHttpClient({ ... });  // ì¸ìŠ¤í„´ìŠ¤ 1
  const dataSource = new PaymentDataSource(httpClient);
  const repository = new PaymentRepositoryImpl(dataSource);
  const useCase = new ProcessPaymentUseCase(repository);
  // ...
}

function useProcessRefund() {
  const httpClient = new AxiosHttpClient({ ... });  // ì¸ìŠ¤í„´ìŠ¤ 2 (ì¤‘ë³µ!)
  const dataSource = new UserDataSource(httpClient);
  const repository = new UserRepositoryImpl(dataSource);
  const useCase = new ProcessRefundUseCase(repository);
  // ...
}

// ë¬¸ì œ: HttpClientê°€ ì»´í¬ë„ŒíŠ¸ë§ˆë‹¤ ìƒì„±ë¨
// - 10ê°œ ì»´í¬ë„ŒíŠ¸ â†’ HttpClient 10ê°œ
// - ë©”ëª¨ë¦¬ ë‚­ë¹„ + ì„¤ì • ë¶ˆì¼ì¹˜ ê°€ëŠ¥
```

DI ContainerëŠ” `??=` (Nullish coalescing assignment)ë¡œ **ì‹±ê¸€í†¤**ì„ êµ¬í˜„í•œë‹¤:

```ts
// âœ… DI Container: ì‹±ê¸€í†¤ìœ¼ë¡œ 1ë²ˆë§Œ ìƒì„±
static get httpClient() {
  return (this._httpClient ??= new AxiosHttpClient({ ... }));
  // _httpClientê°€ ì—†ìœ¼ë©´ ìƒì„±, ìˆìœ¼ë©´ ê¸°ì¡´ ê²ƒ ì¬ì‚¬ìš©
}
```

**ì´ì **:

- **ë©”ëª¨ë¦¬ íš¨ìœ¨**: `HttpClient` 1ê°œë§Œ ìƒì„±, ëª¨ë“  ê³³ì—ì„œ ì¬ì‚¬ìš©
- **ì„¤ì • ì¼ê´€ì„±**: `baseURL`, `timeout` ë“± ì„¤ì •ì´ í•­ìƒ ë™ì¼
- **ì„±ëŠ¥**: ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë¹„ìš© ì ˆê°

ë§ˆì¹˜ ì‚¬ë¬´ì‹¤ì—ì„œ ë³µì‚¬ê¸° 1ëŒ€ë¥¼ ì—¬ëŸ¬ ì‚¬ëŒì´ ê³µìœ í•˜ëŠ” ê²ƒê³¼ ê°™ë‹¤. ê°ì ë³µì‚¬ê¸°ë¥¼ ì‚¬ëŠ” ê²ƒë³´ë‹¤ í›¨ì”¬ íš¨ìœ¨ì ì´ë‹¤.

---

## Presentation Layer: UIì™€ ìƒí˜¸ì‘ìš©

`Presentation` ë ˆì´ì–´ëŠ” ì‚¬ìš©ìì™€ ì§ì ‘ ìƒí˜¸ì‘ìš©í•œë‹¤. 2ê°€ì§€ë¡œ êµ¬ì„±ëœë‹¤:

1. `Hook`: `Domain`ì˜ `UseCase`ë¥¼ í˜¸ì¶œ
2. `Component`: UIë¥¼ ë Œë”ë§

### Hook: UseCase í˜¸ì¶œ

```ts
// presentation/hooks/useProcessPayment.ts
import { useMutation } from "@tanstack/react-query";
import DIContainer from "@/di/DIContainer";
import type { PaymentGateway } from "@/domain/entities/PaymentGateway";
import type { User } from "@/domain/entities/User";

interface ProcessPaymentParams {
  userId: number;
  amount: number;
}

export function useProcessPayment(paymentGateway: PaymentGateway) {
  return useMutation<User, Error, ProcessPaymentParams>({
    mutationFn: async ({ userId, amount }: ProcessPaymentParams) => {
      // DI Containerì—ì„œ UseCaseë¥¼ ê°€ì ¸ì˜¨ë‹¤
      const processPaymentUseCase = DIContainer.processPaymentUseCase;
      return await processPaymentUseCase.execute(
        paymentGateway,
        userId,
        amount
      );
    },
  });
}
```

`useProcessPayment` Hookì€ `DI Container`ì—ì„œ `UseCase`ë¥¼ ê°€ì ¸ì˜¨ë‹¤. ì˜ì¡´ì„±ì„ ì™¸ë¶€ì—ì„œ ì£¼ì…ë°›ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, **ì¤‘ì•™ ì§‘ì¤‘ì‹ìœ¼ë¡œ ê´€ë¦¬**í•œë‹¤.

### Component: UI ë Œë”ë§

```ts
// presentation/components/PaymentButton.tsx
import { useProcessPayment } from "@/presentation/hooks/useProcessPayment";
import type { PaymentGateway } from "@/domain/entities/PaymentGateway";

interface PaymentButtonProps {
  paymentGateway: PaymentGateway;
  userId: number;
  paymentAmount: number;
}

export function PaymentButton({
  paymentGateway,
  userId,
  paymentAmount,
}: PaymentButtonProps) {
  const { mutate, isPending, error } = useProcessPayment(paymentGateway);

  const handleClick = () => {
    mutate(
      { userId, amount: paymentAmount },
      {
        onSuccess: (user) => {
          alert(`ê²°ì œ ì™„ë£Œ! ì‚¬ìš©ì: ${user.name}`);
        },
      }
    );
  };

  return (
    <div>
      <button onClick={handleClick} disabled={isPending}>
        {isPending ? "ê²°ì œ ì¤‘..." : "ê²°ì œí•˜ê¸°"}
      </button>
      {error && <p style={{ color: "red" }}>{error.message}</p>}
    </div>
  );
}
```

`PaymentButton` ì»´í¬ë„ŒíŠ¸ëŠ” **UIë§Œ** ë‹´ë‹¹í•œë‹¤. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ `UseCase`ì— ìœ„ì„í•˜ê³ , `UseCase`ëŠ” `DI Container`ê°€ ì œê³µí•œë‹¤.

### ì˜ì¡´ì„± ì£¼ì…

"ì–´? `UseCase`ë¥¼ ì–´ë””ì„œ ê°€ì ¸ì™”ì§€?"

ì•ì—ì„œ ë§Œë“  **DI Container**ì—ì„œ ê°€ì ¸ì˜¨ë‹¤! Hookì—ì„œ `DIContainer.processPaymentUseCase`ë¥¼ í˜¸ì¶œí•˜ë©´, ëª¨ë“  ì˜ì¡´ì„±ì´ ìë™ìœ¼ë¡œ ì£¼ì…ëœ `UseCase`ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.

**ì™œ DI Containerê°€ ì¤‘ìš”í• ê¹Œ?**

ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ì§ì ‘ ìƒì„±í•˜ë©´ **í…ŒìŠ¤íŠ¸ê°€ ë§¤ìš° ì–´ë µë‹¤**. í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ì‹¤ì œ `HttpClient`ë¥¼ ëª¨í‚¹í•˜ê±°ë‚˜, í…ŒìŠ¤íŠ¸ìš© ì„œë²„ë¥¼ ë„ì›Œì•¼ í•œë‹¤.

```ts
// âŒ ë‚˜ìœ ì˜ˆì‹œ: ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ìƒì„±
function PaymentButton({ paymentGateway, userId, paymentAmount }: Props) {
  // ì»´í¬ë„ŒíŠ¸ ì•ˆì—ì„œ ì§ì ‘ ìƒì„±
  const httpClient = new AxiosHttpClient();
  const paymentGatewayRepo = new PaymentGatewayRepositoryImpl(httpClient);
  const userRepo = new UserRepositoryImpl(httpClient);
  const useCase = new ProcessPaymentUseCase(paymentGatewayRepo, userRepo);

  const handleProcessPayment = async () => {
    await useCase.execute(paymentGateway, userId, paymentAmount);
  };
  // ...
}

// ë¬¸ì œì :
// 1. ì‹¤ì œ APIë¥¼ í˜¸ì¶œí•¨ (í…ŒìŠ¤íŠ¸ê°€ ëŠë¦¬ê³  ë¶ˆì•ˆì •)
// 2. Mockìœ¼ë¡œ ë°”ê¿€ ë°©ë²•ì´ ì—†ìŒ
// 3. ë„¤íŠ¸ì›Œí¬ ì—†ìœ¼ë©´ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨
```

DI Containerë¥¼ ì‚¬ìš©í•˜ë©´ **ì¤‘ì•™ ì§‘ì¤‘ì‹ìœ¼ë¡œ ì˜ì¡´ì„±ì„ ê´€ë¦¬**í•˜ê³ , **í…ŒìŠ¤íŠ¸ ì‹œ Mockìœ¼ë¡œ êµì²´**í•  ìˆ˜ ìˆë‹¤.

#### í…ŒìŠ¤íŠ¸ì—ì„œ Mock ì£¼ì…

```ts
// PaymentButton.test.tsx
import { test, expect, vi, beforeEach, afterEach } from "vitest";
import { render, fireEvent, screen } from "@testing-library/react";
import { PaymentButton } from "./PaymentButton";
import DIContainer from "@/di/DIContainer";
import type { PaymentGatewayRepository } from "@/domain/repositories/PaymentGatewayRepository";
import type { UserRepository } from "@/domain/repositories/UserRepository";
import { PaymentGateway } from "@/domain/entities/PaymentGateway";
import { User } from "@/domain/entities/User";

// Mock Repository ìƒì„±
const mockPaymentGatewayRepository: PaymentGatewayRepository = {
  getPaymentGateway: vi.fn(),
  processPayment: vi.fn(),
};

const mockUserRepository: UserRepository = {
  getUser: vi.fn(),
  processPayment: vi.fn().mockResolvedValue(
    new User({
      id: 1,
      name: "ê¹€ì‚¬ìš©ì",
      gatewayId: 1,
      paymentBalance: 1_500, // ê²°ì œ í›„ ì”ì•¡
      walletBalance: 0,
      createdAt: new Date(),
      updatedAt: new Date(),
    })
  ),
  processRefund: vi.fn(),
};

beforeEach(() => {
  // í…ŒìŠ¤íŠ¸ ì „ì— Mock Repository ì£¼ì…
  DIContainer.setMockRepositories(
    mockPaymentGatewayRepository,
    mockUserRepository
  );
});

afterEach(() => {
  // í…ŒìŠ¤íŠ¸ í›„ DI Container ì´ˆê¸°í™”
  DIContainer.reset();
  vi.clearAllMocks();
});

test("ê²°ì œ ë²„íŠ¼ í´ë¦­ ì‹œ UseCase í˜¸ì¶œ", async () => {
  const paymentGateway = new PaymentGateway({
    id: 1,
    name: "í…ŒìŠ¤íŠ¸ê²°ì œì‚¬",
    walletBalance: 100_000,
    createdAt: new Date(),
    updatedAt: new Date(),
  });

  render(
    <PaymentButton
      paymentGateway={paymentGateway}
      userId={1}
      paymentAmount={500}
    />
  );

  fireEvent.click(screen.getByText("ê²°ì œí•˜ê¸°"));

  // Mock Repositoryê°€ ì˜¬ë°”ë¥´ê²Œ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ê²€ì¦
  await vi.waitFor(() => {
    expect(mockUserRepository.processPayment).toHaveBeenCalledWith(1, 1_000);
  });
});
```

DI Container ë•ë¶„ì— **ì‹¤ì œ APIë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šê³ ë„** ì»´í¬ë„ŒíŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤. `setMockRepositories`ë¡œ Mockì„ ì£¼ì…í•˜ê³ , `reset()`ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ë©´ ëœë‹¤.

### Adapter: Entityë¥¼ UIì— ë§ê²Œ ê°€ê³µ (ì„ íƒ)

ëŒ€ë¶€ë¶„ì˜ ê²½ìš° Entityë¥¼ ê·¸ëŒ€ë¡œ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ë©´ ëœë‹¤. í•˜ì§€ë§Œ **ë³µì¡í•œ UI ë¡œì§**ì´ë‚˜ **ì—¬ëŸ¬ Entityë¥¼ ì¡°í•©**í•´ì•¼ í•  ë•ŒëŠ” `Adapter`ë¥¼ ì‚¬ìš©í•œë‹¤.

`Adapter`ëŠ” Entityë¥¼ UIì— ìµœì í™”ëœ í˜•íƒœë¡œ ë³€í™˜í•œë‹¤. ë§ˆì¹˜ ì½˜ì„¼íŠ¸ ì–´ëŒ‘í„°ì²˜ëŸ¼, Entity(220V)ë¥¼ UI(110V)ì— ë§ê²Œ ë³€í™˜í•˜ëŠ” ì—­í• ì´ë‹¤.

AdapterëŠ” Mapperì™€ ë§ˆì°¬ê°€ì§€ë¡œ classê°€ ì•„ë‹Œ **ìˆœìˆ˜ í•¨ìˆ˜**ë¡œ êµ¬í˜„í•œë‹¤.

#### ê³µí†µ ìœ í‹¸ í•¨ìˆ˜: formatters.ts

ì—¬ëŸ¬ Adapterì—ì„œ ë°˜ë³µ ì‚¬ìš©ë˜ëŠ” í¬ë§·íŒ… ë¡œì§ì€ ê³µí†µ ìœ í‹¸ í•¨ìˆ˜ë¡œ ë¶„ë¦¬í•œë‹¤.

```ts
// presentation/utils/formatters.ts

/**
 * ê²°ì œ ê¸ˆì•¡ì„ í¬ë§·íŒ…
 * @example formatPayments(500) // "500P"
 */
export function formatPayments(payments: number): string {
  return `${payments.toLocaleString()}P`;
}

/**
 * ë‚ ì§œë¥¼ í•œêµ­ í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…
 * @example formatDate(new Date()) // "2025-01-08"
 */
export function formatDate(date: Date): string {
  return date.toLocaleDateString("ko-KR");
}

/**
 * ë‚ ì§œì‹œê°„ì„ í•œêµ­ í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…
 * @example formatDateTime(new Date()) // "2025-01-08 15:30"
 */
export function formatDateTime(date: Date): string {
  return date.toLocaleString("ko-KR", {
    year: "numeric",
    month: "2-digit",
    day: "2-digit",
    hour: "2-digit",
    minute: "2-digit",
  });
}
```

#### ì–¸ì œ Adapterë¥¼ ì“¸ê¹Œ?

ë‹¤ìŒê³¼ ê°™ì€ ê²½ìš°ì—ë§Œ `Adapter`ë¥¼ ì‚¬ìš©í•œë‹¤:

1. **ì—¬ëŸ¬ Entityë¥¼ ì¡°í•©**í•´ì•¼ í•  ë•Œ (User + PaymentGateway)
2. **ë³µì¡í•œ UI ë³€í™˜**ì´ í•„ìš”í•  ë•Œ (ìˆ«ì â†’ "500P", ë‚ ì§œ â†’ "2025-01-08")
3. **Entityë¥¼ ìˆœìˆ˜í•˜ê²Œ ìœ ì§€**í•˜ê³  ì‹¶ì„ ë•Œ (UI ë¡œì§ì„ Entityì— ë„£ì§€ ì•Šê¸°)

#### Adapterì˜ 3ê°€ì§€ í•µì‹¬ ì¥ì 

##### 1. UI ë¡œì§ ê²©ë¦¬

EntityëŠ” **ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™**ë§Œ ë‹´ë‹¹í•˜ê³ , UI í‘œí˜„ ë¡œì§ì€ `Adapter`ê°€ ë‹´ë‹¹í•œë‹¤.

```ts
// âŒ Entityì— UI ë¡œì§ì„ ë„£ìœ¼ë©´?
class User {
  getDisplayPayments(): string {
    return `${this.paymentBalance.toLocaleString()}P`; // UI ë¡œì§ì´ Entityì—!
  }

  getDisplayWallet(): string {
    return `${this.walletBalance.toLocaleString()}ì›`; // UI ë¡œì§ì´ Entityì—!
  }
}

// âœ… Adapter í•¨ìˆ˜ë¡œ ë¶„ë¦¬
export function adaptUserForView(user: User) {
  return {
    displayPaymentBalance: formatPayments(user.paymentBalance), // UI ë¡œì§ì€ Adapterì—
    displayWalletBalance: formatCurrency(user.walletBalance),
  };
}
```

ì´ë ‡ê²Œ ë¶„ë¦¬í•˜ë©´ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë™ì¼í•œ Adapter í•¨ìˆ˜ë¥¼ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

##### 2. Entity ìˆœìˆ˜ì„± ìœ ì§€

EntityëŠ” UIë¥¼ ì „í˜€ ëª¨ë¥¸ë‹¤. ë•ë¶„ì— **ì„œë²„ì™€ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë™ì¼í•œ Entity**ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```ts
// domain/entities/User.ts (í”„ë¡ íŠ¸ì—”ë“œ - ë¶ˆë³€ íŒ¨í„´)
export class User {
  private readonly _paymentBalance: number; // ë¶ˆë³€
  private readonly _walletBalance: number; // ë¶ˆë³€

  // âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ë§Œ ë‹´ë‹¹ (ê²€ì¦ ë¡œì§)
  canRefund(amount: number, minRefundAmount: number): boolean {
    return this._paymentBalance >= amount && amount >= minRefundAmount;
  }

  canUseWallet(amount: number): boolean {
    return this._walletBalance >= amount;
  }

  // âŒ ìƒíƒœ ë³€ê²½ ë©”ì„œë“œëŠ” ì—†ìŒ (ì„œë²„ê°€ ìƒíƒœ ë³€ê²½)
  // processRefundToBalance() ê°™ì€ ë©”ì„œë“œ ì—†ìŒ
}
```

##### 3. í…ŒìŠ¤íŠ¸ ìš©ì´ì„±

AdapterëŠ” **ìˆœìˆ˜ í•¨ìˆ˜**ë¼ì„œ í…ŒìŠ¤íŠ¸ê°€ ì‰½ë‹¤. ê°™ì€ ì…ë ¥ì„ ë„£ìœ¼ë©´ í•­ìƒ ê°™ì€ ê²°ê³¼ê°€ ë‚˜ì˜¤ê³ , ì™¸ë¶€ ìƒíƒœë¥¼ ë³€ê²½í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤.

```ts
import { test, expect } from "vitest";
import { adaptUserForView } from "@/presentation/adapters/userAdapter";

test("userAdapterëŠ” ê²°ì œ ê¸ˆì•¡ê³¼ ì§€ê°‘ ì”ì•¡ì„ í¬ë§·íŒ…í•œë‹¤", () => {
  const user = new User({
    id: 1,
    name: "ê¹€ì‚¬ìš©ì",
    gatewayId: 1,
    paymentBalance: 5_000,
    walletBalance: 10_000,
    createdAt: new Date(),
    updatedAt: new Date(),
  });

  const view = adaptUserForView(user, paymentGateway, 5_000);

  expect(view.displayPaymentBalance).toBe("5,000P");
  expect(view.displayWalletBalance).toBe("10,000ì›");
});
```

#### ì˜ˆì‹œ 1: ë³µì¡í•œ UI ë³€í™˜ - userAdapter

ì‚¬ìš©ì ì •ë³´ë¥¼ UIì— ë§ê²Œ ê°€ê³µí•˜ëŠ” Adapter í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ë³´ì.

```ts
// presentation/adapters/userAdapter.ts
import type { User } from "@/domain/entities/User";
import type { PaymentGateway } from "@/domain/entities/PaymentGateway";
import {
  formatCurrency,
  formatPayments,
  formatDate,
} from "@/presentation/utils/formatters";

interface UserView {
  userId: number;
  userName: string;
  paymentGatewayName: string;
  displayPaymentBalance: string; // "5,000P"
  displayWalletBalance: string; // "10,000ì›"
  canProcessRefund: boolean;
  minConversionMessage: string; // "ìµœì†Œ 5,000ì›ë¶€í„° ì „í™˜ ê°€ëŠ¥"
  lastUpdated: string; // "2025-01-08"
}

export function adaptUserForView(
  user: User,
  paymentGateway: PaymentGateway,
  minConversionAmount: number
): UserView {
  return {
    userId: user.id,
    userName: user.name,
    paymentGatewayName: paymentGateway.name,
    displayPaymentBalance: formatPayments(user.paymentBalance),
    displayWalletBalance: formatCurrency(user.walletBalance),
    canProcessRefund: user.canRefund(user.paymentBalance, minConversionAmount),
    minConversionMessage: getConversionMessage(minConversionAmount),
    lastUpdated: formatDate(user.updatedAt),
  };
}

function getConversionMessage(minAmount: number): string {
  return `ìµœì†Œ ${formatCurrency(minAmount)}ë¶€í„° ì „í™˜ ê°€ëŠ¥`;
}
```

#### ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ê¸°

ì»´í¬ë„ŒíŠ¸ëŠ” Adapterë¡œ ë³€í™˜ëœ ë°ì´í„°ë¥¼ ì‚¬ìš©í•œë‹¤.

```ts
// presentation/components/UserCard.tsx
export function UserCard({ user, paymentGateway, minConversionAmount }: Props) {
  const view = adaptUserForView(user, paymentGateway, minConversionAmount);

  return (
    <div className="user-card">
      <h3>{view.userName}</h3>
      <p className="payments">{view.displayPaymentBalance}</p>
      <p className="wallet">{view.displayWalletBalance}</p>
    </div>
  );
}
```

#### Adapterë¥¼ ì“°ì§€ ì•ŠëŠ” ê²½ìš°

ë‹¨ìˆœí•œ ê²½ìš°ì—ëŠ” Entityë¥¼ ê·¸ëŒ€ë¡œ ì“´ë‹¤.

```ts
// presentation/components/SimpleRefundButton.tsx
import type { User } from "@/domain/entities/User";

interface Props {
  user: User;
  minConversionAmount: number;
}

export function SimpleRefundButton({ user, minConversionAmount }: Props) {
  // Adapter ì—†ì´ Entity ì§ì ‘ ì‚¬ìš© (ê°„ë‹¨í•  ë•Œ)
  return (
    <button
      disabled={!user.canRefund(user.paymentBalance, minConversionAmount)}
    >
      {user.paymentBalance}P í™˜ë¶ˆí•˜ê¸°
    </button>
  );
}
```

---

## ì „ì²´ ê²°ì œ ì²˜ë¦¬ Flow: ëª¨ë“  ë ˆì´ì–´ í†µê³¼í•˜ê¸°

ì´ì œ ê´€ë¦¬ìê°€ "ê²°ì œ ì²˜ë¦¬" ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ **ëª¨ë“  ë ˆì´ì–´**ë¥¼ ì–´ë–»ê²Œ í†µê³¼í•˜ëŠ”ì§€ ì‚´í´ë³´ì.

### 1. ê´€ë¦¬ìê°€ ë²„íŠ¼ í´ë¦­

```ts
// Presentation Layer: Component
<button onClick={handleClick}>ê²°ì œ ì²˜ë¦¬</button>
```

### 2. Hookì´ UseCase í˜¸ì¶œ

```ts
// Presentation Layer: Hook
const transaction = await processPaymentUseCase.execute(
  gatewayId,
  userId,
  paymentAmount
);
```

### 3. UseCaseê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰

```ts
// Domain Layer: UseCase
PaymentGateway.validatePaymentAmount(amount); // ê²°ì œ ê¸ˆì•¡ ê²€ì¦
gateway.canProcessPayment(amount); // ì˜ˆì¹˜ê¸ˆ ì”ì•¡ ê²€ì¦
const transactionDto = await this.paymentRepository.processPayment(
  gatewayId,
  userId,
  amount
); // API í˜¸ì¶œ
```

### 4. Repositoryê°€ DataSource í˜¸ì¶œ

```ts
// Data Layer: Repository
return this.paymentDataSource.processPayment(gatewayId, userId, amount);
```

### 5. DataSourceê°€ API í˜¸ì¶œ

```ts
// Data Layer: DataSource
return this.httpClient.post<PaymentTransactionDto>("/api/payments/process", {
  gateway_id: gatewayId,
  user_id: userId,
  amount,
});
```

### 6. HTTP Clientê°€ ì‹¤ì œ ìš”ì²­

```ts
// Infrastructure Layer: HTTP Client
const response = await axios.post(url, data);
return response.data;
```

### 7. ì‘ë‹µì´ ë‹¤ì‹œ ì—­ìˆœìœ¼ë¡œ ëŒì•„ì˜´

```
Infrastructure â†’ Data (DataSource) â†’ Data (Repository) â†’ Data (Mapper) â†’ Domain (Entity) â†’ Presentation
```

```ts
// Data Layer: Mapper í•¨ìˆ˜
const transaction = mapPaymentTransactionDtoToDomain(transactionDto);
```

### 7. Entityê°€ ì»´í¬ë„ŒíŠ¸ë¡œ ì „ë‹¬

```ts
// Presentation Layer: Component
alert(`ê²°ì œ ì²˜ë¦¬ ì™„ë£Œ! ê±°ë˜ ID: ${transaction.id}`);
```

### ì „ì²´ Flow ìš”ì•½

```
ğŸ‘¤ ê´€ë¦¬ì ë²„íŠ¼ í´ë¦­
  â†“
ğŸ¨ Presentation: Hook â†’ UseCase í˜¸ì¶œ
  â†“
ğŸ§  Domain: UseCase â†’ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ + Repository í˜¸ì¶œ
  â†“
ğŸ“¦ Data: Repository â†’ HTTP Client í˜¸ì¶œ
  â†“
ğŸŒ Infrastructure: HTTP Client â†’ API ìš”ì²­
  â†“
ğŸŒ Infrastructure: ì‘ë‹µ ë°›ìŒ (DTO)
  â†“
ğŸ“¦ Data: Mapper í•¨ìˆ˜ â†’ DTOë¥¼ Entityë¡œ ë³€í™˜
  â†“
ğŸ§  Domain: Entity ë°˜í™˜
  â†“
ğŸ¨ Presentation: UI ì—…ë°ì´íŠ¸
```

---

## ìœ ì§€ë³´ìˆ˜ê°€ ì‰¬ìš´ ì´ìœ : ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤

í´ë¦° ì•„í‚¤í…ì²˜ì˜ ì§„ì§œ ê°•ì ì€ **ë³€ê²½ì— ê°•í•˜ë‹¤**ëŠ” ì ì´ë‹¤. ì‹¤ì œ ìƒí™©ì„ ì‚´í´ë³´ì.

### ì‹œë‚˜ë¦¬ì˜¤ 1: ê¸°íšì - "ê²°ì œ ì²˜ë¦¬ í›„ ì„±ê³µ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì£¼ì„¸ìš”"

#### Before (í´ë¦° ì•„í‚¤í…ì²˜ ì—†ì„ ë•Œ)

```js
// âŒ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¾ì•„ì„œ ê°ê° ìˆ˜ì •í•´ì•¼ í•¨
// components/ProcessPaymentButton.jsx
const handleClick = async () => {
  const response = await axios.post("/api/process-payment", data);
  toast.success("ê²°ì œë¥¼ ì²˜ë¦¬í–ˆë‹¤"); // â† ì¶”ê°€
};

// components/QuickPaymentButton.jsx
const handleQuickPayment = async () => {
  const response = await axios.post("/api/quick-payment", data);
  toast.success("ë¹ ë¥¸ ê²°ì œë¥¼ ì²˜ë¦¬í–ˆë‹¤"); // â† ì¶”ê°€
};

// components/RecurringPaymentButton.jsx
const handleRecurring = async () => {
  const response = await axios.post("/api/recurring-payment", data);
  toast.success("ì •ê¸° ê²°ì œë¥¼ ì²˜ë¦¬í–ˆë‹¤"); // â† ì¶”ê°€
};
```

#### After (í´ë¦° ì•„í‚¤í…ì²˜)

```ts
// âœ… Hook 1ê°œë§Œ ìˆ˜ì •í•˜ë©´ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì— ì ìš©ë¨
// presentation/hooks/useProcessPayment.ts
export function useProcessPayment(
  gateway: PaymentGateway,
  processPaymentUseCase: ProcessPaymentUseCase
) {
  return useMutation<User, Error, ProcessPaymentParams>({
    mutationFn: async ({ userId, amount }: ProcessPaymentParams) => {
      return await processPaymentUseCase.execute(gateway, userId, amount);
    },
+   onSuccess: () => {
+     toast.success("ê²°ì œë¥¼ ì²˜ë¦¬í–ˆë‹¤");
+   },
  });
}
```

**ë³€ê²½ ë²”ìœ„**: Hook 1ê°œ íŒŒì¼ (ëª¨ë“  ê²°ì œ ì²˜ë¦¬ ë²„íŠ¼ì— ìë™ ì ìš©)

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì„œë²„ - "API ì‘ë‹µ êµ¬ì¡°ê°€ ë°”ë€Œì—ˆì–´ìš”"

ì„œë²„ê°€ `transaction_id` ëŒ€ì‹  `id`ë¥¼ ë³´ë‚´ê¸° ì‹œì‘í–ˆë‹¤.

#### Before (í´ë¦° ì•„í‚¤í…ì²˜ ì—†ì„ ë•Œ)

```js
// âŒ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ìˆ˜ì •í•´ì•¼ í•¨
// components/ProcessPaymentButton.jsx
const transactionId = response.data.transaction_id; // â† ì—¬ê¸°
alert(`ê²°ì œ ì²˜ë¦¬ ì™„ë£Œ! ID: ${transactionId}`);

// components/PaymentHistory.jsx
const id = item.transaction_id; // â† ì—¬ê¸°ë„

// components/TransactionDetail.jsx
const transactionId = transaction.transaction_id; // â† ì—¬ê¸°ë„
```

#### After (í´ë¦° ì•„í‚¤í…ì²˜)

```diff
// âœ… Data Layerì˜ Mapper í•¨ìˆ˜ë§Œ ìˆ˜ì •
// data/mappers/paymentTransactionMapper.ts
  export function mapPaymentTransactionDtoToDomain(dto: PaymentTransactionDto): PaymentTransaction {
    return new PaymentTransaction({
-     id: dto.transaction_id,
+     id: dto.id,
      gatewayId: dto.gateway_id,
      userId: dto.user_id,
      amount: dto.amount,
      // ...
    });
  }
```

**ë³€ê²½ ë²”ìœ„**: Data Layerì˜ Mapper í•¨ìˆ˜ 1ê°œ íŒŒì¼

ë‚˜ë¨¸ì§€ ì½”ë“œëŠ” `PaymentTransaction` Entityì˜ `id` ì†ì„±ë§Œ ì“°ë¯€ë¡œ **ì•„ë¬´ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ”ë‹¤**.

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: ê¸°íšì - "í™˜ë¶ˆ ìµœì†Œ ê¸ˆì•¡ì„ 5,000ì›ì—ì„œ 10,000ì›ìœ¼ë¡œ ë°”ê¿”ì£¼ì„¸ìš”"

#### Before (í´ë¦° ì•„í‚¤í…ì²˜ ì—†ì„ ë•Œ)

```js
// âŒ ì»´í¬ë„ŒíŠ¸ ê³³ê³³ì˜ ifë¬¸ì„ ì°¾ì•„ì„œ ìˆ˜ì •
// components/RefundButton.jsx
if (amount < 5_000) {
  alert("ìµœì†Œ í™˜ë¶ˆ ê¸ˆì•¡ì€ 5,000ì›ì…ë‹ˆë‹¤");
}

// components/RefundForm.jsx
if (payment < 5_000) {
  return "ìµœì†Œ 5,000ì› ì´ìƒ";
}

// components/PaymentInput.jsx
<input min={5_000} />;
```

#### After (í´ë¦° ì•„í‚¤í…ì²˜)

```diff
// âœ… Domain Layerì˜ Entity 1ì¤„ë§Œ ìˆ˜ì •
// domain/entities/User.ts
- static readonly MIN_REFUND_AMOUNT = 5_000;
+ static readonly MIN_REFUND_AMOUNT = 10_000;
```

**ë³€ê²½ ë²”ìœ„**: Domain Layerì˜ Entity 1ì¤„

ëª¨ë“  ê³³ì—ì„œ `User.MIN_REFUND_AMOUNT`ë¥¼ ì°¸ì¡°í•˜ë¯€ë¡œ **ìë™ìœ¼ë¡œ ì ìš©**ëœë‹¤.

---

### ì‹œë‚˜ë¦¬ì˜¤ 4: ê°œë°œì - "í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ì‹¶ì–´ìš”"

#### Before (í´ë¦° ì•„í‚¤í…ì²˜ ì—†ì„ ë•Œ)

```js
// âŒ í…ŒìŠ¤íŠ¸ ë³µì¡í•¨ (API, ì„œë²„ ì‘ë‹µ í˜•ì‹, ì—”ë“œí¬ì¸íŠ¸ ë“± ëª¨ë‘ ëª¨í‚¹ í•„ìš”)
// import { test } from "vitest";
test("í™˜ë¶ˆ ë²„íŠ¼ í´ë¦­ ì‹œ í™˜ë¶ˆ", async () => {
  // axios ëª¨í‚¹ â†’ ì„œë²„ ì‘ë‹µ í˜•ì‹ â†’ snake_case ì²˜ë¦¬ â†’ ...
  // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ í…ŒìŠ¤íŠ¸í•˜ê³  ì‹¶ì€ë° API ì˜ì¡´ì„±ì´ ë„ˆë¬´ ë§ë‹¤
});
```

#### After (í´ë¦° ì•„í‚¤í…ì²˜)

```ts
// âœ… Domain Layer ë…ë¦½ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
import { test, expect } from "vitest";
import { User } from "@/domain/entities/User";

test("ìµœì†Œ í™˜ë¶ˆ ê¸ˆì•¡ ë¯¸ë§Œì´ë©´ í™˜ë¶ˆ ë¶ˆê°€", () => {
  const user = new User({
    id: 1,
    name: "ê¹€ì‚¬ìš©ì",
    gatewayId: 1,
    paymentBalance: 8_000,
    walletBalance: 0,
    createdAt: new Date(),
    updatedAt: new Date(),
  });

  expect(user.canRefund(8_000, 10_000)).toBe(false);
});
```

```ts
// âœ… UseCase í…ŒìŠ¤íŠ¸ (Repository ëª¨í‚¹)
test("ì˜ˆì¹˜ê¸ˆ ë¶€ì¡± ì‹œ ì—ëŸ¬", async () => {
  const mockRepository = { processPayment: vi.fn() };
  const useCase = new ProcessPaymentUseCase(mockRepository);
  const gateway = new PaymentGateway({
    id: 1,
    name: "í…ŒìŠ¤íŠ¸ê²°ì œëŒ€í–‰ì‚¬",
    walletBalance: 3_000,
    createdAt: new Date(),
    updatedAt: new Date(),
  });

  await expect(useCase.execute(gateway, 1, 5_000)).rejects.toThrow(
    "ì˜ˆì¹˜ê¸ˆì´ ë¶€ì¡±í•˜ë‹¤"
  );
});
```

**ë³€ê²½ ë²”ìœ„**: í…ŒìŠ¤íŠ¸ë§Œ ì¶”ê°€ (ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ë¶ˆí•„ìš”)

---

### ì‹œë‚˜ë¦¬ì˜¤ 5: ê¸°íšì - "ì˜ˆì¹˜ê¸ˆ ì¶©ì „ ê¸°ëŠ¥ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”"

ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì¶”ê°€í•  ë•Œ í´ë¦° ì•„í‚¤í…ì²˜ì˜ ì§„ê°€ê°€ ë“œëŸ¬ë‚œë‹¤.

#### Before (í´ë¦° ì•„í‚¤í…ì²˜ ì—†ì„ ë•Œ)

```js
// âŒ ì—¬ëŸ¬ ê³³ì„ ìˆ˜ì •í•´ì•¼ í•¨
// components/DepositButton.js
const handleDeposit = async () => {
  // ì¶©ì „ ë¡œì§ì„ ì²˜ìŒë¶€í„° ì‘ì„±
  if (depositAmount <= 0) {
    alert("ì¶©ì „ ê¸ˆì•¡ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤");
    return;
  }

  const response = await axios.post(`/api/payment-gateways/deposit`, {
    payment_gateway_id: gatewayId,
    amount: depositAmount,
  });
  // ...
};

// components/QuickDepositButton.jsx
// ë˜‘ê°™ì€ ì¶©ì „ ë¡œì§ ë³µì‚¬...

// components/WalletPage.jsx
// ë˜ ë˜‘ê°™ì€ ì¶©ì „ ë¡œì§ ë³µì‚¬...
```

#### After (í´ë¦° ì•„í‚¤í…ì²˜)

í´ë¦° ì•„í‚¤í…ì²˜ì—ì„œëŠ” **ê° ë ˆì´ì–´ì— í•„ìš”í•œ ë¶€ë¶„ë§Œ ì¶”ê°€**í•˜ë©´ ëœë‹¤.

```ts
// UseCase ì¶”ê°€
export class DepositToGatewayUseCase {
  async execute(gateway: PaymentGateway, amount: number) {
    if (amount <= 0 || amount > 10_000_000) {
      throw new Error("ì¶©ì „ ê¸ˆì•¡ì€ 0ì›~1,000ë§Œì›ì´ì–´ì•¼ í•©ë‹ˆë‹¤");
    }
    return await this.paymentGatewayRepository.deposit(gateway.id, amount);
  }
}

// Hook ì¶”ê°€
export function useDeposit(gateway, depositUseCase) {
  return useMutation({
    mutationFn: ({ amount }) => depositUseCase.execute(gateway, amount),
    onSuccess: (updated) =>
      queryClient.setQueryData(["gateway", updated.id], updated),
  });
}
```

**ë³€ê²½ ë²”ìœ„**: ê° ë ˆì´ì–´ì— 1ê°œ íŒŒì¼ì”© ì¶”ê°€ (ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ì—†ìŒ). ë¡œì§ì„ ë³µì‚¬í•˜ì§€ ì•Šê³  ì¬ì‚¬ìš©í•œë‹¤.

---

### ì‹œë‚˜ë¦¬ì˜¤ 6: ê°œë°œì - "ê²°ì œì™€ í™˜ë¶ˆì„ ë™ì‹œì— ëˆ„ë¥´ë©´ ìƒíƒœê°€ ê¼¬ì—¬ìš”"

ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œ ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œë‹¤. ì‚¬ìš©ìê°€ "ê²°ì œ" ë²„íŠ¼ì„ ëˆ„ë¥´ê³ , ì‘ë‹µì´ ì˜¤ê¸° ì „ì— "í™˜ë¶ˆ" ë²„íŠ¼ì„ ë˜ ëˆ„ë¥´ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

#### ë¬¸ì œ: í´ë¼ì´ì–¸íŠ¸ê°€ ìƒíƒœë¥¼ ì§ì ‘ ë³€ê²½í•˜ë©´ ë™ê¸°í™” ë¬¸ì œ ë°œìƒ

```ts
// âŒ Entityê°€ ì§ì ‘ ìƒíƒœë¥¼ ë³€ê²½ â†’ ì„œë²„ì™€ ë¶ˆì¼ì¹˜
user.receivePayment(5_000); // í´ë¼ì´ì–¸íŠ¸: 15,000
// ì„œë²„ ì‘ë‹µ (ìˆ˜ìˆ˜ë£Œ ì°¨ê°): 14,950 â†’ ìƒíƒœ ë¶ˆì¼ì¹˜!
```

#### í•´ê²°: EntityëŠ” readonly, ì„œë²„ê°€ ìƒíƒœ ê²°ì •

```ts
// âœ… EntityëŠ” ê²€ì¦ë§Œ ìˆ˜í–‰
class User {
  private readonly _paymentBalance: number;
  canRefund(amount: number, minRefundAmount: number): boolean {
    return this._paymentBalance >= amount && amount >= minRefundAmount;
  }
}

// UseCaseëŠ” ì„œë²„ ì‘ë‹µë§Œ ì‚¬ìš©
const processPaymentUseCase = async (user: User, amount: number) => {
  PaymentGateway.validatePaymentAmount(amount);
  return await api.processPayment(user.id, amount);
};
```

TanStack Queryê°€ ì„œë²„ ì‘ë‹µìœ¼ë¡œ ìºì‹œë¥¼ ìë™ ì—…ë°ì´íŠ¸í•œë‹¤.

**í•µì‹¬**: **"Tanstack Queryê°€ ìƒíƒœ ê´€ë¦¬ë¥¼ ì „ë‹´í•œë‹¤"**. Entityì—ì„œë„ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ë©´ Tanstack Query ìºì‹œì™€ ë¶ˆì¼ì¹˜ê°€ ë°œìƒí•œë‹¤. ë”°ë¼ì„œ EntityëŠ” ë¶ˆë³€(`readonly`)ìœ¼ë¡œ ë§Œë“¤ì–´ ê²€ì¦ë§Œ ë‹´ë‹¹í•œë‹¤.

| êµ¬ë¶„               | Mutable Entity (âŒ)                   | Immutable Entity (âœ…)               |
| ------------------ | ------------------------------------- | ----------------------------------- |
| **ìƒíƒœ ê´€ë¦¬ ì£¼ì²´** | Entity + Tanstack Query (ì¤‘ë³µ)        | Tanstack Queryë§Œ                    |
| **ìƒíƒœ ë¶ˆì¼ì¹˜**    | Entityì™€ ìºì‹œê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ          | ë°œìƒí•˜ì§€ ì•ŠìŒ (ìºì‹œë§Œ ìƒíƒœ ê´€ë¦¬)    |
| **ë™ê¸°í™” ë°©ì‹**    | ìˆ˜ë™ (ì„œë²„ ì‘ë‹µì„ Entityì— ë°˜ì˜ í•„ìš”) | ìë™ (Tanstack Queryê°€ ìºì‹œ ê°±ì‹ )   |
| **ë™ì‹œ ìš”ì²­ ì²˜ë¦¬** | Race Condition ë°œìƒ ê°€ëŠ¥              | Tanstack Queryê°€ ìˆœì°¨ ì²˜ë¦¬          |
| **ë””ë²„ê¹…**         | ì–´ë””ì„œ ìƒíƒœê°€ ë°”ë€Œì—ˆëŠ”ì§€ ì¶”ì  ì–´ë ¤ì›€  | Tanstack Query DevToolsë¡œ ì¶”ì  ì‰¬ì›€ |

---

### ìœ ì§€ë³´ìˆ˜ ë¹„ìš© ë¹„êµ

| ë³€ê²½ ì‚¬í•­           | Before (ì•ˆí‹°íŒ¨í„´)                           | After (í´ë¦° ì•„í‚¤í…ì²˜)                |
| ------------------- | ------------------------------------------- | ------------------------------------ |
| ë²„íŠ¼ ìƒ‰ìƒ ë³€ê²½      | ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ ìˆ˜ì •                          | Presentation ë ˆì´ì–´ë§Œ                |
| API ì‘ë‹µ í˜•ì‹ ë³€ê²½  | ì„œë²„ì—ì„œ ë³€ê²½ëœ í•„ë“œëª… ëª¨ë“  ì»´í¬ë„ŒíŠ¸ ìˆ˜ì •   | Data ë ˆì´ì–´(Mapper)ë§Œ                |
| ìµœì†Œ ê¸ˆì•¡ ê·œì¹™ ë³€ê²½ | ì»´í¬ë„ŒíŠ¸ë§ˆë‹¤ í•˜ë“œì½”ë”©ëœ ê²€ì¦ ë¡œì§ ìˆ˜ì •      | Domain ë ˆì´ì–´(Entity) ìƒìˆ˜ 1ì¤„       |
| í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±    | ì»´í¬ë„ŒíŠ¸ê°€ API/ì „ì—­ ìƒíƒœ ì˜ì¡´ìœ¼ë¡œ ëª¨í‚¹ ë³µì¡ | Domain ë ˆì´ì–´ ìˆœìˆ˜ í•¨ìˆ˜ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸  |
| í™˜ë¶ˆ ê¸°ëŠ¥ ì¶”ê°€      | ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì— ì¤‘ë³µ ë¡œì§ ë³µì‚¬              | ë‹¨ì¼ ì±…ì„ì— ë§ê²Œ ë ˆì´ì–´ë³„ë¡œ ì¶”ê°€     |
| ìƒˆ ê²°ì œ ìˆ˜ë‹¨ ì¶”ê°€   | ì „ì²´ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë¶„ê¸° ì²˜ë¦¬ ì¶”ê°€            | Data ë ˆì´ì–´(DataSource/Repository)ë§Œ |
| axios â†’ fetch ë³€ê²½  | ëª¨ë“  API í˜¸ì¶œ ì½”ë“œ ìˆ˜ì •                     | Infrastructure ë ˆì´ì–´(HttpClient)ë§Œ  |

---

## ë„ì… í›„ ê¸°ëŒ€ íš¨ê³¼

ìš°ë¦¬ íŒ€ì€ ê¸°ì¡´ `Feature Based Architecture`ì—ì„œ `Domain Based Clean Architecture`ë¡œ ì „í™˜í–ˆë‹¤.

íŒ€ì›ë“¤ì—ê²Œ ìœ„ì—ì„œ ì„¤ëª…í•œ ì¥ì ë“¤ì„ ì •ë¦¬í•´ì„œ ì „ë‹¬í–ˆë‹¤: "ì„œë²„ í•„ë“œëª…ì´ ë°”ë€Œì–´ë„ `Mapper` 1ì¤„ë§Œ ê³ ì¹˜ë©´ ëœë‹¤", "ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ `Entity`ì— ëª¨ì—¬ ìˆì–´ í…ŒìŠ¤íŠ¸ê°€ ì‰½ë‹¤", "ë ˆì´ì–´ê°€ ëª…í™•í•´ AIê°€ ì •í™•í•œ ìœ„ì¹˜ì— ì½”ë“œë¥¼ ìƒì„±í•œë‹¤".

íŠ¹íˆ ìš°ë¦¬ ì„œë¹„ìŠ¤ëŠ” `Next.js` ê¸°ë°˜ì´ë¼ ì„œë²„ í™˜ê²½ê³¼ í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ì„ ëª¨ë‘ ê³ ë ¤í•´ì•¼ í–ˆëŠ”ë°, ë ˆì´ì–´ê°€ ëª…í™•í• ìˆ˜ë¡ ê°œì„ ê³¼ ë¦¬íŒ©í† ë§ì´ í›¨ì”¬ ìˆ˜ì›”í–ˆë‹¤.

ì‚¬ì‹¤ ì œì¼ ê±±ì •í–ˆë˜ ë¶€ë¶„ì€ ë‚´ê°€ ì´ ì•„í‚¤í…ì²˜ ë³€ê²½ì„ ì£¼ë„í•œ ë§Œí¼, ê¸°ì¡´ ì½”ë“œë² ì´ìŠ¤ ì „ì²´ë¥¼ ì „í™˜í•´ì•¼ í•œë‹¤ëŠ” ì±…ì„ê°ì´ì—ˆë‹¤. í•˜ì§€ë§Œ AI Promptë¥¼ í™œìš©í•´ ì „í™˜í–ˆë”ë‹ˆ **ìƒê° ì´ìƒìœ¼ë¡œ ë¹ ë¥´ê²Œ ì„±ê³µ**í–ˆë‹¤.

ì²˜ìŒì—” íŒ€ì›ë“¤ë„ "ì¡°ê¸ˆ ê³¼í•œ ì„¤ê³„ ì•„ë‹Œê°€?" ì‹¶ì–´í–ˆì§€ë§Œ, ë³€ê²½ì´ ì¦ì€ ìš°ë¦¬ ì„œë¹„ìŠ¤ í™˜ê²½(ê¸ˆìœµì‚¬ ì •ì±… ë³€ê²½, API ì‘ë‹µ í˜•ì‹ ë³€ê²½)ì„ ê³ ë ¤í•˜ë©´ ì™œ ì´ êµ¬ì¡°ê°€ í•„ìš”í•œì§€ ì„¤ëª…í–ˆë”ë‹ˆ ì´í•´í•˜ê¸° ì‹œì‘í–ˆë‹¤.

### ì½”ë“œ ë¦¬ë·°ê°€ ì˜¤íˆë ¤ ë” ì‰¬ì›Œì§ˆ ê²ƒì´ë‹¤

íŒŒì¼ ê°œìˆ˜ëŠ” 2~3ë°° ëŠ˜ì–´ë‚˜ì§€ë§Œ, ë ˆì´ì–´ê°€ ëª…í™•í•˜ê¸° ë•Œë¬¸ì— **í•„ìš”í•œ ë¶€ë¶„ë§Œ ì„ íƒì ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆë‹¤**. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë³€ê²½ì´ë¼ë©´ `Domain/Entity`ë§Œ ë³´ë©´ ë˜ê³ , API ë³€ê²½ì´ë¼ë©´ `Data/DataSource`ë§Œ ë³´ë©´ ëœë‹¤.

íŠ¹íˆ **í…ŒìŠ¤íŠ¸ ì½”ë“œ ìœ„ì£¼ë¡œ ë¦¬ë·°**í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•´ì§„ë‹¤. êµ¬ì¡°ê°€ í…ŒìŠ¤íŠ¸í•˜ê¸° ì¢‹ê²Œ ì„¤ê³„ë˜ì–´ ìˆë‹¤ ë³´ë‹ˆ, íŒ€ì›ë“¤ì´ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë” ë§ì´ ì‘ì„±í•˜ê²Œ ë˜ì—ˆë‹¤. ë¦¬ë·°ì–´ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë¨¼ì € ë³´ê³  "ì´ ì¼€ì´ìŠ¤ë„ ì¶”ê°€í•˜ë©´ ì¢‹ê² ì–´ìš”", "ì´ ì—£ì§€ ì¼€ì´ìŠ¤ëŠ” ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ë‚˜ìš”?" ê°™ì€ ë³¸ì§ˆì ì¸ ì§ˆë¬¸ì„ í•  ìˆ˜ ìˆë‹¤. ì½”ë“œ í’ˆì§ˆì´ ìì—°ìŠ¤ëŸ½ê²Œ ë†’ì•„ì§ˆ ê²ƒìœ¼ë¡œ ê¸°ëŒ€í•œë‹¤.

### AIê°€ ì •í™•í•œ ìœ„ì¹˜ì— ì½”ë“œë¥¼ ìƒì„±í•œë‹¤

ì•„í‚¤í…ì²˜ êµ¬ì¡°ë¥¼ í”„ë¡¬í”„íŠ¸ì— ëª…í™•íˆ ì‘ì„±í•´ë‘ë©´, AIê°€ **ì •í™•íˆ ì–´ëŠ ë ˆì´ì–´ì— ì–´ë–¤ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í•˜ëŠ”ì§€** ì´í•´í•œë‹¤. ë‹¤ìŒì€ ì‹¤ì œë¡œ ì‚¬ìš©í•˜ëŠ” AI í”„ë¡¬í”„íŠ¸ ì˜ˆì‹œë‹¤:

```
# CLEAN ARCHITECTURE RULES

## DI Layer (Dependency Injection)
- MUST: Use singleton pattern (??= operator) for all instances
- MUST: Provide factory methods (static getters) for dependencies
- MUST NOT: Contain any business logic
- MUST NOT: Directly instantiate dependencies outside of getters

## Core Layer (Shared Utilities)
- MUST: Be pure, reusable utility functions
- MUST: Have zero dependencies on other layers
- MUST NOT: Import from Domain, Data, Infrastructure, or Presentation
- MUST NOT: Contain framework-specific code

## Infrastructure Layer (External Adapters)
- MUST: Implement port interfaces defined in Domain
- MUST: Handle all external system communication (HTTP, Storage, etc.)
- MUST NOT: Know about Domain entities or business rules
- MUST NOT: Transform data formats (use Data layer Mappers instead)

## Data Layer (Data Access & Transformation)
- MUST: Implement Repository interfaces from Domain
- MUST: Use Mapper to convert DTO â†” Entity
- MUST: Handle all DTO type definitions
- MUST NOT: Contain validation or business logic
- MUST NOT: Skip Mapper and directly pass DTO to Domain

## Domain Layer (Business Logic)
- MUST: Contain all business rules and validation in Entities
- MUST: Define Repository interfaces (ports)
- MUST: Be completely independent (no imports from other layers)
- MUST NOT: Call APIs or access external systems directly
- MUST NOT: Import from Data, Infrastructure, or Presentation layers

## Presentation Layer (UI & Hooks)
- MUST: Use hooks to consume UseCases
- MUST: Handle UI state and user interactions only
- MUST NOT: Contain business logic or validation
- MUST NOT: Call Repository or DataSource directly
- MUST NOT: Import DTOs (only work with Entities)

---

Example Task:
"Add minimum payment amount validation logic"

Expected AI Response:
- File: `src/Domain/Entity/PaymentGateway.ts`
- Action: Add validation method to Entity class
- Reason: Business rule MUST be in Domain Layer

Example Task:
"Server changed response format: payment_id â†’ id"

Expected AI Response:
- File: `src/Data/Mapper/PaymentGatewayMapper.ts`
- Action: Update single line in Mapper
- Reason: DTO transformation MUST happen only in Mapper
```

í´ë” êµ¬ì¡°ê°€ ëª…í™•í•˜ì§€ ì•Šìœ¼ë©´ AIê°€ ì–´ë””ì— ì½”ë“œë¥¼ ë„£ì„ì§€ í—¤ë§¤ì§€ë§Œ, ì´ë ‡ê²Œ **ë ˆì´ì–´ë³„ MUST/MUST NOT ê·œì¹™**ì„ ëª…ì‹œí•˜ë©´ AIê°€ **ê°œë°œìê°€ ì˜ë„í•œ ëŒ€ë¡œ, ì •í•´ì§„ í‹€ ë‚´ì—ì„œ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê³  í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±**í•  ìˆ˜ ìˆë‹¤. ì•„í‚¤í…ì²˜ ê°€ì´ë“œë¼ì¸ì„ ë²—ì–´ë‚˜ì§€ ì•Šìœ¼ë©´ì„œë„ ë¹ ë¥´ê²Œ ê°œë°œí•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤.

### ì¥ê¸°ì ìœ¼ë¡œ ê¸°ëŒ€í•˜ëŠ” íš¨ê³¼

- **ì‹¬ë¦¬ì  ì•ˆì •ê°**: "ì´ê±° ê³ ì¹˜ë©´ ì–´ë”” í„°ì§ˆê¹Œ" ë¶ˆì•ˆê° ì†Œë©¸. ë³€ê²½ ë²”ìœ„ê°€ ëª…í™•í•˜ë¯€ë¡œ ë°°í¬ê°€ ë‘ë µì§€ ì•ŠìŒ
- **ì˜¨ë³´ë”© ì‹œê°„ ë‹¨ì¶•**: ìƒˆ íŒ€ì›ì´ êµ¬ì¡°ë§Œ ì´í•´í•˜ë©´ ë°”ë¡œ ê¸°ì—¬ ê°€ëŠ¥. "ì´ ê¸°ëŠ¥ì€ ì–´ë”” ìˆë‚˜ìš”?" ì§ˆë¬¸ì´ ì¤„ì–´ë“¤ ê²ƒ
- **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ì¦ê°€**: `UseCase`ëŠ” ëª¨í‚¹ ì—†ì´ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥. í…ŒìŠ¤íŠ¸ ì‘ì„±ì´ ì¦ê±°ì›Œì ¸ì„œ ì»¤ë²„ë¦¬ì§€ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ë†’ì•„ì§ˆ ê²ƒ
- **AI í™œìš©ë„ ì¦ê°€**: í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ëŠ˜ì–´ë‚˜ë‹ˆ ì¡°ê¸ˆ ë” í¸í•˜ê²Œ AIë¥¼ í™œìš©í•  ìˆ˜ ìˆë‹¤. "ë‚´ê°€ ëŒë¦° AI ë•Œë¬¸ì— ê¸°ì¡´ ì½”ë“œê°€ ë¬´ë„ˆì§€ì§€ ì•Šì„ê¹Œ?" í•˜ëŠ” ê±±ì • ì—†ì´ AIë¥¼ í™œìš©í•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤

### ê· í˜•ì¡íŒ í‰ê°€: ë§ŒëŠ¥ì€ ì•„ë‹ˆë‹¤

í´ë¦° ì•„í‚¤í…ì²˜ê°€ ë§ŒëŠ¥ì€ ì•„ë‹ˆë‹¤. **ì‘ì€ í”„ë¡œì íŠ¸**ë‚˜ **ì¼íšŒì„± í”„ë¡œí† íƒ€ì…**ì—ëŠ” ê³¼í•  ìˆ˜ ìˆë‹¤. ì´ˆê¸° ë¹„ìš©ì´ í¬ê¸° ë•Œë¬¸ì´ë‹¤.

í•˜ì§€ë§Œ **ìš°ë¦¬ ì„œë¹„ìŠ¤**ì²˜ëŸ¼ ì™¸ë¶€ ì •ì±… ë³€ê²½ì´ ì¦ê³ , íŒ€ì›ì´ ì—¬ëŸ¿ì´ë©°, ë‚˜ì²˜ëŸ¼ í”„ë¡ íŠ¸ì—”ë“œì™€ ì„œë²„ ê°œë°œì„ í•¨ê»˜ í•˜ê±°ë‚˜ ì¥ê¸° ìš´ì˜ì´ ì˜ˆì •ë˜ì–´ ìˆë‹¤ë©´ ì´ˆê¸° ë¹„ìš©ì„ ê°ìˆ˜í•  ê°€ì¹˜ê°€ ì¶©ë¶„í•˜ë‹¤.

---

## í•µì‹¬ ì •ë¦¬

í´ë¦° ì•„í‚¤í…ì²˜ë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ ì •ë¦¬í•˜ë©´: **ì—­í• ì„ ë¶„ë¦¬í•´ì„œ ë³€ê²½ì— ê°•í•œ êµ¬ì¡°ë¥¼ ë§Œë“œëŠ” ê²ƒ**ì´ë‹¤.

### 6ê°œ ë ˆì´ì–´ì™€ ì—­í• 

ì½”ë“œë¥¼ 6ê°œ ë ˆì´ì–´ë¡œ ë‚˜ëˆ  ê°ìì˜ ì±…ì„ì„ ëª…í™•íˆ í•œë‹¤:

- **`DI`** (ì˜ì¡´ì„± ì£¼ì…) - ëª¨ë“  ë ˆì´ì–´ë¥¼ ì¡°í•©í•˜ê³  ì£¼ì…
- **`Core`** (ê³µí†µ ê¸°ëŠ¥) - ëª¨ë“  ë ˆì´ì–´ì—ì„œ ì“°ëŠ” ìˆœìˆ˜ ìœ í‹¸ë¦¬í‹°
- **`Infrastructure`** (ì™¸ë¶€ ì„¸ê³„ ê²©ë¦¬) - HTTP í´ë¼ì´ì–¸íŠ¸, ìŠ¤í† ë¦¬ì§€ ë“± ì™¸ë¶€ ë„êµ¬ ì¶”ìƒí™”
- **`Data`** (ì™¸ë¶€ ë°ì´í„° ë³€í™˜) - API í˜¸ì¶œ + DTO â†” Entity ë³€í™˜
- **`Domain`** (ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™) - ê²€ì¦ ë¡œì§, ì—”í‹°í‹°, ìœ ìŠ¤ì¼€ì´ìŠ¤ ë“± í•µì‹¬ ë¡œì§
- **`Presentation`** (UI ìƒí˜¸ì‘ìš©) - í›…ê³¼ ì»´í¬ë„ŒíŠ¸ë¡œ UI ê´€ë¦¬

### í•µì‹¬ ì›ì¹™ 3ê°€ì§€

1. **Domainì€ ì™„ì „íˆ ë…ë¦½** - ë‹¤ë¥¸ ë ˆì´ì–´ë¥¼ importí•˜ì§€ ì•ŠìŒ
2. **ì˜ì¡´ì„±ì€ í•­ìƒ ì•ˆìª½ìœ¼ë¡œ** - Presentation â†’ Domain â† Data
3. **ë³€í™˜ì€ Mapperê°€ ìœ ì¼** - DTOì™€ Entity ì‚¬ì´ëŠ” Mapperë§Œ í†µê³¼

### ì–¸ì œ ë„ì…í•˜ë©´ ì¢‹ì„ê¹Œ?

ë‹¤ìŒ ìƒí™©ì´ë¼ë©´ í´ë¦° ì•„í‚¤í…ì²˜ê°€ ë¹›ì„ ë°œí•œë‹¤:

- ê¸°íšì´ ìì£¼ ë°”ë€ŒëŠ” ì„œë¹„ìŠ¤
- 6ê°œì›” ì´ìƒ ìš´ì˜í•  í”„ë¡œì íŠ¸
- í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ í•„ìš”í•œ ê²½ìš°
- í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œë¥¼ í•¨ê»˜ ê°œë°œí•˜ëŠ” ê²½ìš°

### ì‹¤ì œ ìœ ì§€ë³´ìˆ˜ ë¹„ìš© ë¹„êµ

**API í•„ë“œëª… ë³€ê²½ ì‹œ**:

- Before: 10ê°œ íŒŒì¼ ìˆ˜ì • (ëª¨ë“  ì»´í¬ë„ŒíŠ¸)
- After: 1ê°œ íŒŒì¼ ìˆ˜ì • (Mapper)

**ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ë³€ê²½ ì‹œ**:

- Before: 5ê°œ íŒŒì¼ ìˆ˜ì • (ì¤‘ë³µëœ ê²€ì¦ ë¡œì§)
- After: 1ì¤„ ìˆ˜ì • (Entity ë©”ì„œë“œ)

**ê²°ì œ ìˆ˜ë‹¨ ì¶”ê°€ ì‹œ**:

- Before: ì „ì²´ ì»´í¬ë„ŒíŠ¸ ë¶„ê¸° ì²˜ë¦¬
- After: Data ë ˆì´ì–´ë§Œ ìˆ˜ì •

### ë§ˆì§€ë§‰ìœ¼ë¡œ

í´ë¦° ì•„í‚¤í…ì²˜ëŠ” ì´ˆê¸° ë¹„ìš©ì´ ìˆë‹¤. íŒŒì¼ì´ ë§ì•„ì§€ê³  êµ¬ì¡°ê°€ ë³µì¡í•´ ë³´ì¸ë‹¤.

í•˜ì§€ë§Œ ì¥ê¸°ì ìœ¼ë¡œëŠ” ìœ ë¦¬í•˜ë‹¤:

- ë³€ê²½ì— ê°•í•˜ë‹¤
- í…ŒìŠ¤íŠ¸ê°€ ì‰½ë‹¤
- AI í™œìš©ì´ ì¢‹ë‹¤
- ì½”ë“œ ìˆ˜ì •ì˜ ë‘ë ¤ì›€ì´ ì‚¬ë¼ì§„ë‹¤

ê²°êµ­ íŒ€ ì „ì²´ì˜ ë§Œì¡±ë„ê°€ ë†’ì•„ì§„ë‹¤. "ì´ê±° ê³ ì¹˜ë©´ ì–´ë”” í„°ì§ˆê¹Œ" ê±±ì • ì—†ì´ ê°œë°œí•  ìˆ˜ ìˆëŠ” ê²ƒ, ê·¸ê²Œ í´ë¦° ì•„í‚¤í…ì²˜ì˜ ê°€ì¥ í° ê°€ì¹˜ë‹¤.
