---
title: Tanstack Query íš¨ìœ¨ì ìœ¼ë¡œ Key ê´€ë¦¬í•´ë³´ê¸°
date: 2025-10-15
updatedDate: 2025-10-15
tags: [Tanstack Query, Query Key Factory, íš¨ìœ¨ì ì¸ Key ê´€ë¦¬]
category: DEVELOPMENT
image: '/images/query-key-factory/thumbnail.webp'
---

# ì‚¬ê±´ì˜ ë°œë‹¨

> ğŸ™†ğŸ»â€â™‚ï¸ ì•„ë§ˆ ëŒ€ë¶€ë¶„ì˜ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì ë¶„ë“¤ì€ Tanstack-Queryë¼ëŠ” ë„êµ¬ë¥¼ í™œìš©í•´ì„œ ë¹„ë™ê¸° ìƒíƒœ ê´€ë¦¬ë¥¼ í•  ê²ƒì…ë‹ˆë‹¤.

ì‹¤ì œë¡œ Tanstack-QueryëŠ” í˜„ì¬ (2025ë…„ 10ì›” 15ì¼ ê¸°ì¤€) ì•½ 1150ë§ŒíšŒ ì´ìƒ ë‹¤ìš´ë°›ì•„ì§ˆ ì •ë„ë¡œ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìì—ê²Œ ìˆì–´ì„œ í•„ìˆ˜ ë¶ˆê°€ê²°í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. (ë¬¼ë¡  SWRë„... ìˆê¸°ëŠ” í•©ë‹ˆë‹¤ ^ã…^)

![ë†€ë¼ìš´ query-key-factory ì„¤ì¹˜ ìˆ˜](/images/query-key-factory/1.webp)

í˜„ì¬ ìš´ì˜ì¤‘ì¸ ì„œë¹„ìŠ¤ì—ì„œë„ Tanstack-Queryë¥¼ ë§¤ìš° ì•Œì°¨ê²Œ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.

ë§ì€ ë¶„ë“¤ì´ ì•„ì‹œê² ì§€ë§Œ Tanstack-Queryë¥¼ ë„ì…í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ì¥ì ì„ ì–»ê²Œ ë©ë‹ˆë‹¤.

1. ë°ì´í„° ìºì‹± ë° ìƒíƒœ ê´€ë¦¬
2. ìë™í™”ëœ ë°ì´í„° ë™ê¸°í™”
3. ë¡œë”©/ì—ëŸ¬ì²˜ë¦¬ (ë°ì´í„° ìƒíƒœë¥¼) ì‰½ê²Œ ê´€ë¦¬
4. ì„œë²„ ìƒíƒœì™€ í´ë¼ì´ì–¸íŠ¸ ìƒíƒœë¥¼ ë¶„ë¦¬
5. `QueryKey`ë¥¼ í™œìš©í•¨ìœ¼ë¡œì¨ ì¤‘ë³µ ìš”ì²­ì„ ë°©ì§€
6. `Optimistic Update`, `Background Update`ì™€ ê°™ì€ ìµœì í™”ëœ ë°ì´í„° ì—…ë°ì´íŠ¸ (ì‚¬ìš©ì ê²½í—˜ê³¼ ì—°ê´€)
7. ê°œë°œ í¸ì˜ì„± (`Query`, `Mutation`ì„ í†µí•œ ì§ê´€ì ì¸ ì½”ë“œ ì‘ì„±, DevToolì˜ ìœ ìš©í•¨)

ë¬¼ë¡  ì´ ì™¸ì—ë„ ì •ë§ ë§ì€ ì¥ì ì´ ìˆê² ì§€ë§Œ, Tanstack Queryë¥¼ ë„ì…í•˜ë©´ ë¹„ë™ê¸° ë°ì´í„° ìš”ì²­ ë° ìºì‹±ì´ ë§ì´ í•„ìš”í•œ í”„ë¡œì íŠ¸ì—ì„œ ê°œë°œ ì†ë„ì™€ ìœ ì§€ë³´ìˆ˜ì„±ì„ í¬ê²Œ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ê·¸ë˜ì„œ, ë§í•˜ê³ ì í•˜ëŠ”ê²Œ ë­ì•¼?

ìœ„ì˜ Tanstack-Queryì— ëŒ€í•œ ì¥ì ì„ ì˜ ë³´ë©´ `QueryKey`ê°€ ë§¤ìš° ì¤‘ìš”í•œ ì—­í• ì„ í•˜ê³  ìˆë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤!

ì‹¤ì œë¡œ ì•„ë˜ ê³µì‹ë¬¸ì„œì—ì„œë„ `QueryKey`ì˜ ì¤‘ìš”ì„±ì„ ì„¤ëª…í•˜ê³  ìˆìŠµë‹ˆë‹¤!

![ê³µì‹ë¬¸ì„œì—ì„œì˜ QueryKeyì˜ ì¤‘ìš”ì„±](/images/query-key-factory/2.webp)

### ì¿¼ë¦¬ í‚¤ (Query Keys)

TanStack QueryëŠ” ì¿¼ë¦¬ í‚¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¿¼ë¦¬ ìºì‹±ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.

`QueryKey`ëŠ” ìµœìƒìœ„ ìˆ˜ì¤€ì—ì„œ `ë°°ì—´(Array)` í˜•íƒœë¥¼ ê°€ì ¸ì•¼ í•˜ë©°, ë‹¨ìˆœíˆ ë¬¸ìì—´ í•˜ë‚˜ë¡œ êµ¬ì„±ëœ ë°°ì—´ì¼ ìˆ˜ë„ ìˆê³  ì—¬ëŸ¬ ë¬¸ìì—´ê³¼ ì¤‘ì²©ëœ ê°ì²´ë¡œ ì´ë£¨ì–´ì§„ ë³µì¡í•œ ë°°ì—´ì¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

`QueryKey`ê°€ `ì§ë ¬í™” ê°€ëŠ¥(serializable)`í•˜ê³  ì¿¼ë¦¬ ë°ì´í„°ì— ê³ ìœ í•˜ë‹¤ë©´ ì–´ë–¤ í˜•íƒœë¡œë“  ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!

**ë­ ëŒ€ì¶©, ì—„ì²­ ì¤‘ìš”í•˜ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.**

ì‚¬ì‹¤ ì²˜ìŒ ê°œë°œì„ í•  ë•Œì—ëŠ” `QueryKey`ì— ëŒ€í•œ ì¤‘ìš”ì„±ì´ í¬ê²Œ ëŠê»´ì§€ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

1. ì „ì²´ ì¡°íšŒë¥¼ í•œë‹¤.

```js
const queryKeys = {
  todos: 'todos',
  challenges: 'challenges',
};
```

ì „ì²´ ì¡°íšŒë§Œ ìˆìœ¼ë©´ ì´ë ‡ê²Œ í•˜ë©´ ê´œì°®ì„ ê²ƒ ê°™ì•˜ìŠµë‹ˆë‹¤!

2. ìƒì„¸ ì¡°íšŒë„ í•œë‹¤.

ì—¬ê¸°ì„œ ì‚´ì§ ê³ ë¯¼ì´ ìƒê²¼ìŠµë‹ˆë‹¤.

ë¬¼ë¡  ì¼ë°˜ì ìœ¼ë¡œ `[todos, 1]` ì´ëŸ°ì‹ìœ¼ë¡œ `QueryKey`ë¥¼ ê´€ë¦¬í•´ë„ ë˜ì§€ ì•Šì„ê¹Œ ë¼ëŠ” ìƒê°ì„ í–ˆì§€ë§Œ, ì´ëŸ¬ë©´ ìƒì„¸ í˜ì´ì§€ë§Œ `invalidate(ìƒˆë¡œê³ ì¹¨)`ì„ í•˜ê³  ì‹¶ì€ ê²½ìš°ê°€ ëŒ€ì‘ì´ ì–´ë ¤ì›Œì§‘ë‹ˆë‹¤.

ê·¸ë˜ì„œ ìƒê°í•œ `QueryKey`ì˜ êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ì•„ì¡ŒìŠµë‹ˆë‹¤.

```js
const queryKeys = {
  todos: {
    all: ['todos', 'all'],
    detail: (id: number) => ['todos', 'detail', id],
  },
  challenges: {
    all: ['challenges', 'all'],
    detail: (id: number) => ['challenges', 'detail', id],
  },
};
```

ë­, ì—¬ê¸°ê¹Œì§€ëŠ” ê·¸ë˜ë„ ëŒ€ì‘ í•  ë§Œ í–ˆìŠµë‹ˆë‹¤.

3. challengeì˜ ì¢…ë¥˜ê°€ ìƒê¸´ ê²½ìš°? (ì˜ìƒ ì±Œë¦°ì§€, ë…¹ìŒ ì±Œë¦°ì§€ ë“±ë“±)

ì—¬ê¸°ì„œë¶€í„° ì´ì œ í˜¼ë€ì´ ì˜¤ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤. ì–´ë–¤ì‹ìœ¼ë¡œ ê´€ë¦¬í•´ì•¼ì§€??

```js
const queryKeys = {
  challenges: {
    general: {
      all: ['challenges', 'all', 'general'],
      detail: (id: number) => ['todos', 'detail', 'general', id],
    },
    recording: {
      all: ['challenges', 'all', 'recording'],
      detail: (id: number) => ['todos', 'detail', 'recording', id],
    },
  },
};
```

ë¬¼ë¡  `filters`ë¼ëŠ” íŒŒë¼ë¯¸í„°ë¥¼ ì „ë‹¬ë°›ì•„ì„œ `{ filters }` í˜•íƒœë¡œ `QueryKey`ë¥¼ ê´€ë¦¬í•´ë„ ë  ê²ƒ ê°™ë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤!

ê·¸ëŸ¬ë‚˜ í˜„ì¬ ì €í¬ ì„œë¹„ìŠ¤ ë¿ë§Œ ì•„ë‹ˆë¼ ëŒ€ë¶€ë¶„ì˜ ì„œë¹„ìŠ¤ë“¤ì€ ê³„ì† ëŠ˜ì–´ë‚˜ëŠ” ê³ ê°ë“¤ì˜ ìš”êµ¬ì‚¬í•­ê³¼ í¸ë¦¬í•¨ì„ ì¶©ì¡±í•˜ê¸° ìœ„í•´ì„œ ê¸°ëŠ¥ì„ ì¶”ê°€í•  ê²ƒì´ê³ , ê·¸ì— ë”°ë¼ `QueryKey`ì˜ ë³€ë™ì´ ì •ë§ ë§ì´ ì¼ì–´ë‚  ê²ƒ ê°™ë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.

í˜„ì¬ ì„œë¹„ìŠ¤ì˜ í¬ê¸° ì •ë„ë©´ ì¶©ë¶„íˆ ì´ëŸ°ì‹ìœ¼ë¡œ ê´€ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤ê³  ìƒê°í–ˆì§€ë§Œ, ì•ìœ¼ë¡œ ë§ì€ ì§ì›ë“¤ì´ ë“¤ì–´ì˜¤ê±°ë‚˜ í˜‘ì—…ì„ í•˜ëŠ”ë°ì— ìˆì–´ì„œ `QueryKey`ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê¸°ì¤€ì„ ì¡ëŠ” ê²ƒì´ ë§¤ìš° í•„ìš”í•˜ë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.

![ë§¤ë²ˆ, ë¦¬íŒ©í† ë§ í•˜ë ¤ê³  í–ˆì§€ë§Œ ì‰½ì§€ ì•Šì•˜ë‹¤ëŠ” í•‘ê³„..](/images/query-key-factory/3.webp)

### ìê¸° ë°˜ì„± ğŸ™‡ğŸ»â€â™‚ï¸

`QueryKey`ë¥¼ í•œë²ˆ ë¹ ë¥´ê²Œ ì •ë¦¬í•˜ê³  ì‹¶ì—ˆìœ¼ë‚˜...

ì„œë¹„ìŠ¤ ì¶œì‹œ ì´í›„ ëŠ˜ì–´ë‚˜ëŠ” ìš”êµ¬ì‚¬í•­ê³¼ ìœ ì € ì—ëŸ¬ë“¤ì„ ì¦‰ê° ëŒ€ì‘í•˜ëŠë¼ (í•‘ê³„) ì •ë§ ì‹œê°„ì´ ë‚¨ì§€ ì•Šì•„ì„œ ë¦¬íŒ©í† ë§ì„ í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.

> ì´ì œëŠ” ì§„ì§œ í•  ê²ƒì´ë‹¤... (ì•„ë˜ë¡œ...)

---

## ê³µì‹ë¬¸ì„œ, ë„ˆëŠ” ì–´ë–»ê²Œ ì¶”ì²œí•´ì£¼ë‹ˆ?

ì ì§„ì§œ ë¦¬íŒ©í† ë§ í•©ë‹ˆë‹¤...

ì¼ë‹¨ ëª¨ë¥¼ë•ŒëŠ” ê³µì‹ë¬¸ì„œë¶€í„° ë´ë´…ì‹œë‹¤...

![ê³µì‹ë¬¸ì„œì—ì„œì˜ QueryKeyì˜ ì¤‘ìš”ì„±](/images/query-key-factory/4.webp)

> For tips on organizing Query Keys in larger applications, have a look at Effective React Query Keys and check the Query Key Factory Package from the Community Resources.

**ì°¸ê³  ìë£Œ**:

- [Effective React Query Keys](https://tkdodo.eu/blog/effective-react-query-keys)
- [Query Key Factory Package](https://www.npmjs.com/package/query-key-factory)

ë‹¹ì—°íˆ ì €ë§ê³ ë„ ë§ì€ ì‚¬ëŒë“¤ì´ ë¹„ìŠ·í•œ ê³ ë¯¼ì„ ê²ªê³  ìˆê³ , ê³µì‹ë¬¸ì„œì—ì„œëŠ” í¬ê²Œ 2ê°€ì§€ ë°©ì‹ì„ ì¶”ì²œí•´ì£¼ì…¨ìŠµë‹ˆë‹¤.

í•˜ë‚˜ì”© ì•Œì•„ë³´ê³ ì í•©ë‹ˆë‹¤.

---

## 1. Effective React Query Keys

Effective React Query Keysì—ì„œëŠ” ë¨¼ì € ì €ì˜ ë¼ˆë¥¼ ì°Œë¥´ëŠ” ë¬¸ì¥ìœ¼ë¡œ ì‹œì‘í–ˆìŠµë‹ˆë‹¤.

### 1. Colocate (ì½”ë“œ ê·¼ì²˜ì— ë°°ì¹˜)

ëª¨ë“  `QueryKey`ë¥¼ `/src/utils/queryKeys.ts`ì™€ ê°™ì€ ê¸€ë¡œë²Œ íŒŒì¼ì— ì €ì¥í•˜ëŠ” ê²ƒì´ ì¢‹ì€ ì„ íƒì´ë¼ê³  ìƒê°í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ëŒ€ì‹  `QueryKey`ë¥¼ ê´€ë ¨ëœ ì¿¼ë¦¬ì™€ ê°€ê¹Œìš´ ìœ„ì¹˜ì— ë°°ì¹˜í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ë©´, ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ì…ë‹ˆë‹¤:

```js
src
  â”œâ”€ features
  â”‚    â”œâ”€ Profile
  â”‚    â”‚    â”œâ”€ index.tsx
  â”‚    â”‚    â”œâ”€ queries.ts
  â”‚    â”œâ”€ Todos
  â”‚         â”œâ”€ index.tsx
  â”‚         â”œâ”€ queries.ts
```

ê° `queries.ts` íŒŒì¼ì€ React Queryì™€ ê´€ë ¨ëœ ëª¨ë“  ë‚´ìš©ì„ í¬í•¨í•˜ë©°, ì¼ë°˜ì ìœ¼ë¡œ ì»¤ìŠ¤í…€ í›…ë§Œ exportí•©ë‹ˆë‹¤.

ì¿¼ë¦¬ í•¨ìˆ˜ì™€ `Query Key`ëŠ” ì§€ì—­ì ìœ¼ë¡œ ê´€ë¦¬ë©ë‹ˆë‹¤.

ì´ë¥¼ ë³´ë©° ì¼ë‹¨ í´ë” êµ¬ì¡°ë¥¼ features ì¤‘ì‹¬ìœ¼ë¡œ ë³€ê²½í•´ì•¼ê² ë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.

---

### 2. í•­ìƒ ë°°ì—´ í˜•íƒœì˜ Query Key ì‚¬ìš©í•˜ê¸°

`QueryKey`ëŠ” ë¬¸ìì—´ í•˜ë‚˜ë¡œë„ ì •ì˜í•  ìˆ˜ ìˆì§€ë§Œ, í†µì¼ì„±ì„ ìœ„í•´ í•­ìƒ `ë°°ì—´(Array)`ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

React QueryëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ë¬¸ìì—´ë„ ë°°ì—´ë¡œ ë³€í™˜í•˜ë¯€ë¡œ ì•„ë˜ì²˜ëŸ¼ ì‘ì„±í•˜ëŠ” ê²ƒì´ ë” ì¢‹ìŠµë‹ˆë‹¤:

```js
// ğŸš¨ React Queryê°€ ë‚´ë¶€ì ìœ¼ë¡œ ['todos']ë¡œ ë³€í™˜í•¨
useQuery({ queryKey: 'todos' });

// âœ… ë°°ì—´ í˜•íƒœë¡œ ì‘ì„±
useQuery({ queryKey: ['todos'] });
```

**ì—…ë°ì´íŠ¸**: React Query v4ë¶€í„°ëŠ” ëª¨ë“  `Query Key`ê°€ ë°°ì—´ í˜•íƒœì—¬ì•¼ í•©ë‹ˆë‹¤.

### 3. Query Key êµ¬ì¡° ì„¤ê³„

`QueryKey`ëŠ” ì¼ë°˜ì ì¸ ìˆ˜ì¤€ì—ì„œë¶€í„° êµ¬ì²´ì ì¸ ìˆ˜ì¤€ê¹Œì§€ ë‹¨ê³„ì ìœ¼ë¡œ êµ¬ì¡°í™”í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

í•„ìš”ì— ë”°ë¼ ì„¸ë¶€ì ì¸ ë ˆë²¨ì„ ì¶”ê°€í•˜ì„¸ìš”.

ì˜ˆë¥¼ ë“¤ì–´, í•„í„°ë§ ê°€ëŠ¥í•œ ToDo ë¦¬ìŠ¤íŠ¸ì™€ ì„¸ë¶€ ì¡°íšŒë¥¼ ì œê³µí•˜ëŠ” ê²½ìš°ëŠ” ì•„ë˜ì™€ ê°™ì´ ì„¤ê³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```js
['todos', 'list', { filters: 'all' }],
  ['todos', 'list', { filters: 'done' }],
  ['todos', 'detail', 1],
  ['todos', 'detail', 2];
```

ì´ëŸ¬í•œ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì´ì ì´ ìˆìŠµë‹ˆë‹¤:

1. `['todos']`: ToDoì™€ ê´€ë ¨ëœ ëª¨ë“  ë°ì´í„°ë¥¼ ë¬´íš¨í™”í•  ìˆ˜ ìˆìŒ
2. `['todos', 'list']`: ëª¨ë“  ë¦¬ìŠ¤íŠ¸ë¥¼ ë¬´íš¨í™”í•  ìˆ˜ ìˆìŒ
3. íŠ¹ì • í‚¤ë¥¼ ì§€ì •í•˜ì—¬ íŠ¹ì • ë¦¬ìŠ¤íŠ¸ë‚˜ ë°ì´í„°ë¥¼ ê°±ì‹  ê°€ëŠ¥

### 4. Mutationì—ì„œ ìœ ì—°í•œ ì—…ë°ì´íŠ¸

#### 1. ìƒì„¸ ì •ë³´ì™€ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸

```js
function useUpdateTitle() {
  return useMutation({
    mutationFn: updateTitle,
    onSuccess: (newTodo) => {
      // âœ… ìƒì„¸ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸
      queryClient.setQueryData(['todos', 'detail', newTodo.id], newTodo);

      // âœ… ì´ ToDoê°€ í¬í•¨ëœ ëª¨ë“  ë¦¬ìŠ¤íŠ¸ë¥¼ ì—…ë°ì´íŠ¸
      queryClient.setQueriesData(['todos', 'list'], (previous) =>
        previous.map((todo) => (todo.id === newTodo.id ? newTodo : todo))
      );
    },
  });
}
```

#### 2. ëª¨ë“  ë¦¬ìŠ¤íŠ¸ ë¬´íš¨í™”

êµ¬ì²´ì ì¸ í‚¤ë¥¼ ì„¤ì •í•˜ê¸° ì–´ë ¤ìš´ ê²½ìš°, ëª¨ë“  ë¦¬ìŠ¤íŠ¸ë¥¼ ë¬´íš¨í™”í•˜ëŠ” ë°©ì‹ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤:

```js
function useUpdateTitle() {
  return useMutation({
    mutationFn: updateTitle,
    onSuccess: (newTodo) => {
      queryClient.setQueryData(['todos', 'detail', newTodo.id], newTodo);

      // âœ… ëª¨ë“  ë¦¬ìŠ¤íŠ¸ë¥¼ ë¬´íš¨í™”
      queryClient.invalidateQueries({
        queryKey: ['todos', 'list'],
      });
    },
  });
}
```

#### 3. í™œì„± ë¦¬ìŠ¤íŠ¸ë¥¼ ì œì™¸í•œ ë¬´íš¨í™”

URLì—ì„œ í˜„ì¬ í•„í„°ë¥¼ ì½ì–´ì™€ í™œì„±í™”ëœ ë¦¬ìŠ¤íŠ¸ë§Œ ì—…ë°ì´íŠ¸í•˜ê³ , ë‚˜ë¨¸ì§€ ë¦¬ìŠ¤íŠ¸ëŠ” ë¬´íš¨í™”í•˜ëŠ” ë°©ì‹:

```js
function useUpdateTitle() {
  // URLì—ì„œ í˜„ì¬ í•„í„°ë¥¼ ì½ì–´ì˜¤ëŠ” ì»¤ìŠ¤í…€ í›…
  const { filters } = useFilterParams();

  return useMutation({
    mutationFn: updateTitle,
    onSuccess: (newTodo) => {
      queryClient.setQueryData(['todos', 'detail', newTodo.id], newTodo);

      // âœ… í˜„ì¬ ë³´ê³  ìˆëŠ” ë¦¬ìŠ¤íŠ¸ë¥¼ ì—…ë°ì´íŠ¸
      queryClient.setQueryData(['todos', 'list', { filters }], (previous) =>
        previous.map((todo) => (todo.id === newTodo.id ? newTodo : todo))
      );

      // ğŸ¥³ í™œì„±í™”ëœ ë¦¬ìŠ¤íŠ¸ëŠ” ì œì™¸í•˜ê³ , ë‚˜ë¨¸ì§€ ë¦¬ìŠ¤íŠ¸ë¥¼ ë¬´íš¨í™”
      queryClient.invalidateQueries({
        queryKey: ['todos', 'list'],
        refetchType: 'none', // v4ì—ì„œ ì‚¬ìš©
      });
    },
  });
}
```

---

## 2. Query Key Factory

ì‚¬ì‹¤ 1ë²ˆì˜ ë°©ë²•ì„ í†µí•´ `QueryKey`ì˜ íš¨ìœ¨ì  ê´€ë¦¬ë¥¼ ìœ„í•´ ê¸°ëŠ¥ë³„ í´ë”êµ¬ì¡°ë¥¼ ì¡ëŠ”ê²Œ ì¤‘ìš”í•œ ê²ƒì„ ì•Œ ìˆ˜ ìˆê²Œ ë˜ì—ˆì§€ë§Œ, ê°œì¸ì ìœ¼ë¡œ `QueryKey`ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ë¶€ë¶„ì— ëŒ€í•œ ê¶ê¸ˆì¦ì€ ì•„ì§ í•´ì†Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

ê³µì‹ë¬¸ì„œì—ì„œ ì•„ë˜ì™€ ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•´ì£¼ì—ˆê¸°ì— í•œë²ˆ ë°”ë¡œ ì‚¬ìš©í•´ë³´ê³ ì í–ˆìŠµë‹ˆë‹¤.

> **ì°¸ê³  ìë£Œ**: [Query Key Factory](https://github.com/lukemorales/query-key-factory)

![Query Key Factory ë¼ì´ë¸ŒëŸ¬ë¦¬](/images/query-key-factory/5.webp)

#### 1. í‘œì¤€í™”ëœ í‚¤ ìƒì„± (Standardized Keys)

`query-key-factory`ë¥¼ ì‚¬ìš©í•˜ë©´ ëª¨ë“  í‚¤ê°€ ë°°ì—´ í˜•íƒœë¡œ í‘œì¤€í™”ë©ë‹ˆë‹¤.

ë˜í•œ ì§ë ¬í™” ê°€ëŠ¥í•œ ê°ì²´ë¥¼ í¬í•¨í•œ í‚¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts
export const todos = createQueryKeys('todos', {
  detail: (todoId: string) => [todoId],
  list: (filters: TodoFilters) => ({
    queryKey: [{ filters }],
  }),
});
```

```ts
// createQueryKeys ì¶œë ¥:
{
  _def: ['todos'],
  detail: (todoId: string) => {
    queryKey: ['todos', 'detail', todoId],
  },
  list: (filters: TodoFilters) => {
    queryKey: ['todos', 'list', { filters }],
  },
}
```

`queryKey`ê°€ í•„ìš”í•˜ì§€ ì•Šì€ ê²½ìš°ì—ëŠ” `null`ë¡œ ì„¤ì •í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:

```ts
export const users = createQueryKeys('users', {
  list: {
    queryKey: null,
    queryFn: () => api.getUsers(),
  },
});
```

---

#### 2. Query Keyì™€ Query Option ë™ì‹œ ì„ ì–¸ (Generate the Query Options You Need)

`queryKey`ì™€ `queryFn`ì„ í•¨ê»˜ ì„ ì–¸í•˜ì—¬ í•„ìš”í•œ Query Optionì„ ë°”ë¡œ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts
export const users = createQueryKeys('users', {
  detail: (userId: string) => ({
    queryKey: [userId],
    queryFn: () => api.getUser(userId),
  }),
});

export function useUserDetail(id: string) {
  return useQuery(users.detail(id));
}
```

---

#### 3. ë¬¸ë§¥ ê¸°ë°˜ ì¿¼ë¦¬ ìƒì„± (Generate Contextual Queries)

íŠ¹ì • ì»¨í…ìŠ¤íŠ¸ì— ì¢…ì†ëœ ì¿¼ë¦¬ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ ì‚¬ìš©ìì˜ ì¢‹ì•„ìš” ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¿¼ë¦¬ë¥¼ ìƒì„±í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.

```ts
export const users = createQueryKeys('users', {
  detail: (userId: string) => ({
    queryKey: [userId],
    queryFn: () => api.getUser(userId),
    contextQueries: {
      likes: {
        queryKey: null,
        queryFn: () => api.getUserLikes(userId),
      },
    },
  }),
});

// => createQueryKeys output:
// {
//   _def: ['users'],
//   detail: (userId: string) => {
//     queryKey: ['users', 'detail', userId],
//     queryFn: (ctx: QueryFunctionContext) => api.getUser(userId),
//     _ctx: {
//       likes: {
//         queryKey: ['users', 'detail', userId, 'likes'],
//         queryFn: (ctx: QueryFunctionContext) => api.getUserLikes(userId),
//       },
//     },
//   },
// }

export function useUserLikes(userId: string) {
  return useQuery(users.detail(userId)._ctx.likes);
}
```

---

#### 4. ì§ë ¬í™” ê°€ëŠ¥í•œ í‚¤ ìŠ¤ì½”í”„ ì •ì˜ (Access to Serializable Keys Scope)

ì „ì²´ í‚¤ ìŠ¤ì½”í”„ë¥¼ ì‰½ê²Œ ì•¡ì„¸ìŠ¤í•˜ê³ , í•´ë‹¹ ì»¨í…ìŠ¤íŠ¸ì˜ ìºì‹œë¥¼ ë¬´íš¨í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```js
users.detail(userId).queryKey; // => ['users', 'detail', userId]
users.detail._def; // => ['users', 'detail']
```

---

#### 5. ë‹¨ì¼ íŒŒì¼ì—ì„œ Query Keys ì„ ì–¸ (Declare Your Query Keys in a Single File)

í•˜ë‚˜ì˜ íŒŒì¼ì—ì„œ QueryKeysë¥¼ ì„ ì–¸í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts
export const queries = createQueryKeyStore({
  users: {
    all: null,
    detail: (userId: string) => ({
      queryKey: [userId],
      queryFn: () => api.getUser(userId),
    }),
  },
  todos: {
    detail: (todoId: string) => [todoId],
    list: (filters: TodoFilters) => ({
      queryKey: [{ filters }],
      queryFn: (ctx) => api.getTodos({ filters, page: ctx.pageParam }),
    }),
  },
});
```

---

#### 6. ê¸°ëŠ¥ë³„ë¡œ Query Keys ì„ ì–¸ (Declare Your Query Keys by Feature)

ê¸°ëŠ¥ë³„ë¡œ ì„¸ë¶„í™”í•˜ì—¬ QueryKeysë¥¼ ì„ ì–¸í•˜ê³ , ì´ë¥¼ í•˜ë‚˜ì˜ ê°ì²´ë¡œ ë³‘í•©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts
// queries/users.ts
export const users = createQueryKeys('users', {
  all: null,
  detail: (userId: string) => ({
    queryKey: [userId],
    queryFn: () => api.getUser(userId),
  }),
});

// queries/todos.ts
export const todos = createQueryKeys('todos', {
  detail: (todoId: string) => [todoId],
  list: (filters: TodoFilters) => ({
    queryKey: [{ filters }],
    queryFn: (ctx) => api.getTodos({ filters, page: ctx.pageParam }),
  }),
});

// queries/index.ts
export const queries = mergeQueryKeys(users, todos);
```

---

#### 7. TypeScript ê¸°ë°˜ì˜ ê°•ë ¥í•œ íƒ€ì… ì•ˆì „ì„± (Type Safety and Smart Autocomplete)

íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì™€ í†µí•©ë˜ì–´ IDEì—ì„œ ìë™ì™„ì„± ë° ê°•ë ¥í•œ íƒ€ì… ì§€ì›ì„ ì œê³µí•©ë‹ˆë‹¤.

í‚¤ì˜ êµ¬ì¡°ë‚˜ ì¶œë ¥ íƒ€ì…ì„ ì‰½ê²Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ìŠ¤í† ì–´ì˜ Query Keys íƒ€ì… ì¶”ë¡ **

```ts
import {
  createQueryKeyStore,
  inferQueryKeyStore,
} from '@lukemorales/query-key-factory';

export const queries = createQueryKeyStore({
  /* ... */
});

export type QueryKeys = inferQueryKeyStore<typeof queries>;
```

**íŠ¹ì • ê¸°ëŠ¥ì˜ Query Keys íƒ€ì… ì¶”ë¡ **

```ts
import {
  createQueryKeys,
  inferQueryKeys,
} from '@lukemorales/query-key-factory';

export const todos = createQueryKeys('todos', {
  detail: (todoId: string) => [todoId],
  list: (filters: TodoFilters) => ({
    queryKey: [{ filters }],
    queryFn: (ctx) => api.getTodos({ filters, page: ctx.pageParam }),
  }),
});

export type TodosKeys = inferQueryKeys<typeof todos>;
```

---

## ì´ì   ì‹¤ì „ì´ë‹¤

í•­ìƒ ì‚¬ë‚´ í”„ë¡œì íŠ¸ì— ë„ì… ì´ì „ì— ì§ì ‘ ì„œë²„ë¥¼ ë§Œë“¤ë©´ì„œ ê°œì¸ì ìœ¼ë¡œ ë¨¼ì € ì‘ì—…ì„ í•œ í›„ íš¨ìœ¨ì ì¸ êµ¬ì¡°ë¥¼ ì°¾ì•„ë³´ëŠ” í¸ì…ë‹ˆë‹¤.

ë¬¼ë¡  ì œê°€ ë§Œë“  êµ¬ì¡°ê°€ ì •í™•í•œ ì •ë‹µì€ ì•„ë‹ì§€ë¼ë„, ì´ì „ë³´ë‹¤ í™•ì‹¤í•˜ê²Œ ê°œë°œí•˜ëŠ”ë°ì— ìˆì–´ì„œ íš¨ìœ¨ì ì´ë©´ ìµœëŒ€í•œ ë¹ ë¥´ê²Œ ë¦¬íŒ©í† ë§ì„ ì§„í–‰í•˜ê³ ì í•©ë‹ˆë‹¤.

ì•„ë˜ëŠ” ì•ìœ¼ë¡œ ì‚¬ë‚´ ì½”ë“œ ë„ì…ì— ì§„í–‰ í•  ì˜ˆì‹œì…ë‹ˆë‹¤.

1. ë„ë©”ì¸ì„ ê¸°ì¤€ìœ¼ë¡œ í´ë” êµ¬ì¡°ë¥¼ ë‚˜ëˆ„ì.

ì´ë¦„ì€ ì¤‘ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê¸°ëŠ¥ë³„ í´ë” êµ¬ì¡°ë¥¼ ë‚˜ëˆ„ëŠ”ê²Œ ì¤‘ìš”í•˜ë‹¤ê³  ëŠê¼ˆìŠµë‹ˆë‹¤.

`features`ë“  `domains`ë“  ê¸°ëŠ¥ì„ ê¸°ì¤€ìœ¼ë¡œ í´ë” êµ¬ì¡°ë¥¼ ë‚˜ëˆ„ì–´ì•¼ ê² ìŠµë‹ˆë‹¤.

![ë„ë©”ì¸ì„ ê¸°ì¤€ìœ¼ë¡œ, í´ë” êµ¬ì¡°ë¥¼ ë‚˜ëˆ„ì.](/images/query-key-factory/6.webp)

2. ê¸°ëŠ¥ë³„ ì¿¼ë¦¬í‚¤ë¥¼ ë¶„ë¦¬í•˜ì—¬ `QueryKeyFactory`ë¥¼ ì‚¬ìš©í•˜ëŠ” êµ¬ì¡°ë¡œ ë³€ê²½í•˜ì.

```ts
import { createQueryKeyStore } from '@lukemorales/query-key-factory';
import { getAllTodos, getTodo } from '../services/todo.service';

export const todoKeys = createQueryKeyStore({
  todos: {
    getAll: (search?: string, limit?: number) => ({
      queryKey: [{ search }],
      queryFn: (ctx) =>
        getAllTodos({
          search,
          cursor: ctx.pageParam as number,
          limit,
        }),
    }),
    getById: (id: number) => ({
      queryKey: [id] as const,
      queryFn: () => getTodo(id),
    }),
  },
});
```

ì´ë ‡ê²Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•˜ë©´ ë§¤ìš° íš¨ìœ¨ì ìœ¼ë¡œ ì¿¼ë¦¬í‚¤ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

3. í•´ë‹¹ í‚¤ë¥¼ í™œìš©í•˜ì—¬ hooksë¥¼ ìƒì„±í•˜ì

ì¼ë‹¨ì€ `useQuery` / `useInfiniteQuery`ë¥¼ í™œìš©í•˜ëŠ” `queries` í´ë”ì™€, `useMutation`ì„ í™œìš©í•˜ëŠ” `mutations` í´ë”ë¡œ í¬ê²Œ ë‚˜ëˆ„ì—ˆìŠµë‹ˆë‹¤.

```ts
// queries/todo.query.ts
import { useQuery } from '@tanstack/react-query';
import { todoKeys } from '../todo.key';

export const useGetTodoList = (search?: string, limit?: number) => {
  return useQuery({
    queryKey: todoKeys.todos.getAll(search, limit).queryKey,
    queryFn: todoKeys.todos.getAll(search, limit).queryFn,
  });
};

export const useGetTodo = (id: string) => {
  const parseIntId = parseInt(id);
  return useQuery({
    queryKey: todoKeys.todos.getById(parseIntId).queryKey,
    queryFn: todoKeys.todos.getById(parseIntId).queryFn,
  });
};
```

```ts
// mutations/todo.mutation.ts
import { useMutation } from '@tanstack/react-query';
import {
  deleteTodo,
  postTodo,
  updateTodoDoneStatus,
} from '../../services/todo.service';
import { queryClient } from '../../../../common/containers/QueryClientProvider';
import { todoKeys } from '../todo.key';

export function useCreateTodoMutation() {
  return useMutation({
    mutationFn: postTodo,
    onSuccess: () => {
      queryClient.invalidateQueries({
        queryKey: todoKeys.todos.getAll().queryKey,
      });
    },
  });
}

export function useDeleteTodoMutation() {
  return useMutation({
    mutationFn: deleteTodo,
    onSuccess: () => {
      queryClient.invalidateQueries({
        queryKey: todoKeys.todos._def,
      });
    },
  });
}

export function useUpdateTodoDoneStatusMutation() {
  return useMutation({
    mutationFn: updateTodoDoneStatus,
  });
}

export function useTodo() {
  const create = useCreateTodoMutation();
  const remove = useDeleteTodoMutation();
  const updateStatus = useUpdateTodoDoneStatusMutation();
  return {
    create,
    remove,
    updateStatus,
  };
}
```

4. ì˜ ì‚¬ìš©í•´ë³´ì, ì „ì²´ í‚¤ë¥¼ invalidate í• ì§€, íŠ¹ì • ê²Œì‹œê¸€ë§Œ invalidate í• ì§€, íš¨ìœ¨ì ìœ¼ë¡œ ì¿¼ë¦¬í‚¤ë¥¼ í™œìš©í•˜ì.

```ts
import { useNavigate } from 'react-router-dom';
import { useGetTodoList } from '../features/todo/hooks/queries/todo.queries';
import { useState } from 'react';
import { useTodo } from '../features/todo/hooks/mutations/todo.mutation';
import { queryClient } from '../common/containers/QueryClientProvider';
import { todoKeys } from '../features/todo/hooks/todo.key';

export default function TodosPage() {
  const navigate = useNavigate();

  const [title, setTitle] = useState < string > '';
  const [search, setSearch] = (useState < string) | (undefined > undefined);
  const { data: todos } = useGetTodoList(search);
  const { create, remove, updateStatus } = useTodo();

  return (
    <div>
      <div
        style={{
          display: 'flex',
          flexDirection: 'column',
          gap: 10,
        }}
      >
        <input
          type='text'
          value={search}
          onChange={(e) => setSearch(e.target.value)}
          placeholder='ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'
        />
        <div>
          <input
            type='text'
            value={title}
            onChange={(e) => setTitle(e.target.value)}
            placeholder='íˆ¬ë‘ ì œëª© ì…ë ¥ í•´ì£¼ì„¸ìš”.'
          />
          <button
            onClick={() =>
              create.mutate({
                title,
                content: 'content',
              })
            }
          >
            íˆ¬ë‘ ìƒì„±
          </button>
        </div>
      </div>
      {todos?.data.todos.map((todo) => (
        <div
          onClick={() => navigate(`/${todo.id}`)}
          style={{
            cursor: 'pointer',
            padding: 10,
            border: '1px solid black',
            margin: 10,
            display: 'flex',
            justifyContent: 'center',
            alignItems: 'center',
          }}
        >
          <h1>{todo.title}</h1>
          <p>{todo.content}</p>
          <input
            type='checkbox'
            defaultChecked={todo.done}
            onClick={(e) => {
              e.stopPropagation();
              updateStatus.mutate(todo.id);
            }}
          />
          <button
            onClick={(e) => {
              e.stopPropagation();
              remove.mutate(todo.id, {
                onSuccess: () => {
                  queryClient.invalidateQueries({
                    queryKey: todoKeys.todos.getById(todo.id).queryKey,
                  });
                },
              });
            }}
          >
            ì‚­ì œ
          </button>
        </div>
      ))}
    </div>
  );
}
```

---

## ë§ˆë¬´ë¦¬

ê·¸ë™ì•ˆ `QueryKey` ê´€ë¦¬ì— ëŒ€í•œ ë§ì€ ê³ ë¯¼ì´ ìˆì—ˆëŠ”ë° ê³µì‹ë¬¸ì„œì™€ ë‹¤ì–‘í•œ ë¸”ë¡œê·¸, ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì„ íƒë°©í•˜ë©° ë‹¤ì–‘í•œ í•´ê²°ì±…ì„ ì•Œì•„ë‚¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

íš¨ìœ¨ì ì¸ `QueryKey` ê´€ë¦¬ì— ëŒ€í•´ ê³ ë¯¼í•˜ë©° ê¸°ì¡´ ì„œë¹„ìŠ¤ì˜ í´ë” êµ¬ì¡°ì˜ ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€ì— ëŒ€í•œ ë¬¸ì œì ë„ ë°œê²¬í•˜ì—¬ ê³ ì¹  ìˆ˜ ìˆëŠ” ì†Œì¤‘í•œ ê¸°íšŒê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.

ë” ë‚˜ì•„ê°€ `Optimistic Update`ë¥¼ í†µí•œ User Experienceë¥¼ í–¥ìƒ ì‹œí‚¤ê¸° ìœ„í•œ ì‘ì—…ì„ ì§„í–‰í•˜ë ¤ê³  í–ˆëŠ”ë°, ì´ë•Œ `QueryKey`ì— ëŒ€í•œ ë¬¸ì œê°€ ìˆì—ˆëŠ”ë° ì´ë²ˆ ê¸°íšŒì— ì´ë¥¼ ì‰½ê²Œ í•´ê²°í•˜ê³  ì›í•˜ë˜ `Optimistic Update`ë¥¼ ì¡°ê¸ˆ ë” ì‰½ê²Œ ì ìš©í•  ìˆ˜ ìˆê²Œ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ì €ì²˜ëŸ¼ í˜¹ì‹œë¼ë„ `QueryKey` ê´€ë¦¬ì— ëŒ€í•´ì„œ ë§ì€ ê³ ë¯¼ì„ í•œ ì‚¬ëŒì—ê²Œ ì¡°ê¸ˆì´ë‚˜ë§ˆ ì´ ê²Œì‹œê¸€ì´ ë„ì›€ì´ ë˜ì…¨ìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤!

íš¨ìœ¨ì ì¸ `QueryKey` ê´€ë¦¬ì— ëŒ€í•´ (í´ë”êµ¬ì¡° ë“±) ì¢‹ì€ ê²½í—˜ì„ ê°–ê³  ê³„ì‹ ë‹¤ë©´ ëŒ“ê¸€ì€ ì–¸ì œë‚˜ í™˜ì˜ì…ë‹ˆë‹¤!!

ì•„ë˜ëŠ” ì§ì ‘ ì‚¬ë‚´ í”„ë¡œì íŠ¸ ë„ì…ì „ í˜¼ì Nest.jsë¡œ ì„œë²„ë¥¼ ë§Œë“¤ì–´ê°€ë©° QueryKeyFactory í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ëŠ” ì˜ìƒì´ë‹ˆ, ìœ„ì˜ ë¸”ë¡œê·¸ ê¸€ì´ ì´í•´ê°€ ì•ˆê°„ë‹¤ë©´ ì¡°ê¸ˆì”© ì°¸ê³ í•´ë³´ì…”ë„ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤!

https://youtu.be/O_G-oQ1_Zag?si=oCKpbzskrnXJeHd0
