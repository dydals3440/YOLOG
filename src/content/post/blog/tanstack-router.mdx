---
title: 'ë¦¬ì•¡íŠ¸ í”„ë¡œì íŠ¸ì— TanStack Routerë¥¼ ë„ì…í•´ì•¼ í•˜ëŠ” ì´ìœ '
date: '2025-12-20'
updatedDate: '2025-12-21'
tags: [TanStack Router, React, TypeScript, ë¼ìš°íŒ…]
category: DEVELOPMENT
image: '/images/tanstack-router/thumbnail.webp'
---

# TanStack Routerë¥¼ ì†Œê°œí•©ë‹ˆë‹¤

## ë¦¬ì•¡íŠ¸ í”„ë¡œì íŠ¸ì— TanStack Routerë¥¼ ë„ì…í•´ì•¼ í•˜ëŠ” ì´ìœ 

ì‚¬ë‚´ì—ì„œ CSR ì¤‘ì‹¬ì˜ ì‹ ê·œ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ë©´ì„œ `react-router-dom`ê³¼ `tanstack-router`ë¥¼ ê³ ë¯¼í–ˆë‹¤. ê²°êµ­ TanStack Routerë¥¼ ì„ íƒí–ˆê³ , ê·¸ ì´ìœ ëŠ” ì„¸ ê°€ì§€ë‹¤.

**1. ì»´íŒŒì¼ íƒ€ì„ íƒ€ì… ì•ˆì „ì„±**

React Routerì˜ `useParams`ëŠ” `string | undefined`ë§Œ ë°˜í™˜í•œë‹¤. ê²½ë¡œ ì˜¤íƒ€ëŠ” ëŸ°íƒ€ì„ì—ì„œì•¼ ë°œê²¬ëœë‹¤. TanStack RouterëŠ” ê²½ë¡œ, íŒŒë¼ë¯¸í„°, ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ê¹Œì§€ **ì™„ì „í•œ íƒ€ì… ì•ˆì „ì„±**ì„ ë³´ì¥í•œë‹¤. ì—ë””í„°ì—ì„œ ë¹¨ê°„ ì¤„ë¡œ ì°¨ë‹¨ë˜ë¯€ë¡œ DXì™€ ì•ˆì •ì„±ì´ ì••ë„ì ì´ë‹¤.

**2. CSRì— ìµœì í™”ëœ ë‹¨ìˆœí•¨**

Next.jsì˜ ì„œë²„ ì»´í¬ë„ŒíŠ¸ì™€ ë³µì¡í•œ ìºì‹± ì „ëµì€ í´ë¼ì´ì–¸íŠ¸ ì¤‘ì‹¬ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì˜¤ë²„ì—”ì§€ë‹ˆì–´ë§ì´ë‹¤. `beforeLoad`ì™€ `loader`ë¡œ ë³´ì•ˆ ì²´í¬ì™€ ë°ì´í„° ë¡œë”© ìˆœì„œë¥¼ ëª…í™•íˆ ë³´ì¥í•˜ë©´ì„œë„, CSR í™˜ê²½ì— ìµœì í™”ëœ ë‹¨ìˆœí•œ êµ¬ì¡°ë¥¼ ì œê³µí•œë‹¤.

**3. SSR í™•ì¥ì„±**

ë‚˜ì¤‘ì— SSRì´ í•„ìš”í•´ë„ ê±±ì • ì—†ë‹¤. TanStack RouterëŠ” SSRì„ ì—¼ë‘ì— ë‘ê³  ì„¤ê³„ë˜ì—ˆê³ , **TanStack Start**ê°€ í˜„ì¬ RC ìƒíƒœì´ë©°, ì¶”í›„ SSR ë„ì… ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜ ë¹„ìš©ì´ ì ë‹¤.

---

## Installation and Setup

### íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
pnpm add @tanstack/react-router @tanstack/react-router-devtools
pnpm add -D @tanstack/router-plugin
```

Search Parametersì— Zod ìŠ¤í‚¤ë§ˆ ê²€ì¦ì„ ì‚¬ìš©í•˜ë ¤ë©´ ì¶”ê°€ë¡œ ì„¤ì¹˜í•œë‹¤:

```bash
pnpm add @tanstack/zod-adapter zod
```

TanStack RouterëŠ” ë‘ ê°€ì§€ ë¼ìš°íŒ… ë°©ì‹ì„ ì œê³µí•œë‹¤:

- **Code Based Router**: ì½”ë“œë¡œ ë¼ìš°íŠ¸ë¥¼ ì§ì ‘ ì •ì˜
- **File Based Router**: íŒŒì¼ ì‹œìŠ¤í…œ êµ¬ì¡°ê°€ ê³§ ë¼ìš°íŠ¸ (ê¶Œì¥)

ì´ ê°€ì´ë“œì—ì„œëŠ” ë” ì§ê´€ì ì´ê³  ê´€ë¦¬í•˜ê¸° ì‰¬ìš´ **File Based Router**ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ëª…í•œë‹¤.

### Vite Configuration

```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { TanStackRouterVite } from '@tanstack/router-plugin/vite';

export default defineConfig({
  plugins: [TanStackRouterVite(), react()],
});
```

### Project Structure

ì‹¤ì œë¡œ, í´ë”ê¸°ë°˜ ë¼ìš°íŒ…ì´ê¸° ë•Œë¬¸ì— ë¨¼ì € ì „ì²´ì ì¸ íë¦„ì„ í´ë” êµ¬ì¡°ë¡œ ë³´ì.
ì‹¤ì œë¡œ ì´ ë¸”ë¡œê·¸ì—ì„œ ë§Œë“¤ "í•  ì¼ ê´€ë¦¬ ì•±"ì˜ ìµœì¢… í´ë” êµ¬ì¡°ë‹¤.

```
ğŸ“¦ src
 â”£ ğŸ“‚ routes
 â”ƒ â”£ ğŸ“‚ -components          # ë¼ìš°íŠ¸ê°€ ì•„ë‹Œ ì»´í¬ë„ŒíŠ¸ í´ë” (- ì ‘ë‘ì‚¬)
 â”ƒ â”£ ğŸ“‚ (utils)              # ë¼ìš°íŠ¸ê°€ ì•„ë‹Œ ìœ í‹¸ í´ë” (ê´„í˜¸)
 â”ƒ â”£ ğŸ“œ __root.tsx           # ë£¨íŠ¸ ë ˆì´ì•„ì›ƒ (ë„¤ë¹„ê²Œì´ì…˜, ê³µí†µ UI)
 â”ƒ â”£ ğŸ“œ index.tsx            # í™ˆí˜ì´ì§€ (/)
 â”ƒ â”£ ğŸ“œ login.tsx            # ë¡œê·¸ì¸ (/login)
 â”ƒ â”£ ğŸ“œ todos.tsx            # í•  ì¼ ë ˆì´ì•„ì›ƒ (/todos/*)
 â”ƒ â”£ ğŸ“œ todos.index.tsx      # í•  ì¼ ëª©ë¡ (/todos)
 â”ƒ â”£ ğŸ“œ todos.$todoId.tsx    # í•  ì¼ ìƒì„¸ (/todos/:todoId)
 â”ƒ â”£ ğŸ“œ todos_.$todoId.edit.tsx # í•  ì¼ í¸ì§‘ - ë ˆì´ì•„ì›ƒ íƒˆì¶œ (/todos/:todoId/edit)
 â”ƒ â”£ ğŸ“œ _authenticated.tsx   # ì¸ì¦ í•„ìš” ë ˆì´ì•„ì›ƒ (pathless)
 â”ƒ â”£ ğŸ“œ _authenticated.dashboard.tsx # ëŒ€ì‹œë³´ë“œ (/dashboard)
 â”ƒ â”— ğŸ“œ _authenticated.settings.tsx  # ì„¤ì • (/settings)
 â”£ ğŸ“œ main.tsx               # ì•± ì§„ì…ì 
 â”— ğŸ“œ routeTree.gen.ts       # ìë™ ìƒì„±ë¨
```

---

## Code Based Router

ì•± ì§„ì…ì ì—ì„œ ë¼ìš°í„°ë¥¼ ì„¤ì •í•œë‹¤.

```tsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import { RouterProvider, createRouter } from '@tanstack/react-router';
import { routeTree } from './routeTree.gen';

const router = createRouter({
  routeTree,
  defaultPreload: 'intent',
});

declare module '@tanstack/react-router' {
  interface Register {
    router: typeof router;
  }
}

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <RouterProvider router={router} />
  </React.StrictMode>
);
```

`routeTree.gen.ts`ëŠ” TanStack Routerê°€ ìë™ìœ¼ë¡œ ìƒì„±í•˜ëŠ” íŒŒì¼ì´ë‹¤.
`routes` í´ë”ì˜ íŒŒì¼ êµ¬ì¡°ë¥¼ ë¶„ì„í•˜ì—¬ íƒ€ì… ì•ˆì „í•œ ë¼ìš°íŠ¸ íŠ¸ë¦¬ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.

> íŒŒì¼ì„ ìƒì„±í•˜ê±°ë‚˜, ìˆ˜ì •í•  ë•Œ ë§ˆë‹¤ ìë™ìœ¼ë¡œ íƒ€ì…ì´ ìƒì„±ëœë‹¤. íŠ¹íˆ, ìˆ˜ì •ì‹œì— ë³€ê²½ëœ íƒ€ì…ë“¤ì„ ê°ì§€í•˜ì§€ ëª»í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤. ì´ ê²½ìš°ì—ëŠ” routeTree.gen.ts íŒŒì¼ì„ ìˆ˜ë™ìœ¼ë¡œ ì‚­ì œí•˜ê³  ë‹¤ì‹œ í”„ë¡œì íŠ¸ë¥¼ ì¢…ë£Œí•˜ê³  ì‹¤í–‰í•˜ë©´ í•´ê²°ëœë‹¤.

### declare moduleì„ í†µí•œ ì „ì—­ íƒ€ì… ë“±ë¡

```tsx
declare module '@tanstack/react-router' {
  interface Register {
    router: typeof router;
  }
}
```

ì´ ì½”ë“œê°€ **TanStack Routerì˜ 100% íƒ€ì… ì•ˆì „ì„±**ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” í•µì‹¬ì´ë‹¤.

ì‰½ê²Œ ì„¤ëª…í•˜ë©´, ì´ ì½”ë“œëŠ” "TypeScriptì—ê²Œ ìš°ë¦¬ í”„ë¡œì íŠ¸ì˜ ë¼ìš°íŠ¸ ì§€ë„ë¥¼ ë“±ë¡í•˜ëŠ” ê²ƒ"ì´ë‹¤. ë§ˆì¹˜ íšŒì‚¬ì— ì‹ ì…ì‚¬ì›ì´ ë“¤ì–´ì™”ì„ ë•Œ ê±´ë¬¼ ì•ˆë‚´ë„ë¥¼ ì£¼ëŠ” ê²ƒì²˜ëŸ¼, TypeScriptì—ê²Œ "ìš°ë¦¬ ì•±ì—ëŠ” `/about`, `/posts`, `/products` ì´ëŸ° ê²½ë¡œë“¤ì´ ìˆì–´"ë¼ê³  ì•Œë ¤ì£¼ëŠ” ì‘ì—…ì´ë‹¤. ì´ ì§€ë„ê°€ ìˆì–´ì•¼ TypeScriptê°€ "ì–´? `/abuot`ë¼ëŠ” ê²½ë¡œëŠ” ì§€ë„ì— ì—†ëŠ”ë°?"ë¼ê³  ì˜¤íƒ€ë¥¼ ì¡ì•„ì¤„ ìˆ˜ ìˆë‹¤.

**ì™œ í•„ìš”í• ê¹Œ?**

TypeScriptì˜ Module Augmentation ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ `@tanstack/react-router` ëª¨ë“ˆì— ìš°ë¦¬ í”„ë¡œì íŠ¸ì˜ `router` íƒ€ì…ì„ ë“±ë¡í•œë‹¤. ì´ë ‡ê²Œ í•˜ë©´:

1. **í”„ë¡œì íŠ¸ ì „ì—­ì—ì„œ íƒ€ì… ì¶”ë¡ **: `Link`, `useNavigate`, `useParams` ë“± ëª¨ë“  ë¼ìš°í„° ê´€ë ¨ í•¨ìˆ˜ì—ì„œ ìš°ë¦¬ í”„ë¡œì íŠ¸ì˜ ë¼ìš°íŠ¸ ì •ë³´ë¥¼ ìë™ìœ¼ë¡œ ì¶”ë¡ 
2. **ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ë¡œ ê°ì§€**: `<Link to="/nonexistent">` ê°™ì€ ì˜¤íƒ€ë¥¼ ì»´íŒŒì¼ íƒ€ì„ì— ì¦‰ì‹œ ë°œê²¬
3. **íŒŒë¼ë¯¸í„° íƒ€ì… ì•ˆì „ì„±**: `useParams()`ê°€ í˜„ì¬ ë¼ìš°íŠ¸ì— ë§ëŠ” ì •í™•í•œ íƒ€ì…ì„ ë°˜í™˜

```tsx
// ì´ íƒ€ì… ë“±ë¡ì´ ì—†ìœ¼ë©´:
<Link to="/about">  // íƒ€ì… ì²´í¬ ì•ˆë¨

// íƒ€ì… ë“±ë¡ í›„:
<Link to="/abuot">  // âŒ TypeScript ì˜¤ë¥˜! '/abuot' ê²½ë¡œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
```

**React Routerì™€ ë­ê°€ ë‹¤ë¥¼ê¹Œ?**

React Routerì—ì„œëŠ” `useParams()`ê°€ í•­ìƒ `{ [key: string]: string | undefined }`ë¥¼ ë°˜í™˜í•œë‹¤.
TanStack Routerì—ì„œëŠ” í˜„ì¬ ë¼ìš°íŠ¸ì— ì •ì˜ëœ íŒŒë¼ë¯¸í„°ë§Œ ì •í™•í•œ íƒ€ì…ìœ¼ë¡œ ë°˜í™˜ëœë‹¤.

```tsx
// React Router (í•­ìƒ string | undefined)
const { postId } = useParams(); // postId: string | undefined

// TanStack Router (ì •í™•í•œ íƒ€ì…)
const { postId } = Route.useParams(); // postId: string (í˜„ì¬ ë¼ìš°íŠ¸ì— ì •ì˜ëœ ê²½ìš°)
```

### createRootRoute

ëª¨ë“  í˜ì´ì§€ì— ê³µí†µìœ¼ë¡œ ì ìš©ë˜ëŠ” ë£¨íŠ¸ ë ˆì´ì•„ì›ƒì„ ì •ì˜í•œë‹¤.

```tsx
import { createRootRoute, Link, Outlet } from '@tanstack/react-router';
import { TanStackRouterDevtools } from '@tanstack/router-devtools';

export const Route = createRootRoute({
  component: RootComponent,
  notFoundComponent: () => <div>í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>,
});

function RootComponent() {
  return (
    <div>
      <nav>
        <Link to='/' activeProps={{ className: 'font-bold' }}>
          í™ˆ
        </Link>
        <Link to='/todos' activeProps={{ className: 'font-bold' }}>
          í•  ì¼
        </Link>
      </nav>

      <main>
        <Outlet />
      </main>

      <TanStackRouterDevtools position='bottom-right' />
    </div>
  );
}
```

`<Outlet />`ì€ ìì‹ ë¼ìš°íŠ¸ì˜ ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ë˜ëŠ” ìœ„ì¹˜ë‹¤.
React Routerì™€ ë™ì¼í•œ ê°œë…ì´ì§€ë§Œ, TanStack Routerì—ì„œëŠ” íƒ€ì… ì•ˆì „ì„±ì´ ë³´ì¥ëœë‹¤.

---

## Navigation Link

### Link Component

```tsx
import { Link } from '@tanstack/react-router';

function Navigation() {
  return (
    <nav>
      {/* ê¸°ë³¸ ë§í¬ */}
      <Link to='/'>í™ˆ</Link>

      {/* ë™ì  íŒŒë¼ë¯¸í„° */}
      <Link to='/todos/$todoId' params={{ todoId: '1' }}>
        í•  ì¼ ë³´ê¸°
      </Link>

      {/* Search Params ì „ë‹¬ */}
      <Link to='/todos' search={{ page: 1, status: 'completed' }}>
        ì™„ë£Œëœ í•  ì¼
      </Link>

      {/* ì´ì „ Search ìœ ì§€í•˜ë©° ì—…ë°ì´íŠ¸ */}
      <Link to='/todos' search={(prev) => ({ ...prev, page: 2 })}>
        ë‹¤ìŒ í˜ì´ì§€
      </Link>

      {/* activeProps: í˜„ì¬ ê²½ë¡œ ì¼ì¹˜ ì‹œ ìŠ¤íƒ€ì¼ */}
      <Link
        to='/about'
        activeProps={{ className: 'font-bold text-blue-600' }}
        inactiveProps={{ className: 'text-gray-600' }}
      >
        ì†Œê°œ
      </Link>

      {/* activeOptions.exact: ì •í™•íˆ ì¼ì¹˜í•  ë•Œë§Œ í™œì„±í™” */}
      <Link
        to='/todos'
        activeOptions={{ exact: true }}
        activeProps={{ className: 'underline' }}
      >
        í•  ì¼ ëª©ë¡
      </Link>
    </nav>
  );
}
```

`Link` ì»´í¬ë„ŒíŠ¸ì—ì„œ `params`ë¥¼ ì „ë‹¬í•  ë•Œ íƒ€ì… ì²´í¬ê°€ ìë™ìœ¼ë¡œ ëœë‹¤.
ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íŒŒë¼ë¯¸í„°ë‚˜ ì˜ëª»ëœ íƒ€ì…ì„ ì „ë‹¬í•˜ë©´ TypeScriptê°€ ì¦‰ì‹œ ì˜¤ë¥˜ë¥¼ í‘œì‹œí•œë‹¤.

### Link ì¶”ê°€ ì˜µì…˜

```tsx
function Navigation() {
  return (
    <nav>
      {/* resetScroll: í˜ì´ì§€ ì´ë™ ì‹œ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì´ˆê¸°í™” (ê¸°ë³¸ê°’: true) */}
      <Link to='/posts' resetScroll={true}>
        ê²Œì‹œê¸€ (ìŠ¤í¬ë¡¤ ì´ˆê¸°í™”)
      </Link>

      {/* resetScroll: falseë©´ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ìœ ì§€ */}
      <Link to='/posts' resetScroll={false}>
        ê²Œì‹œê¸€ (ìŠ¤í¬ë¡¤ ìœ ì§€)
      </Link>

      {/* hash: URL í•´ì‹œ ì§€ì • */}
      <Link to='/docs' hash='getting-started'>
        ì‹œì‘í•˜ê¸° (#getting-startedë¡œ ìŠ¤í¬ë¡¤)
      </Link>

      {/* replace: íˆìŠ¤í† ë¦¬ êµì²´ (ë’¤ë¡œê°€ê¸° ë¶ˆê°€) */}
      <Link to='/checkout/complete' replace>
        ê²°ì œ ì™„ë£Œ (ë’¤ë¡œê°€ê¸° ë°©ì§€)
      </Link>

      {/* mask: URL ë§ˆìŠ¤í‚¹ (í‘œì‹œë˜ëŠ” URLê³¼ ì‹¤ì œ URL ë¶„ë¦¬) */}
      <Link
        to='/photos/$photoId'
        params={{ photoId: '123' }}
        mask={{ to: '/photos', unmaskOnReload: true }}
      >
        ì‚¬ì§„ ë³´ê¸° (ëª¨ë‹¬ë¡œ í‘œì‹œ, URLì€ /photos)
      </Link>
    </nav>
  );
}
```

**mask ì˜µì…˜ì€ ì–¸ì œ ì“¸ê¹Œ?**

ì¸ìŠ¤íƒ€ê·¸ë¨ ìŠ¤íƒ€ì¼ì˜ ëª¨ë‹¬ ì‚¬ì§„ ë·°ì–´ë¥¼ êµ¬í˜„í•  ë•Œ ìœ ìš©í•˜ë‹¤.

```tsx
<Link
  to='/photos/$photoId'
  params={{ photoId: '123' }}
  mask={{
    to: '/photos',
    unmaskOnReload: true, // ìƒˆë¡œê³ ì¹¨ ì‹œ ì‹¤ì œ URLë¡œ ì´ë™
  }}
>
  ì‚¬ì§„ ë³´ê¸°
</Link>
```

- í´ë¦­ ì‹œ: `/photos/123` ë¼ìš°íŠ¸ê°€ í™œì„±í™”ë˜ì§€ë§Œ URLì€ `/photos`ë¡œ í‘œì‹œ
- ìƒˆë¡œê³ ì¹¨ ì‹œ: `/photos`ë¡œ ì´ë™ (ëª¨ë‹¬ì´ ì•„ë‹Œ ê°¤ëŸ¬ë¦¬ í˜ì´ì§€)
- ë’¤ë¡œê°€ê¸°: ì´ì „ í˜ì´ì§€ë¡œ ì •ìƒ ì´ë™

### Programmatic Navigation

```tsx
import { useNavigate } from '@tanstack/react-router';

function TodoSearchForm() {
  const navigate = useNavigate();

  const handleSearch = (keyword: string) => {
    navigate({
      to: '/todos',
      search: {
        page: 1,
        keyword,
        sort: 'date',
      },
    });
  };

  // ìƒëŒ€ ê²½ë¡œ ë„¤ë¹„ê²Œì´ì…˜
  const navigateRelative = useNavigate({ from: Route.fullPath });

  const goBack = () => {
    navigateRelative({ to: '..' }); // ë¶€ëª¨ ê²½ë¡œë¡œ ì´ë™
  };

  return (
    <form
      onSubmit={(e) => {
        e.preventDefault();
        const formData = new FormData(e.currentTarget);
        handleSearch(formData.get('keyword') as string);
      }}
    >
      <input name='keyword' placeholder='ê²€ìƒ‰ì–´ ì…ë ¥' />
      <button type='submit'>ê²€ìƒ‰</button>
    </form>
  );
}
```

`navigate` í•¨ìˆ˜ë„ ì™„ì „íˆ íƒ€ì… ì•ˆì „í•˜ë‹¤.
ì¡´ì¬í•˜ì§€ ì•ŠëŠ” search íŒŒë¼ë¯¸í„°ë¥¼ ì „ë‹¬í•˜ë©´ TypeScript ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.

---

## Nesting Routes

### Trailing Slashì˜ ì¤‘ìš”ì„±

íŒŒì¼ ê¸°ë°˜ ë¼ìš°íŒ…ì—ì„œ **trailing slashì˜ ìœ ë¬´**ëŠ” ë§¤ìš° ì¤‘ìš”í•œ ì°¨ì´ë¥¼ ë§Œë“ ë‹¤:

```tsx
// todos.tsx - trailing slash ì—†ìŒ
// /todosë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ê²½ë¡œì˜ ë ˆì´ì•„ì›ƒ ì—­í• 
export const Route = createFileRoute('/todos')({
  component: TodosLayout,
});

// todos.index.tsx - trailing slash ìˆìŒ
// /todos ê²½ë¡œì˜ ì‹¤ì œ í˜ì´ì§€ (ë ˆì´ì•„ì›ƒ ë‚´ë¶€ì— ë Œë”ë§ë¨)
export const Route = createFileRoute('/todos/')({
  component: TodoList,
});
```

- `createFileRoute('/todos')`: ë ˆì´ì•„ì›ƒ ì—­í• , `/todos/*` ëª¨ë“  í•˜ìœ„ ê²½ë¡œì˜ ë¶€ëª¨
- `createFileRoute('/todos/')`: `/todos` ê²½ë¡œì˜ ì •í™•í•œ index í˜ì´ì§€

**ì™œ ì´ëŸ° êµ¬ë¶„ì´ í•„ìš”í• ê¹Œ?**

TanStack Routerì—ì„œ ë¼ìš°íŠ¸ëŠ” ë‘ ê°€ì§€ ì—­í• ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤:

1. **ë ˆì´ì•„ì›ƒ (Layout)**: í•˜ìœ„ ë¼ìš°íŠ¸ë¥¼ ê°ì‹¸ëŠ” ê³µí†µ UI ì œê³µ (`<Outlet />` í•„ìš”)
2. **í˜ì´ì§€ (Page)**: íŠ¹ì • URLì˜ ì‹¤ì œ ì½˜í…ì¸  ë Œë”ë§

```
/todos          â†’ todos.tsx (ë ˆì´ì•„ì›ƒ) + todos.index.tsx (í˜ì´ì§€)
/todos/1        â†’ todos.tsx (ë ˆì´ì•„ì›ƒ) + todos.$todoId.tsx (í˜ì´ì§€)
/todos/1/edit   â†’ todos.tsx (ë ˆì´ì•„ì›ƒ) + todos.$todoId.edit.tsx (í˜ì´ì§€)
```

**ë””ë ‰í† ë¦¬ êµ¬ì¡°ì—ì„œì˜ ì°¨ì´:**

```
ğŸ“‚ routes/todos
 â”£ ğŸ“œ route.tsx    # createFileRoute('/todos') - ë ˆì´ì•„ì›ƒ + ì„¤ì •
 â”£ ğŸ“œ index.tsx    # createFileRoute('/todos/') - ì‹¤ì œ /todos í˜ì´ì§€
 â”— ğŸ“œ $todoId.tsx  # createFileRoute('/todos/$todoId') - ìƒì„¸ í˜ì´ì§€
```

`route.tsx`ì—ëŠ” ë ˆì´ì•„ì›ƒ, `loader`, `beforeLoad` ë“±ì˜ ì„¤ì •ì„ ë‘ê³ ,
`index.tsx`ì—ëŠ” í•´ë‹¹ ê²½ë¡œì˜ ê¸°ë³¸ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ë¥¼ ë‘”ë‹¤.

ìì£¼ í•˜ëŠ” ì‹¤ìˆ˜ë¥¼ ì‚´í´ë³´ì.

**ì‹¤ìˆ˜ 1: ë ˆì´ì•„ì›ƒì— trailing slash ë¶™ì´ê¸°**

```tsx
// âŒ ì˜ëª»ëœ íŒ¨í„´: ë ˆì´ì•„ì›ƒì¸ë° trailing slash ì‚¬ìš©
createFileRoute('/todos/'); // [!code --]

// âœ… ì˜¬ë°”ë¥¸ íŒ¨í„´
createFileRoute('/todos'); // ë ˆì´ì•„ì›ƒ (Outlet ì‚¬ìš© ê°€ëŠ¥) // [!code ++]
createFileRoute('/todos/'); // index í˜ì´ì§€ // [!code ++]
```

**ì‹¤ìˆ˜ 2: Outlet ì—†ì´ ë ˆì´ì•„ì›ƒ ë§Œë“¤ê¸°**

```tsx
// âŒ Outletì´ ì—†ìœ¼ë©´ í•˜ìœ„ ë¼ìš°íŠ¸ê°€ ë³´ì´ì§€ ì•ŠìŒ
function TodosLayout() {
  return <div>Todos Header</div>; // [!code --]
}

// âœ… ë°˜ë“œì‹œ Outlet ì¶”ê°€
function TodosLayout() {
  return (
    <div>
      <div>Todos Header</div>
      <Outlet /> {/* ì—¬ê¸°ì— í•˜ìœ„ ë¼ìš°íŠ¸ê°€ ë Œë”ë§ë¨ */} // [!code ++]
    </div>
  );
}
```

ê¸°ì–µí•˜ê¸° ì‰¬ìš´ ê·œì¹™ì€ ì´ë ‡ë‹¤:

- **slash ì—†ìŒ** = ë ˆì´ì•„ì›ƒ (í•˜ìœ„ í˜ì´ì§€ë“¤ì˜ ë¶€ëª¨)
- **slash ìˆìŒ** = ê·¸ ê²½ë¡œ ìì²´ì˜ í˜ì´ì§€

### Layout with Outlet

```tsx
import { createFileRoute, Outlet, Link } from '@tanstack/react-router';

export const Route = createFileRoute('/todos')({
  component: TodosLayout,
});

function TodosLayout() {
  return (
    <div>
      <div>
        <h1>í•  ì¼ ê´€ë¦¬</h1>
        <nav>
          <Link to='/todos' activeOptions={{ exact: true }}>
            ì „ì²´ ëª©ë¡
          </Link>
          <Link to='/todos/$todoId' params={{ todoId: 'new' }}>
            ìƒˆ í•  ì¼ ì¶”ê°€
          </Link>
        </nav>
      </div>

      {/* ìì‹ ë¼ìš°íŠ¸ê°€ ì—¬ê¸°ì— ë Œë”ë§ë¨ */}
      <Outlet />
    </div>
  );
}
```

---

## Flat Routes

### Dot Notation

TanStack RouterëŠ” ë‘ ê°€ì§€ íŒŒì¼ êµ¬ì¡°ë¥¼ ì§€ì›í•œë‹¤.

**Flat Routes (ì  í‘œê¸°ë²•)**: íŒŒì¼ëª…ì— `.`ì„ ì‚¬ìš©í•´ ë¼ìš°íŠ¸ì˜ ì¤‘ì²© ë ˆë²¨ì„ í‘œí˜„í•œë‹¤. (ê¹Šê²Œ ì¤‘ì²©ëœ ë¼ìš°íŠ¸ê°€ ë§ì„ ë•Œ, ë””ë ‰í„°ë¦¬ë¥¼ ê³¼ë„í•˜ê²Œ ë§Œë“¤ì§€ ì•Šì•„ì„œ í¸í•˜ë‹¤)

```
ğŸ“¦ routes
 â”£ ğŸ“œ todos.tsx           # /todos ë ˆì´ì•„ì›ƒ
 â”£ ğŸ“œ todos.index.tsx     # /todos
 â”— ğŸ“œ todos.$todoId.tsx   # /todos/:todoId
```

**Directory Routes (í´ë” êµ¬ì¡°)**

```
ğŸ“¦ routes
 â”— ğŸ“‚ todos
   â”£ ğŸ“œ route.tsx         # /todos ë ˆì´ì•„ì›ƒ ë° ì„¤ì •
   â”£ ğŸ“œ index.tsx         # /todos
   â”— ğŸ“œ $todoId.tsx       # /todos/:todoId
```

ë‘ ë°©ì‹ ëª¨ë‘ ë™ì¼í•˜ê²Œ ë™ì‘í•œë‹¤. í”„ë¡œì íŠ¸ ê·œëª¨ì™€ íŒ€ ì„ í˜¸ë„ì— ë”°ë¼ ì„ íƒí•˜ë©´ ëœë‹¤.

ë˜í•œ ê³µì‹ ë¬¸ì„œì—ì„œë„ â€œ100% Flat ë˜ëŠ” 100% Directoryë§Œì´ ë‹µì€ ì•„ë‹ˆë‹¤â€ë¼ëŠ” í†¤ìœ¼ë¡œ, **Flat/Directoryë¥¼ ì„ì–´(Mixed) êµ¬ì„±**í•˜ëŠ” ê²ƒë„ ìì—°ìŠ¤ëŸ¬ìš´ ì„ íƒì§€ë¡œ ì†Œê°œí•œë‹¤.

### index.tsx vs route.tsx

ë‘ íŒŒì¼ ëª¨ë‘ í´ë”ì˜ ê¸°ë³¸ í˜ì´ì§€ë¥¼ ë‚˜íƒ€ë‚´ì§€ë§Œ ë™ì‘ì´ ë‹¤ë¥´ë‹¤.

```
ğŸ“¦ routes/todos
 â”£ ğŸ“œ index.tsx    # /todosì˜ ì‹¤ì œ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
 â”— ğŸ“œ route.tsx    # /todosì˜ ë ˆì´ì•„ì›ƒ ë° ì„¤ì • (loader ë“±)
```

`route.tsx`ëŠ” ë ˆì´ì•„ì›ƒê³¼ ì„¤ì •ì„ ë‹´ë‹¹í•˜ê³ , `index.tsx`ëŠ” í•´ë‹¹ ê²½ë¡œì˜ ê¸°ë³¸ ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹´ë‹¹í•œë‹¤.

---

## Dynamic Path Segments

### Basic Dynamic Segment

`$` ì ‘ë‘ì‚¬ë¡œ ë™ì  íŒŒë¼ë¯¸í„°ë¥¼ ì •ì˜í•œë‹¤.

```tsx
import { createFileRoute } from '@tanstack/react-router';

export const Route = createFileRoute('/todos/$todoId')({
  component: TodoDetail,
  loader: async ({ params }) => {
    const response = await fetch(`/api/todos/${params.todoId}`);
    return response.json();
  },
});

function TodoDetail() {
  const { todoId } = Route.useParams();
  const todo = Route.useLoaderData();

  return (
    <article>
      <h1>{todo.title}</h1>
      <p>í•  ì¼ ID: {todoId}</p>
    </article>
  );
}
```

`Route.useParams()`ë¥¼ ì‚¬ìš©í•˜ë©´ í˜„ì¬ ë¼ìš°íŠ¸ì˜ íŒŒë¼ë¯¸í„°ë¥¼ íƒ€ì… ì•ˆì „í•˜ê²Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.
`todoId`ê°€ string íƒ€ì…ì„ì´ ìë™ìœ¼ë¡œ ì¶”ë¡ ëœë‹¤.

### Multiple Dynamic Segments

```tsx
import { createFileRoute } from '@tanstack/react-router';

export const Route = createFileRoute('/users/$userId/todos/$todoId')({
  component: UserTodo,
});

function UserTodo() {
  const { userId, todoId } = Route.useParams();
  // ë‘˜ ë‹¤ string íƒ€ì…ìœ¼ë¡œ ìë™ ì¶”ë¡ 

  return (
    <div>
      <p>
        ì‚¬ìš©ì {userId}ì˜ í•  ì¼ {todoId}
      </p>
    </div>
  );
}
```

---

## Catch All Routes

### Splat Syntax `{$}`

ë‚˜ë¨¸ì§€ ëª¨ë“  ê²½ë¡œë¥¼ ìºì¹˜í•˜ë ¤ë©´ `{$}` ë˜ëŠ” `$`ë¥¼ ì‚¬ìš©í•œë‹¤.

```tsx
// íŒŒì¼ëª…: file.file-{$fileId}.{$}[.]txt.tsx
import { createFileRoute } from '@tanstack/react-router';

export const Route = createFileRoute('/file/file-{$fileId}/{$}.txt')({
  component: FileViewer,
});

function FileViewer() {
  const { fileId, _splat } = Route.useParams();

  // URL: /file/file-123/a/b/c.txt
  // fileId = "123"
  // _splat = "a/b/c"

  return (
    <div>
      <p>íŒŒì¼ ID: {fileId}</p>
      <p>ê²½ë¡œ: {_splat}</p>
    </div>
  );
}
```

`_splat`ì€ ë‚˜ë¨¸ì§€ ê²½ë¡œ ì „ì²´ë¥¼ í¬í•¨í•˜ëŠ” íŠ¹ë³„í•œ íŒŒë¼ë¯¸í„°ë‹¤.

### Simple Catch All

```tsx
// íŒŒì¼ëª…: files.$.tsx
import { createFileRoute } from '@tanstack/react-router';

export const Route = createFileRoute('/files/$')({
  component: FileViewer,
});

function FileViewer() {
  const { _splat } = Route.useParams();

  // /files/docs/2024/report.pdf â†’ _splat = "docs/2024/report.pdf"

  return <div>íŒŒì¼ ê²½ë¡œ: {_splat}</div>;
}
```

---

## Optional Parameters

### Optional Segment Syntax `{-$param}`

ê²½ë¡œì˜ ì¼ë¶€ë¥¼ ì„ íƒì ìœ¼ë¡œ ë§Œë“¤ë ¤ë©´ `{-$param}` ë¬¸ë²•ì„ ì‚¬ìš©í•œë‹¤.

```tsx
// íŒŒì¼ëª…: {-$locale}/archive.{-$year}.{-$month}.{-$day}.tsx
import { createFileRoute } from '@tanstack/react-router';

export const Route = createFileRoute(
  '/{-$locale}/archive/{-$year}/{-$month}/{-$day}'
)({
  component: ArchivePage,
});

function ArchivePage() {
  const { locale, year, month, day } = Route.useParams();
  // ëª¨ë“  íŒŒë¼ë¯¸í„°ê°€ string | undefined íƒ€ì…

  // ë§¤ì¹­ë˜ëŠ” URLë“¤:
  // /archive              â†’ ëª¨ë‘ undefined
  // /archive/2024         â†’ year="2024"
  // /archive/2024/11      â†’ year="2024", month="11"
  // /archive/2024/11/15   â†’ year="2024", month="11", day="15"
  // /ko/archive/2024/11   â†’ locale="ko", year="2024", month="11"

  return (
    <div>
      <p>ì–¸ì–´: {locale ?? 'ê¸°ë³¸'}</p>
      <p>
        ë‚ ì§œ: {year ?? '*'}/{month ?? '*'}/{day ?? '*'}
      </p>
    </div>
  );
}
```

### Optional Locale Pattern

```
ğŸ“¦ routes
 â”£ ğŸ“‚ ($lang)
 â”ƒ â”£ ğŸ“œ about.tsx
 â”ƒ â”— ğŸ“œ contact.tsx
```

```tsx
import { createFileRoute } from '@tanstack/react-router';

export const Route = createFileRoute('/($lang)/about')({
  component: About,
});

function About() {
  const { lang } = Route.useParams();
  // lang: string | undefined

  const content = lang === 'ko' ? 'íšŒì‚¬ ì†Œê°œ' : 'About Us';

  return <h1>{content}</h1>;
}
```

`/about`ê³¼ `/ko/about` ëª¨ë‘ ì´ ë¼ìš°íŠ¸ì™€ ë§¤ì¹­ëœë‹¤.

---

## Non-Route Folders

ë¼ìš°íŠ¸ í´ë” ë‚´ì—ì„œ ì»´í¬ë„ŒíŠ¸ë‚˜ ìœ í‹¸ë¦¬í‹°ë¥¼ ì •ë¦¬í•˜ë˜ ë¼ìš°íŠ¸ë¡œ ì¸ì‹ë˜ì§€ ì•Šê²Œ í•˜ë ¤ë©´ ë‘ ê°€ì§€ ë°©ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

### Dash Prefix `-`

```
ğŸ“¦ routes
 â”£ ğŸ“‚ -components        # ë¼ìš°íŠ¸ë¡œ ì¸ì‹ë˜ì§€ ì•ŠìŒ
 â”ƒ â”£ ğŸ“œ TodoItem.tsx
 â”ƒ â”£ ğŸ“œ TodoFilter.tsx
 â”ƒ â”— ğŸ“œ Post.tsx
 â”£ ğŸ“‚ -hooks             # ë¼ìš°íŠ¸ë¡œ ì¸ì‹ë˜ì§€ ì•ŠìŒ
 â”ƒ â”— ğŸ“œ useTodos.tsx
 â”£ ğŸ“œ index.tsx
 â”— ğŸ“œ todos.tsx
```

### Parentheses `()`

```
ğŸ“¦ routes
 â”£ ğŸ“‚ (components)       # ë¼ìš°íŠ¸ë¡œ ì¸ì‹ë˜ì§€ ì•ŠìŒ
 â”ƒ â”£ ğŸ“œ Header.tsx
 â”ƒ â”— ğŸ“œ Footer.tsx
 â”£ ğŸ“‚ (utils)            # ë¼ìš°íŠ¸ë¡œ ì¸ì‹ë˜ì§€ ì•ŠìŒ
 â”ƒ â”— ğŸ“œ formatDate.ts
 â”£ ğŸ“œ index.tsx
 â”— ğŸ“œ todos.tsx
```

ë‘ ë°©ë²• ëª¨ë‘ ë™ì¼í•˜ê²Œ ì‘ë™í•œë‹¤. íŒ€ ì»¨ë²¤ì…˜ì— ë”°ë¼ ì„ íƒí•˜ì.

---

## Search Parameters

TanStack Routerì˜ ê°€ì¥ ê°•ë ¥í•œ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ë‹¤.
ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì„ íƒ€ì… ì•ˆì „í•˜ê²Œ ë‹¤ë£° ìˆ˜ ìˆë‹¤.

### zodValidator with fallback()

```tsx
import { createFileRoute, Link } from '@tanstack/react-router';
import { fallback, zodValidator } from '@tanstack/zod-adapter';
import { z } from 'zod';

// fallback(): .catch()ì˜ unknown íƒ€ì… ë¬¸ì œë¥¼ í•´ê²°
const todoSearchSchema = z.object({
  page: fallback(z.number(), 1).default(1),
  limit: fallback(z.number(), 10).default(10),
  status: fallback(z.enum(['all', 'completed', 'pending']), 'all').default(
    'all'
  ),
  sort: fallback(z.enum(['date', 'title', 'priority']), 'date').default('date'),
  // ë³µì¡í•œ ìŠ¤í‚¤ë§ˆë„ ê°€ëŠ¥
  tags: fallback(z.array(z.string()), []).default([]),
});

type TodoSearch = z.infer<typeof todoSearchSchema>;

export const Route = createFileRoute('/todos/')({
  validateSearch: zodValidator(todoSearchSchema),
  component: TodoList,
});

function TodoList() {
  const { page, limit, status, sort, tags } = Route.useSearch();
  // ëª¨ë“  ê°’ì´ ì •í™•í•œ íƒ€ì…ìœ¼ë¡œ ì¶”ë¡ ë¨

  return (
    <div>
      <div>
        <Link to='/todos' search={(prev) => ({ ...prev, status: 'completed' })}>
          ì™„ë£Œë¨
        </Link>
        <Link to='/todos' search={(prev) => ({ ...prev, status: 'pending' })}>
          ì§„í–‰ì¤‘
        </Link>
      </div>

      <p>
        í˜„ì¬ ì„¤ì •: í˜ì´ì§€ {page}, {limit}ê°œì”©, ìƒíƒœ: {status}, ì •ë ¬: {sort}
      </p>
    </div>
  );
}
```

`fallback()` í—¬í¼ì˜ ì¥ì :

- ê¸°ì¡´ Zodì˜ `.catch()`ëŠ” `unknown` íƒ€ì…ì„ ë°˜í™˜í•˜ëŠ” ë¬¸ì œê°€ ìˆì—ˆìŒ
- `fallback()`ì€ ì˜¬ë°”ë¥¸ íƒ€ì…ì„ ìœ ì§€í•˜ë©´ì„œ ê¸°ë³¸ê°’ ì²˜ë¦¬

### Complex Nested Schemas

```tsx
import { fallback, zodValidator } from '@tanstack/zod-adapter';
import { z } from 'zod';

const todoFilterSchema = z.object({
  tags: fallback(z.array(z.string()), []).default([]),
  priority: z.enum(['low', 'medium', 'high']).optional(),
  dateRange: z
    .object({
      start: z.string().optional(),
      end: z.string().optional(),
    })
    .default({}),
  page: fallback(z.number(), 1).default(1),
});

export const Route = createFileRoute('/todos')({
  validateSearch: zodValidator(todoFilterSchema),
  component: Todos,
});

function Todos() {
  const { tags, priority, dateRange, page } = Route.useSearch();

  return (
    <div>
      <p>ì„ íƒëœ íƒœê·¸: {tags.join(', ') || 'ì—†ìŒ'}</p>
      <p>ìš°ì„ ìˆœìœ„: {priority ?? 'ì „ì²´'}</p>
      <p>
        ê¸°ê°„: {dateRange.start ?? 'ì‹œì‘ì¼ ì—†ìŒ'} ~{' '}
        {dateRange.end ?? 'ì¢…ë£Œì¼ ì—†ìŒ'}
      </p>
    </div>
  );
}
```

ë°°ì—´ê³¼ ì¤‘ì²© ê°ì²´ë„ íƒ€ì… ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ëœë‹¤.

### Search Middlewaresë¡œ URL ìµœì í™”

ì°¸ê³ ë¡œ, ì´ ì„¹ì…˜ì€ Search Parametersì˜ ì‹¬í™” ë‚´ìš©ì´ë‹¤. ê¸°ë³¸ì ì¸ Search Parameters ì‚¬ìš©ë²•ì„ ìµíŒ í›„, URLì„ ë” ê¹”ë”í•˜ê²Œ ë§Œë“¤ê³  ì‹¶ì„ ë•Œ ì°¸ê³ í•˜ë©´ ëœë‹¤. ì²˜ìŒ ë°°ìš¸ ë•ŒëŠ” ê±´ë„ˆë›°ì–´ë„ ê´œì°®ë‹¤.

`search.middlewares`ë¥¼ ì‚¬ìš©í•˜ë©´ URLì— í‘œì‹œë˜ëŠ” ê²€ìƒ‰ íŒŒë¼ë¯¸í„°ë¥¼ ë³€í™˜í•  ìˆ˜ ìˆë‹¤.
ê°€ì¥ í”í•œ ì‚¬ìš© ì‚¬ë¡€ëŠ” **ê¸°ë³¸ê°’ì„ URLì—ì„œ ì œê±°**í•˜ì—¬ ê¹”ë”í•œ URLì„ ìœ ì§€í•˜ëŠ” ê²ƒì´ë‹¤.

```tsx
import { createFileRoute } from '@tanstack/react-router';
import { zodValidator } from '@tanstack/zod-adapter';
import { z } from 'zod';
import { stripSearchParams } from '@tanstack/react-router';

const todoSearchSchema = z.object({
  page: z.number().default(1),
  limit: z.number().default(10),
  status: z.enum(['all', 'completed', 'pending']).default('all'),
});

// ê¸°ë³¸ê°’ ì •ì˜
const defaultValues = {
  page: 1,
  limit: 10,
  status: 'all' as const,
};

export const Route = createFileRoute('/todos/')({
  validateSearch: zodValidator(todoSearchSchema),
  search: {
    // ê¸°ë³¸ê°’ê³¼ ë™ì¼í•œ íŒŒë¼ë¯¸í„°ëŠ” URLì—ì„œ ì œê±°
    middlewares: [stripSearchParams(defaultValues)],
  },
  component: TodoList,
});

// URL ë³€í™” ì˜ˆì‹œ:
// /todos?page=1&limit=10&status=all  â†’  /todos (ê¸°ë³¸ê°’ì´ë¯€ë¡œ ì œê±°)
// /todos?page=2&limit=10&status=all  â†’  /todos?page=2 (pageë§Œ í‘œì‹œ)
// /todos?page=1&limit=20&status=completed  â†’  /todos?limit=20&status=completed
```

**ì™œ í•„ìš”í• ê¹Œ?**

```
âŒ ê¸°ë³¸ê°’ í¬í•¨ URL:
/todos?page=1&limit=10&status=all&sort=date

âœ… ê¸°ë³¸ê°’ ì œê±° URL:
/todos

ì‚¬ìš©ìê°€ ê³µìœ í•˜ê¸° ì‰½ê³ , ë¶ë§ˆí¬í•˜ê¸°ë„ ê¹”ë”í•˜ë‹¤.
```

### ì»¤ìŠ¤í…€ Middleware ì‘ì„±

ë” ë³µì¡í•œ ë³€í™˜ì´ í•„ìš”í•˜ë©´ ì»¤ìŠ¤í…€ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤:

```tsx
import { createFileRoute } from '@tanstack/react-router';

export const Route = createFileRoute('/products/')({
  validateSearch: zodValidator(productSearchSchema),
  search: {
    middlewares: [
      // ì»¤ìŠ¤í…€ ë¯¸ë“¤ì›¨ì–´: ë¹ˆ ë°°ì—´ ì œê±°
      ({ search, next }) => {
        const cleaned = { ...search };

        // colorsê°€ ë¹ˆ ë°°ì—´ì´ë©´ ì œê±°
        if (Array.isArray(cleaned.colors) && cleaned.colors.length === 0) {
          delete cleaned.colors;
        }

        // tagsê°€ ë¹ˆ ë°°ì—´ì´ë©´ ì œê±°
        if (Array.isArray(cleaned.tags) && cleaned.tags.length === 0) {
          delete cleaned.tags;
        }

        return next(cleaned);
      },
    ],
  },
});

// URL ë³€í™”:
// ?colors=[]&tags=[]  â†’  (íŒŒë¼ë¯¸í„° ì œê±°)
// ?colors=["red"]&tags=[]  â†’  ?colors=["red"]
```

### Middleware ì²´ì´ë‹

ì—¬ëŸ¬ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì¡°í•©í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤:

```tsx
search: {
  middlewares: [
    // 1. ê¸°ë³¸ê°’ ì œê±°
    stripSearchParams(defaultValues),
    // 2. ë¹ˆ ë°°ì—´ ì œê±°
    ({ search, next }) => {
      // ...ë¹ˆ ë°°ì—´ ì²˜ë¦¬
      return next(cleaned);
    },
    // 3. ë¡œê¹… (ë””ë²„ê·¸ìš©)
    ({ search, next }) => {
      console.log('Final search params:', search);
      return next(search);
    },
  ],
}
```

**ì‹¤í–‰ ìˆœì„œ ë‹¤ì´ì–´ê·¸ë¨:**

```
ì‚¬ìš©ì ì…ë ¥ â†’ [Middleware 1] â†’ [Middleware 2] â†’ [Middleware 3] â†’ URL ë°˜ì˜
              (ê¸°ë³¸ê°’ ì œê±°)    (ë¹ˆ ë°°ì—´ ì œê±°)    (ë¡œê¹…)
```

---

## Loader Function

### Basic Loader

ë¼ìš°íŠ¸ê°€ í™œì„±í™”ë˜ê¸° ì „ì— ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ë¡œë“œí•œë‹¤.

```tsx
import { createFileRoute } from '@tanstack/react-router';

async function fetchTodo(todoId: string) {
  const response = await fetch(`/api/todos/${todoId}`);
  if (!response.ok) {
    throw new Error('í•  ì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
  }
  return response.json();
}

export const Route = createFileRoute('/todos/$todoId')({
  loader: async ({ params }) => {
    const todo = await fetchTodo(params.todoId);
    return { todo };
  },
  component: TodoDetail,
});

function TodoDetail() {
  const { todo } = Route.useLoaderData();

  return (
    <article>
      <h1>{todo.title}</h1>
      <div>{todo.description}</div>
    </article>
  );
}
```

### Loader ë§¤ê°œë³€ìˆ˜ ìƒì„¸

loader í•¨ìˆ˜ëŠ” ë‹¤ì–‘í•œ ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ëŠ”ë‹¤:

```tsx
export const Route = createFileRoute('/todos/$todoId')({
  loader: async ({
    params, // URL íŒŒë¼ë¯¸í„° ({ todoId: string })
    context, // RouterProviderì—ì„œ ì „ë‹¬í•œ context
    deps, // loaderDepsì—ì„œ ë°˜í™˜í•œ ê°’
    abortController, // ìš”ì²­ ì·¨ì†Œìš© AbortController
    preload, // í”„ë¦¬ë¡œë“œ ì—¬ë¶€ (boolean)
    cause, // 'enter' | 'stay' | 'preload'
  }) => {
    // paramsëŠ” íƒ€ì… ì•ˆì „í•˜ê²Œ ì¶”ë¡ ë¨
    console.log(params.todoId); // string

    // contextì—ì„œ ì¸ì¦ ì •ë³´ ì ‘ê·¼
    if (context.user) {
      console.log(context.user.id);
    }

    // ìš”ì²­ ì·¨ì†Œ ì§€ì›
    const response = await fetch(`/api/todos/${params.todoId}`, {
      signal: abortController.signal,
    });

    return response.json();
  },
});
```

**cause ê°’ì˜ ì˜ë¯¸:**

- `'enter'`: ì²˜ìŒ ë¼ìš°íŠ¸ì— ì§„ì…
- `'stay'`: ê°™ì€ ë¼ìš°íŠ¸ì—ì„œ íŒŒë¼ë¯¸í„°ë§Œ ë³€ê²½
- `'preload'`: í”„ë¦¬ë¡œë“œ ì¤‘

### loaderDeps: Search Params in Loader

Search paramsë¥¼ loaderì—ì„œ ì‚¬ìš©í•˜ë ¤ë©´ `loaderDeps`ë¥¼ ë°˜ë“œì‹œ ì •ì˜í•´ì•¼ í•œë‹¤.
`loaderDeps`ëŠ” search params ê°’ì— ë”°ë¼ **ë³„ë„ì˜ ìºì‹œ**ë¥¼ ìƒì„±í•œë‹¤.

```tsx
import { createFileRoute } from '@tanstack/react-router';
import { zodValidator } from '@tanstack/zod-adapter';
import { z } from 'zod';

const searchSchema = z.object({
  lang: z.enum(['en', 'es', 'fr', 'zh', 'kr']).catch('en'),
});

export const Route = createFileRoute('/_authenticated/random-word')({
  validateSearch: zodValidator(searchSchema),

  // loaderDeps: search paramsë¥¼ loaderì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•¨
  // lang ê°’ë³„ë¡œ ë³„ë„ ìºì‹œê°€ ìƒì„±ë¨ (en, fr, kr ê°ê° ë‹¤ë¥¸ ìºì‹œ)
  loaderDeps: ({ search }) => ({ lang: search.lang }),

  loader: async ({ deps }) => {
    // deps.langìœ¼ë¡œ search param ì ‘ê·¼
    const res = await fetch(
      `https://random-words-api.example.com/api?lang=${deps.lang}`
    );
    const resJson = await res.json();
    return { word: resJson[0]?.word };
  },

  component: RandomWord,
});

function RandomWord() {
  const { word } = Route.useLoaderData();
  const { lang } = Route.useSearch();

  return (
    <div>
      <p>ì–¸ì–´: {lang}</p>
      <h2>{word}</h2>
    </div>
  );
}
```

**í•µì‹¬ í¬ì¸íŠ¸:**

- `loaderDeps`ì— ëª…ì‹œëœ ê°’ì´ ë³€ê²½ë  ë•Œë§Œ `loader`ê°€ ë‹¤ì‹œ ì‹¤í–‰ë¨
- ê° `deps` ê°’ ì¡°í•©ë³„ë¡œ ë³„ë„ì˜ ìºì‹œê°€ ìƒì„±ë¨
- ë¶ˆí•„ìš”í•œ ë¦¬í˜ì¹˜ë¥¼ ë°©ì§€í•˜ê³  ì„±ëŠ¥ì„ ìµœì í™”

---

## Pagination

### Search Params for Pagination

```tsx
import { createFileRoute, Link } from '@tanstack/react-router';
import { fallback, zodValidator } from '@tanstack/zod-adapter';
import { z } from 'zod';

const paginationSchema = z.object({
  page: fallback(z.number(), 1).default(1),
  pageSize: fallback(z.number(), 10).default(10),
});

export const Route = createFileRoute('/todos/')({
  validateSearch: zodValidator(paginationSchema),
  loaderDeps: ({ search }) => ({
    page: search.page,
    pageSize: search.pageSize,
  }),
  loader: async ({ deps }) => {
    const response = await fetch(
      `/api/todos?page=${deps.page}&pageSize=${deps.pageSize}`
    );
    return response.json();
  },
  component: TodoList,
});

function TodoList() {
  const { page, pageSize } = Route.useSearch();
  const { todos, totalPages } = Route.useLoaderData();

  return (
    <div>
      <ul>
        {todos.map((todo) => (
          <li key={todo.id}>{todo.title}</li>
        ))}
      </ul>

      <div>
        <Link
          to='/todos'
          search={(prev) => ({ ...prev, page: Math.max(1, prev.page - 1) })}
          disabled={page === 1}
        >
          ì´ì „
        </Link>
        <span>
          {page} / {totalPages}
        </span>
        <Link
          to='/todos'
          search={(prev) => ({ ...prev, page: prev.page + 1 })}
          disabled={page >= totalPages}
        >
          ë‹¤ìŒ
        </Link>
      </div>
    </div>
  );
}
```

---

## Loading Data in Parallel

### Deferred Loading Pattern

ê¸´ ë¡œë”© ì‹œê°„ì´ í•„ìš”í•œ ë°ì´í„°ëŠ” ì§€ì—° ë¡œë”©í•  ìˆ˜ ìˆë‹¤.

**ì¤‘ìš”:** Promise ë³€ìˆ˜ëª…ì€ ëª…í™•í•˜ê²Œ `~Promise`ë¡œ ëë‚´ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.

```tsx
import { createFileRoute, Await } from '@tanstack/react-router';
import { Suspense } from 'react';

export const Route = createFileRoute('/posts/$postId')({
  loader: async ({ params }) => {
    // í•µì‹¬: await ì—†ëŠ” PromiseëŠ” awaitê°€ ìˆëŠ” ê²ƒë³´ë‹¤ ë¨¼ì € ì„ ì–¸í•´ì•¼ í•¨
    // ë³‘ë ¬ ë¡œë”©ì„ ìœ„í•´ ìˆœì„œê°€ ì¤‘ìš”!
    const commentsPromise = fetchComments(params.postId); // await ì—†ìŒ // [!code highlight]
    const reactionsPromise = fetchReactions(params.postId); // await ì—†ìŒ // [!code highlight]

    // í•„ìˆ˜ ë°ì´í„°ëŠ” await
    const post = await fetchPost(params.postId); // [!code highlight]

    return {
      post,
      commentsPromise, // Promise ìì²´ë¥¼ ë°˜í™˜
      reactionsPromise,
    };
  },
  component: PostDetail,
});

function PostDetail() {
  const { post, commentsPromise, reactionsPromise } = Route.useLoaderData();

  return (
    <article>
      {/* í•„ìˆ˜ ë°ì´í„°ëŠ” ì¦‰ì‹œ í‘œì‹œ */}
      <h1>{post.title}</h1>
      <div>{post.content}</div>

      {/* ì§€ì—° ë¡œë”© ë°ì´í„° */}
      <section>
        <h2>ëŒ“ê¸€</h2>
        <Suspense fallback={<div>ëŒ“ê¸€ ë¡œë”©ì¤‘...</div>}>
          <Await promise={commentsPromise}>
            {(comments) => (
              <ul>
                {comments.map((c) => (
                  <li key={c.id}>{c.text}</li>
                ))}
              </ul>
            )}
          </Await>
        </Suspense>
      </section>

      <section>
        <h2>ë°˜ì‘</h2>
        <Suspense fallback={<div>ë°˜ì‘ ë¡œë”©ì¤‘...</div>}>
          <Await promise={reactionsPromise}>
            {(reactions) => <ReactionList reactions={reactions} />}
          </Await>
        </Suspense>
      </section>
    </article>
  );
}
```

**í•µì‹¬ ê·œì¹™:**

1. Promise ë³€ìˆ˜ëª…ì€ `~Promise`ë¡œ ëë‚´ê¸° (ëª…í™•ì„±)
2. await ì—†ëŠ” Promise ì„ ì–¸ì„ await ìˆëŠ” ê²ƒë³´ë‹¤ **ë¨¼ì €** ì‘ì„± (ë³‘ë ¬ ì‹¤í–‰ ë³´ì¥)
3. `Await` ì»´í¬ë„ŒíŠ¸ëŠ” `Suspense`ë¡œ ê°ì‹¸ê¸°

### Deferred Loadingì—ì„œì˜ ì—ëŸ¬ ì²˜ë¦¬

ì§€ì—° ë¡œë”©ëœ Promiseê°€ ì‹¤íŒ¨í•  ìˆ˜ ìˆë‹¤. `CatchBoundary`ë¡œ ì—ëŸ¬ë¥¼ ê²©ë¦¬í•˜ì.

```tsx
function PostDetail() {
  const { post, commentsPromise, reactionsPromise } = Route.useLoaderData();

  return (
    <article>
      <h1>{post.title}</h1>
      <div>{post.content}</div>

      {/* ëŒ“ê¸€ ë¡œë”© ì‹¤íŒ¨í•´ë„ ê²Œì‹œê¸€ì€ í‘œì‹œë¨ */}
      <CatchBoundary
        errorComponent={({ error, reset }) => (
          <div>
            <p>ëŒ“ê¸€ ë¡œë”© ì‹¤íŒ¨</p>
            <button onClick={reset}>ì¬ì‹œë„</button>
          </div>
        )}
        getResetKey={() => 'comments'}
      >
        <Suspense fallback={<CommentsSkeleton />}>
          <Await promise={commentsPromise}>
            {(comments) => <CommentList comments={comments} />}
          </Await>
        </Suspense>
      </CatchBoundary>

      {/* ë°˜ì‘ ë¡œë”© ì‹¤íŒ¨í•´ë„ ë‹¤ë¥¸ ì„¹ì…˜ì— ì˜í–¥ ì—†ìŒ */}
      <CatchBoundary
        errorComponent={() => <div>ë°˜ì‘ì„ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>}
        getResetKey={() => 'reactions'}
      >
        <Suspense fallback={<ReactionsSkeleton />}>
          <Await promise={reactionsPromise}>
            {(reactions) => <ReactionList reactions={reactions} />}
          </Await>
        </Suspense>
      </CatchBoundary>
    </article>
  );
}
```

**ì—ëŸ¬ ê²©ë¦¬ì˜ ì¥ì :**

```
ê²Œì‹œê¸€ ë³¸ë¬¸ â† ë°˜ë“œì‹œ í‘œì‹œ (awaitë¡œ ë¡œë“œ)
     â”‚
     â”œâ”€â”€ ëŒ“ê¸€ ì„¹ì…˜ â† ì‹¤íŒ¨í•´ë„ OK (CatchBoundaryë¡œ ê²©ë¦¬)
     â”‚
     â””â”€â”€ ë°˜ì‘ ì„¹ì…˜ â† ì‹¤íŒ¨í•´ë„ OK (CatchBoundaryë¡œ ê²©ë¦¬)
```

ê° ì„¹ì…˜ì´ ë…ë¦½ì ìœ¼ë¡œ ì‹¤íŒ¨í•˜ê³  ë³µêµ¬í•  ìˆ˜ ìˆì–´ ì‚¬ìš©ì ê²½í—˜ì´ í–¥ìƒëœë‹¤.

---

## Pending State, Error Handling, Not Found, Catch Boundary

### pendingComponent

ë°ì´í„° ë¡œë”© ì¤‘ì— í‘œì‹œí•  ì»´í¬ë„ŒíŠ¸ë‹¤. ìŠ¤ì¼ˆë ˆí†¤ UIë‚˜ ë¡œë”© ì¸ë””ì¼€ì´í„°ë¥¼ í‘œì‹œí•  ë•Œ ì‚¬ìš©í•œë‹¤.

```tsx
export const Route = createFileRoute('/todos/$todoId')({
  loader: async ({ params }) => {
    return fetchTodo(params.todoId);
  },

  pendingComponent: () => {
    return (
      <div>
        <div>ì œëª© ë¡œë”©ì¤‘...</div>
        <div>ë‚´ìš© ë¡œë”©ì¤‘...</div>
      </div>
    );
  },

  // ì´ ì‹œê°„(200ms) ì´í›„ì— pendingComponent í‘œì‹œ
  pendingMs: 200,
  // ìµœì†Œ ì´ ì‹œê°„(500ms) ë™ì•ˆ í‘œì‹œ (ê¹œë¹¡ì„ ë°©ì§€)
  pendingMinMs: 500,

  component: TodoDetail,
});
```

### pendingMsì™€ pendingMinMs ìƒì„¸ ì„¤ëª…

**pendingMs: ë¡œë”© í‘œì‹œ ì§€ì—° ì‹œê°„**

```tsx
pendingMs: 200, // 200ms í›„ì— pendingComponent í‘œì‹œ
```

ë¡œë”©ì´ 200ms ì´ë‚´ì— ì™„ë£Œë˜ë©´ `pendingComponent`ê°€ ì•„ì˜ˆ í‘œì‹œë˜ì§€ ì•ŠëŠ”ë‹¤.
ë¹ ë¥¸ ë„¤íŠ¸ì›Œí¬ì—ì„œ ë¶ˆí•„ìš”í•œ ê¹œë¹¡ì„ì„ ë°©ì§€í•œë‹¤.

**pendingMinMs: ìµœì†Œ í‘œì‹œ ì‹œê°„**

```tsx
pendingMinMs: 500, // í‘œì‹œë˜ë©´ ìµœì†Œ 500ms ë™ì•ˆ ìœ ì§€
```

`pendingComponent`ê°€ í•œ ë²ˆ í‘œì‹œë˜ë©´ ìµœì†Œ 500ms ë™ì•ˆ ìœ ì§€ëœë‹¤.
ë¡œë”©ì´ 210msì— ì™„ë£Œë˜ì–´ë„ 500msê¹Œì§€ ê¸°ë‹¤ë¦° í›„ ì‹¤ì œ ì»´í¬ë„ŒíŠ¸ë¥¼ í‘œì‹œí•œë‹¤.

**ì™œ ì´ëŸ° ì˜µì…˜ì´ í•„ìš”í• ê¹Œ?**

```
ì‹œë‚˜ë¦¬ì˜¤ 1: ë¹ ë¥¸ ë¡œë”© (50ms)
- pendingMs: 200 ì„¤ì •
- ë¡œë”©ì´ 50msì— ì™„ë£Œ â†’ pendingComponent í‘œì‹œ ì•ˆë¨ âœ…

ì‹œë‚˜ë¦¬ì˜¤ 2: ì¤‘ê°„ ë¡œë”© (250ms)
- pendingMs: 200, pendingMinMs: 500 ì„¤ì •
- 200msì— pendingComponent í‘œì‹œ ì‹œì‘
- 250msì— ë¡œë”© ì™„ë£Œë˜ì§€ë§Œ, 500msê¹Œì§€ pendingComponent ìœ ì§€
- 500msì— ì‹¤ì œ ì»´í¬ë„ŒíŠ¸ í‘œì‹œ âœ…

ì‹œë‚˜ë¦¬ì˜¤ 3: ëŠë¦° ë¡œë”© (2ì´ˆ)
- pendingMs: 200, pendingMinMs: 500 ì„¤ì •
- 200msì— pendingComponent í‘œì‹œ ì‹œì‘
- 2ì´ˆì— ë¡œë”© ì™„ë£Œ â†’ ë°”ë¡œ ì‹¤ì œ ì»´í¬ë„ŒíŠ¸ í‘œì‹œ âœ…
```

ì´ ì¡°í•©ìœ¼ë¡œ **UXë¥¼ í¬ê²Œ ê°œì„ **í•  ìˆ˜ ìˆë‹¤:

- ë¹ ë¥¸ ë¡œë”©: ê¹œë¹¡ì„ ì—†ìŒ
- ì¤‘ê°„ ë¡œë”©: ë¡œë”© í‘œì‹œê°€ ë„ˆë¬´ ì§§ì•„ ì–´ìƒ‰í•˜ì§€ ì•ŠìŒ
- ëŠë¦° ë¡œë”©: ì‚¬ìš©ìì—ê²Œ ë¡œë”© ì¤‘ì„ì„ ëª…í™•íˆ ì•Œë¦¼

### errorComponent

```tsx
export const Route = createFileRoute('/todos/$todoId')({
  loader: async ({ params }) => {
    const response = await fetch(`/api/todos/${params.todoId}`);
    if (response.status === 404) {
      throw new Error('í•  ì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
    }
    return response.json();
  },

  errorComponent: ({ error, reset }) => {
    return (
      <div>
        <h2>ì˜¤ë¥˜ ë°œìƒ</h2>
        <p>{error.message}</p>
        <button onClick={reset}>ë‹¤ì‹œ ì‹œë„</button>
      </div>
    );
  },

  component: TodoDetail,
});
```

### notFoundComponent

```tsx
export const Route = createRootRouteWithContext<RouterContext>()({
  component: RootLayout,

  notFoundComponent: () => {
    return (
      <div>
        <h1>404</h1>
        <p>í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
        <Link to='/'>í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</Link>
      </div>
    );
  },
});
```

### notFoundMode: 'fuzzy' vs 'root'

ë¼ìš°í„° ìƒì„± ì‹œ `notFoundMode` ì˜µì…˜ìœ¼ë¡œ 404 ì²˜ë¦¬ ë°©ì‹ì„ ê²°ì •í•  ìˆ˜ ìˆë‹¤.

```tsx
const router = createRouter({
  routeTree,
  notFoundMode: 'fuzzy', // ê¸°ë³¸ê°’
  // ë˜ëŠ”
  notFoundMode: 'root',
});
```

**'fuzzy' ëª¨ë“œ (ê¸°ë³¸ê°’):**

ê°€ì¥ ê°€ê¹Œìš´ ë¶€ëª¨ ë¼ìš°íŠ¸ì˜ `notFoundComponent`ë¥¼ í‘œì‹œí•œë‹¤.

```
/todos/123/nonexistent ì ‘ê·¼ ì‹œ:
1. todos.$todoId ë¼ìš°íŠ¸ì— notFoundComponentê°€ ìˆìœ¼ë©´ â†’ ê·¸ê²ƒì„ í‘œì‹œ
2. ì—†ìœ¼ë©´ â†’ todos ë¼ìš°íŠ¸ì˜ notFoundComponent í™•ì¸
3. ì—†ìœ¼ë©´ â†’ __rootì˜ notFoundComponent í‘œì‹œ
```

**'root' ëª¨ë“œ:**

í•­ìƒ ë£¨íŠ¸ ë¼ìš°íŠ¸ì˜ `notFoundComponent`ë¥¼ í‘œì‹œí•œë‹¤.

```
/todos/123/nonexistent ì ‘ê·¼ ì‹œ:
â†’ ë¬´ì¡°ê±´ __rootì˜ notFoundComponent í‘œì‹œ
```

**ì–´ë–¤ ìƒí™©ì—ì„œ ì‚¬ìš©í• ê¹Œ?**

- `fuzzy`: ì„¹ì…˜ë³„ë¡œ ë‹¤ë¥¸ 404 í˜ì´ì§€ë¥¼ ë³´ì—¬ì£¼ê³  ì‹¶ì„ ë•Œ (ì˜ˆ: ì‡¼í•‘ëª°ì˜ ìƒí’ˆ 404 vs ë¸”ë¡œê·¸ì˜ ê²Œì‹œê¸€ 404)
- `root`: ì¼ê´€ëœ 404 í˜ì´ì§€ë¥¼ ì „ì²´ ì‚¬ì´íŠ¸ì—ì„œ ì‚¬ìš©í•  ë•Œ

```tsx
// todos.$todoId.tsx - ìƒí’ˆ ì„¹ì…˜ ì „ìš© 404
export const Route = createFileRoute('/todos/$todoId')({
  notFoundComponent: () => (
    <div>
      <h2>í•  ì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h2>
      <Link to='/todos'>ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</Link>
    </div>
  ),
});
```

### CatchBoundary with getRouteApi

ì™¸ë¶€ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë¼ìš°íŠ¸ ë°ì´í„°ì— ì ‘ê·¼í•˜ë ¤ë©´ `getRouteApi()`ë¥¼ ì‚¬ìš©í•œë‹¤.

```tsx
// routes/-components/Post.tsx
import { Await, CatchBoundary, getRouteApi } from '@tanstack/react-router';

export const Post = () => {
  // ì™¸ë¶€ ì»´í¬ë„ŒíŠ¸ì—ì„œ íŠ¹ì • ë¼ìš°íŠ¸ì˜ ë°ì´í„° ì ‘ê·¼
  const routeApi = getRouteApi('/posts/$postId');
  const { post, commentsPromise } = routeApi.useLoaderData();

  return (
    <article>
      <h1>{post.title}</h1>
      <div>{post.content}</div>

      {/* CatchBoundary: íŠ¹ì • ì—ëŸ¬ íƒ€ì…ì„ ê²©ë¦¬ */}
      <CatchBoundary
        errorComponent={({ error, reset }) => (
          <div>
            <p>ëŒ“ê¸€ ë¡œë”© ì‹¤íŒ¨: {error.message}</p>
            <button onClick={reset}>ì¬ì‹œë„</button>
          </div>
        )}
        getResetKey={() => 'comments'} // ë¦¬ì…‹ í‚¤ë¡œ ì—ëŸ¬ ìƒíƒœ ì¶”ì 
      >
        <Await promise={commentsPromise} fallback={<div>ë¡œë”©ì¤‘...</div>}>
          {(comments) => <CommentList comments={comments} />}
        </Await>
      </CatchBoundary>
    </article>
  );
};
```

### getResetKey ìƒì„¸ ì„¤ëª…

`getResetKey`ëŠ” ì—ëŸ¬ ìƒíƒœë¥¼ ì¶”ì í•˜ê³  ìë™ ë¦¬ì…‹ ì‹œì ì„ ê²°ì •í•˜ëŠ” ì¤‘ìš”í•œ í•¨ìˆ˜ë‹¤.

```tsx
<CatchBoundary errorComponent={ErrorDisplay} getResetKey={() => 'comments'}>
  {children}
</CatchBoundary>
```

**getResetKeyê°€ í•˜ëŠ” ì¼:**

1. **ì—ëŸ¬ ìƒíƒœ ì¶”ì **: ë°˜í™˜ëœ í‚¤ ê°’ì´ ë³€ê²½ë˜ë©´ ì—ëŸ¬ ìƒíƒœê°€ ìë™ìœ¼ë¡œ ë¦¬ì…‹ë¨
2. **ìˆ˜ë™ ë¦¬ì…‹ê³¼ ì—°ë™**: `reset()` í˜¸ì¶œ ì‹œ ì´ í‚¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìƒíƒœ ê´€ë¦¬

```tsx
// ë™ì  í‚¤ ì‚¬ìš© ì˜ˆì‹œ
const { postId } = Route.useParams();

<CatchBoundary
  errorComponent={ErrorDisplay}
  getResetKey={() => postId} // postIdê°€ ë³€ê²½ë˜ë©´ ìë™ ë¦¬ì…‹
>
  <Await promise={commentsPromise}>
    {(comments) => <CommentList comments={comments} />}
  </Await>
</CatchBoundary>;
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**

```
/posts/1 â†’ ëŒ“ê¸€ ë¡œë”© ì‹¤íŒ¨ (ì—ëŸ¬ ìƒíƒœ)
          â†“
/posts/2ë¡œ ì´ë™ â†’ getResetKeyê°€ '1' â†’ '2'ë¡œ ë³€ê²½
          â†“
ì—ëŸ¬ ìƒíƒœ ìë™ ë¦¬ì…‹ â†’ ìƒˆ ëŒ“ê¸€ ë¡œë”© ì‹œë„
```

ì´ íŒ¨í„´ì„ ì‚¬ìš©í•˜ë©´ ì‚¬ìš©ìê°€ ë‹¤ë¥¸ ê²Œì‹œê¸€ë¡œ ì´ë™í–ˆì„ ë•Œ ì´ì „ ì—ëŸ¬ ìƒíƒœê°€ ìë™ìœ¼ë¡œ ì •ë¦¬ëœë‹¤.

### reset() vs router.invalidate()

ë‘ í•¨ìˆ˜ì˜ ì°¨ì´ë¥¼ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤:

```tsx
import { useRouter } from '@tanstack/react-router';

function ErrorDisplay({ error, reset }) {
  const router = useRouter();

  return (
    <div>
      <p>ì—ëŸ¬: {error.message}</p>
      {/* reset(): ì»´í¬ë„ŒíŠ¸ë§Œ ë¦¬ë Œë”ë§ (ë°ì´í„° ì¬ìš”ì²­ ì•ˆí•¨) */}
      <button onClick={() => reset()}>í™”ë©´ ìƒˆë¡œê³ ì¹¨ (ë°ì´í„° ìœ ì§€)</button> //
      [!code highlight]
      {/* router.invalidate(): loader ë‹¤ì‹œ ì‹¤í–‰ (ë°ì´í„° ì¬ìš”ì²­) */}
      <button onClick={() => router.invalidate()}>
        ë°ì´í„° ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
      </button>{' '}
      // [!code highlight]
    </div>
  );
}
```

- `reset()`: ì—ëŸ¬ ìƒíƒœë§Œ ì´ˆê¸°í™”í•˜ê³  ì»´í¬ë„ŒíŠ¸ ë¦¬ë Œë”ë§. **loaderëŠ” ë‹¤ì‹œ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ**
- `router.invalidate()`: ëª¨ë“  ë¼ìš°íŠ¸ì˜ ìºì‹œ ë¬´íš¨í™”, **loader ë‹¤ì‹œ ì‹¤í–‰**

**ì–´ë–¤ ìƒí™©ì—ì„œ ì‚¬ìš©í• ê¹Œ?**

- UI ì—ëŸ¬ (ë Œë”ë§ ì—ëŸ¬): `reset()` ì‚¬ìš©
- ë°ì´í„° ì—ëŸ¬ (API ì‹¤íŒ¨): `router.invalidate()` ì‚¬ìš©

---

## Code Splitting

### autoCodeSplitting

Vite í”ŒëŸ¬ê·¸ì¸ì—ì„œ `autoCodeSplitting: true`ë¥¼ í™œì„±í™”í•˜ë©´ ìë™ìœ¼ë¡œ ì ìš©ëœë‹¤.
ê° ë¼ìš°íŠ¸ê°€ ìë™ìœ¼ë¡œ ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…ë˜ì–´ ì´ˆê¸° ë²ˆë“¤ í¬ê¸°ë¥¼ ì¤„ì´ê³  í•„ìš”í•œ ì½”ë“œë§Œ ë¡œë“œí•œë‹¤.

```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { TanStackRouterVite } from '@tanstack/router-plugin/vite';

export default defineConfig({
  plugins: [
    TanStackRouterVite({
      autoCodeSplitting: true, // ìë™ ì½”ë“œ ìŠ¤í”Œë¦¬íŒ… í™œì„±í™”
    }),
    react(),
  ],
});
```

### ë¬´ì—‡ì´ ë¶„ë¦¬ë˜ê³  ë¬´ì—‡ì´ ë‚¨ì„ê¹Œ?

`autoCodeSplitting`ì„ í™œì„±í™”í•˜ë©´:

**Critical Path (ë©”ì¸ ë²ˆë“¤ì— í¬í•¨):**

- `beforeLoad`: ë¼ìš°íŠ¸ ì§„ì… ì „ ì‹¤í–‰ë˜ì–´ì•¼ í•˜ë¯€ë¡œ ë¶„ë¦¬ ë¶ˆê°€
- `loader`: ë°ì´í„° í˜ì¹­ì— í•„ìš”í•˜ë¯€ë¡œ ë¶„ë¦¬ ë¶ˆê°€
- `validateSearch`: ê²€ìƒ‰ íŒŒë¼ë¯¸í„° ê²€ì¦ì— í•„ìš”
- `loaderDeps`: loader ì˜ì¡´ì„± ê³„ì‚°ì— í•„ìš”

**Lazy Loaded (ë³„ë„ ì²­í¬):**

- `component`: í™”ë©´ì— ê·¸ë ¤ì§€ëŠ” UI
- `pendingComponent`: ë¡œë”© UI
- `errorComponent`: ì—ëŸ¬ UI

```
/todos/$todoId ì ‘ê·¼ ì‹œ:
1. Critical Path ì½”ë“œ (ì´ë¯¸ ë¡œë“œë¨)
   â”œâ”€â”€ beforeLoad ì‹¤í–‰
   â”œâ”€â”€ loader ì‹¤í–‰
   â””â”€â”€ ë°ì´í„° ë°˜í™˜
2. Lazy ì½”ë“œ ë¡œë“œ (ì´ ì‹œì ì— ë‹¤ìš´ë¡œë“œ)
   â””â”€â”€ component ë Œë”ë§
```

### Manual Code Splitting with .lazy.tsx

ìˆ˜ë™ìœ¼ë¡œ ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…í•˜ë ¤ë©´ `.lazy.tsx` íŒŒì¼ì„ ì‚¬ìš©í•œë‹¤.

```tsx
// todos.$todoId.tsx - loaderì™€ ì„¤ì •ë§Œ (Critical Path)
export const Route = createFileRoute('/todos/$todoId')({
  beforeLoad: ({ context }) => {
    // ì¸ì¦ ì²´í¬ ë“± - í•­ìƒ ë¡œë“œë¨
  },
  loader: async ({ params }) => fetchTodo(params.todoId),
  // componentëŠ” ì—¬ê¸° ì •ì˜í•˜ì§€ ì•ŠìŒ!
});
```

```tsx
// todos.$todoId.lazy.tsx - ì»´í¬ë„ŒíŠ¸ë§Œ (Lazy Loaded)
import { createLazyFileRoute } from '@tanstack/react-router';

export const Route = createLazyFileRoute('/todos/$todoId')({
  component: TodoDetail,
  pendingComponent: () => <div>ë¡œë”©...</div>,
  errorComponent: ({ error }) => <div>ì—ëŸ¬: {error.message}</div>,
});

function TodoDetail() {
  const todo = Route.useLoaderData();
  return <article>{/* ... */}</article>;
}
```

**ì™œ ì´ë ‡ê²Œ ë¶„ë¦¬í• ê¹Œ?**

```
ë²ˆë“¤ í¬ê¸° ì˜ˆì‹œ:
- todos.$todoId.tsx: 2KB (beforeLoad, loader ë¡œì§)
- todos.$todoId.lazy.tsx: 50KB (React ì»´í¬ë„ŒíŠ¸, UI ë¼ì´ë¸ŒëŸ¬ë¦¬ ë“±)

ê²°ê³¼:
- ì´ˆê¸° ë²ˆë“¤: ëª¨ë“  ë¼ìš°íŠ¸ì˜ Critical Path ì½”ë“œë§Œ í¬í•¨
- /todos/123 ì ‘ê·¼ ì‹œ: í•´ë‹¹ lazy íŒŒì¼ë§Œ ë™ì  ë¡œë“œ
```

ì»´í¬ë„ŒíŠ¸ ì½”ë“œëŠ” í•´ë‹¹ ë¼ìš°íŠ¸ì— ì ‘ê·¼í•  ë•Œë§Œ ë¡œë“œëœë‹¤.
ì´ íŒ¨í„´ìœ¼ë¡œ ì´ˆê¸° ë¡œë”© ì†ë„ë¥¼ í¬ê²Œ ê°œì„ í•  ìˆ˜ ìˆë‹¤.

---

## Preloading

ì‚¬ìš©ìê°€ ë§í¬ë¥¼ í´ë¦­í•˜ê¸° ì „ì— ë¯¸ë¦¬ ë°ì´í„°ë¥¼ ë¡œë“œí•œë‹¤.

### Preload Options

```tsx
// ì „ì—­ ì„¤ì •
const router = createRouter({
  routeTree,
  defaultPreload: 'intent', // ê¸°ë³¸ê°’: hover ì‹œ í”„ë¦¬ë¡œë“œ
});
```

```tsx
// Link ì»´í¬ë„ŒíŠ¸ì—ì„œ ê°œë³„ ì„¤ì •
function Navigation() {
  return (
    <nav>
      {/* intent: ë§ˆìš°ìŠ¤ hover ë˜ëŠ” í„°ì¹˜ ì‹œì‘ ì‹œ í”„ë¦¬ë¡œë“œ (ê¶Œì¥) */}
      <Link to='/about' preload='intent'>
        About
      </Link>

      {/* viewport: ë§í¬ê°€ í™”ë©´ì— ë³´ì¼ ë•Œ í”„ë¦¬ë¡œë“œ */}
      <Link to='/todos' preload='viewport'>
        Todos
      </Link>

      {/* render: ë§í¬ê°€ ë Œë”ë§ë˜ë©´ ì¦‰ì‹œ í”„ë¦¬ë¡œë“œ */}
      <Link to='/dashboard' preload='render'>
        Dashboard
      </Link>

      {/* false: í”„ë¦¬ë¡œë“œ ë¹„í™œì„±í™” */}
      <Link to='/heavy-page' preload={false}>
        Heavy Page
      </Link>
    </nav>
  );
}
```

**í”„ë¦¬ë¡œë“œ ì˜µì…˜ ë¹„êµ:**

- `intent`: ì‚¬ìš©ì ì˜ë„ ê°ì§€ (hover/touch), ê°€ì¥ ê· í˜• ì¡íŒ ì˜µì…˜
- `viewport`: ìŠ¤í¬ë¡¤í•˜ë©´ì„œ ë³´ì´ëŠ” ë§í¬ ë¯¸ë¦¬ ë¡œë“œ, ëª©ë¡ í˜ì´ì§€ì— ìœ ìš©
- `render`: í˜ì´ì§€ ë¡œë“œ ì‹œ ì¦‰ì‹œ í”„ë¦¬ë¡œë“œ, í™•ì‹¤íˆ ë°©ë¬¸í•  ë§í¬ì— ì‚¬ìš©

### preloadDelay: í”„ë¦¬ë¡œë“œ ì§€ì—°

`intent` ì˜µì…˜ ì‚¬ìš© ì‹œ ì¦‰ê°ì ì¸ í”„ë¦¬ë¡œë“œê°€ ë¶€ë‹´ìŠ¤ëŸ¬ìš¸ ìˆ˜ ìˆë‹¤.

```tsx
// ì „ì—­ ì„¤ì •
const router = createRouter({
  routeTree,
  defaultPreload: 'intent',
  defaultPreloadDelay: 50, // 50ms í›„ì— í”„ë¦¬ë¡œë“œ ì‹œì‘
});
```

```tsx
// Link ì»´í¬ë„ŒíŠ¸ì—ì„œ ê°œë³„ ì„¤ì •
<Link to='/heavy-page' preload='intent' preloadDelay={100}>
  Heavy Page
</Link>
```

**ì™œ ì§€ì—°ì´ í•„ìš”í• ê¹Œ?**

ì‚¬ìš©ìê°€ ë§ˆìš°ìŠ¤ë¥¼ ë¹ ë¥´ê²Œ ì§€ë‚˜ê°€ë©´ì„œ ì—¬ëŸ¬ ë§í¬ ìœ„ë¥¼ ìŠ¤ì³ ì§€ë‚˜ê°ˆ ë•Œ,
ëª¨ë“  ë§í¬ì— ëŒ€í•´ í”„ë¦¬ë¡œë“œê°€ ë°œìƒí•˜ë©´ ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì´ ë§ì•„ì§„ë‹¤.
50-100ms ì •ë„ì˜ ì§€ì—°ì„ ë‘ë©´ ì‹¤ì œë¡œ ì‚¬ìš©ìê°€ ê´€ì‹¬ì„ ê°€ì§„ ë§í¬ë§Œ í”„ë¦¬ë¡œë“œëœë‹¤.

---

## Caching

TanStack RouterëŠ” ë‚´ì¥ ìºì‹±ì„ ì œê³µí•œë‹¤.
ë³„ë„ì˜ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ì´ë„ íš¨ìœ¨ì ì¸ ìºì‹±ì´ ê°€ëŠ¥í•˜ë‹¤.

### SWR (Stale-While-Revalidate) ìºì‹± ì „ëµ

TanStack Routerì˜ ìºì‹±ì€ **SWR (Stale-While-Revalidate)** íŒ¨í„´ì„ ë”°ë¥¸ë‹¤.

```
1. ì²« ë°©ë¬¸: loader ì‹¤í–‰ â†’ ë°ì´í„° ìºì‹œ ì €ì¥ â†’ í™”ë©´ í‘œì‹œ
2. ì¬ë°©ë¬¸ (staleTime ì´ë‚´): ìºì‹œëœ ë°ì´í„° ì¦‰ì‹œ í‘œì‹œ (loader ì‹¤í–‰ ì•ˆí•¨)
3. ì¬ë°©ë¬¸ (staleTime ì´í›„): ìºì‹œëœ ë°ì´í„° ë¨¼ì € í‘œì‹œ â†’ ë°±ê·¸ë¼ìš´ë“œì—ì„œ loader ì‹¤í–‰ â†’ ìƒˆ ë°ì´í„°ë¡œ ì—…ë°ì´íŠ¸
```

**í•µì‹¬ ê°œë…:**

- **Stale (ì˜¤ë˜ëœ)**: `staleTime`ì´ ì§€ë‚œ ë°ì´í„°
- **Fresh (ì‹ ì„ í•œ)**: `staleTime` ì´ë‚´ì˜ ë°ì´í„°

Fresh ë°ì´í„°ëŠ” ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ê³ , Stale ë°ì´í„°ëŠ” ì¼ë‹¨ ë³´ì—¬ì¤€ ë’¤ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ê°±ì‹ í•œë‹¤.

### staleTime, gcTime, preloadStaleTime

```tsx
export const Route = createFileRoute('/_authenticated/random-word')({
  validateSearch: zodValidator(searchSchema),
  loaderDeps: ({ search }) => ({ lang: search.lang }),

  // staleTime: ë°ì´í„°ê°€ "ì‹ ì„ "í•˜ë‹¤ê³  ê°„ì£¼ë˜ëŠ” ì‹œê°„
  // ì´ ì‹œê°„ ë™ì•ˆì€ ìºì‹œëœ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš© (ì¬ìš”ì²­ ì•ˆí•¨)
  staleTime: 30_000, // 30ì´ˆ // [!code highlight]

  // gcTime: ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— ë³´ê´€í•˜ëŠ” ì‹œê°„
  // ì´ì „ì—ëŠ” cacheTimeì´ë¼ê³  ë¶ˆë €ìŒ
  gcTime: 30 * 60 * 1000, // 30ë¶„ (ê¸°ë³¸ê°’) // [!code highlight]

  // preloadStaleTime: í”„ë¦¬ë¡œë“œëœ ë°ì´í„°ì˜ ì‹ ì„ ë„ ì‹œê°„
  // í”„ë¦¬ë¡œë“œ í›„ ì´ ì‹œê°„ì´ ì§€ë‚˜ë©´ ë‹¤ì‹œ í”„ë¦¬ë¡œë“œí•¨
  preloadStaleTime: 5_000, // 5ì´ˆ // [!code highlight]

  loader: async ({ deps }) => {
    await new Promise((r) => setTimeout(r, 3000)); // 3ì´ˆ ë”œë ˆì´
    const res = await fetch(`https://api.example.com/word?lang=${deps.lang}`);
    return res.json();
  },

  component: RandomWord,
});
```

**ìºì‹± ë™ì‘ ì˜ˆì‹œ:**

1. `/random-word?lang=en` ì²« ë°©ë¬¸ â†’ loader ì‹¤í–‰, ìºì‹œ ì €ì¥
2. 10ì´ˆ í›„ ê°™ì€ URL ë°©ë¬¸ â†’ ìºì‹œ ì‚¬ìš© (staleTime 30ì´ˆ ì´ë‚´)
3. 40ì´ˆ í›„ ê°™ì€ URL ë°©ë¬¸ â†’ ìºì‹œ í‘œì‹œ í›„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì¬ìš”ì²­
4. `/random-word?lang=fr` ë°©ë¬¸ â†’ ë‹¤ë¥¸ ìºì‹œ í‚¤, loader ì‹¤í–‰

### loaderDeps Creates Separate Cache

```tsx
loaderDeps: ({ search }) => ({ lang: search.lang }),
```

ì´ ì„¤ì •ì€ `lang` ê°’ë³„ë¡œ **ë³„ë„ì˜ ìºì‹œ**ë¥¼ ìƒì„±í•œë‹¤.

ìºì‹œê°€ ì–´ë–»ê²Œ ë¶„ë¦¬ë˜ëŠ”ì§€ ì‹œê°í™”í•˜ë©´ ì´ë ‡ë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TanStack Router Cache                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  /random-word?lang=en  â”€â”€â”€â”€â–º  ìºì‹œ A (ì˜ì–´ ë‹¨ì–´ë“¤)          â”‚
â”‚                                 â””â”€ "apple", "banana"...     â”‚
â”‚                                                             â”‚
â”‚  /random-word?lang=kr  â”€â”€â”€â”€â–º  ìºì‹œ B (í•œêµ­ì–´ ë‹¨ì–´ë“¤)        â”‚
â”‚                                 â””â”€ "ì‚¬ê³¼", "ë°”ë‚˜ë‚˜"...       â”‚
â”‚                                                             â”‚
â”‚  /random-word?lang=fr  â”€â”€â”€â”€â–º  ìºì‹œ C (í”„ë‘ìŠ¤ì–´ ë‹¨ì–´ë“¤)      â”‚
â”‚                                 â””â”€ "pomme", "banane"...     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ê° ì–¸ì–´ë³„ë¡œ ì™„ì „íˆ ë…ë¦½ëœ ìºì‹œê°€ ìƒê¸´ë‹¤. en ìºì‹œê°€ stale ë˜ì–´ë„ kr, fr ìºì‹œëŠ” ì˜í–¥ ì—†ê³ , ì–¸ì–´ ì „í™˜ ì‹œ í•´ë‹¹ ì–¸ì–´ ìºì‹œê°€ ìˆìœ¼ë©´ ì¦‰ì‹œ í‘œì‹œëœë‹¤.

**ì™œ loaderDepsê°€ í•„ìš”í• ê¹Œ?**

ë§Œì•½ `loaderDeps` ì—†ì´ search paramsë¥¼ ì‚¬ìš©í•˜ë©´, TanStack RouterëŠ” URL ê²½ë¡œ(`/random-word`)ë§Œìœ¼ë¡œ ìºì‹œ í‚¤ë¥¼ ë§Œë“ ë‹¤. ê·¸ëŸ¬ë©´ `?lang=en`ê³¼ `?lang=kr`ì´ ê°™ì€ ìºì‹œë¥¼ ê³µìœ í•˜ê²Œ ë˜ì–´ ì–¸ì–´ê°€ ë’¤ì„ì´ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤.

```tsx
// âŒ loaderDeps ì—†ì´ search params ì‚¬ìš© - ìºì‹œ ì¶©ëŒ!
loader: async ({ search }) => { // [!code --]
  // search.langì„ ì“°ì§€ë§Œ ìºì‹œ í‚¤ì—ëŠ” ë°˜ì˜ ì•ˆë¨ // [!code --]
} // [!code --]

// âœ… loaderDepsë¡œ ìºì‹œ í‚¤ ë¶„ë¦¬
loaderDeps: ({ search }) => ({ lang: search.lang }), // [!code ++]
loader: async ({ deps }) => { // [!code ++]
  // deps.langë³„ë¡œ ë³„ë„ ìºì‹œ // [!code ++]
} // [!code ++]
```

### Global Cache Configuration

```tsx
const router = createRouter({
  routeTree,
  defaultStaleTime: 1000 * 60, // 1ë¶„
  defaultGcTime: 1000 * 60 * 10, // 10ë¶„
  defaultPreloadStaleTime: 1000 * 30, // 30ì´ˆ
});
```

### shouldReload: ì»¤ìŠ¤í…€ ë¦¬ë¡œë“œ ë¡œì§

íŠ¹ì • ì¡°ê±´ì—ì„œë§Œ loaderë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ê³  ì‹¶ì„ ë•Œ `shouldReload` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œë‹¤.

```tsx
export const Route = createFileRoute('/dashboard')({
  loaderDeps: ({ search }) => ({ tab: search.tab }),

  // true ë°˜í™˜ ì‹œ loader ì¬ì‹¤í–‰, false ë°˜í™˜ ì‹œ ìºì‹œ ì‚¬ìš©
  shouldReload: ({ context, params, deps, prevDeps }) => {
    // ì˜ˆ: ì´ì „ íƒ­ê³¼ í˜„ì¬ íƒ­ì´ ê°™ìœ¼ë©´ ë¦¬ë¡œë“œ ì•ˆí•¨
    if (deps.tab === prevDeps?.tab) {
      return false;
    }

    // ì˜ˆ: íŠ¹ì • ì‚¬ìš©ìë§Œ í•­ìƒ ë¦¬ë¡œë“œ
    if (context.user?.role === 'admin') {
      return true;
    }

    // ê¸°ë³¸ ë™ì‘
    return true;
  },

  loader: async ({ deps }) => {
    return fetchDashboardData(deps.tab);
  },
});
```

**shouldReload ë§¤ê°œë³€ìˆ˜:**

- `context`: í˜„ì¬ ë¼ìš°í„° context
- `params`: í˜„ì¬ ë¼ìš°íŠ¸ íŒŒë¼ë¯¸í„°
- `deps`: í˜„ì¬ loaderDeps ê°’
- `prevDeps`: ì´ì „ loaderDeps ê°’

### Cache Invalidation

```tsx
import { useRouter } from '@tanstack/react-router';

function TodoEditor() {
  const router = useRouter();

  const handleSave = async (todoData: TodoData) => {
    await saveTodo(todoData);
    // ëª¨ë“  ë¼ìš°íŠ¸ì˜ ìºì‹œ ë¬´íš¨í™”, í˜„ì¬ ë¼ìš°íŠ¸ loader ì¬ì‹¤í–‰
    router.invalidate();
  };

  return <form>{/* ... */}</form>;
}
```

**invalidate() vs navigate():**

```tsx
// invalidate(): í˜„ì¬ URLì—ì„œ loader ì¬ì‹¤í–‰
router.invalidate(); // [!code highlight]

// navigate(): ìƒˆ URLë¡œ ì´ë™ (ìºì‹œ ì •ì±…ì— ë”°ë¼ loader ì‹¤í–‰)
navigate({ to: '/todos' }); // [!code highlight]
```

ë°ì´í„°ë¥¼ ìˆ˜ì •í•œ í›„ì—ëŠ” `router.invalidate()`ë¥¼ ì‚¬ìš©í•˜ì—¬ í˜„ì¬ í˜ì´ì§€ì˜ ë°ì´í„°ë¥¼ ê°±ì‹ í•œë‹¤.

---

## Protecting Routes

ì´ ì„¹ì…˜ì€ íŠ¹íˆ ì¤‘ìš”í•˜ë‹¤. ì˜ëª»ëœ ì¸ì¦ êµ¬í˜„ì€ ë³´ì•ˆ ì·¨ì•½ì ê³¼ ë¶ˆí•„ìš”í•œ API í˜¸ì¶œë¡œ ì´ì–´ì§„ë‹¤.

### beforeLoad â†’ loader â†’ component ì‹¤í–‰ ìˆœì„œ

TanStack Routerì˜ í•µì‹¬ ì„¤ê³„ ì¤‘ í•˜ë‚˜ë‹¤:

ì‹¤í–‰ íë¦„ì„ ì‹œê°í™”í•˜ë©´ ì´ë ‡ë‹¤:

```
                          ì •ìƒ íë¦„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ beforeLoad  â”‚ â”€â”€â–º â”‚  loader  â”‚ â”€â”€â–º â”‚  component  â”‚
â”‚ (ì¸ì¦ ì²´í¬)  â”‚     â”‚ (ë°ì´í„°)  â”‚     â”‚   (í™”ë©´)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ ì¸ì¦ ì‹¤íŒ¨ ì‹œ
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ì—¬ê¸°ì„œ ì¤‘ë‹¨!                        â”‚
â”‚                                                 â”‚
â”‚   - loader ì‹¤í–‰ ì•ˆë¨ â†’ API í˜¸ì¶œ ì—†ìŒ            â”‚
â”‚   - component ë Œë”ë§ ì•ˆë¨                       â”‚
â”‚   - redirect ë˜ëŠ” errorComponent í‘œì‹œ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

`beforeLoad`ì—ì„œ ì—ëŸ¬ë‚˜ ë¦¬ë‹¤ì´ë ‰íŠ¸ê°€ ë°œìƒí•˜ë©´, ê·¸ ìˆœê°„ **ë¼ìš°íŠ¸ ì§„ì…ì´ ì¤‘ë‹¨**ëœë‹¤. `loader`ëŠ” ì ˆëŒ€ ì‹¤í–‰ë˜ì§€ ì•Šê³ , ë‹¹ì—°íˆ `component`ë„ ë Œë”ë§ë˜ì§€ ì•ŠëŠ”ë‹¤. ì´ ìˆœì„œê°€ ë³´ì¥ë˜ê¸° ë•Œë¬¸ì— ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì˜ API í˜¸ì¶œì„ ì›ì²œ ì°¨ë‹¨í•  ìˆ˜ ìˆë‹¤.

**ì´ ìˆœì„œê°€ ì¤‘ìš”í•œ ì´ìœ :**

`beforeLoad`ì—ì„œ ì¸ì¦ ì²´í¬ë¥¼ í•˜ë©´, ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” **loaderê°€ ì ˆëŒ€ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤**.
ì´ëŠ” ë¶ˆí•„ìš”í•œ API í˜¸ì¶œì„ ë°©ì§€í•˜ê³  ë³´ì•ˆì„ ê°•í™”í•œë‹¤.

```
1. beforeLoad ì‹¤í–‰ (ëª¨ë“  ë¼ìš°íŠ¸, ë¶€ëª¨ â†’ ìì‹ ìˆœì„œ)
   â†“ ì—ëŸ¬/ë¦¬ë‹¤ì´ë ‰íŠ¸ ë°œìƒ ì‹œ ì—¬ê¸°ì„œ ì¤‘ë‹¨
2. loader ì‹¤í–‰ (ë³‘ë ¬ë¡œ ì‹¤í–‰ ê°€ëŠ¥)
   â†“ ì—ëŸ¬ ë°œìƒ ì‹œ ì—¬ê¸°ì„œ ì¤‘ë‹¨
3. component ë Œë”ë§
```

### Router Contextë¡œ ì¸ì¦ ìƒíƒœ ê´€ë¦¬

ê·¸ëŸ°ë° `beforeLoad`ë‚˜ `loader`ì—ì„œ ì¸ì¦ ìƒíƒœ(`user`)ë¥¼ ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆì„ê¹Œ?

TanStack RouterëŠ” **Router Context**ë¥¼ í†µí•´ ëª¨ë“  ë¼ìš°íŠ¸ì—ì„œ ê³µìœ  ìƒíƒœì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.
ì¸ì¦ ì •ë³´ì²˜ëŸ¼ ì•± ì „ì—­ì—ì„œ í•„ìš”í•œ ë°ì´í„°ë¥¼ ë¼ìš°íŠ¸ì— ì „ë‹¬í•˜ëŠ” í‘œì¤€ ë°©ë²•ì´ë‹¤.

Router Context ì„¤ì •ì€ 3ë‹¨ê³„ë¡œ ì§„í–‰ëœë‹¤:

1. **Context íƒ€ì… ì •ì˜** - ì–´ë–¤ ë°ì´í„°ë¥¼ ê³µìœ í• ì§€ ì •ì˜
2. **createRootRouteWithContextë¡œ Root Route ìƒì„±** - íƒ€ì…ì„ ì ìš©í•œ Root Route
3. **RouterProviderì— ì‹¤ì œ ê°’ ì „ë‹¬** - ëŸ°íƒ€ì„ì— ì‹¤ì œ ë°ì´í„° ì£¼ì…

#### Step 1 & 2: Context íƒ€ì… ì •ì˜ + Root Route ìƒì„±

ë¨¼ì € Contextì˜ íƒ€ì…ì„ ì •ì˜í•˜ê³ , `createRootRouteWithContext`ë¥¼ ì‚¬ìš©í•´ Root Routeë¥¼ ìƒì„±í•œë‹¤:

```tsx
// __root.tsx
import {
  createRootRouteWithContext,
  Link,
  Outlet,
} from '@tanstack/react-router';
import { TanStackRouterDevtools } from '@tanstack/router-devtools';

// Context íƒ€ì… ì •ì˜
interface RootRouteContext {
  user: User | undefined;
  login: (user: User) => void;
  logout: () => void;
}

// createRootRouteWithContextë¡œ Root Route ìƒì„±
export const Route = createRootRouteWithContext<RootRouteContext>()({
  // [!code highlight]
  component: RootComponent,
  notFoundComponent: () => <div>í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>,
});

function RootComponent() {
  const { user, logout } = Route.useRouteContext();

  return (
    <div>
      <nav>
        <Link to='/' activeProps={{ className: 'font-bold' }}>
          í™ˆ
        </Link>
        <Link to='/dashboard' activeProps={{ className: 'font-bold' }}>
          ëŒ€ì‹œë³´ë“œ
        </Link>
        {user ? (
          <button onClick={logout}>ë¡œê·¸ì•„ì›ƒ ({user.name})</button>
        ) : (
          <Link to='/login'>ë¡œê·¸ì¸</Link>
        )}
      </nav>
      <main>
        <Outlet />
      </main>
      <TanStackRouterDevtools position='bottom-right' />
    </div>
  );
}
```

#### Step 3: RouterProviderì— ì‹¤ì œ ê°’ ì „ë‹¬

`main.tsx`ì—ì„œ ì‹¤ì œ ì¸ì¦ ìƒíƒœë¥¼ Contextë¡œ ì „ë‹¬í•œë‹¤:

```tsx
// main.tsx
import { useState } from 'react';
import ReactDOM from 'react-dom/client';
import { RouterProvider, createRouter } from '@tanstack/react-router';
import { routeTree } from './routeTree.gen';

const router = createRouter({
  routeTree,
  defaultPreload: 'intent',
  context: {
    user: undefined,
    login: () => {},
    logout: () => {},
  },
});

function App() {
  const [user, setUser] = useState<User | undefined>(undefined);

  const login = (newUser: User) => setUser(newUser);
  const logout = () => setUser(undefined);

  return (
    <RouterProvider
      router={router}
      context={{
        user,
        login,
        logout,
      }}
    />
  );
}

ReactDOM.createRoot(document.getElementById('root')!).render(<App />);
```

ì´ì œ ëª¨ë“  ë¼ìš°íŠ¸ì—ì„œ `context.user`ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

### Problem: Checking Auth in Component

ë¨¼ì € ì˜ëª»ëœ íŒ¨í„´ì„ ì‚´í´ë³´ì.

```tsx
// âŒ ì˜ëª»ëœ íŒ¨í„´
export const Route = createFileRoute('/dashboard')({
  loader: async () => {
    const data = await fetchDashboardData(); // [!code highlight]
    return data; // ì¸ì¦ ì•ˆëœ ì‚¬ìš©ìë„ API í˜¸ì¶œë¨!
  },
  component: Dashboard,
});

function Dashboard() {
  const { user } = Route.useRouteContext();

  if (!user) {
    // [!code highlight]
    return <div>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</div>; // ì´ë¯¸ loaderëŠ” ì‹¤í–‰ëœ í›„!
  }

  const data = Route.useLoaderData();
  return <DashboardContent data={data} />;
}
```

**ë¬¸ì œì :**

- ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìë„ `loader`ê°€ ì‹¤í–‰ë¨
- ë¶ˆí•„ìš”í•œ API í˜¸ì¶œ ë°œìƒ (ë³´í˜¸ëœ ë°ì´í„°ì¸ë°!)
- ì„œë²„ ìì› ë‚­ë¹„
- ì ì¬ì  ë³´ì•ˆ ìœ„í—˜

### Solution 1: beforeLoad with throw Error

```tsx
// âœ… ì˜¬ë°”ë¥¸ íŒ¨í„´ - ì—ëŸ¬ ë°œìƒ
export const Route = createFileRoute('/dashboard')({
  beforeLoad: ({ context }) => {
    // [!code ++]
    if (!context.user) {
      // [!code ++]
      throw new Error('Unauthorized'); // [!code ++]
    } // [!code ++]
  }, // [!code ++]

  // beforeLoad ì„±ê³µ í›„ì—ë§Œ ì‹¤í–‰ë¨
  loader: async ({ context }) => {
    return fetchDashboardData(context.user.id);
  },

  errorComponent: () => <div>Unauthorized</div>,

  component: Dashboard,
});
```

### Solution 2: beforeLoad with redirect

```tsx
// âœ… ì˜¬ë°”ë¥¸ íŒ¨í„´ - ë¦¬ë‹¤ì´ë ‰íŠ¸
import { createFileRoute, redirect } from '@tanstack/react-router';

export const Route = createFileRoute('/dashboard')({
  beforeLoad: ({ context, location }) => {
    // [!code ++]
    if (!context.user) {
      // [!code ++]
      throw redirect({
        // [!code ++]
        to: '/login', // [!code ++]
        search: {
          // [!code ++]
          redirect: location.pathname, // ë¡œê·¸ì¸ í›„ ëŒì•„ì˜¬ ê²½ë¡œ ì €ì¥ // [!code ++]
        }, // [!code ++]
      }); // [!code ++]
    } // [!code ++]
  }, // [!code ++]

  loader: async ({ context }) => {
    return fetchDashboardData(context.user.id);
  },

  component: Dashboard,
});
```

### Pathless Layout for Multiple Routes

ì—¬ëŸ¬ ë¼ìš°íŠ¸ì— ë™ì¼í•œ ì¸ì¦ ë¡œì§ì„ ì ìš©í•˜ë ¤ë©´ Pathless Layoutì„ ì‚¬ìš©í•œë‹¤.

```tsx
// _authenticated.tsx - URLì— ë‚˜íƒ€ë‚˜ì§€ ì•ŠëŠ” ë ˆì´ì•„ì›ƒ
import { createFileRoute, Outlet, redirect } from '@tanstack/react-router';

export const Route = createFileRoute('/_authenticated')({
  beforeLoad: ({ context }) => {
    if (!context.user) {
      throw new Error('Unauthorized');
    }
  },
  errorComponent: () => <div>Unauthorized</div>,
  component: AuthenticatedLayout,
});

function AuthenticatedLayout() {
  const { user } = Route.useRouteContext();

  // beforeLoadì—ì„œ ì´ë¯¸ ì²´í¬í–ˆì§€ë§Œ, íƒ€ì… narrowingì„ ìœ„í•´
  if (!user) {
    return <div>Please Login to access this content</div>;
  }

  return <Outlet />;
}
```

```tsx
// _authenticated.dashboard.tsx â†’ URL: /dashboard
export const Route = createFileRoute('/_authenticated/dashboard')({
  loader: async ({ context }) => {
    return fetchDashboardData();
  },
  component: Dashboard,
});
```

```tsx
// _authenticated.settings.tsx â†’ URL: /settings
export const Route = createFileRoute('/_authenticated/settings')({
  loader: async ({ context }) => {
    return fetchUserSettings();
  },
  component: Settings,
});
```

**ì‹¤í–‰ ìˆœì„œ ìƒì„¸:**

```
/dashboard ì ‘ê·¼ ì‹œ:

1. __root.tsxì˜ beforeLoad ì‹¤í–‰
2. _authenticated.tsxì˜ beforeLoad ì‹¤í–‰
   â†’ ì—¬ê¸°ì„œ context.user í™•ì¸
   â†’ userê°€ ì—†ìœ¼ë©´ Error ë°œìƒ, ì—¬ê¸°ì„œ ì¤‘ë‹¨!
   â†’ errorComponent ë Œë”ë§
3. _authenticated.dashboard.tsxì˜ beforeLoad ì‹¤í–‰ (ìˆë‹¤ë©´)
4. _authenticated.dashboard.tsxì˜ loader ì‹¤í–‰
   â†’ ì´ ì‹œì ì—ì„œëŠ” userê°€ ë°˜ë“œì‹œ ì¡´ì¬
5. ëª¨ë“  ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ (ë¶€ëª¨ â†’ ìì‹ ìˆœì„œ)
```

**í•µì‹¬ í¬ì¸íŠ¸:**

- `beforeLoad`ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ **í•˜ìœ„ ë¼ìš°íŠ¸ì˜ loaderëŠ” ì ˆëŒ€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ**
- ì´ ë•ë¶„ì— ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì˜ API í˜¸ì¶œì„ ì›ì²œ ì°¨ë‹¨
- Pathless Layoutì„ ì‚¬ìš©í•˜ë©´ ì¸ì¦ ë¡œì§ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬ ê°€ëŠ¥

### ë¡œê·¸ì¸ í›„ ìƒíƒœ ë°˜ì˜í•˜ê¸°

ë¡œê·¸ì¸ì„ í–ˆëŠ”ë° í™”ë©´ì´ ë°”ë¡œ ì•ˆ ë°”ë€ŒëŠ” ê²½í—˜ì„ í•´ë³¸ ì ì´ ìˆëŠ”ê°€?

`RouterProvider`ì— ì „ë‹¬í•œ contextëŠ” React ìƒíƒœë‹¤.
ìƒíƒœê°€ ë°”ë€Œë©´ ë¼ìš°í„°ê°€ ë‹¤ì‹œ ë Œë”ë§ë˜ì§€ë§Œ, **ì´ë¯¸ ì‹¤í–‰ëœ `beforeLoad`ì™€ `loader`ëŠ” ìë™ìœ¼ë¡œ ë‹¤ì‹œ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤**.

```tsx
// login.tsx
function LoginPage() {
  const { login } = Route.useRouteContext();
  const navigate = useNavigate();

  const handleLogin = async () => {
    const user = await authenticateUser();
    login(user); // ìƒíƒœëŠ” ë°”ë€Œì§€ë§Œ... // [!code highlight]
    navigate({ to: '/dashboard' }); // beforeLoadê°€ ìƒˆ userë¥¼ ëª» ë³¼ ìˆ˜ë„ ìˆë‹¤! // [!code highlight]
  };

  return <button onClick={handleLogin}>ë¡œê·¸ì¸</button>;
}
```

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ë©´ `flushSync`ì™€ `router.invalidate()`ë¥¼ í•¨ê»˜ ì‚¬ìš©í•œë‹¤:

```tsx
import { flushSync } from 'react-dom';
import { useRouter } from '@tanstack/react-router';

function LoginPage() {
  const { login } = Route.useRouteContext();
  const router = useRouter();
  const navigate = useNavigate();

  const handleLogin = async () => {
    const user = await authenticateUser();

    // flushSyncë¡œ ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬
    flushSync(() => {
      // [!code highlight]
      login(user); // [!code highlight]
    }); // [!code highlight]

    // ë¼ìš°í„° ìºì‹œ ë¬´íš¨í™” - ìƒˆ contextë¡œ beforeLoad/loader ì¬ì‹¤í–‰
    await router.invalidate(); // [!code highlight]

    // ì´ì œ ì•ˆì „í•˜ê²Œ ì´ë™
    navigate({ to: '/dashboard' }); // [!code highlight]
  };

  return <button onClick={handleLogin}>ë¡œê·¸ì¸</button>;
}
```

**ì™œ ì´ë ‡ê²Œ í•´ì•¼ í• ê¹Œ?**

- `flushSync`: Reactì˜ ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ ì¦‰ì‹œ DOMì— ë°˜ì˜í•œë‹¤ (ë°°ì¹­ ì—†ì´)
- `router.invalidate()`: ë¼ìš°í„°ì˜ ìºì‹œë¥¼ ë¬´íš¨í™”í•˜ê³ , ìƒˆ contextë¡œ `beforeLoad`ì™€ `loader`ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•œë‹¤

ì£¼ì˜í•  ì ì´ ìˆë‹¤. `flushSync`ëŠ” ì„±ëŠ¥ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê¼­ í•„ìš”í•œ ê²½ìš°ì—ë§Œ ì‚¬ìš©í•´ì•¼ í•œë‹¤. ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒì²˜ëŸ¼ ì¸ì¦ ìƒíƒœê°€ ë°”ë€ŒëŠ” ìˆœê°„ì— ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì ì ˆí•˜ë‹¤.

ë˜ í•˜ë‚˜ ì£¼ì˜í•  ì ì€, `router.invalidate()`ë¥¼ í˜¸ì¶œí•˜ë©´ í˜„ì¬ ë¼ìš°íŠ¸ì˜ `loader`ë„ ë‹¤ì‹œ ì‹¤í–‰ëœë‹¤ëŠ” ê²ƒì´ë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ í˜¸ì¶œí•  ê²½ìš°, ë¡œê·¸ì¸ í˜ì´ì§€ì˜ loaderê°€ ìˆë‹¤ë©´ ë¶ˆí•„ìš”í•˜ê²Œ ì¬ì‹¤í–‰ë  ìˆ˜ ìˆë‹¤.

### Layout Escape with Underscore Suffix

íŠ¹ì • ë¼ìš°íŠ¸ì—ì„œ ë¶€ëª¨ ë ˆì´ì•„ì›ƒì„ ë²—ì–´ë‚˜ê³  ì‹¶ì„ ë•Œ íŒŒì¼ëª… ëì— `_`ë¥¼ ë¶™ì¸ë‹¤.

```
ğŸ“¦ routes
 â”£ ğŸ“œ posts.tsx                # /posts ë ˆì´ì•„ì›ƒ
 â”£ ğŸ“œ posts.index.tsx          # /posts (ë ˆì´ì•„ì›ƒ ì ìš©ë¨)
 â”£ ğŸ“œ posts.$postId.tsx        # /posts/:postId (ë ˆì´ì•„ì›ƒ ì ìš©ë¨)
 â”— ğŸ“œ posts_.$postId.edit.tsx  # /posts/:postId/edit (ë ˆì´ì•„ì›ƒ íƒˆì¶œ!)
```

```tsx
// posts_.$postId.edit.tsx
import { createFileRoute, useNavigate } from '@tanstack/react-router';

export const Route = createFileRoute('/posts_/$postId/edit')({
  component: PostEditFullScreen,
});

function PostEditFullScreen() {
  const { postId } = Route.useParams();
  const navigate = useNavigate({ from: Route.fullPath });

  const handleCancel = () => {
    navigate({ to: '..' }); // ìƒëŒ€ ê²½ë¡œë¡œ ë’¤ë¡œê°€ê¸°
  };

  return (
    <div>
      <h1>ê²Œì‹œê¸€ ìˆ˜ì • (ì „ì²´ í™”ë©´)</h1>
      <p>ID: {postId}</p>
      <button onClick={handleCancel}>ì·¨ì†Œ</button>
    </div>
  );
}
```

`posts_`ì˜ `_`ê°€ ì ‘ë¯¸ì‚¬ë¡œ ë¶™ì–´ì„œ, `/posts/:postId/edit`ëŠ” `posts.tsx` ë ˆì´ì•„ì›ƒì„ ê±°ì¹˜ì§€ ì•ŠëŠ”ë‹¤.

### Login Route with Redirect

```tsx
// login.tsx
import { createFileRoute, redirect } from '@tanstack/react-router';
import { z } from 'zod';
import { zodValidator } from '@tanstack/zod-adapter';

const loginSearchParamsSchema = z.object({
  redirect: z.string().optional(),
});

export const Route = createFileRoute('/login')({
  validateSearch: zodValidator(loginSearchParamsSchema),
  beforeLoad: ({ context, search }) => {
    // ì´ë¯¸ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìëŠ” ë¦¬ë‹¤ì´ë ‰íŠ¸
    if (context.user) {
      throw redirect({
        to: search.redirect || '/',
      });
    }
  },
  component: LoginPage,
});

function LoginPage() {
  const { login } = Route.useRouteContext();
  const { redirect: redirectUrl } = Route.useSearch();
  const navigate = Route.useNavigate();

  const handleLogin = () => {
    login({ id: '1', name: 'John' });
    navigate({ to: redirectUrl || '/' });
  };

  return (
    <div>
      <h1>ë¡œê·¸ì¸</h1>
      <button onClick={handleLogin}>ë¡œê·¸ì¸</button>
    </div>
  );
}
```

### Auth Pattern Summary

ì¸ì¦ íŒ¨í„´ë³„ ì°¨ì´ë¥¼ ì •ë¦¬í•˜ë©´ ì´ë ‡ë‹¤:

- **`beforeLoad` + throw error**: loaderê°€ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤. ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•  ë•Œ ì‚¬ìš©í•œë‹¤.
- **`beforeLoad` + redirect**: loaderê°€ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•  ë•Œ ì‚¬ìš©í•œë‹¤.
- **ì»´í¬ë„ŒíŠ¸ì—ì„œ ì²´í¬**: loaderê°€ ì‹¤í–‰ëœë‹¤. ë¶ˆí•„ìš”í•œ API í˜¸ì¶œì´ ë°œìƒí•˜ë¯€ë¡œ ê¶Œì¥í•˜ì§€ ì•ŠëŠ”ë‹¤.

**ê²°ë¡ : í•­ìƒ `beforeLoad`ì—ì„œ ì¸ì¦ì„ ì²´í¬í•˜ì.**

---

## í•µì‹¬ ì •ë¦¬

`TanStack Router`ë¥¼ í”„ë¡œë•ì…˜ì— ë„ì…í•˜ë©´ì„œ â€œë¼ìš°íŒ…â€ì´ ìƒê°ë³´ë‹¤ DXì— í° ì˜í–¥ì„ ì¤€ë‹¤ëŠ” ê±¸ ì²˜ìŒ ì²´ê°í–ˆë‹¤.

`react-router-dom`ì—ì„œë„ `nuqs` ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë³´ì™„í•  ìˆ˜ëŠ” ìˆì§€ë§Œ, `TanStack Router`ëŠ” **ë¼ìš°íŠ¸/íŒŒë¼ë¯¸í„°/search paramsê¹Œì§€ í•œ ë²ˆì— íƒ€ì…ìœ¼ë¡œ ë¬¶ì—¬ì„œ** ì½”ë“œê°€ í›¨ì”¬ ê¹”ë”í•´ì¡Œë‹¤.

ê·¸ë¦¬ê³  `TanStack Query`ë¥¼ ì¨ë³¸ ì‚¬ëŒì´ â€œì•„, ì´ê±° í¸í•˜ë‹¤â€ë¥¼ ëŠë¼ë“¯ì´, `TanStack Router`ë„ ê·¸ ì´ìƒì˜ ë§Œì¡±ê°ì„ ì¤¬ë‹¤.

ë¼ìš°íŒ…ì„ ë‹¨ìˆœíˆ â€œì´ë™â€ìœ¼ë¡œë§Œ ë³´ì§€ ì•Šê³ , **í”„ë¦¬ë¡œë“œ/ìºì‹±/ê°€ë“œ** ê°™ì€ ê²ƒë“¤ì„ ì‰½ê²Œ ë¶™ì´ë‹ˆê¹Œ â€œìœ ì € ê²½í—˜â€ì„ ì±™ê¸¸ ì—¬ìœ ê°€ ìƒê²¼ë‹¤.

ë¬´ì—‡ë³´ë‹¤ **ê³µì‹ ë¬¸ì„œ**ê°€ â€œì´ ê¸°ëŠ¥ì´ ìˆë‹¤â€ì—ì„œ ëë‚˜ì§€ ì•Šê³ , â€œë¼ìš°íŒ… ê´€ì ì—ì„œ UXë¥¼ ì–´ë–»ê²Œ ì„¤ê³„í• ì§€â€ë¥¼ ê³„ì† ë– ì˜¬ë¦¬ê²Œ í•´ì¤˜ì„œ ì¢‹ì•˜ë‹¤.

---

## References

### Official Documentation

- [TanStack Router ê³µì‹ ë¬¸ì„œ](https://tanstack.com/router/latest)
- [GitHub ì €ì¥ì†Œ](https://github.com/TanStack/router)

### Key Guides

- [File-Based Routing Guide](https://tanstack.com/router/latest/docs/framework/react/guide/file-based-routing)
- [Search Params Guide](https://tanstack.com/router/latest/docs/framework/react/guide/search-params)
- [Data Loading Guide](https://tanstack.com/router/latest/docs/framework/react/guide/data-loading)
- [Authenticated Routes Guide](https://tanstack.com/router/latest/docs/framework/react/guide/authenticated-routes)
- [Code Splitting Guide](https://tanstack.com/router/latest/docs/framework/react/guide/code-splitting)

### API Reference

- [Route Options API](https://tanstack.com/router/latest/docs/framework/react/api/router/RouteOptionsType)
- [Link Component API](https://tanstack.com/router/latest/docs/framework/react/api/router/LinkPropsType)
- [Router API](https://tanstack.com/router/latest/docs/framework/react/api/router/RouterType)

### Related Libraries

- [TanStack Query](https://tanstack.com/query/latest) - ì„œë²„ ìƒíƒœ ê´€ë¦¬
- [Zod](https://zod.dev/) - ìŠ¤í‚¤ë§ˆ ê²€ì¦ (Search Paramsì— ì‚¬ìš©)
- [@tanstack/zod-adapter](https://tanstack.com/router/latest/docs/framework/react/guide/search-params#zod) - Zod ìŠ¤í‚¤ë§ˆ ì–´ëŒ‘í„°
